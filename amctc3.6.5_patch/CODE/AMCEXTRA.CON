

defstate lowperf 
ife INVASION 1 killit
else ife PERFMODE 0 killit
else 
	{
	ifmultiplayer nullop
	else
	ifl framerate 10 killit 
	}
ends

action FORM 0
action FORMED 0
action UNFORM 0

defstate setknockback // Player knockback
getp[].posx mx
getp[].posy my
geta[].x x
geta[].y y
sub mx x
sub my y
getangle knockbackang mx my
set knockback 3
ends

// PROJECTILE FLAGS
// 1 = Energy attack
// 2 = Fire attack
// 4 = Ice attack
// 8 = Slashing attack
// 16 = Magic/Laser attack (Ignores supernatural defenses)
// 32 = Armour piercing attack (Double damage to armour)
// 64 = Armour negating attack (normal damage to armour)
// 80 = Golden shot (Ignores all defenses)
// 128 = Soft attack (Does minimal damage against armour)
// 256 = Silver attack (Double damage to Supernatural)
// 512 = Double armour attack (Triple damage to armour)
// 1024 = Double Silver attack (Triple damage to Supernatural)
// 2048 = Body-armour piercing (Ignores body armour, reduced against proper armour)
// 4096 = Homing attack
// 8192 = Electrical attack
// 16384 = Spirit Attack
// 32768 = Draining attack
// 65536 = Nuclear Attack (bypasses all protections)
// 131072 = melee attack
// 262144 = Curse attack
// 524288 = blind attack

// DEBRIS

spriteflags SPARK SFLAG_NOCLIP
spriteflags SPARK2 SFLAG_NOCLIP

defineprojectile SPARK PROJ_WORKSLIKE 2103430
defineprojectile SPARK PROJ_HITRADIUS 0
defineprojectile SPARK PROJ_VEL 150
defineprojectile SPARK PROJ_DROP -200
defineprojectile SPARK PROJ_BOUNCES 1
defineprojectile SPARK PROJ_BSOUND 4
defineprojectile SPARK PROJ_ISOUND 4
defineprojectile SPARK PROJ_XREPEAT 2
defineprojectile SPARK PROJ_YREPEAT 2
defineprojectile SPARK PROJ_EXTRA 0
defineprojectile SPARK PROJ_SPAWNS -1

defineprojectile SPARK2 PROJ_WORKSLIKE 2103430
defineprojectile SPARK2 PROJ_HITRADIUS 0
defineprojectile SPARK2 PROJ_VEL 150
defineprojectile SPARK2 PROJ_DROP -200
defineprojectile SPARK2 PROJ_BOUNCES 1
defineprojectile SPARK2 PROJ_BSOUND 4
defineprojectile SPARK2 PROJ_ISOUND 4
defineprojectile SPARK2 PROJ_XREPEAT 2
defineprojectile SPARK2 PROJ_YREPEAT 2
defineprojectile SPARK2 PROJ_EXTRA 0
defineprojectile SPARK2 PROJ_SPAWNS -1

defineprojectile SLIMEPROJ PROJ_WORKSLIKE 2103430
defineprojectile SLIMEPROJ PROJ_HITRADIUS 0
defineprojectile SLIMEPROJ PROJ_VEL 80
defineprojectile SLIMEPROJ PROJ_DROP -50
defineprojectile SLIMEPROJ PROJ_BOUNCES 1
defineprojectile SLIMEPROJ PROJ_BSOUND 4
defineprojectile SLIMEPROJ PROJ_ISOUND SLIME_IMPACT
defineprojectile SLIMEPROJ PROJ_XREPEAT 24
defineprojectile SLIMEPROJ PROJ_YREPEAT 24
defineprojectile SLIMEPROJ PROJ_EXTRA 0
defineprojectile SLIMEPROJ PROJ_SPAWNS SLIMEPUDDLE 

defineprojectile WOODSCRAP PROJ_WORKSLIKE 2103430
defineprojectile WOODSCRAP PROJ_HITRADIUS 0
defineprojectile WOODSCRAP PROJ_VEL 140
defineprojectile WOODSCRAP PROJ_DROP -140
defineprojectile WOODSCRAP PROJ_BOUNCES 0
defineprojectile WOODSCRAP PROJ_BSOUND WOOD_IMPACT
defineprojectile WOODSCRAP PROJ_XREPEAT 12
defineprojectile WOODSCRAP PROJ_YREPEAT 12
defineprojectile WOODSCRAP PROJ_EXTRA 0
defineprojectile WOODSCRAP PROJ_SPAWNS -1

defineprojectile SWOODSCRAP PROJ_WORKSLIKE 2103430
defineprojectile SWOODSCRAP PROJ_HITRADIUS 0
defineprojectile SWOODSCRAP PROJ_VEL 140
defineprojectile SWOODSCRAP PROJ_DROP -140
defineprojectile SWOODSCRAP PROJ_BOUNCES -1
defineprojectile SWOODSCRAP PROJ_BSOUND 4
defineprojectile SWOODSCRAP PROJ_XREPEAT 6
defineprojectile SWOODSCRAP PROJ_YREPEAT 6
defineprojectile SWOODSCRAP PROJ_EXTRA 0
defineprojectile SWOODSCRAP PROJ_SPAWNS -1

defineprojectile ICE_DEBRIS PROJ_WORKSLIKE 2103430
defineprojectile ICE_DEBRIS PROJ_HITRADIUS 0
defineprojectile ICE_DEBRIS PROJ_VEL 180
defineprojectile ICE_DEBRIS PROJ_DROP -200
defineprojectile ICE_DEBRIS PROJ_BOUNCES 0
defineprojectile ICE_DEBRIS PROJ_BSOUND ICE_BOUNCE
defineprojectile ICE_DEBRIS PROJ_XREPEAT 16
defineprojectile ICE_DEBRIS PROJ_YREPEAT 16
defineprojectile ICE_DEBRIS PROJ_EXTRA 0
defineprojectile ICE_DEBRIS PROJ_SPAWNS ICE_DEBRIS_F

// Ogre's bouncing mace
defineprojectile 12704 PROJ_WORKSLIKE 2103430
defineprojectile 12704 PROJ_HITRADIUS 0
defineprojectile 12704 PROJ_VEL 180
defineprojectile 12704 PROJ_DROP -200
defineprojectile 12704 PROJ_BOUNCES 0
defineprojectile 12704 PROJ_BSOUND PIPEBOMB_BOUNCE
defineprojectile 12704 PROJ_XREPEAT 20
defineprojectile 12704 PROJ_YREPEAT 20
defineprojectile 12704 PROJ_EXTRA 0
defineprojectile 12704 PROJ_SPAWNS 12711

// Ogre's bouncing shield
defineprojectile 12695 PROJ_WORKSLIKE 2103430
defineprojectile 12695 PROJ_HITRADIUS 0
defineprojectile 12695 PROJ_VEL 180
defineprojectile 12695 PROJ_DROP -240
defineprojectile 12695 PROJ_BOUNCES 0
defineprojectile 12695 PROJ_BSOUND ENDSEQVOL2SND4
defineprojectile 12695 PROJ_XREPEAT 20
defineprojectile 12695 PROJ_YREPEAT 20
defineprojectile 12695 PROJ_EXTRA 0
defineprojectile 12695 PROJ_SPAWNS 12703

// Heavy powersuit leg

spriteshadow 19177
spriteshadow 19176

defineprojectile 19177 PROJ_WORKSLIKE 2103430
defineprojectile 19177 PROJ_HITRADIUS 0
defineprojectile 19177 PROJ_VEL 180
defineprojectile 19177 PROJ_DROP -300
defineprojectile 19177 PROJ_BOUNCES 0
defineprojectile 19177 PROJ_BSOUND CYBERDEMON_METAL
defineprojectile 19177 PROJ_XREPEAT 50
defineprojectile 19177 PROJ_YREPEAT 50
defineprojectile 19177 PROJ_EXTRA 0
defineprojectile 19177 PROJ_TRAIL SMALLSMOKE
defineprojectile 19177 PROJ_SPAWNS 19176

spriteshadow 19171
spriteshadow 19172

defineprojectile 19172 PROJ_WORKSLIKE 2103430
defineprojectile 19172 PROJ_HITRADIUS 0
defineprojectile 19172 PROJ_VEL 180
defineprojectile 19172 PROJ_DROP -300
defineprojectile 19172 PROJ_BOUNCES 0
defineprojectile 19172 PROJ_BSOUND CYBERDEMON_METAL
defineprojectile 19172 PROJ_XREPEAT 50
defineprojectile 19172 PROJ_YREPEAT 50
defineprojectile 19172 PROJ_EXTRA 0
defineprojectile 19172 PROJ_TRAIL SMALLSMOKE
defineprojectile 19172 PROJ_SPAWNS 19171

defineprojectile ROCKDEB1 PROJ_WORKSLIKE 2103430
defineprojectile ROCKDEB1 PROJ_HITRADIUS 0
defineprojectile ROCKDEB1 PROJ_VEL 180
defineprojectile ROCKDEB1 PROJ_DROP -200
defineprojectile ROCKDEB1 PROJ_BOUNCES 0
defineprojectile ROCKDEB1 PROJ_BSOUND ROCK_IMPACT
defineprojectile ROCKDEB1 PROJ_XREPEAT 32
defineprojectile ROCKDEB1 PROJ_YREPEAT 32
defineprojectile ROCKDEB1 PROJ_EXTRA 0
defineprojectile ROCKDEB1 PROJ_SPAWNS ROCKDEB1F 

defineprojectile ROCKDEB2 PROJ_WORKSLIKE 2054
defineprojectile ROCKDEB2 PROJ_HITRADIUS 128
defineprojectile ROCKDEB2 PROJ_VEL 180
defineprojectile ROCKDEB2 PROJ_DROP -200
defineprojectile ROCKDEB2 PROJ_BOUNCES 0
defineprojectile ROCKDEB2 PROJ_BSOUND ROCK_IMPACT
defineprojectile ROCKDEB2 PROJ_XREPEAT 10
defineprojectile ROCKDEB2 PROJ_YREPEAT 10
defineprojectile ROCKDEB2 PROJ_EXTRA 30
defineprojectile ROCKDEB2 PROJ_EXTRA_RAND 30
defineprojectile ROCKDEB2 PROJ_SPAWNS LAVASPLASH
defineprojectile ROCKDEB2 PROJ_ISOUND BRUISER_FLAME

defineprojectile 9115 PROJ_WORKSLIKE 6278
defineprojectile 9115 PROJ_HITRADIUS 128
defineprojectile 9115 PROJ_VEL 980
defineprojectile 9115 PROJ_DROP -120
defineprojectile 9115 PROJ_BOUNCES 0
defineprojectile 9115 PROJ_BSOUND ROCK_IMPACT
defineprojectile 9115 PROJ_XREPEAT 10
defineprojectile 9115 PROJ_YREPEAT 10
defineprojectile 9115 PROJ_EXTRA 60
defineprojectile 9115 PROJ_EXTRA_RAND 60
defineprojectile 9115 PROJ_SPAWNS LAVASPLASH
defineprojectile 9115 PROJ_ISOUND BRUISER_FLAME

defineprojectile ROCKDEB3 PROJ_WORKSLIKE 2103430
defineprojectile ROCKDEB3 PROJ_HITRADIUS 0
defineprojectile ROCKDEB3 PROJ_VEL 180
defineprojectile ROCKDEB3 PROJ_DROP -200
defineprojectile ROCKDEB3 PROJ_BOUNCES 0
defineprojectile ROCKDEB3 PROJ_BSOUND ROCK_IMPACT
defineprojectile ROCKDEB3 PROJ_XREPEAT 16
defineprojectile ROCKDEB3 PROJ_YREPEAT 16
defineprojectile ROCKDEB3 PROJ_EXTRA 0
defineprojectile ROCKDEB3 PROJ_SPAWNS ROCKDEB3F 

defineprojectile ROCKDEB4 PROJ_WORKSLIKE 2103430
defineprojectile ROCKDEB4 PROJ_HITRADIUS 0
defineprojectile ROCKDEB4 PROJ_VEL 180
defineprojectile ROCKDEB4 PROJ_DROP -200
defineprojectile ROCKDEB4 PROJ_BOUNCES 0
defineprojectile ROCKDEB4 PROJ_BSOUND ROCK_IMPACT
defineprojectile ROCKDEB4 PROJ_XREPEAT 16
defineprojectile ROCKDEB4 PROJ_YREPEAT 16
defineprojectile ROCKDEB4 PROJ_EXTRA 0
defineprojectile ROCKDEB4 PROJ_SPAWNS ROCKDEB4F

defineprojectile SROCKDEB4 PROJ_WORKSLIKE 2103430
defineprojectile SROCKDEB4 PROJ_HITRADIUS 0
defineprojectile SROCKDEB4 PROJ_VEL 180
defineprojectile SROCKDEB4 PROJ_DROP -200
defineprojectile SROCKDEB4 PROJ_BOUNCES 0
defineprojectile SROCKDEB4 PROJ_BSOUND 4
defineprojectile SROCKDEB4 PROJ_XREPEAT 3
defineprojectile SROCKDEB4 PROJ_YREPEAT 3
defineprojectile SROCKDEB4 PROJ_EXTRA 0
defineprojectile SROCKDEB4 PROJ_SPAWNS -1 

defineprojectile LAVABALL PROJ_WORKSLIKE 6278
defineprojectile LAVABALL PROJ_HITRADIUS 0
defineprojectile LAVABALL PROJ_VEL 140
defineprojectile LAVABALL PROJ_DROP -140
defineprojectile LAVABALL PROJ_BOUNCES 2
defineprojectile LAVABALL PROJ_BSOUND 4
defineprojectile LAVABALL PROJ_ISOUND EXPLOSION_SMALL
defineprojectile LAVABALL PROJ_XREPEAT 32
defineprojectile LAVABALL PROJ_YREPEAT 32
defineprojectile LAVABALL PROJ_EXTRA 75
defineprojectile LAVABALL PROJ_TRAIL SMALLSMOKE
defineprojectile LAVABALL PROJ_SPAWNS LAVASPLASH
defineprojectile LAVABALL PROJ_FLASH_COLOR 2

defineprojectile OCTA_TENT PROJ_WORKSLIKE 2103430
defineprojectile OCTA_TENT PROJ_HITRADIUS 0
defineprojectile OCTA_TENT PROJ_VEL 100
defineprojectile OCTA_TENT PROJ_DROP -140
defineprojectile OCTA_TENT PROJ_BSOUND 4
defineprojectile OCTA_TENT PROJ_ISOUND GIB_LAND1
defineprojectile OCTA_TENT PROJ_BOUNCES 2
defineprojectile OCTA_TENT PROJ_XREPEAT 26
defineprojectile OCTA_TENT PROJ_YREPEAT 26
defineprojectile OCTA_TENT PROJ_EXTRA 0
defineprojectile OCTA_TENT PROJ_TRAIL BLOODTRAIL
defineprojectile OCTA_TENT PROJ_SPAWNS OCTA_TENTI

defineprojectile NJIB PROJ_WORKSLIKE 2103430
defineprojectile NJIB PROJ_HITRADIUS 0
defineprojectile NJIB PROJ_VEL 200
defineprojectile NJIB PROJ_DROP -140
defineprojectile NJIB PROJ_BSOUND 4
defineprojectile NJIB PROJ_ISOUND GIB_LAND1
defineprojectile NJIB PROJ_BOUNCES 2
defineprojectile NJIB PROJ_XREPEAT 26
defineprojectile NJIB PROJ_YREPEAT 26
defineprojectile NJIB PROJ_EXTRA 0
defineprojectile NJIB PROJ_TRAIL BLOODTRAIL
defineprojectile NJIB PROJ_SPAWNS NJIBI

defineprojectile NJIB2 PROJ_WORKSLIKE 2103430
defineprojectile NJIB2 PROJ_HITRADIUS 0
defineprojectile NJIB2 PROJ_VEL 200
defineprojectile NJIB2 PROJ_DROP -140
defineprojectile NJIB2 PROJ_BSOUND 4
defineprojectile NJIB2 PROJ_BOUNCES 2
defineprojectile NJIB2 PROJ_ISOUND GIB_LAND2
defineprojectile NJIB2 PROJ_XREPEAT 26
defineprojectile NJIB2 PROJ_YREPEAT 26
defineprojectile NJIB2 PROJ_EXTRA 0
defineprojectile NJIB2 PROJ_TRAIL BLOODTRAIL
defineprojectile NJIB2 PROJ_SPAWNS NJIB2I

defineprojectile NJIB3 PROJ_WORKSLIKE 2103430
defineprojectile NJIB3 PROJ_HITRADIUS 0
defineprojectile NJIB3 PROJ_VEL 200
defineprojectile NJIB3 PROJ_DROP -140
defineprojectile NJIB3 PROJ_BSOUND 4
defineprojectile NJIB3 PROJ_ISOUND GIB_LAND2
defineprojectile NJIB3 PROJ_BOUNCES 2
defineprojectile NJIB3 PROJ_XREPEAT 26
defineprojectile NJIB3 PROJ_YREPEAT 26
defineprojectile NJIB3 PROJ_EXTRA 0
defineprojectile NJIB3 PROJ_TRAIL BLOODTRAIL
defineprojectile NJIB3 PROJ_SPAWNS NJIB3I

defineprojectile NJIB4 PROJ_WORKSLIKE 2103430
defineprojectile NJIB4 PROJ_HITRADIUS 0
defineprojectile NJIB4 PROJ_VEL 200
defineprojectile NJIB4 PROJ_DROP -140
defineprojectile NJIB4 PROJ_BSOUND 4
defineprojectile NJIB4 PROJ_ISOUND GIB_LAND2
defineprojectile NJIB4 PROJ_BOUNCES 2
defineprojectile NJIB4 PROJ_XREPEAT 32
defineprojectile NJIB4 PROJ_YREPEAT 32
defineprojectile NJIB4 PROJ_EXTRA 0
defineprojectile NJIB4 PROJ_TRAIL BLOODTRAIL
defineprojectile NJIB4 PROJ_SPAWNS NJIB4I

defineprojectile 4714 PROJ_WORKSLIKE 2103430
defineprojectile 4714 PROJ_HITRADIUS 0
defineprojectile 4714 PROJ_VEL 100
defineprojectile 4714 PROJ_DROP -140
defineprojectile 4714 PROJ_BSOUND 4
defineprojectile 4714 PROJ_ISOUND 4
defineprojectile 4714 PROJ_BOUNCES 2
defineprojectile 4714 PROJ_XREPEAT 32
defineprojectile 4714 PROJ_YREPEAT 32
defineprojectile 4714 PROJ_EXTRA 1
defineprojectile 4714 PROJ_TRAIL BLOODTRAIL
defineprojectile 4714 PROJ_SPAWNS 2284


defineprojectile 11426 PROJ_WORKSLIKE 2103430
defineprojectile 11426 PROJ_HITRADIUS 0
defineprojectile 11426 PROJ_VEL 200
defineprojectile 11426 PROJ_DROP -140
defineprojectile 11426 PROJ_BSOUND 4
defineprojectile 11426 PROJ_ISOUND GIB_LAND2
defineprojectile 11426 PROJ_BOUNCES 2
defineprojectile 11426 PROJ_XREPEAT 32
defineprojectile 11426 PROJ_YREPEAT 32
defineprojectile 11426 PROJ_EXTRA 0
defineprojectile 11426 PROJ_TRAIL BLOODTRAIL
defineprojectile 11426 PROJ_SPAWNS 11430

defineprojectile 11431 PROJ_WORKSLIKE 2103430
defineprojectile 11431 PROJ_HITRADIUS 0
defineprojectile 11431 PROJ_VEL 200
defineprojectile 11431 PROJ_DROP -140
defineprojectile 11431 PROJ_BSOUND 4
defineprojectile 11431 PROJ_ISOUND GIB_LAND2
defineprojectile 11431 PROJ_BOUNCES 2
defineprojectile 11431 PROJ_XREPEAT 32
defineprojectile 11431 PROJ_YREPEAT 32
defineprojectile 11431 PROJ_EXTRA 0
defineprojectile 11431 PROJ_TRAIL BLOODTRAIL
defineprojectile 11431 PROJ_SPAWNS 11435


defineprojectile LIZMANHEAD3 PROJ_WORKSLIKE 6150
defineprojectile LIZMANHEAD3 PROJ_HITRADIUS 0
defineprojectile LIZMANHEAD3 PROJ_BOUNCES 5
defineprojectile LIZMANHEAD3 PROJ_VEL 800
defineprojectile LIZMANHEAD3 PROJ_DROP -180
defineprojectile LIZMANHEAD3 PROJ_BSOUND HEADBOUNCE
defineprojectile LIZMANHEAD3 PROJ_XREPEAT 32
defineprojectile LIZMANHEAD3 PROJ_YREPEAT 32
defineprojectile LIZMANHEAD3 PROJ_EXTRA 0
defineprojectile LIZMANHEAD3 PROJ_TRAIL BLOODTRAIL
defineprojectile LIZMANHEAD3 PROJ_SPAWNS 2214

defineprojectile SATYR_HEAD PROJ_WORKSLIKE 6150
defineprojectile SATYR_HEAD PROJ_HITRADIUS 0
defineprojectile SATYR_HEAD PROJ_BOUNCES 5
defineprojectile SATYR_HEAD PROJ_VEL 400
defineprojectile SATYR_HEAD PROJ_DROP -180
defineprojectile SATYR_HEAD PROJ_BSOUND HEADBOUNCE
defineprojectile SATYR_HEAD PROJ_XREPEAT 26
defineprojectile SATYR_HEAD PROJ_YREPEAT 26
defineprojectile SATYR_HEAD PROJ_EXTRA 0
defineprojectile SATYR_HEAD PROJ_TRAIL BLOODTRAIL
defineprojectile SATYR_HEAD PROJ_SPAWNS SATYR_HEAD_FLOOR

defineprojectile MJ12_HEAD PROJ_WORKSLIKE 6150
defineprojectile MJ12_HEAD PROJ_HITRADIUS 0
defineprojectile MJ12_HEAD PROJ_BOUNCES 5
defineprojectile MJ12_HEAD PROJ_VEL 600
defineprojectile MJ12_HEAD PROJ_DROP -180
defineprojectile MJ12_HEAD PROJ_BSOUND HEADBOUNCE
defineprojectile MJ12_HEAD PROJ_XREPEAT 30
defineprojectile MJ12_HEAD PROJ_YREPEAT 30
defineprojectile MJ12_HEAD PROJ_EXTRA 0
defineprojectile MJ12_HEAD PROJ_TRAIL BLOODTRAIL
defineprojectile MJ12_HEAD PROJ_SPAWNS MJ12_HEAD_FLOOR

// WEAPON SHELLS

defineprojectile 13772 PROJ_WORKSLIKE 2103430
defineprojectile 13772 PROJ_HITRADIUS 0
defineprojectile 13772 PROJ_VEL 100
defineprojectile 13772 PROJ_DROP -140
defineprojectile 13772 PROJ_BSOUND SHELLBOUNCE
defineprojectile 13772 PROJ_XREPEAT 10
defineprojectile 13772 PROJ_YREPEAT 10
defineprojectile 13772 PROJ_EXTRA 0
defineprojectile 13772 PROJ_BOUNCES 6
defineprojectile 13772 PROJ_SPAWNS 9MMSHELLF

defineprojectile 13780 PROJ_WORKSLIKE 2103430
defineprojectile 13780 PROJ_HITRADIUS 0
defineprojectile 13780 PROJ_VEL 100
defineprojectile 13780 PROJ_DROP -140
defineprojectile 13780 PROJ_BSOUND SHELLBOUNCE
defineprojectile 13780 PROJ_XREPEAT 10
defineprojectile 13780 PROJ_YREPEAT 10
defineprojectile 13780 PROJ_EXTRA 0
defineprojectile 13780 PROJ_BOUNCES 6
defineprojectile 13780 PROJ_SPAWNS 9MMSHELLF

// Empty shotgun shell

defineprojectile 3761 PROJ_WORKSLIKE 2103430
defineprojectile 3761 PROJ_HITRADIUS 0
defineprojectile 3761 PROJ_VEL 100
defineprojectile 3761 PROJ_DROP -140
defineprojectile 3761 PROJ_BSOUND 12GSHELLBOUNCE
defineprojectile 3761 PROJ_XREPEAT 7
defineprojectile 3761 PROJ_BOUNCES 6
defineprojectile 3761 PROJ_YREPEAT 7
defineprojectile 3761 PROJ_TRAIL SMALLSMOKE
defineprojectile 3761 PROJ_EXTRA 0
defineprojectile 3761 PROJ_SPAWNS 12GSHELLF

defineprojectile MAGN_SHELL PROJ_WORKSLIKE 2103430
defineprojectile MAGN_SHELL PROJ_HITRADIUS 0
defineprojectile MAGN_SHELL PROJ_VEL 100
defineprojectile MAGN_SHELL PROJ_DROP -140
defineprojectile MAGN_SHELL PROJ_BSOUND 12GSHELLBOUNCE
defineprojectile MAGN_SHELL PROJ_XREPEAT 7
defineprojectile MAGN_SHELL PROJ_YREPEAT 7
defineprojectile MAGN_SHELL PROJ_TRAIL SMALLSMOKE
defineprojectile MAGN_SHELL PROJ_EXTRA 0
defineprojectile MAGN_SHELL PROJ_SPAWNS MAGN_SHELLF

defineprojectile 40MM_SHELL PROJ_WORKSLIKE 2103430
defineprojectile 40MM_SHELL PROJ_HITRADIUS 0
defineprojectile 40MM_SHELL PROJ_VEL 100
defineprojectile 40MM_SHELL PROJ_DROP -140
defineprojectile 40MM_SHELL PROJ_BSOUND 40_SH_BOUNCE
defineprojectile 40MM_SHELL PROJ_XREPEAT 20
defineprojectile 40MM_SHELL PROJ_YREPEAT 20
defineprojectile 40MM_SHELL PROJ_TRAIL SMALLSMOKE
defineprojectile 40MM_SHELL PROJ_EXTRA 0
defineprojectile 40MM_SHELL PROJ_SPAWNS 40MM_SH_FLOOR

defineprojectile 19028 PROJ_WORKSLIKE 2103430
defineprojectile 19028 PROJ_HITRADIUS 0
defineprojectile 19028 PROJ_VEL 20
defineprojectile 19028 PROJ_DROP -440
defineprojectile 19028 PROJ_BSOUND LEAD_DROP
defineprojectile 19028 PROJ_XREPEAT 32
defineprojectile 19028 PROJ_YREPEAT 32
defineprojectile 19028 PROJ_TRAIL -1
defineprojectile 19028 PROJ_EXTRA 0

// Expended Explosive shotgun shell
defineprojectile EXSHELL PROJ_WORKSLIKE 2103430
defineprojectile EXSHELL PROJ_HITRADIUS 0
defineprojectile EXSHELL PROJ_VEL 100
defineprojectile EXSHELL PROJ_DROP -140
defineprojectile EXSHELL PROJ_BSOUND 12GSHELLBOUNCE
defineprojectile EXSHELL PROJ_XREPEAT 7
defineprojectile EXSHELL PROJ_YREPEAT 7
defineprojectile EXSHELL PROJ_TRAIL SMALLSMOKE
defineprojectile EXSHELL PROJ_EXTRA 0
defineprojectile EXSHELL PROJ_SPAWNS EXSHELLF

// Expended Flechete shotgun shell
defineprojectile FL_SHELL PROJ_WORKSLIKE 2103430
defineprojectile FL_SHELL PROJ_HITRADIUS 0
defineprojectile FL_SHELL PROJ_VEL 100
defineprojectile FL_SHELL PROJ_DROP -140
defineprojectile FL_SHELL PROJ_BSOUND 12GSHELLBOUNCE
defineprojectile FL_SHELL PROJ_XREPEAT 7
defineprojectile FL_SHELL PROJ_YREPEAT 7
defineprojectile FL_SHELL PROJ_TRAIL SMALLSMOKE
defineprojectile FL_SHELL PROJ_EXTRA 0
defineprojectile FL_SHELL PROJ_SPAWNS FL_SHELLF

defineprojectile RIFLESHELL PROJ_WORKSLIKE 2103430
defineprojectile RIFLESHELL PROJ_HITRADIUS 0
defineprojectile RIFLESHELL PROJ_VEL 100
defineprojectile RIFLESHELL PROJ_BOUNCES 6
defineprojectile RIFLESHELL PROJ_DROP -140
defineprojectile RIFLESHELL PROJ_BSOUND BIGSHELLBOUNCE
defineprojectile RIFLESHELL PROJ_XREPEAT 7
defineprojectile RIFLESHELL PROJ_YREPEAT 7
defineprojectile RIFLESHELL PROJ_EXTRA 0
defineprojectile RIFLESHELL PROJ_SPAWNS RIFLESHELLF

// Silver rifle shell
defineprojectile SRIFLESHELL PROJ_WORKSLIKE 2103430
defineprojectile SRIFLESHELL PROJ_HITRADIUS 0
defineprojectile SRIFLESHELL PROJ_VEL 100
defineprojectile SRIFLESHELL PROJ_DROP -140
defineprojectile SRIFLESHELL PROJ_BSOUND BIGSHELLBOUNCE
defineprojectile SRIFLESHELL PROJ_XREPEAT 10
defineprojectile SRIFLESHELL PROJ_YREPEAT 10
defineprojectile SRIFLESHELL PROJ_EXTRA 0
defineprojectile SRIFLESHELL PROJ_SPAWNS SRIFLESHELLF

defineprojectile SHELL_LINK PROJ_WORKSLIKE 2103430
defineprojectile SHELL_LINK PROJ_HITRADIUS 0
defineprojectile SHELL_LINK PROJ_VEL 100
defineprojectile SHELL_LINK PROJ_DROP -140
defineprojectile SHELL_LINK PROJ_BSOUND 4
defineprojectile SHELL_LINK PROJ_XREPEAT 4
defineprojectile SHELL_LINK PROJ_YREPEAT 4
defineprojectile SHELL_LINK PROJ_EXTRA 0
defineprojectile SHELL_LINK PROJ_SPAWNS SHELL_LINK_FLOOR

spritenoshade HEAT_SINK

defineprojectile HEAT_SINK PROJ_WORKSLIKE 2103430
defineprojectile HEAT_SINK PROJ_HITRADIUS 0
defineprojectile HEAT_SINK PROJ_VEL 200
defineprojectile HEAT_SINK PROJ_DROP -140
defineprojectile HEAT_SINK PROJ_BSOUND MAGAZINEFALL
defineprojectile HEAT_SINK PROJ_XREPEAT 12
defineprojectile HEAT_SINK PROJ_YREPEAT 12
defineprojectile HEAT_SINK PROJ_EXTRA 0
defineprojectile HEAT_SINK PROJ_TRAIL SMALLSMOKE
defineprojectile HEAT_SINK PROJ_PAL 21
defineprojectile HEAT_SINK PROJ_SPAWNS 6560


// WEAPON MAGAZINES

useractor notenemy 3720 cstat 32768 shoot PISTOLMAGAZINE killit enda
useractor notenemy 3737 cstat 32768 shoot SMGMAGAZINE killit enda
useractor notenemy 3756 cstat 32768 shoot RIFLEMAGAZINE killit enda
useractor notenemy 7103 cstat 32768 shoot PISTOLMAGAZINE2 killit enda
useractor notenemy 6781 cstat 32768 shoot SHOTGUNBOXMAGAZINE killit enda
useractor notenemy 7111 cstat 32768 shoot DRUMMAGAZINE killit enda
useractor notenemy 12190 cstat 32768 shoot BETA_MAG killit enda
useractor notenemy 14641 cstat 32768 shoot SMG_MAG2 killit enda

defineprojectile PISTOLMAGAZINE PROJ_WORKSLIKE 2103430
defineprojectile PISTOLMAGAZINE PROJ_HITRADIUS 0
defineprojectile PISTOLMAGAZINE PROJ_VEL 100
defineprojectile PISTOLMAGAZINE PROJ_DROP -140
defineprojectile PISTOLMAGAZINE PROJ_BSOUND MAGAZINEFALL
defineprojectile PISTOLMAGAZINE PROJ_XREPEAT 26
defineprojectile PISTOLMAGAZINE PROJ_YREPEAT 26
defineprojectile PISTOLMAGAZINE PROJ_EXTRA 0
defineprojectile PISTOLMAGAZINE PROJ_SPAWNS PISTOLMAGAZINEI

defineprojectile PISTOLMAGAZINE2 PROJ_WORKSLIKE 2103430
defineprojectile PISTOLMAGAZINE2 PROJ_HITRADIUS 0
defineprojectile PISTOLMAGAZINE2 PROJ_VEL 100
defineprojectile PISTOLMAGAZINE2 PROJ_DROP -140
defineprojectile PISTOLMAGAZINE2 PROJ_BSOUND MAGAZINEFALL
defineprojectile PISTOLMAGAZINE2 PROJ_XREPEAT 26
defineprojectile PISTOLMAGAZINE2 PROJ_YREPEAT 26
defineprojectile PISTOLMAGAZINE2 PROJ_EXTRA 0
defineprojectile PISTOLMAGAZINE2 PROJ_SPAWNS PISTOLMAGAZINE2I

defineprojectile SMGMAGAZINE PROJ_WORKSLIKE 2103430
defineprojectile SMGMAGAZINE PROJ_HITRADIUS 0
defineprojectile SMGMAGAZINE PROJ_VEL 100
defineprojectile SMGMAGAZINE PROJ_DROP -140
defineprojectile SMGMAGAZINE PROJ_BSOUND MAGAZINEFALL
defineprojectile SMGMAGAZINE PROJ_XREPEAT 26
defineprojectile SMGMAGAZINE PROJ_YREPEAT 26
defineprojectile SMGMAGAZINE PROJ_EXTRA 0
defineprojectile SMGMAGAZINE PROJ_SPAWNS SMGMAGAZINEI

defineprojectile SMG_MAG2 PROJ_WORKSLIKE 2103430
defineprojectile SMG_MAG2 PROJ_HITRADIUS 0
defineprojectile SMG_MAG2 PROJ_VEL 100
defineprojectile SMG_MAG2 PROJ_DROP -140
defineprojectile SMG_MAG2 PROJ_BSOUND MAGAZINEFALL
defineprojectile SMG_MAG2 PROJ_XREPEAT 26
defineprojectile SMG_MAG2 PROJ_YREPEAT 26
defineprojectile SMG_MAG2 PROJ_EXTRA 0
defineprojectile SMG_MAG2 PROJ_SPAWNS SMG_MAG2I

defineprojectile RIFLEMAGAZINE PROJ_WORKSLIKE 2103430
defineprojectile RIFLEMAGAZINE PROJ_HITRADIUS 0
defineprojectile RIFLEMAGAZINE PROJ_VEL 100
defineprojectile RIFLEMAGAZINE PROJ_DROP -140
defineprojectile RIFLEMAGAZINE PROJ_BSOUND BMAGAZINEFALL
defineprojectile RIFLEMAGAZINE PROJ_XREPEAT 26
defineprojectile RIFLEMAGAZINE PROJ_YREPEAT 26
defineprojectile RIFLEMAGAZINE PROJ_EXTRA 0
defineprojectile RIFLEMAGAZINE PROJ_SPAWNS RIFLEMAGAZINEI

defineprojectile SHOTGUNBOXMAGAZINE PROJ_WORKSLIKE 2103430
defineprojectile SHOTGUNBOXMAGAZINE PROJ_HITRADIUS 0
defineprojectile SHOTGUNBOXMAGAZINE PROJ_VEL 100
defineprojectile SHOTGUNBOXMAGAZINE PROJ_DROP -140
defineprojectile SHOTGUNBOXMAGAZINE PROJ_BSOUND BMAGAZINEFALL
defineprojectile SHOTGUNBOXMAGAZINE PROJ_XREPEAT 26
defineprojectile SHOTGUNBOXMAGAZINE PROJ_YREPEAT 26
defineprojectile SHOTGUNBOXMAGAZINE PROJ_EXTRA 0
defineprojectile SHOTGUNBOXMAGAZINE PROJ_SPAWNS SHOTGUNBOXMAGI

defineprojectile DRUMMAGAZINE PROJ_WORKSLIKE 2103430
defineprojectile DRUMMAGAZINE PROJ_HITRADIUS 0
defineprojectile DRUMMAGAZINE PROJ_VEL 80
defineprojectile DRUMMAGAZINE PROJ_DROP -140
defineprojectile DRUMMAGAZINE PROJ_BSOUND ENDSEQVOL2SND4
defineprojectile DRUMMAGAZINE PROJ_XREPEAT 26
defineprojectile DRUMMAGAZINE PROJ_YREPEAT 26
defineprojectile DRUMMAGAZINE PROJ_EXTRA 0
defineprojectile DRUMMAGAZINE PROJ_SPAWNS DRUMMAGAZINEI

defineprojectile BETA_MAG PROJ_WORKSLIKE 2103430
defineprojectile BETA_MAG PROJ_HITRADIUS 0
defineprojectile BETA_MAG PROJ_VEL 80
defineprojectile BETA_MAG PROJ_DROP -140
defineprojectile BETA_MAG PROJ_BSOUND ENDSEQVOL2SND4
defineprojectile BETA_MAG PROJ_XREPEAT 18
defineprojectile BETA_MAG PROJ_YREPEAT 18
defineprojectile BETA_MAG PROJ_EXTRA 0
defineprojectile BETA_MAG PROJ_SPAWNS BETA_MAGI

// PROJECTILES

defineprojectile MISSILE PROJ_WORKSLIKE 98306
defineprojectile MISSILE PROJ_SPAWNS MISSILE_EXPLOSION
defineprojectile MISSILE PROJ_VEL 999
defineprojectile MISSILE PROJ_VEL_MULT 2
defineprojectile MISSILE PROJ_EXTRA 200
defineprojectile MISSILE PROJ_EXTRA_RAND 150
defineprojectile MISSILE PROJ_ISOUND MISSILE_EXPLODE
defineprojectile MISSILE PROJ_HITRADIUS 1536
defineprojectile MISSILE PROJ_CLIPDIST 24
defineprojectile MISSILE PROJ_TRAIL SMALLSMOKE
defineprojectile MISSILE PROJ_XREPEAT 32
defineprojectile MISSILE PROJ_YREPEAT 32
defineprojectile MISSILE PROJ_CSTAT 128
defineprojectile MISSILE PROJ_FLASH_COLOR 2
defineprojectile MISSILE PROJ_USERDATA 32

spritenoshade MISSILE

action MISSILE_FRAMES 0 1 7
useractor notenemy MISSILE 0 MISSILE_FRAMES seta[].shade -127 enda

// RPG-7 ROCKET

defineprojectile RPG7_ROCKET PROJ_WORKSLIKE 65538
defineprojectile RPG7_ROCKET PROJ_SPAWNS BIG_EXPLOSION
defineprojectile RPG7_ROCKET PROJ_VEL 999
defineprojectile RPG7_ROCKET PROJ_VEL_MULT 2
defineprojectile RPG7_ROCKET PROJ_EXTRA 600
defineprojectile RPG7_ROCKET PROJ_EXTRA_RAND 150
defineprojectile RPG7_ROCKET PROJ_ISOUND EXPLOSION_BIG
defineprojectile RPG7_ROCKET PROJ_HITRADIUS 4096
defineprojectile RPG7_ROCKET PROJ_CLIPDIST 24
defineprojectile RPG7_ROCKET PROJ_TRAIL BIG_SMOKE2
defineprojectile RPG7_ROCKET PROJ_XREPEAT 32
defineprojectile RPG7_ROCKET PROJ_YREPEAT 32
defineprojectile RPG7_ROCKET PROJ_CSTAT 128
defineprojectile RPG7_ROCKET PROJ_FLASH_COLOR 2
defineprojectile RPG7_ROCKET PROJ_USERDATA 32

spritenoshade RPG7_ROCKET

useractor notenemy RPG7_ROCKET 0 ACAR seta[].shade -127 enda

// CYCLOID PLASMA

defineprojectile 14644 PROJ_WORKSLIKE 98306
defineprojectile 14644 PROJ_SPAWNS EXPLOSION2
defineprojectile 14644 PROJ_VEL 950
defineprojectile 14644 PROJ_EXTRA 240
defineprojectile 14644 PROJ_EXTRA_RAND 240
defineprojectile 14644 PROJ_ISOUND RPG_EXPLODE
defineprojectile 14644 PROJ_HITRADIUS 512
defineprojectile 14644 PROJ_CLIPDIST 24
defineprojectile 14644 PROJ_TRAIL SMALLSMOKE
defineprojectile 14644 PROJ_XREPEAT 32
defineprojectile 14644 PROJ_YREPEAT 32
defineprojectile 14644 PROJ_CSTAT 128
defineprojectile 14644 PROJ_USERDATA 65

// TERMINATOR PLASMA

spritenoshade PLASMAPROJ

action PLASMAFRAME 0 1 5 1 1
useractor notenemy PLASMAPROJ 6 PLASMAFRAME enda
defineprojectile PLASMAPROJ PROJ_WORKSLIKE 32770 // 36866
defineprojectile PLASMAPROJ PROJ_EXTRA 6
defineprojectile PLASMAPROJ PROJ_EXTRA_RAND 2
defineprojectile PLASMAPROJ PROJ_VEL 844
defineprojectile PLASMAPROJ PROJ_SPAWNS 6495
defineprojectile PLASMAPROJ PROJ_ISOUND 4
defineprojectile PLASMAPROJ PROJ_HITRADIUS 0
defineprojectile PLASMAPROJ PROJ_TRAIL -1
defineprojectile PLASMAPROJ PROJ_XREPEAT 32
defineprojectile PLASMAPROJ PROJ_YREPEAT 32
defineprojectile PLASMAPROJ PROJ_CSTAT 2
defineprojectile PLASMAPROJ PROJ_PAL 0
defineprojectile PLASMAPROJ PROJ_SHADE -127
defineprojectile PLASMAPROJ PROJ_USERDATA 1
// defineprojectile PLASMAPROJ PROJ_OFFSET -160

useractor notenemy 14644 0 MISSILE_FRAMES enda

defineprojectile TORPEDO PROJ_WORKSLIKE 34
defineprojectile TORPEDO PROJ_SPAWNS MISSILE_EXPLOSION
defineprojectile TORPEDO PROJ_VEL 999
defineprojectile TORPEDO PROJ_VEL_MULT 2
defineprojectile TORPEDO PROJ_EXTRA 300
defineprojectile TORPEDO PROJ_EXTRA_RAND 50
defineprojectile TORPEDO PROJ_ISOUND MISSILE_EXPLODE
defineprojectile TORPEDO PROJ_HITRADIUS 2048
defineprojectile TORPEDO PROJ_CLIPDIST 24
// defineprojectile TORPEDO PROJ_TRAIL -1
defineprojectile TORPEDO PROJ_XREPEAT 16
defineprojectile TORPEDO PROJ_YREPEAT 16
defineprojectile TORPEDO PROJ_CSTAT 128
defineprojectile TORPEDO PROJ_FLASH_COLOR 2

action TORPEDO_FRAMES 0 1 7
useractor notenemy TORPEDO 0 TORPEDO_FRAMES enda

defineprojectile MICRO_MISSILE PROJ_WORKSLIKE 98306
defineprojectile MICRO_MISSILE PROJ_SPAWNS MISSILE_EXPLOSION
defineprojectile MICRO_MISSILE PROJ_VEL 700
defineprojectile MICRO_MISSILE PROJ_EXTRA 100
defineprojectile MICRO_MISSILE PROJ_EXTRA_RAND 50
defineprojectile MICRO_MISSILE PROJ_ISOUND EXPLOSION_MEDIUM
defineprojectile MICRO_MISSILE PROJ_HITRADIUS 1024
defineprojectile MICRO_MISSILE PROJ_CLIPDIST 24
defineprojectile MICRO_MISSILE PROJ_TRAIL SMALLSMOKE
defineprojectile MICRO_MISSILE PROJ_XREPEAT 32
defineprojectile MICRO_MISSILE PROJ_YREPEAT 32
defineprojectile MICRO_MISSILE PROJ_CSTAT 128
defineprojectile MICRO_MISSILE PROJ_FLASH_COLOR 2
defineprojectile MICRO_MISSILE PROJ_USERDATA 64

defineprojectile HOMING_MISSILE PROJ_WORKSLIKE 98306
defineprojectile HOMING_MISSILE PROJ_SPAWNS MISSILE_EXPLOSION
defineprojectile HOMING_MISSILE PROJ_VEL 700
defineprojectile HOMING_MISSILE PROJ_EXTRA 100
defineprojectile HOMING_MISSILE PROJ_EXTRA_RAND 50
defineprojectile HOMING_MISSILE PROJ_ISOUND EXPLOSION_MEDIUM
defineprojectile HOMING_MISSILE PROJ_HITRADIUS 1024
defineprojectile HOMING_MISSILE PROJ_CLIPDIST 24
defineprojectile HOMING_MISSILE PROJ_TRAIL SMALLSMOKE
defineprojectile HOMING_MISSILE PROJ_XREPEAT 32
defineprojectile HOMING_MISSILE PROJ_YREPEAT 32
defineprojectile HOMING_MISSILE PROJ_CSTAT 385
defineprojectile HOMING_MISSILE PROJ_FLASH_COLOR 2
defineprojectile HOMING_MISSILE PROJ_USERDATA 64

defineprojectile ATOM_BOMB PROJ_WORKSLIKE 65538
defineprojectile ATOM_BOMB PROJ_SPAWNS NUCLEAR_EXPLOSION
defineprojectile ATOM_BOMB PROJ_VEL 725
defineprojectile ATOM_BOMB PROJ_EXTRA 2800
defineprojectile ATOM_BOMB PROJ_EXTRA_RAND 1600
defineprojectile ATOM_BOMB PROJ_ISOUND NUKE_EXPLODE
defineprojectile ATOM_BOMB PROJ_HITRADIUS 20000
defineprojectile ATOM_BOMB PROJ_CLIPDIST 24
defineprojectile ATOM_BOMB PROJ_TRAIL GUNSMOKE
defineprojectile ATOM_BOMB PROJ_XREPEAT 32
defineprojectile ATOM_BOMB PROJ_YREPEAT 32
defineprojectile ATOM_BOMB PROJ_CSTAT 128
defineprojectile ATOM_BOMB PROJ_USERDATA 65536 // Damages EVERYTHING

action MICRO_MISSILE_FRAMES 0 1 5
useractor notenemy MICRO_MISSILE 0 MICRO_MISSILE_FRAMES enda
useractor notenemy HOMING_MISSILE 0 MICRO_MISSILE_FRAMES enda
useractor notenemy ATOM_BOMB 0 MICRO_MISSILE_FRAMES enda
useractor notenemy 16004 0 MICRO_MISSILE_FRAMES enda

spriteshadow 16004

defineprojectile 16004 PROJ_WORKSLIKE 2094
defineprojectile 16004 PROJ_VEL 800
defineprojectile 16004 PROJ_SPAWNS BIG_EXPLOSION
defineprojectile 16004 PROJ_EXTRA 300
defineprojectile 16004 PROJ_EXTRA_RAND 140
defineprojectile 16004 PROJ_HITRADIUS 4096
defineprojectile 16004 PROJ_XREPEAT 24
defineprojectile 16004 PROJ_YREPEAT 24
defineprojectile 16004 PROJ_DROP -160
defineprojectile 16004 PROJ_BOUNCES 6
defineprojectile 16004 PROJ_ISOUND EXPLOSION_LARGE
defineprojectile 16004 PROJ_BSOUND GRENBOUNCE2
defineprojectile 16004 PROJ_TRAIL GUNSMOKE
defineprojectile 16004 PROJ_USERDATA 64

defineprojectile GREENLASERSHOT PROJ_WORKSLIKE 1
defineprojectile GREENLASERSHOT PROJ_EXTRA 75
defineprojectile GREENLASERSHOT PROJ_EXTRA_RAND 15
defineprojectile GREENLASERSHOT PROJ_TRAIL 9401 
defineprojectile GREENLASERSHOT PROJ_TXREPEAT 4 
defineprojectile GREENLASERSHOT PROJ_TYREPEAT 4 
defineprojectile GREENLASERSHOT PROJ_TNUM 128 
// defineprojectile GREENLASERSHOT PROJ_OFFSET 0
defineprojectile GREENLASERSHOT PROJ_USERDATA 144

defineprojectile BLUELASERSHOT PROJ_WORKSLIKE 1
defineprojectile BLUELASERSHOT PROJ_EXTRA 15
defineprojectile BLUELASERSHOT PROJ_EXTRA_RAND 15
defineprojectile BLUELASERSHOT PROJ_TRAIL 12902
defineprojectile BLUELASERSHOT PROJ_TXREPEAT 4 
defineprojectile BLUELASERSHOT PROJ_TYREPEAT 4 
defineprojectile BLUELASERSHOT PROJ_TNUM 128 
defineprojectile BLUELASERSHOT PROJ_OFFSET 224
defineprojectile BLUELASERSHOT PROJ_USERDATA 80

// left handed blue laser shot
defineprojectile 20797 PROJ_WORKSLIKE 1
defineprojectile 20797 PROJ_EXTRA 15
defineprojectile 20797 PROJ_EXTRA_RAND 15
defineprojectile 20797 PROJ_TRAIL 12902
defineprojectile 20797 PROJ_TXREPEAT 4 
defineprojectile 20797 PROJ_TYREPEAT 4 
defineprojectile 20797 PROJ_TNUM 128 
defineprojectile 20797 PROJ_OFFSET -224
defineprojectile 20797 PROJ_USERDATA 80

defineprojectile REDLASERSHOT PROJ_WORKSLIKE 1
defineprojectile REDLASERSHOT PROJ_EXTRA 10
defineprojectile REDLASERSHOT PROJ_EXTRA_RAND 10
defineprojectile REDLASERSHOT PROJ_TRAIL 6633
defineprojectile REDLASERSHOT PROJ_TXREPEAT 4 
defineprojectile REDLASERSHOT PROJ_TYREPEAT 4 
defineprojectile REDLASERSHOT PROJ_TNUM 128 
// defineprojectile REDLASERSHOT PROJ_OFFSET 128
defineprojectile REDLASERSHOT PROJ_USERDATA 528

// lightning shot
defineprojectile 20834 PROJ_WORKSLIKE 1
defineprojectile 20834 PROJ_EXTRA 150
defineprojectile 20834 PROJ_EXTRA_RAND 150
defineprojectile 20834 PROJ_TRAIL 12902
defineprojectile 20834 PROJ_TXREPEAT 16 
defineprojectile 20834 PROJ_TYREPEAT 16 
defineprojectile 20834 PROJ_TNUM 128 
defineprojectile 20834 PROJ_OFFSET 224
defineprojectile 20834 PROJ_USERDATA 8208


defineprojectile MELTA_BEAM PROJ_WORKSLIKE 1
defineprojectile MELTA_BEAM PROJ_EXTRA 20
defineprojectile MELTA_BEAM PROJ_EXTRA_RAND 20
defineprojectile MELTA_BEAM PROJ_TRAIL 6575
defineprojectile MELTA_BEAM PROJ_SPAWNS BIG_SMOKE
defineprojectile MELTA_BEAM PROJ_TXREPEAT 4 
defineprojectile MELTA_BEAM PROJ_TYREPEAT 4 
defineprojectile MELTA_BEAM PROJ_TNUM 128 
defineprojectile MELTA_BEAM PROJ_OFFSET 128
defineprojectile MELTA_BEAM PROJ_USERDATA 33

defineprojectile HEAVY_RAILGUN PROJ_WORKSLIKE 1
defineprojectile HEAVY_RAILGUN PROJ_EXTRA 600
defineprojectile HEAVY_RAILGUN PROJ_EXTRA_RAND 125
defineprojectile HEAVY_RAILGUN PROJ_TRAIL 6517
defineprojectile HEAVY_RAILGUN PROJ_DECAL 952
defineprojectile HEAVY_RAILGUN PROJ_TXREPEAT 4 
defineprojectile HEAVY_RAILGUN PROJ_TYREPEAT 4 
defineprojectile HEAVY_RAILGUN PROJ_TNUM 128 
defineprojectile HEAVY_RAILGUN PROJ_OFFSET 128
defineprojectile HEAVY_RAILGUN PROJ_FLASH_COLOR 1
defineprojectile HEAVY_RAILGUN PROJ_USERDATA 512

define MAEPH_BEAM 14421

defineprojectile MAEPH_BEAM PROJ_WORKSLIKE 1
defineprojectile MAEPH_BEAM PROJ_EXTRA 300
defineprojectile MAEPH_BEAM PROJ_EXTRA_RAND 75
defineprojectile MAEPH_BEAM PROJ_TRAIL 14420
defineprojectile MAEPH_BEAM PROJ_TXREPEAT 16 
defineprojectile MAEPH_BEAM PROJ_TYREPEAT 16 
defineprojectile MAEPH_BEAM PROJ_TNUM 128 
defineprojectile MAEPH_BEAM PROJ_OFFSET 128
defineprojectile MAEPH_BEAM PROJ_FLASH_COLOR 1
defineprojectile MAEPH_BEAM PROJ_USERDATA 64


defineprojectile RAILGUN PROJ_WORKSLIKE 1
defineprojectile RAILGUN PROJ_EXTRA 300
defineprojectile RAILGUN PROJ_EXTRA_RAND 75
defineprojectile RAILGUN PROJ_TRAIL 6522
defineprojectile RAILGUN PROJ_TXREPEAT 4 
defineprojectile RAILGUN PROJ_TYREPEAT 4 
defineprojectile RAILGUN PROJ_TNUM 128 
defineprojectile RAILGUN PROJ_OFFSET 128
defineprojectile RAILGUN PROJ_FLASH_COLOR 1
defineprojectile RAILGUN PROJ_USERDATA 64

defineprojectile RIFLESHOT PROJ_WORKSLIKE 1
defineprojectile RIFLESHOT PROJ_EXTRA 125
defineprojectile RIFLESHOT PROJ_EXTRA_RAND 75
defineprojectile RIFLESHOT PROJ_USERDATA 64

defineprojectile BIGRIFLESHOT PROJ_WORKSLIKE 1
defineprojectile BIGRIFLESHOT PROJ_EXTRA 275
defineprojectile BIGRIFLESHOT PROJ_EXTRA_RAND 25
defineprojectile BIGRIFLESHOT PROJ_USERDATA 512

defineprojectile ANBSHOT PROJ_VEL 999
defineprojectile ANBSHOT PROJ_VEL_MULT 2
defineprojectile ANBSHOT PROJ_WORKSLIKE 32770
defineprojectile ANBSHOT PROJ_EXTRA 5
defineprojectile ANBSHOT PROJ_ISOUND 4
defineprojectile ANBSHOT PROJ_HITRADIUS 32

defineprojectile ZRIFLESHOT PROJ_WORKSLIKE 1
defineprojectile ZRIFLESHOT PROJ_EXTRA 12
defineprojectile ZRIFLESHOT PROJ_EXTRA_RAND 7
defineprojectile ZRIFLESHOT PROJ_USERDATA 64

defineprojectile ZRIFLESHOTU PROJ_WORKSLIKE 1
defineprojectile ZRIFLESHOTU PROJ_EXTRA 15
defineprojectile ZRIFLESHOTU PROJ_EXTRA_RAND 9
defineprojectile ZRIFLESHOTU PROJ_USERDATA 2048

defineprojectile F45_CALIBRE PROJ_WORKSLIKE 1
defineprojectile F45_CALIBRE PROJ_EXTRA 15 // .45 Calibre ammo
defineprojectile F45_CALIBRE PROJ_EXTRA_RAND 5
defineprojectile F45_CALIBRE PROJ_USERDATA 128

defineprojectile NINEMM_CALIBRE PROJ_WORKSLIKE 1
defineprojectile NINEMM_CALIBRE PROJ_EXTRA 8 // 9mm ammo
defineprojectile NINEMM_CALIBRE PROJ_EXTRA_RAND 4
defineprojectile NINEMM_CALIBRE PROJ_USERDATA 128

defineprojectile GOLDEN_SHOT_LOW PROJ_WORKSLIKE 1
defineprojectile GOLDEN_SHOT_LOW PROJ_EXTRA 12
defineprojectile GOLDEN_SHOT_LOW PROJ_USERDATA 80

defineprojectile GOLDEN_SHOT_MED PROJ_WORKSLIKE 1
defineprojectile GOLDEN_SHOT_MED PROJ_EXTRA 24
defineprojectile GOLDEN_SHOT_MED PROJ_USERDATA 80

defineprojectile GOLDEN_SHOT_HIGH PROJ_WORKSLIKE 1
defineprojectile GOLDEN_SHOT_HIGH PROJ_EXTRA 48
defineprojectile GOLDEN_SHOT_HIGH PROJ_USERDATA 80

defineprojectile SILVERAMMOSHOT PROJ_WORKSLIKE 1
defineprojectile SILVERAMMOSHOT PROJ_EXTRA 10
defineprojectile SILVERAMMOSHOT PROJ_EXTRA_RAND 5
defineprojectile SILVERAMMOSHOT PROJ_USERDATA 384

defineprojectile RMAXREVOLVERSHOT PROJ_WORKSLIKE 1
defineprojectile RMAXREVOLVERSHOT PROJ_EXTRA 30
defineprojectile RMAXREVOLVERSHOT PROJ_EXTRA_RAND 16
defineprojectile RMAXREVOLVERSHOT PROJ_USERDATA 2048

defineprojectile MSCORP_SHOT PROJ_WORKSLIKE 1
defineprojectile MSCORP_SHOT PROJ_EXTRA 20
defineprojectile MSCORP_SHOT PROJ_EXTRA_RAND 10
defineprojectile MSCORP_SHOT PROJ_USERDATA 2048

defineprojectile ARMOUR_PIERCING_SHOT PROJ_WORKSLIKE 1
defineprojectile ARMOUR_PIERCING_SHOT PROJ_EXTRA 13
defineprojectile ARMOUR_PIERCING_SHOT PROJ_EXTRA_RAND 2
defineprojectile ARMOUR_PIERCING_SHOT PROJ_USERDATA 32

defineprojectile HOLLOW_POINT_SHOT PROJ_WORKSLIKE 1
defineprojectile HOLLOW_POINT_SHOT PROJ_EXTRA 20
defineprojectile HOLLOW_POINT_SHOT PROJ_EXTRA_RAND 25
defineprojectile HOLLOW_POINT_SHOT PROJ_USERDATA 128

// PROTECTOR DRONE SCRATCH
defineprojectile 4609 PROJ_WORKSLIKE 2129986
defineprojectile 4609 PROJ_EXTRA 22
defineprojectile 4609 PROJ_EXTRA_RAND 2
defineprojectile 4609 PROJ_HITRADIUS 0
defineprojectile 4609 PROJ_RANGE 3
defineprojectile 4609 PROJ_ISOUND NEWBEAST_ATTACK
defineprojectile 4609 PROJ_USERDATA 131080

// SPIDER BLIND BITE
defineprojectile 23533 PROJ_WORKSLIKE 2129986
defineprojectile 23533 PROJ_EXTRA 5
defineprojectile 23533 PROJ_EXTRA_RAND 2
defineprojectile 23533 PROJ_HITRADIUS 0
defineprojectile 23533 PROJ_RANGE 3
defineprojectile 23533 PROJ_ISOUND SCRATCHS
defineprojectile 23533 PROJ_USERDATA 524288

// RIPPER SCRATCH
defineprojectile 17663 PROJ_WORKSLIKE 2129986
defineprojectile 17663 PROJ_EXTRA 25
defineprojectile 17663 PROJ_EXTRA_RAND 10
defineprojectile 17663 PROJ_HITRADIUS 0
defineprojectile 17663 PROJ_RANGE 3
defineprojectile 17663 PROJ_ISOUND RIPPER_SCRATCH
defineprojectile 17663 PROJ_USERDATA 131080

// MAMANO SCRATCH
defineprojectile 15729 PROJ_WORKSLIKE 2129986
defineprojectile 15729 PROJ_EXTRA 35
defineprojectile 15729 PROJ_EXTRA_RAND 15
defineprojectile 15729 PROJ_HITRADIUS 0
defineprojectile 15729 PROJ_RANGE 3
defineprojectile 15729 PROJ_ISOUND RIPPER_SCRATCH
defineprojectile 15729 PROJ_USERDATA 131080

// GUARDIAN SLASH
defineprojectile 17849 PROJ_WORKSLIKE 2129986
defineprojectile 17849 PROJ_EXTRA 25
defineprojectile 17849 PROJ_EXTRA_RAND 20
defineprojectile 17849 PROJ_HITRADIUS 0
defineprojectile 17849 PROJ_RANGE 3
defineprojectile 17849 PROJ_ISOUND GUARDIAN_HIT
defineprojectile 17849 PROJ_USERDATA 131080

// BERSERKER SLEDGE
defineprojectile 11741 PROJ_WORKSLIKE 2134082
defineprojectile 11741 PROJ_EXTRA 20
defineprojectile 11741 PROJ_EXTRA_RAND 20
defineprojectile 11741 PROJ_HITRADIUS 0
defineprojectile 11741 PROJ_RANGE 3
defineprojectile 11741 PROJ_ISOUND BERSERK_HIT
defineprojectile 11741 PROJ_USERDATA 131072

// BERSERKER SUPER SLEDGE
defineprojectile 11742 PROJ_WORKSLIKE 2129986
defineprojectile 11742 PROJ_EXTRA 50
defineprojectile 11742 PROJ_EXTRA_RAND 50
defineprojectile 11742 PROJ_HITRADIUS 0
defineprojectile 11742 PROJ_RANGE 3
defineprojectile 11742 PROJ_ISOUND SPUNCHHIT
defineprojectile 11742 PROJ_USERDATA 131136

// PUNCH

defineprojectile 5357 PROJ_WORKSLIKE 2129986
defineprojectile 5357 PROJ_EXTRA 20
defineprojectile 5357 PROJ_EXTRA_RAND 20
defineprojectile 5357 PROJ_HITRADIUS 0
defineprojectile 5357 PROJ_RANGE 3
defineprojectile 5357 PROJ_ISOUND BIONIC_PUNCH
defineprojectile 5357 PROJ_USERDATA 131072

// KICK
defineprojectile KICK_2 PROJ_WORKSLIKE 2129986
defineprojectile KICK_2 PROJ_EXTRA 13
defineprojectile KICK_2 PROJ_HITRADIUS 0
defineprojectile KICK_2 PROJ_RANGE 2
defineprojectile KICK_2 PROJ_ISOUND KICK_HIT
defineprojectile KICK_2 PROJ_USERDATA 131072

// DAGGER
defineprojectile 14604 PROJ_WORKSLIKE 2129986
defineprojectile 14604 PROJ_EXTRA 40
defineprojectile 14604 PROJ_EXTRA_RAND 10
defineprojectile 14604 PROJ_HITRADIUS 0
defineprojectile 14604 PROJ_RANGE 2
defineprojectile 14604 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 14604 PROJ_USERDATA 131136

// GOLD DAGGER
defineprojectile 14605 PROJ_WORKSLIKE 2129986
defineprojectile 14605 PROJ_EXTRA 25
defineprojectile 14605 PROJ_EXTRA_RAND 25
defineprojectile 14605 PROJ_HITRADIUS 0
defineprojectile 14605 PROJ_RANGE 2
defineprojectile 14605 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 14605 PROJ_USERDATA 131152

// KNIFE
defineprojectile 4963 PROJ_WORKSLIKE 2129986
defineprojectile 4963 PROJ_EXTRA 15
defineprojectile 4963 PROJ_HITRADIUS 0
defineprojectile 4963 PROJ_RANGE 2
defineprojectile 4963 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 4963 PROJ_USERDATA 131200

// SILVER KNIFE
defineprojectile 12203 PROJ_WORKSLIKE 2129986
defineprojectile 12203 PROJ_EXTRA 10
defineprojectile 12203 PROJ_HITRADIUS 0
defineprojectile 12203 PROJ_RANGE 2
defineprojectile 12203 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 12203 PROJ_USERDATA 131456

// COMBAT SHOVEL
defineprojectile 12204 PROJ_WORKSLIKE 2129986
defineprojectile 12204 PROJ_EXTRA 20
defineprojectile 12204 PROJ_HITRADIUS 0
defineprojectile 12204 PROJ_RANGE 3
defineprojectile 12204 PROJ_ISOUND SHOVEL_IMPACT
defineprojectile 12204 PROJ_USERDATA 131200


// SWORD
defineprojectile 4961 PROJ_WORKSLIKE 2129986
defineprojectile 4961 PROJ_EXTRA 100
defineprojectile 4961 PROJ_HITRADIUS -1
defineprojectile 4961 PROJ_RANGE 3
defineprojectile 4961 PROJ_ISOUND 4
defineprojectile 4961 PROJ_USERDATA 133120

// Gold SWORD
defineprojectile 19802 PROJ_WORKSLIKE 2129986
defineprojectile 19802 PROJ_EXTRA 80
defineprojectile 19802 PROJ_HITRADIUS 0
defineprojectile 19802 PROJ_RANGE 3
defineprojectile 19802 PROJ_ISOUND 4
defineprojectile 19802 PROJ_USERDATA 131152

// GUANDAO
defineprojectile 16076 PROJ_WORKSLIKE 2129986
defineprojectile 16076 PROJ_EXTRA 75
defineprojectile 16076 PROJ_HITRADIUS 0
defineprojectile 16076 PROJ_RANGE 5
defineprojectile 16076 PROJ_ISOUND 4
defineprojectile 16076 PROJ_USERDATA 133120

// LONG AXE
defineprojectile 13404 PROJ_WORKSLIKE 2129986
defineprojectile 13404 PROJ_EXTRA 120
defineprojectile 13404 PROJ_HITRADIUS 0
defineprojectile 13404 PROJ_RANGE 3
defineprojectile 13404 PROJ_ISOUND 4
defineprojectile 13404 PROJ_USERDATA 131080

// ARMOUR-PEIRCING STRIKE
defineprojectile 13383 PROJ_WORKSLIKE 2129986
defineprojectile 13383 PROJ_EXTRA 40
defineprojectile 13383 PROJ_HITRADIUS 0
defineprojectile 13383 PROJ_RANGE 3
defineprojectile 13383 PROJ_ISOUND METSWIPE
defineprojectile 13383 PROJ_USERDATA 131104

// SMASH
defineprojectile 9902 PROJ_WORKSLIKE 2129986
defineprojectile 9902 PROJ_EXTRA 2
defineprojectile 9902 PROJ_HITRADIUS 0
defineprojectile 9902 PROJ_RANGE 3
defineprojectile 9902 PROJ_ISOUND 4
defineprojectile 9902 PROJ_USERDATA 131072

// KATANA
defineprojectile 12053 PROJ_WORKSLIKE 2134082
defineprojectile 12053 PROJ_EXTRA 50
defineprojectile 12053 PROJ_EXTRA_RAND 30
defineprojectile 12053 PROJ_HITRADIUS 0
defineprojectile 12053 PROJ_RANGE 3
defineprojectile 12053 PROJ_ISOUND 4
defineprojectile 12053 PROJ_USERDATA 131208

// BEAM SABRE
defineprojectile 19027 PROJ_WORKSLIKE 2134082
defineprojectile 19027 PROJ_EXTRA 100
defineprojectile 19027 PROJ_HITRADIUS 0
defineprojectile 19027 PROJ_RANGE 3
defineprojectile 19027 PROJ_ISOUND 4
defineprojectile 19027 PROJ_USERDATA 131160

// CHAINSAW
defineprojectile 10247 PROJ_WORKSLIKE 2129986
defineprojectile 10247 PROJ_EXTRA 20
defineprojectile 10247 PROJ_HITRADIUS 0
defineprojectile 10247 PROJ_RANGE 3
defineprojectile 10247 PROJ_ISOUND 4
defineprojectile 10247 PROJ_USERDATA 133120

// MOP
defineprojectile 12054 PROJ_WORKSLIKE 2129986
defineprojectile 12054 PROJ_EXTRA 50
defineprojectile 12054 PROJ_HITRADIUS 0
defineprojectile 12054 PROJ_RANGE 4
defineprojectile 12054 PROJ_ISOUND 4
defineprojectile 12054 PROJ_USERDATA 131208

// DRAGONSL
defineprojectile 19 PROJ_WORKSLIKE 2129986
defineprojectile 19 PROJ_EXTRA 200
defineprojectile 19 PROJ_ISOUND DRAGONSLAYERHIT
defineprojectile 19 PROJ_HITRADIUS 0
defineprojectile 19 PROJ_RANGE 8
defineprojectile 19 PROJ_USERDATA 131160

// AXE
defineprojectile 4960 PROJ_WORKSLIKE 2129986
defineprojectile 4960 PROJ_EXTRA 150
defineprojectile 4960 PROJ_ISOUND 4
defineprojectile 4960 PROJ_HITRADIUS 0
defineprojectile 4960 PROJ_RANGE 5
defineprojectile 4960 PROJ_USERDATA 131080

// BAYONET
defineprojectile 6874 PROJ_WORKSLIKE 2129986
defineprojectile 6874 PROJ_EXTRA 100
defineprojectile 6874 PROJ_EXTRA_RAND 25
defineprojectile 6874 PROJ_ISOUND METSWIPE2
defineprojectile 6874 PROJ_HITRADIUS 0
defineprojectile 6874 PROJ_RANGE 5
defineprojectile 6874 PROJ_USERDATA 133120

// SILVER BAYONET
defineprojectile 6875 PROJ_WORKSLIKE 2129986
defineprojectile 6875 PROJ_EXTRA 50
defineprojectile 6875 PROJ_EXTRA_RAND 15
defineprojectile 6875 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 6875 PROJ_HITRADIUS 0
defineprojectile 6875 PROJ_RANGE 5
defineprojectile 6875 PROJ_USERDATA 131456

// HADES SHOT
defineprojectile HADESBLAST PROJ_WORKSLIKE 32770
defineprojectile HADESBLAST PROJ_VEL 900
defineprojectile HADESBLAST PROJ_SPAWNS HADESFEXPLOSION
defineprojectile HADESBLAST PROJ_OFFSET -224
defineprojectile HADESBLAST PROJ_EXTRA 5
defineprojectile HADESBLAST PROJ_CSTAT 130
defineprojectile HADESBLAST PROJ_EXTRA_RAND 5
defineprojectile HADESBLAST PROJ_HITRADIUS 16
defineprojectile HADESBLAST PROJ_CLIPDIST 20
defineprojectile HADESBLAST PROJ_DROP 0
defineprojectile HADESBLAST PROJ_ISOUND HADES_IMPACT
defineprojectile HADESBLAST PROJ_TRAIL PROJECTILE_FLARE
defineprojectile HADESBLAST PROJ_USERDATA 16

// HADES SHOT HOME
defineprojectile HADESBLASTH PROJ_WORKSLIKE 32770
defineprojectile HADESBLASTH PROJ_VEL 400
defineprojectile HADESBLASTH PROJ_SPAWNS BRUISERFEXPLOSION
defineprojectile HADESBLASTH PROJ_OFFSET -224
defineprojectile HADESBLASTH PROJ_EXTRA 40
defineprojectile HADESBLASTH PROJ_CSTAT 130
defineprojectile HADESBLASTH PROJ_TRAIL SHADEFEXPLOSION
defineprojectile HADESBLASTH PROJ_EXTRA_RAND 15
defineprojectile HADESBLASTH PROJ_HITRADIUS 16
defineprojectile HADESBLASTH PROJ_CLIPDIST 20
defineprojectile HADESBLASTH PROJ_XREPEAT 50
defineprojectile HADESBLASTH PROJ_YREPEAT 50
defineprojectile HADESBLASTH PROJ_DROP 0
defineprojectile HADESBLASTH PROJ_ISOUND DEMON_FIREXPL
defineprojectile HADESBLASTH PROJ_USERDATA 4112

// GAS BURST
defineprojectile GASBURST PROJ_WORKSLIKE 32770
defineprojectile GASBURST PROJ_VEL 900
defineprojectile GASBURST PROJ_SPAWNS 6495
// defineprojectile GASBURST PROJ_OFFSET 14354
defineprojectile GASBURST PROJ_EXTRA 20
defineprojectile GASBURST PROJ_EXTRA_RAND 5
defineprojectile GASBURST PROJ_ISOUND GASBURST_EXPL
defineprojectile GASBURST PROJ_XREPEAT 25
defineprojectile GASBURST PROJ_YREPEAT 25
defineprojectile GASBURST PROJ_HITRADIUS 16
defineprojectile GASBURST PROJ_CLIPDIST 20
defineprojectile GASBURST PROJ_DROP 0
defineprojectile GASBURST PROJ_CSTAT 2
defineprojectile GASBURST PROJ_USERDATA 2048


// BONE SHARD
defineprojectile BONE_SHARD PROJ_WORKSLIKE 32770
defineprojectile BONE_SHARD PROJ_VEL 700
defineprojectile BONE_SHARD PROJ_SPAWNS BLOOD_EX
defineprojectile BONE_SHARD PROJ_OFFSET 2048
defineprojectile BONE_SHARD PROJ_EXTRA 10
defineprojectile BONE_SHARD PROJ_EXTRA_RAND 10
defineprojectile BONE_SHARD PROJ_ISOUND 4
defineprojectile BONE_SHARD PROJ_XREPEAT 16
defineprojectile BONE_SHARD PROJ_YREPEAT 16
defineprojectile BONE_SHARD PROJ_HITRADIUS 16
defineprojectile BONE_SHARD PROJ_CLIPDIST 20
defineprojectile BONE_SHARD PROJ_DROP -128
defineprojectile BONE_SHARD PROJ_USERDATA 64

// PLASMA 2
defineprojectile MPLASMA PROJ_WORKSLIKE 32770
defineprojectile MPLASMA PROJ_VEL 900
defineprojectile MPLASMA PROJ_SPAWNS 6495
defineprojectile MPLASMA PROJ_EXTRA 20
defineprojectile MPLASMA PROJ_EXTRA_RAND 25
defineprojectile MPLASMA PROJ_ISOUND 4
defineprojectile MPLASMA PROJ_XREPEAT 20
defineprojectile MPLASMA PROJ_YREPEAT 20
defineprojectile MPLASMA PROJ_HITRADIUS 16
defineprojectile MPLASMA PROJ_CLIPDIST 20
defineprojectile MPLASMA PROJ_DROP 0
defineprojectile MPLASMA PROJ_CSTAT 130
defineprojectile MPLASMA PROJ_USERDATA 129

// PLASMA 2
defineprojectile MDF_PLASMA PROJ_WORKSLIKE 32770
defineprojectile MDF_PLASMA PROJ_VEL 900
defineprojectile MDF_PLASMA PROJ_VEL_MULT 2
defineprojectile MDF_PLASMA PROJ_SPAWNS 6495
defineprojectile MDF_PLASMA PROJ_EXTRA 15
defineprojectile MDF_PLASMA PROJ_EXTRA_RAND 25
defineprojectile MDF_PLASMA PROJ_ISOUND 4
defineprojectile MDF_PLASMA PROJ_XREPEAT 20
defineprojectile MDF_PLASMA PROJ_YREPEAT 20
defineprojectile MDF_PLASMA PROJ_HITRADIUS 16
defineprojectile MDF_PLASMA PROJ_CLIPDIST 20
defineprojectile MDF_PLASMA PROJ_DROP 0
defineprojectile MDF_PLASMA PROJ_CSTAT 130
defineprojectile MDF_PLASMA PROJ_USERDATA 129

// SHADE FIREBALL
defineprojectile 7526 PROJ_WORKSLIKE 36866
defineprojectile 7526 PROJ_EXTRA 10
defineprojectile 7526 PROJ_EXTRA_RAND 10
defineprojectile 7526 PROJ_ISOUND DEMON_FIREXPL
defineprojectile 7526 PROJ_HITRADIUS 256
defineprojectile 7526 PROJ_XREPEAT 26
defineprojectile 7526 PROJ_YREPEAT 26
defineprojectile 7526 PROJ_OFFSET 14354
defineprojectile 7526 PROJ_TRAIL SHADEFEXPLOSION
defineprojectile 7526 PROJ_SPAWNS SHADEFEXPLOSION
defineprojectile 7526 PROJ_USERDATA 18
defineprojectile 7526 PROJ_CSTAT 130

// ANUBIS magic blast
defineprojectile 12712 PROJ_WORKSLIKE 32770
defineprojectile 12712 PROJ_EXTRA 10
defineprojectile 12712 PROJ_EXTRA_RAND 10
defineprojectile 12712 PROJ_ISOUND TRANSFORM
defineprojectile 12712 PROJ_HITRADIUS 256
defineprojectile 12712 PROJ_XREPEAT 26
defineprojectile 12712 PROJ_YREPEAT 26
defineprojectile 12712 PROJ_OFFSET 14354
defineprojectile 12712 PROJ_TRAIL -1
defineprojectile 12712 PROJ_SPAWNS 12722
defineprojectile 12712 PROJ_USERDATA 16
defineprojectile 12712 PROJ_CSTAT 130

action AN_MAGIC_FRAMES 0 2 5 1 10
useractor notenemy 12712 0 AN_MAGIC_FRAMES enda

// SIREN curse blast
defineprojectile 12717 PROJ_WORKSLIKE 32770
defineprojectile 12717 PROJ_EXTRA 10
defineprojectile 12717 PROJ_EXTRA_RAND 0
defineprojectile 12717 PROJ_ISOUND TRANSFORM
defineprojectile 12717 PROJ_HITRADIUS 256
defineprojectile 12717 PROJ_XREPEAT 26
defineprojectile 12717 PROJ_YREPEAT 26
defineprojectile 12717 PROJ_PAL 18
defineprojectile 12717 PROJ_OFFSET 14354
defineprojectile 12717 PROJ_TRAIL -1
defineprojectile 12717 PROJ_SPAWNS 12722
defineprojectile 12717 PROJ_USERDATA 266240
defineprojectile 12717 PROJ_CSTAT 130

action PC_MAGIC_FRAMES -5 2 5 1 10
useractor notenemy 12717 0 PC_MAGIC_FRAMES enda

// BRUISER FIREBALL
defineprojectile BRUISERFIREBALL PROJ_WORKSLIKE 32770
defineprojectile BRUISERFIREBALL PROJ_EXTRA 30
defineprojectile BRUISERFIREBALL PROJ_EXTRA_RAND 20
defineprojectile BRUISERFIREBALL PROJ_ISOUND DEMON_FIREXPL
defineprojectile BRUISERFIREBALL PROJ_HITRADIUS 256
defineprojectile BRUISERFIREBALL PROJ_XREPEAT 30
defineprojectile BRUISERFIREBALL PROJ_YREPEAT 30
defineprojectile BRUISERFIREBALL PROJ_OFFSET 14354
defineprojectile BRUISERFIREBALL PROJ_TRAIL SHADEFEXPLOSION
defineprojectile BRUISERFIREBALL PROJ_SPAWNS BRUISERFEXPLOSION
defineprojectile BRUISERFIREBALL PROJ_USERDATA 18
defineprojectile BRUISERFIREBALL PROJ_CSTAT 130

// RUBY BLAST
defineprojectile RUBYBLAST PROJ_WORKSLIKE 32770
defineprojectile RUBYBLAST PROJ_VEL 900
defineprojectile RUBYBLAST PROJ_SPAWNS RUBYBLAST_EX
defineprojectile RUBYBLAST PROJ_OFFSET 2048
defineprojectile RUBYBLAST PROJ_EXTRA 50
defineprojectile RUBYBLAST PROJ_EXTRA_RAND 50
defineprojectile RUBYBLAST PROJ_ISOUND RUBYBLAST_EXPLODE
defineprojectile RUBYBLAST PROJ_XREPEAT 10
defineprojectile RUBYBLAST PROJ_YREPEAT 10
defineprojectile RUBYBLAST PROJ_CLIPDIST 20
defineprojectile RUBYBLAST PROJ_DROP 0
defineprojectile RUBYBLAST PROJ_USERDATA 81
defineprojectile RUBYBLAST PROJ_CSTAT 130

// AP SLUG
defineprojectile 5125 PROJ_VEL 999
defineprojectile 5125 PROJ_VEL_MULT 2
defineprojectile 5125 PROJ_WORKSLIKE 32770
defineprojectile 5125 PROJ_EXTRA 70
defineprojectile 5125 PROJ_EXTRA_RAND 25
defineprojectile 5125 PROJ_ISOUND SPUNCHHIT
defineprojectile 5125 PROJ_HITRADIUS 0
defineprojectile 5125 PROJ_HITRADIUS 32
defineprojectile 5125 PROJ_USERDATA 32

// 50 cal slow projectile
defineprojectile 22442 PROJ_VEL 999
// defineprojectile 22442 PROJ_VEL_MULT 2
defineprojectile 22442 PROJ_WORKSLIKE 32770
defineprojectile 22442 PROJ_EXTRA 200
defineprojectile 22442 PROJ_OFFSET 14354
defineprojectile 22442 PROJ_EXTRA_RAND 50
defineprojectile 22442 PROJ_ISOUND SPUNCHHIT
defineprojectile 22442 PROJ_SPAWNS 8433
defineprojectile 22442 PROJ_HITRADIUS 32
defineprojectile 22442 PROJ_CSTAT 130
defineprojectile 22442 PROJ_USERDATA 32

// RANDOM TRACERFIRE
defineprojectile 13215 PROJ_WORKSLIKE 1
defineprojectile 13215 PROJ_EXTRA 0
defineprojectile 13215 PROJ_EXTRA_RAND 0
defineprojectile 13215 PROJ_TRAIL 13216
defineprojectile 13215 PROJ_TXREPEAT 16 
defineprojectile 13215 PROJ_TYREPEAT 16 
defineprojectile 13215 PROJ_TNUM 128 

// EXPLOSIVE SHOTGUN SHELL

defineprojectile 9361 PROJ_VEL 999
defineprojectile 9361 PROJ_VEL_MULT 2
defineprojectile 9361 PROJ_WORKSLIKE 98306
defineprojectile 9361 PROJ_SPAWNS EXPLOSION2
defineprojectile 9361 PROJ_BOUNCES -1
defineprojectile 9361 PROJ_EXTRA 25
defineprojectile 9361 PROJ_ISOUND EXPLOSION_LARGE
defineprojectile 9361 PROJ_HITRADIUS 2048
defineprojectile 9361 PROJ_USERDATA 64

// EXPLOSIVE SHELL (Fired from Mech)
defineprojectile 9359 PROJ_VEL 999
defineprojectile 9359 PROJ_VEL_MULT 2
defineprojectile 9359 PROJ_WORKSLIKE 98306
defineprojectile 9359 PROJ_SPAWNS EXPLOSION2
defineprojectile 9359 PROJ_EXTRA 30
defineprojectile 9359 PROJ_OFFSET -224
defineprojectile 9359 PROJ_ISOUND EXPLOSION_LARGE
defineprojectile 9359 PROJ_HITRADIUS 4096
defineprojectile 9359 PROJ_USERDATA 64

// DRAGON'S BREATH

defineprojectile 22536 PROJ_WORKSLIKE 36930
defineprojectile 22536 PROJ_EXTRA 10
defineprojectile 22536 PROJ_VEL 900
defineprojectile 22536 PROJ_EXTRA_RAND 5
defineprojectile 22536 PROJ_ISOUND EXPLOSION_SMALL
defineprojectile 22536 PROJ_HITRADIUS 256
defineprojectile 22536 PROJ_XREPEAT 26
defineprojectile 22536 PROJ_YREPEAT 26
defineprojectile 22536 PROJ_RANGE 60
defineprojectile 22536 PROJ_TRAIL 3296
defineprojectile 22536 PROJ_SPAWNS SHADEFEXPLOSION
defineprojectile 22536 PROJ_USERDATA 18
defineprojectile 22536 PROJ_CSTAT 130

// STATIC BURST

defineprojectile 22610 PROJ_WORKSLIKE 36930
defineprojectile 22610 PROJ_EXTRA 50
defineprojectile 22610 PROJ_VEL 900
defineprojectile 22610 PROJ_EXTRA_RAND 25
defineprojectile 22610 PROJ_ISOUND THUNDERBALL_HIT
defineprojectile 22610 PROJ_HITRADIUS 256
defineprojectile 22610 PROJ_XREPEAT 26
defineprojectile 22610 PROJ_YREPEAT 26
defineprojectile 22610 PROJ_RANGE 60
defineprojectile 22610 PROJ_TRAIL 8433
defineprojectile 22610 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile 22610 PROJ_USERDATA 8192
defineprojectile 22610 PROJ_CSTAT 130


// NAILS
defineprojectile 6826 PROJ_VEL 999
defineprojectile 6826 PROJ_VEL_MULT 2
defineprojectile 6826 PROJ_WORKSLIKE 32770
defineprojectile 6826 PROJ_EXTRA 14
defineprojectile 6826 PROJ_EXTRA_RAND 5
defineprojectile 6826 PROJ_ISOUND METALCLINK
defineprojectile 6826 PROJ_HITRADIUS 32
defineprojectile 6826 PROJ_USERDATA 32

// AURA NAILS
defineprojectile 6816 PROJ_VEL 999
defineprojectile 6816 PROJ_VEL_MULT 2
defineprojectile 6816 PROJ_WORKSLIKE 32770
defineprojectile 6816 PROJ_EXTRA 14
defineprojectile 6816 PROJ_EXTRA_RAND 5
defineprojectile 6816 PROJ_ISOUND METALCLINK
defineprojectile 6816 PROJ_HITRADIUS 32
defineprojectile 6816 PROJ_USERDATA 48

// HELL NAILS
defineprojectile 22631 PROJ_VEL 999
defineprojectile 22631 PROJ_VEL_MULT 2
defineprojectile 22631 PROJ_WORKSLIKE 32770
defineprojectile 22631 PROJ_EXTRA 14
defineprojectile 22631 PROJ_EXTRA_RAND 5
defineprojectile 22631 PROJ_ISOUND LAVA_SPLASH
defineprojectile 22631 PROJ_HITRADIUS 32
defineprojectile 22631 PROJ_USERDATA 34

useractor notenemy 22631 0 MICRO_MISSILE_FRAMES enda

// LASER PISTOL
defineprojectile 5394 PROJ_WORKSLIKE 32770
defineprojectile 5394 PROJ_VEL 700
defineprojectile 5394 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 5394 PROJ_SPAWNS CRYSTALEXPLOSION
defineprojectile 5394 PROJ_EXTRA 6
defineprojectile 5394 PROJ_EXTRA_RAND 10
defineprojectile 5394 PROJ_XREPEAT 20
defineprojectile 5394 PROJ_YREPEAT 20
defineprojectile 5394 PROJ_HITRADIUS 8
defineprojectile 5394 PROJ_CSTAT 130
defineprojectile 5394 PROJ_DROP 0
defineprojectile 5394 PROJ_USERDATA 48

defineprojectile GOLD_SPELL1 PROJ_WORKSLIKE 32778
defineprojectile GOLD_SPELL1 PROJ_VEL 600
defineprojectile GOLD_SPELL1 PROJ_SPAWNS CRYSTALEXPLOSION
defineprojectile GOLD_SPELL1 PROJ_EXTRA 5
defineprojectile GOLD_SPELL1 PROJ_HITRADIUS 8
defineprojectile GOLD_SPELL1 PROJ_CLIPDIST 20
defineprojectile GOLD_SPELL1 PROJ_DROP 0
defineprojectile GOLD_SPELL1 PROJ_USERDATA 80

defineprojectile GOLD_SPELL2 PROJ_WORKSLIKE 32778
defineprojectile GOLD_SPELL2 PROJ_VEL 900
defineprojectile GOLD_SPELL2 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile GOLD_SPELL2 PROJ_EXTRA 105
defineprojectile GOLD_SPELL2 PROJ_HITRADIUS 8
defineprojectile GOLD_SPELL2 PROJ_CLIPDIST 20
defineprojectile GOLD_SPELL2 PROJ_DROP 0
defineprojectile GOLD_SPELL2 PROJ_CSTAT 130
defineprojectile GOLD_SPELL2 PROJ_ISOUND SPELL_HIT
defineprojectile GOLD_SPELL2 PROJ_TRAIL PROJECTILE_FLARE
defineprojectile GOLD_SPELL2 PROJ_USERDATA 81

defineprojectile 19807 PROJ_WORKSLIKE 32770
defineprojectile 19807 PROJ_VEL 800
defineprojectile 19807 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile 19807 PROJ_EXTRA 15
defineprojectile 19807 PROJ_HITRADIUS 16
defineprojectile 19807 PROJ_CLIPDIST 20
defineprojectile 19807 PROJ_XREPEAT 5
defineprojectile 19807 PROJ_YREPEAT 5
defineprojectile 19807 PROJ_DROP 0
defineprojectile 19807 PROJ_TRAIL PROJECTILE_FLARE
defineprojectile 19807 PROJ_ISOUND SPELL_HIT
defineprojectile 19807 PROJ_CSTAT 130
defineprojectile 19807 PROJ_USERDATA 81

defineprojectile SPELL1 PROJ_WORKSLIKE 32778
defineprojectile SPELL1 PROJ_VEL 600
defineprojectile SPELL1 PROJ_SPAWNS CRYSTALEXPLOSION
defineprojectile SPELL1 PROJ_EXTRA 5
defineprojectile SPELL1 PROJ_EXTRA_RAND 3
defineprojectile SPELL1 PROJ_HITRADIUS 8
defineprojectile SPELL1 PROJ_CLIPDIST 20
defineprojectile SPELL1 PROJ_DROP 0
defineprojectile SPELL1 PROJ_USERDATA 16

defineprojectile PRIEST_BLAST PROJ_WORKSLIKE 36866
defineprojectile PRIEST_BLAST PROJ_VEL 600
defineprojectile PRIEST_BLAST PROJ_SPAWNS -1
defineprojectile PRIEST_BLAST PROJ_EXTRA 20
defineprojectile PRIEST_BLAST PROJ_CSTAT 130
defineprojectile PRIEST_BLAST PROJ_XREPEAT 4
defineprojectile PRIEST_BLAST PROJ_YREPEAT 4
defineprojectile PRIEST_BLAST PROJ_EXTRA_RAND 15
defineprojectile PRIEST_BLAST PROJ_HITRADIUS 8
defineprojectile PRIEST_BLAST PROJ_CLIPDIST 20
defineprojectile PRIEST_BLAST PROJ_DROP 0
defineprojectile PRIEST_BLAST PROJ_OFFSET 14354
defineprojectile PRIEST_BLAST PROJ_TRAIL CRYSTALEXPLOSION
defineprojectile PRIEST_BLAST PROJ_USERDATA 16384

// MIA Gun blast
defineprojectile 9376 PROJ_WORKSLIKE 32778
defineprojectile 9376 PROJ_VEL 800
defineprojectile 9376 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile 9376 PROJ_EXTRA 1
defineprojectile 9376 PROJ_HITRADIUS 8
defineprojectile 9376 PROJ_CLIPDIST 20
defineprojectile 9376 PROJ_XREPEAT 32
defineprojectile 9376 PROJ_YREPEAT 32
defineprojectile 9376 PROJ_DROP 0
defineprojectile 9376 PROJ_ISOUND SHRINKER_HIT
defineprojectile 9376 PROJ_USERDATA 80

// Electric spell
defineprojectile SPELL2 PROJ_WORKSLIKE 32778
defineprojectile SPELL2 PROJ_VEL 900
defineprojectile SPELL2 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile SPELL2 PROJ_EXTRA 95
defineprojectile SPELL2 PROJ_EXTRA_RAND 25
defineprojectile SPELL2 PROJ_HITRADIUS 8
defineprojectile SPELL2 PROJ_CLIPDIST 40
defineprojectile SPELL2 PROJ_DROP 0
defineprojectile SPELL2 PROJ_TRAIL PROJECTILE_FLARE
defineprojectile SPELL2 PROJ_ISOUND 873
defineprojectile SPELL2 PROJ_CSTAT 130
defineprojectile SPELL2 PROJ_USERDATA 8272

// Riot Gun Tesla Charge
defineprojectile 6198 PROJ_WORKSLIKE 32770
defineprojectile 6198 PROJ_VEL 800
defineprojectile 6198 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile 6198 PROJ_EXTRA 25
defineprojectile 6198 PROJ_EXTRA_RAND 10
defineprojectile 6198 PROJ_HITRADIUS 16
defineprojectile 6198 PROJ_CLIPDIST 20
defineprojectile 6198 PROJ_XREPEAT 5
defineprojectile 6198 PROJ_YREPEAT 5
defineprojectile 6198 PROJ_DROP 0
defineprojectile 6198 PROJ_TRAIL PROJECTILE_FLARE
defineprojectile 6198 PROJ_ISOUND 873
defineprojectile 6198 PROJ_CSTAT 130
defineprojectile 6198 PROJ_USERDATA 8272

// Geo shockrifle Charge
defineprojectile 6627 PROJ_WORKSLIKE 32770
defineprojectile 6627 PROJ_VEL 800
defineprojectile 6627 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile 6627 PROJ_EXTRA 30
defineprojectile 6627 PROJ_EXTRA_RAND 5
defineprojectile 6627 PROJ_HITRADIUS 16
defineprojectile 6627 PROJ_CLIPDIST 20
defineprojectile 6627 PROJ_XREPEAT 5
defineprojectile 6627 PROJ_YREPEAT 5
defineprojectile 6627 PROJ_DROP 0
defineprojectile 6627 PROJ_ISOUND 873
defineprojectile 6627 PROJ_CSTAT 130
defineprojectile 6627 PROJ_USERDATA 8272

// Nemesis blast
defineprojectile SPELL8 PROJ_WORKSLIKE 36866
defineprojectile SPELL8 PROJ_VEL 800
defineprojectile SPELL8 PROJ_SPAWNS SKULLEXPLOSION
defineprojectile SPELL8 PROJ_EXTRA 150
defineprojectile SPELL8 PROJ_OFFSET 5000
defineprojectile SPELL8 PROJ_HITRADIUS 512
defineprojectile SPELL8 PROJ_CLIPDIST 20
defineprojectile SPELL8 PROJ_DROP 0
defineprojectile SPELL8 PROJ_ISOUND SPELL_HIT
defineprojectile SPELL8 PROJ_TRAIL PROJECTILE_FLARE
defineprojectile SPELL8 PROJ_USERDATA 16400

defineprojectile STYGIAN_ROCK PROJ_WORKSLIKE 32770
defineprojectile STYGIAN_ROCK PROJ_VEL 800
defineprojectile STYGIAN_ROCK PROJ_SPAWNS SKULLEXPLOSION
defineprojectile STYGIAN_ROCK PROJ_EXTRA 250
defineprojectile STYGIAN_ROCK PROJ_EXTRA_RAND 100
defineprojectile STYGIAN_ROCK PROJ_HITRADIUS 1780
defineprojectile STYGIAN_ROCK PROJ_XREPEAT 42
defineprojectile STYGIAN_ROCK PROJ_YREPEAT 42
defineprojectile STYGIAN_ROCK PROJ_CLIPDIST 20
defineprojectile STYGIAN_ROCK PROJ_DROP -64
defineprojectile STYGIAN_ROCK PROJ_ISOUND BARREL_EXPLODE
defineprojectile STYGIAN_ROCK PROJ_TRAIL SHADEFEXPLOSION
defineprojectile STYGIAN_ROCK PROJ_USERDATA 80

// MORPHRAY
defineprojectile SPELL5 PROJ_WORKSLIKE 32770
defineprojectile SPELL5 PROJ_VEL 800
defineprojectile SPELL5 PROJ_SPAWNS SHADEFEXPLOSION
defineprojectile SPELL5 PROJ_EXTRA 1
defineprojectile SPELL5 PROJ_HITRADIUS 8
defineprojectile SPELL5 PROJ_CLIPDIST 20
defineprojectile SPELL5 PROJ_DROP 0
defineprojectile SPELL5 PROJ_ISOUND SPELL_HIT
defineprojectile SPELL5 PROJ_USERDATA 16

// MORPHRAY2
defineprojectile SPELL14 PROJ_WORKSLIKE 32770
defineprojectile SPELL14 PROJ_VEL 800
defineprojectile SPELL14 PROJ_SPAWNS SHADEFEXPLOSION
defineprojectile SPELL14 PROJ_EXTRA 1
defineprojectile SPELL14 PROJ_HITRADIUS 8
defineprojectile SPELL14 PROJ_CLIPDIST 20
defineprojectile SPELL14 PROJ_DROP 0
defineprojectile SPELL14 PROJ_ISOUND SPELL_HIT
defineprojectile SPELL14 PROJ_USERDATA 16

// PULSE
defineprojectile 6857 PROJ_WORKSLIKE 32770
defineprojectile 6857 PROJ_VEL 800
defineprojectile 6857 PROJ_SPAWNS PULSEEXPLOSION
defineprojectile 6857 PROJ_EXTRA 30
defineprojectile 6857 PROJ_HITRADIUS 8
defineprojectile 6857 PROJ_XREPEAT 16
defineprojectile 6857 PROJ_YREPEAT 16
defineprojectile 6857 PROJ_OFFSET 224
defineprojectile 6857 PROJ_CLIPDIST 20
defineprojectile 6857 PROJ_DROP 0
defineprojectile 6857 PROJ_CSTAT 130
defineprojectile 6857 PROJ_ISOUND PULSE_HIT
defineprojectile 6857 PROJ_USERDATA 1

defineprojectile MINE_DART PROJ_WORKSLIKE 32770
defineprojectile MINE_DART PROJ_VEL 999
defineprojectile MINE_DART PROJ_VEL_MULT 2
defineprojectile MINE_DART PROJ_SPAWNS -1
defineprojectile MINE_DART PROJ_EXTRA 1
defineprojectile MINE_DART PROJ_HITRADIUS 8
defineprojectile MINE_DART PROJ_XREPEAT 8
defineprojectile MINE_DART PROJ_YREPEAT 8
defineprojectile MINE_DART PROJ_CLIPDIST 20
defineprojectile MINE_DART PROJ_DROP 0
defineprojectile MINE_DART PROJ_ISOUND BOLT_MISS

defineprojectile IN_MINE_DART PROJ_WORKSLIKE 32770
defineprojectile IN_MINE_DART PROJ_VEL 999
defineprojectile IN_MINE_DART PROJ_VEL_MULT 2
defineprojectile IN_MINE_DART PROJ_SPAWNS -1
defineprojectile IN_MINE_DART PROJ_EXTRA 1
defineprojectile IN_MINE_DART PROJ_HITRADIUS 8
defineprojectile IN_MINE_DART PROJ_XREPEAT 8
defineprojectile IN_MINE_DART PROJ_YREPEAT 8
defineprojectile IN_MINE_DART PROJ_CLIPDIST 20
defineprojectile IN_MINE_DART PROJ_DROP 0
defineprojectile IN_MINE_DART PROJ_ISOUND BOLT_MISS

defineprojectile DAYBLAST PROJ_WORKSLIKE 32770
defineprojectile DAYBLAST PROJ_VEL 400
defineprojectile DAYBLAST PROJ_SPAWNS TRANSPORTERSTAR
defineprojectile DAYBLAST PROJ_EXTRA 15
defineprojectile DAYBLAST PROJ_HITRADIUS 8
defineprojectile DAYBLAST PROJ_XREPEAT 15
defineprojectile DAYBLAST PROJ_YREPEAT 15
defineprojectile DAYBLAST PROJ_CLIPDIST 20
defineprojectile DAYBLAST PROJ_DROP 0
defineprojectile DAYBLAST PROJ_ISOUND DL_EXPLODE
defineprojectile DAYBLAST PROJ_USERDATA 1

// PLASMA
defineprojectile 5372 PROJ_WORKSLIKE 36866
defineprojectile 5372 PROJ_VEL 900
defineprojectile 5372 PROJ_SPAWNS TRANSPORTERSTAR
defineprojectile 5372 PROJ_EXTRA 30
defineprojectile 5372 PROJ_HITRADIUS 8
defineprojectile 5372 PROJ_XREPEAT 5
defineprojectile 5372 PROJ_YREPEAT 5
defineprojectile 5372 PROJ_CLIPDIST 20
defineprojectile 5372 PROJ_BOUNCES 3
defineprojectile 5372 PROJ_DROP 0
defineprojectile 5372 PROJ_ISOUND 4
defineprojectile 5372 PROJ_USERDATA 145
defineprojectile 5372 PROJ_CSTAT 130
defineprojectile 5372 PROJ_OFFSET 224

// PLASMA BOUNCE
defineprojectile 5374 PROJ_WORKSLIKE 32782
defineprojectile 5374 PROJ_VEL 900
defineprojectile 5374 PROJ_SPAWNS TRANSPORTERSTAR
defineprojectile 5374 PROJ_EXTRA 25
defineprojectile 5374 PROJ_HITRADIUS 8
defineprojectile 5374 PROJ_XREPEAT 5
defineprojectile 5374 PROJ_YREPEAT 5
defineprojectile 5374 PROJ_CLIPDIST 20
defineprojectile 5374 PROJ_DROP 0
defineprojectile 5374 PROJ_ISOUND 4
defineprojectile 5374 PROJ_BSOUND 4
defineprojectile 5374 PROJ_USERDATA 145
defineprojectile 5374 PROJ_CSTAT 130

defineprojectile PETRIFYRAY PROJ_WORKSLIKE 32782
defineprojectile PETRIFYRAY PROJ_VEL 800
defineprojectile PETRIFYRAY PROJ_SPAWNS TRANSPORTERSTAR
defineprojectile PETRIFYRAY PROJ_EXTRA 500
defineprojectile PETRIFYRAY PROJ_HITRADIUS 8
defineprojectile PETRIFYRAY PROJ_XREPEAT 7
defineprojectile PETRIFYRAY PROJ_YREPEAT 7
defineprojectile PETRIFYRAY PROJ_CLIPDIST 20
defineprojectile PETRIFYRAY PROJ_DROP 0
defineprojectile PETRIFYRAY PROJ_XREPEAT 16
defineprojectile PETRIFYRAY PROJ_YREPEAT 16
defineprojectile PETRIFYRAY PROJ_ISOUND 4
defineprojectile PETRIFYRAY PROJ_BOUNCES 3
defineprojectile PETRIFYRAY PROJ_BSOUND 4
defineprojectile PETRIFYRAY PROJ_USERDATA 80
defineprojectile PETRIFYRAY PROJ_CSTAT 130

defineprojectile SPELL4 PROJ_WORKSLIKE 2
defineprojectile SPELL4 PROJ_VEL 800
defineprojectile SPELL4 PROJ_SPAWNS EXPLOSION2
defineprojectile SPELL4 PROJ_EXTRA 200
defineprojectile SPELL4 PROJ_HITRADIUS 1780
defineprojectile SPELL4 PROJ_XREPEAT 42
defineprojectile SPELL4 PROJ_YREPEAT 42
defineprojectile SPELL4 PROJ_CLIPDIST 20
defineprojectile SPELL4 PROJ_DROP 0
defineprojectile SPELL4 PROJ_ISOUND BARREL_EXPLODE
defineprojectile SPELL4 PROJ_TRAIL SMALLSMOKE
defineprojectile SPELL4 PROJ_USERDATA 80

spritenoshade 6221
spritenopal 6221

defineprojectile 6221 PROJ_WORKSLIKE 2
defineprojectile 6221 PROJ_VEL 500
defineprojectile 6221 PROJ_SPAWNS SKULLEXPLOSION
defineprojectile 6221 PROJ_EXTRA 50
defineprojectile 6221 PROJ_HITRADIUS 1780
defineprojectile 6221 PROJ_XREPEAT 42
defineprojectile 6221 PROJ_YREPEAT 42
defineprojectile 6221 PROJ_CLIPDIST 20
defineprojectile 6221 PROJ_DROP 0
defineprojectile 6221 PROJ_PAL 30
defineprojectile 6221 PROJ_CSTAT 2
defineprojectile 6221 PROJ_ISOUND BARREL_EXPLODE
defineprojectile 6221 PROJ_USERDATA 4112


// Ice Materia
defineprojectile 7159 PROJ_WORKSLIKE 98306
defineprojectile 7159 PROJ_VEL 700
defineprojectile 7159 PROJ_SPAWNS ENERGY_EXPLOSION
defineprojectile 7159 PROJ_EXTRA 250
defineprojectile 7159 PROJ_HITRADIUS 1024
defineprojectile 7159 PROJ_XREPEAT 42
defineprojectile 7159 PROJ_YREPEAT 42
defineprojectile 7159 PROJ_CLIPDIST 96
defineprojectile 7159 PROJ_DROP 0
defineprojectile 7159 PROJ_ISOUND DEMON_FIREXPL
defineprojectile 7159 PROJ_TRAIL SHADEFEXPLOSION
defineprojectile 7159 PROJ_USERDATA 20
defineprojectile 7159 PROJ_CSTAT 130

// Fire Materia
defineprojectile 7163 PROJ_WORKSLIKE 98306
defineprojectile 7163 PROJ_VEL 700
defineprojectile 7163 PROJ_SPAWNS EXPLOSION2
defineprojectile 7163 PROJ_EXTRA 250
defineprojectile 7163 PROJ_HITRADIUS 1024
defineprojectile 7163 PROJ_XREPEAT 42
defineprojectile 7163 PROJ_YREPEAT 42
defineprojectile 7163 PROJ_CLIPDIST 96
defineprojectile 7163 PROJ_DROP 0
defineprojectile 7163 PROJ_ISOUND DEMON_FIREXPL
defineprojectile 7163 PROJ_TRAIL SHADEFEXPLOSION
defineprojectile 7163 PROJ_USERDATA 18
defineprojectile 7163 PROJ_CSTAT 130

// Red Materia blast
defineprojectile REDM_BLAST PROJ_WORKSLIKE 65538
defineprojectile REDM_BLAST PROJ_VEL 600
defineprojectile REDM_BLAST PROJ_SPAWNS ENERGY_EXPLOSION
defineprojectile REDM_BLAST PROJ_EXTRA 700
defineprojectile REDM_BLAST PROJ_HITRADIUS 6096
defineprojectile REDM_BLAST PROJ_XREPEAT 20
defineprojectile REDM_BLAST PROJ_YREPEAT 20
defineprojectile REDM_BLAST PROJ_OFFSET 14354
defineprojectile REDM_BLAST PROJ_CLIPDIST 96
defineprojectile REDM_BLAST PROJ_CSTAT 130
defineprojectile REDM_BLAST PROJ_DROP 0
defineprojectile REDM_BLAST PROJ_ISOUND REDMGUN_EXPLODE
defineprojectile REDM_BLAST PROJ_TRAIL PROJECTILE_FLARE
defineprojectile REDM_BLAST PROJ_USERDATA 17

// BLOOD BLAST
defineprojectile BLOOD_BLAST PROJ_WORKSLIKE 65538
defineprojectile BLOOD_BLAST PROJ_VEL 600
defineprojectile BLOOD_BLAST PROJ_SPAWNS ENERGY_EXPLOSION
defineprojectile BLOOD_BLAST PROJ_EXTRA 50
defineprojectile BLOOD_BLAST PROJ_HITRADIUS 256
defineprojectile BLOOD_BLAST PROJ_XREPEAT 20
defineprojectile BLOOD_BLAST PROJ_YREPEAT 20
defineprojectile BLOOD_BLAST PROJ_OFFSET 14354
defineprojectile BLOOD_BLAST PROJ_CLIPDIST 96
defineprojectile BLOOD_BLAST PROJ_CSTAT 130
defineprojectile BLOOD_BLAST PROJ_DROP 0
defineprojectile BLOOD_BLAST PROJ_ISOUND REDMGUN_EXPLODE
defineprojectile BLOOD_BLAST PROJ_TRAIL PROJECTILE_FLARE
defineprojectile BLOOD_BLAST PROJ_USERDATA 17


// Firebomb
defineprojectile 7047 PROJ_WORKSLIKE 2
defineprojectile 7047 PROJ_VEL 800
defineprojectile 7047 PROJ_SPAWNS EXPLOSION2
defineprojectile 7047 PROJ_EXTRA 260
defineprojectile 7047 PROJ_EXTRA_RAND 140
defineprojectile 7047 PROJ_HITRADIUS 1780
defineprojectile 7047 PROJ_XREPEAT 42
defineprojectile 7047 PROJ_YREPEAT 42
defineprojectile 7047 PROJ_CLIPDIST 20
defineprojectile 7047 PROJ_DROP 0
defineprojectile 7047 PROJ_ISOUND BARREL_EXPLODE
defineprojectile 7047 PROJ_TRAIL SMALLSMOKE
defineprojectile 7047 PROJ_USERDATA 2

// Bouncing firebomb
defineprojectile 7052 PROJ_WORKSLIKE 2094
defineprojectile 7052 PROJ_VEL 600
defineprojectile 7052 PROJ_SPAWNS EXPLOSION2
defineprojectile 7052 PROJ_EXTRA 200
defineprojectile 7052 PROJ_EXTRA_RAND 140
defineprojectile 7052 PROJ_HITRADIUS 1780
defineprojectile 7052 PROJ_XREPEAT 42
defineprojectile 7052 PROJ_YREPEAT 42
defineprojectile 7052 PROJ_DROP -200
defineprojectile 7052 PROJ_BOUNCES 6
defineprojectile 7052 PROJ_ISOUND BARREL_EXPLODE
defineprojectile 7052 PROJ_BSOUND EXPLOSION_SMALL
defineprojectile 7052 PROJ_TRAIL SMALLSMOKE
defineprojectile 7052 PROJ_USERDATA 2

spritenoshade 22828

// nether brute firespit
defineprojectile 15175 PROJ_WORKSLIKE 32770
defineprojectile 15175 PROJ_VEL 700
defineprojectile 15175 PROJ_SPAWNS 15184
defineprojectile 15175 PROJ_EXTRA 35
defineprojectile 15175 PROJ_EXTRA_RAND 15
defineprojectile 15175 PROJ_OFFSET 224
defineprojectile 15175 PROJ_HITRADIUS 1780
defineprojectile 15175 PROJ_XREPEAT 55
defineprojectile 15175 PROJ_YREPEAT 55
defineprojectile 15175 PROJ_CLIPDIST 20
defineprojectile 15175 PROJ_DROP 0
defineprojectile 15175 PROJ_ISOUND EXPLOSION_SMALL
defineprojectile 15175 PROJ_TRAIL SMALLSMOKE
defineprojectile 15175 PROJ_USERDATA 18
defineprojectile 15175 PROJ_CSTAT 130

// Cobra firespit
defineprojectile 22828 PROJ_WORKSLIKE 36866
defineprojectile 22828 PROJ_VEL 700
defineprojectile 22828 PROJ_SPAWNS GORO_FLAME_EX
defineprojectile 22828 PROJ_EXTRA 15
defineprojectile 22828 PROJ_EXTRA_RAND 15
defineprojectile 22828 PROJ_HITRADIUS 1780
defineprojectile 22828 PROJ_XREPEAT 42
defineprojectile 22828 PROJ_YREPEAT 42
defineprojectile 22828 PROJ_CLIPDIST 20
defineprojectile 22828 PROJ_DROP 0
defineprojectile 22828 PROJ_ISOUND EXPLOSION_SMALL
defineprojectile 22828 PROJ_TRAIL SMALLSMOKE
defineprojectile 22828 PROJ_USERDATA 18
defineprojectile 22828 PROJ_CSTAT 130

action FIREBALL_FRAMES 0 2 5

useractor notenemy 22828 0 FIREBALL_FRAMES enda
useractor notenemy 15175 0 FIREBALL_FRAMES enda

spritenoshade MORTER2
defineprojectile MORTER2 PROJ_WORKSLIKE 34822
defineprojectile MORTER2 PROJ_BOUNCES 3
defineprojectile MORTER2 PROJ_EXTRA 30
defineprojectile MORTER2 PROJ_EXTRA_RAND 10
defineprojectile MORTER2 PROJ_HITRADIUS MORTERBLASTRADIUS
defineprojectile MORTER2 PROJ_VEL 844
defineprojectile MORTER2 PROJ_SPAWNS EXPLOSION2
defineprojectile MORTER2 PROJ_DROP -192
defineprojectile MORTER2 PROJ_ISOUND RPG_EXPLODE
defineprojectile MORTER2 PROJ_BSOUND -1
defineprojectile MORTER2 PROJ_TRAIL FRAMEEFFECT1
defineprojectile MORTER2 PROJ_XREPEAT 32
defineprojectile MORTER2 PROJ_YREPEAT 32
defineprojectile MORTER2 PROJ_SHADE -127

spritenoshade GORO_FLAME

defineprojectile GORO_FLAME PROJ_WORKSLIKE 32770
defineprojectile GORO_FLAME PROJ_VEL 800
defineprojectile GORO_FLAME PROJ_SPAWNS GORO_FLAME_EX
defineprojectile GORO_FLAME PROJ_EXTRA 5
defineprojectile GORO_FLAME PROJ_EXTRA_RAND 7
defineprojectile GORO_FLAME PROJ_HITRADIUS 0
defineprojectile GORO_FLAME PROJ_CLIPDIST 20
defineprojectile GORO_FLAME PROJ_DROP 0
defineprojectile GORO_FLAME PROJ_XREPEAT 6
defineprojectile GORO_FLAME PROJ_YREPEAT 6
defineprojectile GORO_FLAME PROJ_ISOUND EXPLOSION_SMALL
defineprojectile GORO_FLAME PROJ_USERDATA 18
defineprojectile GORO_FLAME PROJ_OFFSET 224
defineprojectile GORO_FLAME PROJ_CSTAT 130

defineprojectile GORO_EXPLODING_FLAME PROJ_WORKSLIKE 32770
defineprojectile GORO_EXPLODING_FLAME PROJ_VEL 800
// defineprojectile GORO_EXPLODING_FLAME PROJ_VEL_MULT 2
defineprojectile GORO_EXPLODING_FLAME PROJ_SPAWNS GORO_FLAME_EX
defineprojectile GORO_EXPLODING_FLAME PROJ_EXTRA 200
defineprojectile GORO_EXPLODING_FLAME PROJ_EXTRA_RAND 100
defineprojectile GORO_EXPLODING_FLAME PROJ_HITRADIUS 0
defineprojectile GORO_EXPLODING_FLAME PROJ_CLIPDIST 20
defineprojectile GORO_EXPLODING_FLAME PROJ_DROP 0
defineprojectile GORO_EXPLODING_FLAME PROJ_XREPEAT 12
defineprojectile GORO_EXPLODING_FLAME PROJ_YREPEAT 12
defineprojectile GORO_EXPLODING_FLAME PROJ_ISOUND EXPLOSION_MEDIUM
defineprojectile GORO_EXPLODING_FLAME PROJ_TRAIL EXPLOSION2
defineprojectile GORO_EXPLODING_FLAME PROJ_USERDATA 18
defineprojectile GORO_EXPLODING_FLAME PROJ_OFFSET 224
defineprojectile GORO_EXPLODING_FLAME PROJ_CSTAT 130

defineprojectile SPELL7 PROJ_WORKSLIKE 32770
defineprojectile SPELL7 PROJ_VEL 800
defineprojectile SPELL7 PROJ_SPAWNS CRYSTALEXPLOSION
defineprojectile SPELL7 PROJ_EXTRA 25
defineprojectile SPELL7 PROJ_CSTAT 2
defineprojectile SPELL7 PROJ_HITRADIUS 8
defineprojectile SPELL7 PROJ_CLIPDIST 20
defineprojectile SPELL7 PROJ_DROP 0
defineprojectile SPELL7 PROJ_ISOUND 4
defineprojectile SPELL7 PROJ_USERDATA 32816

defineprojectile DYNAMITESTICK PROJ_WORKSLIKE 65538
defineprojectile DYNAMITESTICK PROJ_HITRADIUS 2048
defineprojectile DYNAMITESTICK PROJ_VEL 600
defineprojectile DYNAMITESTICK PROJ_DROP -120
defineprojectile DYNAMITESTICK PROJ_BSOUND 4
defineprojectile DYNAMITESTICK PROJ_SOUND TNT_THROW
// defineprojectile DYNAMITESTICK PROJ_BOUNCES 0
defineprojectile DYNAMITESTICK PROJ_XREPEAT 20
defineprojectile DYNAMITESTICK PROJ_YREPEAT 20
defineprojectile DYNAMITESTICK PROJ_EXTRA 120
defineprojectile DYNAMITESTICK PROJ_ISOUND LASERTRIP_EXPLODE
defineprojectile DYNAMITESTICK PROJ_SPAWNS EXPLOSION2
defineprojectile DYNAMITESTICK PROJ_RANGE 130

// charmed dynamite stick
defineprojectile 3622 PROJ_WORKSLIKE 65538
defineprojectile 3622 PROJ_HITRADIUS 2048
defineprojectile 3622 PROJ_VEL 600
defineprojectile 3622 PROJ_DROP -120
defineprojectile 3622 PROJ_BSOUND 4
defineprojectile 3622 PROJ_SOUND TNT_THROW
// defineprojectile 3622 PROJ_BOUNCES 0
defineprojectile 3622 PROJ_XREPEAT 20
defineprojectile 3622 PROJ_YREPEAT 20
defineprojectile 3622 PROJ_EXTRA 140
defineprojectile 3622 PROJ_ISOUND LASERTRIP_EXPLODE
defineprojectile 3622 PROJ_SPAWNS EXPLOSION2
defineprojectile 3622 PROJ_RANGE 130
defineprojectile 3622 PROJ_USERDATA 256

defineprojectile DYNAMITEBUNDLE PROJ_WORKSLIKE 2103438
defineprojectile DYNAMITEBUNDLE PROJ_HITRADIUS 0
defineprojectile DYNAMITEBUNDLE PROJ_VEL 600
defineprojectile DYNAMITEBUNDLE PROJ_DROP -140
defineprojectile DYNAMITEBUNDLE PROJ_BSOUND TNT_BOUNCE
defineprojectile DYNAMITEBUNDLE PROJ_SOUND TNT_THROW
defineprojectile DYNAMITEBUNDLE PROJ_BOUNCES 6
defineprojectile DYNAMITEBUNDLE PROJ_XREPEAT 20
defineprojectile DYNAMITEBUNDLE PROJ_YREPEAT 20
defineprojectile DYNAMITEBUNDLE PROJ_EXTRA 0
defineprojectile DYNAMITEBUNDLE PROJ_SPAWNS DYNAMITEONFLOOR

defineprojectile CLUSTER_PROJ PROJ_WORKSLIKE 6286
defineprojectile CLUSTER_PROJ PROJ_HITRADIUS 1524
defineprojectile CLUSTER_PROJ PROJ_VEL 800
defineprojectile CLUSTER_PROJ PROJ_DROP -140
defineprojectile CLUSTER_PROJ PROJ_BSOUND PIPEBOMB_BOUNCE
defineprojectile CLUSTER_PROJ PROJ_ISOUND RPG_EXPLODE
defineprojectile CLUSTER_PROJ PROJ_SOUND ZAX_GLFIRE
defineprojectile CLUSTER_PROJ PROJ_BOUNCES 6
defineprojectile CLUSTER_PROJ PROJ_XREPEAT 30
defineprojectile CLUSTER_PROJ PROJ_YREPEAT 30
defineprojectile CLUSTER_PROJ PROJ_EXTRA 160
defineprojectile CLUSTER_PROJ PROJ_SPAWNS EXPLOSION2

defineprojectile CLUSTER_BOMB PROJ_WORKSLIKE 2094
defineprojectile CLUSTER_BOMB PROJ_HITRADIUS 1024
defineprojectile CLUSTER_BOMB PROJ_VEL 100
defineprojectile CLUSTER_BOMB PROJ_DROP -140
defineprojectile CLUSTER_BOMB PROJ_BSOUND GRENBOUNCE2
defineprojectile CLUSTER_BOMB PROJ_ISOUND PHOSPER_EXP
defineprojectile CLUSTER_BOMB PROJ_BOUNCES 3
defineprojectile CLUSTER_BOMB PROJ_XREPEAT 5
defineprojectile CLUSTER_BOMB PROJ_YREPEAT 5
defineprojectile CLUSTER_BOMB PROJ_EXTRA 120
defineprojectile CLUSTER_BOMB PROJ_SPAWNS GROUNDEXPLOSION

defineprojectile CLUSTER_BOMB2 PROJ_WORKSLIKE 2094
defineprojectile CLUSTER_BOMB2 PROJ_HITRADIUS 1524
defineprojectile CLUSTER_BOMB2 PROJ_VEL 200
defineprojectile CLUSTER_BOMB2 PROJ_DROP -140
defineprojectile CLUSTER_BOMB2 PROJ_BSOUND GRENBOUNCE2
defineprojectile CLUSTER_BOMB2 PROJ_ISOUND PHOSPER_EXP
defineprojectile CLUSTER_BOMB2 PROJ_BOUNCES 6
defineprojectile CLUSTER_BOMB2 PROJ_XREPEAT 5
defineprojectile CLUSTER_BOMB2 PROJ_YREPEAT 5
defineprojectile CLUSTER_BOMB2 PROJ_EXTRA 180
defineprojectile CLUSTER_BOMB2 PROJ_SPAWNS GROUNDEXPLOSION

defineprojectile R_TRAP_THROW PROJ_WORKSLIKE 2097154
defineprojectile R_TRAP_THROW PROJ_HITRADIUS 0
defineprojectile R_TRAP_THROW PROJ_VEL 600
defineprojectile R_TRAP_THROW PROJ_DROP -140
defineprojectile R_TRAP_THROW PROJ_BSOUND PIPEBOMB_BOUNCE
defineprojectile R_TRAP_THROW PROJ_ISOUND METALCLINK
defineprojectile R_TRAP_THROW PROJ_SOUND THROWSOMET
defineprojectile R_TRAP_THROW PROJ_BOUNCES 1
defineprojectile R_TRAP_THROW PROJ_XREPEAT 16
defineprojectile R_TRAP_THROW PROJ_YREPEAT 16
defineprojectile R_TRAP_THROW PROJ_EXTRA -1
defineprojectile R_TRAP_THROW PROJ_SPAWNS -1

defineprojectile M_TRAP_THROW PROJ_WORKSLIKE 2097154
defineprojectile M_TRAP_THROW PROJ_HITRADIUS 0
defineprojectile M_TRAP_THROW PROJ_VEL 600
defineprojectile M_TRAP_THROW PROJ_DROP -140
defineprojectile M_TRAP_THROW PROJ_BSOUND PIPEBOMB_BOUNCE
defineprojectile M_TRAP_THROW PROJ_ISOUND METALCLINK
defineprojectile M_TRAP_THROW PROJ_SOUND THROWSOMET
defineprojectile M_TRAP_THROW PROJ_BOUNCES 1
defineprojectile M_TRAP_THROW PROJ_XREPEAT 4
defineprojectile M_TRAP_THROW PROJ_YREPEAT 4
defineprojectile M_TRAP_THROW PROJ_EXTRA -1
defineprojectile M_TRAP_THROW PROJ_SPAWNS -1

defineprojectile MC_TRAP_THROW PROJ_WORKSLIKE 2097154
defineprojectile MC_TRAP_THROW PROJ_HITRADIUS 0
defineprojectile MC_TRAP_THROW PROJ_VEL 600
defineprojectile MC_TRAP_THROW PROJ_DROP -140
defineprojectile MC_TRAP_THROW PROJ_BSOUND PIPEBOMB_BOUNCE
defineprojectile MC_TRAP_THROW PROJ_ISOUND METALCLINK
defineprojectile MC_TRAP_THROW PROJ_SOUND THROWSOMET
defineprojectile MC_TRAP_THROW PROJ_BOUNCES 1
defineprojectile MC_TRAP_THROW PROJ_XREPEAT 8
defineprojectile MC_TRAP_THROW PROJ_YREPEAT 8
defineprojectile MC_TRAP_THROW PROJ_EXTRA -1
defineprojectile MC_TRAP_THROW PROJ_SPAWNS -1

defineprojectile PROXBUNDLE PROJ_WORKSLIKE 2103438
defineprojectile PROXBUNDLE PROJ_HITRADIUS 0
defineprojectile PROXBUNDLE PROJ_VEL 200
defineprojectile PROXBUNDLE PROJ_DROP -140
defineprojectile PROXBUNDLE PROJ_BSOUND TNT_BOUNCE
defineprojectile PROXBUNDLE PROJ_SOUND TNT_THROW
defineprojectile PROXBUNDLE PROJ_BOUNCES 6
defineprojectile PROXBUNDLE PROJ_XREPEAT 20
defineprojectile PROXBUNDLE PROJ_YREPEAT 20
defineprojectile PROXBUNDLE PROJ_EXTRA 0
defineprojectile PROXBUNDLE PROJ_SPAWNS -1

defineprojectile DISCBOMB PROJ_WORKSLIKE 2101250
defineprojectile DISCBOMB PROJ_HITRADIUS 2048
defineprojectile DISCBOMB PROJ_VEL 750
defineprojectile DISCBOMB PROJ_DROP -60
defineprojectile DISCBOMB PROJ_EXTRA 300
defineprojectile DISCBOMB PROJ_ISOUND EXPLOSION_LARGE
defineprojectile DISCBOMB PROJ_SOUND TNT_THROW
defineprojectile DISCBOMB PROJ_XREPEAT 32
defineprojectile DISCBOMB PROJ_YREPEAT 32
defineprojectile DISCBOMB PROJ_SPAWNS EXPLOSION2

defineprojectile DISCBOMB2 PROJ_WORKSLIKE 2103438
defineprojectile DISCBOMB2 PROJ_HITRADIUS 0
defineprojectile DISCBOMB2 PROJ_VEL 450
defineprojectile DISCBOMB2 PROJ_DROP -120
defineprojectile DISCBOMB2 PROJ_BSOUND GRENBOUNCE
defineprojectile DISCBOMB2 PROJ_SOUND TNT_THROW
defineprojectile DISCBOMB2 PROJ_BOUNCES 6
defineprojectile DISCBOMB2 PROJ_XREPEAT 32
defineprojectile DISCBOMB2 PROJ_YREPEAT 32
defineprojectile DISCBOMB2 PROJ_SPAWNS DISCBOMBFLOOR2

// M203 40mm standard Grenade
defineprojectile 10475 PROJ_WORKSLIKE 4098
defineprojectile 10475 PROJ_SPAWNS EXPLOSION2
defineprojectile 10475 PROJ_VEL 900
defineprojectile 10475 PROJ_VEL_MULT 2
defineprojectile 10475 PROJ_EXTRA 300
defineprojectile 10475 PROJ_DROP -100
defineprojectile 10475 PROJ_ISOUND PIPEBOMB_EXPLODE
defineprojectile 10475 PROJ_HITRADIUS 2048
defineprojectile 10475 PROJ_OFFSET 224
defineprojectile 10475 PROJ_CLIPDIST 12

useractor notenemy 10475 0 MICRO_MISSILE_FRAMES enda

defineprojectile GRENADE PROJ_WORKSLIKE 2099246
defineprojectile GRENADE PROJ_HITRADIUS 2500
defineprojectile GRENADE PROJ_VEL 400
defineprojectile GRENADE PROJ_DROP -140
defineprojectile GRENADE PROJ_BSOUND GRENBOUNCE
defineprojectile GRENADE PROJ_SOUND TNT_THROW
defineprojectile GRENADE PROJ_BOUNCES 6
defineprojectile GRENADE PROJ_XREPEAT 10
defineprojectile GRENADE PROJ_YREPEAT 10
defineprojectile GRENADE PROJ_EXTRA 180
defineprojectile GRENADE PROJ_ISOUND LASERTRIP_EXPLODE
defineprojectile GRENADE PROJ_SPAWNS EXPLOSION2
defineprojectile GRENADE PROJ_RANGE 130

defineprojectile H_GRENADE PROJ_WORKSLIKE 2099246
defineprojectile H_GRENADE PROJ_HITRADIUS 2500
defineprojectile H_GRENADE PROJ_VEL 400
defineprojectile H_GRENADE PROJ_DROP -140
defineprojectile H_GRENADE PROJ_BSOUND H_GREN_BOUNCE
defineprojectile H_GRENADE PROJ_SOUND TNT_THROW
defineprojectile H_GRENADE PROJ_BOUNCES 6
defineprojectile H_GRENADE PROJ_XREPEAT 10
defineprojectile H_GRENADE PROJ_YREPEAT 10
defineprojectile H_GRENADE PROJ_EXTRA 180
defineprojectile H_GRENADE PROJ_ISOUND LASERTRIP_EXPLODE
defineprojectile H_GRENADE PROJ_SPAWNS EXPLOSION2
defineprojectile H_GRENADE PROJ_RANGE 130

spriteshadow 6078

useractor notenemy 6078
ifaction 0
	{
	ifspawnedby APLAYER set TEMP2 1
	sizeat 10 10
	action ZERO
	}
	
ifaction ZERO
	{
	fall
	add grenade_counter 1
		ifg grenade_counter 130
			{
			globalsound LASERTRIP_EXPLODE
			spawn EXPLOSION2
			hitradius 2700 200 200 200 200
			ifpdistl 4096 quake 13
			killit
			}
			
	ifg TEMP2 0 ifpdistg 812 set TEMP2 0
			
	ifpdistl 812 
	ife TEMP2 0
	{ 
	seta[].ang player[].ang
	sound ENDSEQVOL2SND4
	ifp prunning { ezshoot 4096 H_GRENADE setthisprojectile[RETURN].VEL 800 setactorvar[RETURN].grenade_counter grenade_counter } else 
	{  ezshoot 2048 H_GRENADE setthisprojectile[RETURN].VEL 600 setactorvar[RETURN].grenade_counter grenade_counter } 
	killit 
	}

			
			
			
	}
	
enda

// GP30 grenade
defineprojectile 6085 PROJ_WORKSLIKE 2
defineprojectile 6085 PROJ_HITRADIUS 1500
defineprojectile 6085 PROJ_VEL 900
defineprojectile 6085 PROJ_VEL_MULT 2
defineprojectile 6085 PROJ_DROP -100
defineprojectile 6085 PROJ_XREPEAT 14
defineprojectile 6085 PROJ_YREPEAT 14
defineprojectile 6085 PROJ_EXTRA 350
defineprojectile 6085 PROJ_ISOUND LASERTRIP_EXPLODE
defineprojectile 6085 PROJ_SPAWNS EXPLOSION2
defineprojectile 6085 PROJ_RANGE 130

defineprojectile J_GRENADE PROJ_WORKSLIKE 2097154
defineprojectile J_GRENADE PROJ_HITRADIUS 2700
defineprojectile J_GRENADE PROJ_VEL 400
defineprojectile J_GRENADE PROJ_DROP -120
defineprojectile J_GRENADE PROJ_BSOUND GRENBOUNCE
defineprojectile J_GRENADE PROJ_SOUND TNT_THROW
// defineprojectile J_GRENADE PROJ_BOUNCES -1
defineprojectile J_GRENADE PROJ_XREPEAT 10
defineprojectile J_GRENADE PROJ_YREPEAT 10
defineprojectile J_GRENADE PROJ_EXTRA 200
defineprojectile J_GRENADE PROJ_ISOUND LASERTRIP_EXPLODE
defineprojectile J_GRENADE PROJ_SPAWNS EXPLOSION2
defineprojectile J_GRENADE PROJ_RANGE 130

defineprojectile SF_GRENADE PROJ_WORKSLIKE 2097154
defineprojectile SF_GRENADE PROJ_HITRADIUS 2700
defineprojectile SF_GRENADE PROJ_VEL 400
defineprojectile SF_GRENADE PROJ_DROP -120
defineprojectile SF_GRENADE PROJ_BSOUND GRENBOUNCE
defineprojectile SF_GRENADE PROJ_SOUND TNT_THROW
// defineprojectile J_GRENADE PROJ_BOUNCES -1
defineprojectile SF_GRENADE PROJ_XREPEAT 26
defineprojectile SF_GRENADE PROJ_YREPEAT 26
defineprojectile SF_GRENADE PROJ_EXTRA 200
defineprojectile SF_GRENADE PROJ_ISOUND REDMGUN_EXPLODE
defineprojectile SF_GRENADE PROJ_SPAWNS ENERGY_EXPLOSION
defineprojectile SF_GRENADE PROJ_RANGE 130
defineprojectile SF_GRENADE PROJ_USERDATA 8193

defineprojectile MC_GRENADE PROJ_WORKSLIKE 6286
defineprojectile MC_GRENADE PROJ_HITRADIUS 0
defineprojectile MC_GRENADE PROJ_VEL 400
defineprojectile MC_GRENADE PROJ_DROP -140
defineprojectile MC_GRENADE PROJ_BSOUND MC_GREN_BOUNCE
defineprojectile MC_GRENADE PROJ_SOUND TNT_THROW
defineprojectile MC_GRENADE PROJ_BOUNCES 6
defineprojectile MC_GRENADE PROJ_XREPEAT 25
defineprojectile MC_GRENADE PROJ_YREPEAT 25
defineprojectile MC_GRENADE PROJ_EXTRA 0
defineprojectile MC_GRENADE PROJ_ISOUND 4
defineprojectile MC_GRENADE PROJ_SPAWNS MC_GRENADE_ONFLOOR

defineprojectile FL_GRENADE PROJ_WORKSLIKE 2
defineprojectile FL_GRENADE PROJ_HITRADIUS 0
defineprojectile FL_GRENADE PROJ_VEL 400
defineprojectile FL_GRENADE PROJ_DROP -120
defineprojectile FL_GRENADE PROJ_BSOUND GRENBOUNCE
defineprojectile FL_GRENADE PROJ_SOUND TNT_THROW
defineprojectile FL_GRENADE PROJ_BOUNCES 2
defineprojectile FL_GRENADE PROJ_XREPEAT 10
defineprojectile FL_GRENADE PROJ_YREPEAT 10
defineprojectile FL_GRENADE PROJ_EXTRA 0
defineprojectile FL_GRENADE PROJ_ISOUND -1
defineprojectile FL_GRENADE PROJ_SPAWNS 8433
defineprojectile FL_GRENADE PROJ_RANGE 130

defineprojectile HOLYHANDG PROJ_WORKSLIKE 65538
defineprojectile HOLYHANDG PROJ_HITRADIUS 2500
defineprojectile HOLYHANDG PROJ_VEL 400
defineprojectile HOLYHANDG PROJ_DROP -140
defineprojectile HOLYHANDG PROJ_BSOUND GRENBOUNCE
defineprojectile HOLYHANDG PROJ_SOUND TNT_THROW
// defineprojectile HOLYHANDG PROJ_BOUNCES 0
defineprojectile HOLYHANDG PROJ_XREPEAT 16
defineprojectile HOLYHANDG PROJ_YREPEAT 16
defineprojectile HOLYHANDG PROJ_EXTRA 200
defineprojectile HOLYHANDG PROJ_ISOUND LASERTRIP_EXPLODE
defineprojectile HOLYHANDG PROJ_SPAWNS EXPLOSION2
defineprojectile HOLYHANDG PROJ_RANGE 78
defineprojectile HOLYHANDG PROJ_USERDATA 288

// HIGHWIRE GRENADE
defineprojectile 5968 PROJ_TRAIL GUNSMOKE
defineprojectile 5968 PROJ_WORKSLIKE 2094
defineprojectile 5968 PROJ_HITRADIUS 3096
defineprojectile 5968 PROJ_VEL 800
defineprojectile 5968 PROJ_DROP -100
defineprojectile 5968 PROJ_ISOUND RGL_EXPLODE
defineprojectile 5968 PROJ_BSOUND 629
defineprojectile 5968 PROJ_BOUNCES 4
defineprojectile 5968 PROJ_XREPEAT 32
defineprojectile 5968 PROJ_YREPEAT 32
defineprojectile 5968 PROJ_EXTRA 200
defineprojectile 5968 PROJ_EXTRA_RAND 100
defineprojectile 5968 PROJ_SPAWNS EXPLOSION2

// JAMES ROCKET-GRENADE
defineprojectile 2698 PROJ_TRAIL SMALLSMOKE
defineprojectile 2698 PROJ_WORKSLIKE 34
defineprojectile 2698 PROJ_HITRADIUS 1780
defineprojectile 2698 PROJ_VEL 800
defineprojectile 2698 PROJ_VEL_MULT 2
defineprojectile 2698 PROJ_ISOUND 9
defineprojectile 2698 PROJ_XREPEAT 24
defineprojectile 2698 PROJ_YREPEAT 24
defineprojectile 2698 PROJ_EXTRA 300
defineprojectile 2698 PROJ_EXTRA_RAND 30
defineprojectile 2698 PROJ_SPAWNS EXPLOSION2

useractor notenemy 2698 0 MISSILE_FRAMES enda

defineprojectile 2704 PROJ_TRAIL SMALLSMOKE
defineprojectile 2704 PROJ_WORKSLIKE 2094
defineprojectile 2704 PROJ_HITRADIUS 1780
defineprojectile 2704 PROJ_VEL 800
defineprojectile 2704 PROJ_DROP -140
defineprojectile 2704 PROJ_ISOUND 9
defineprojectile 2704 PROJ_BSOUND 629
defineprojectile 2704 PROJ_BOUNCES 5
defineprojectile 2704 PROJ_XREPEAT 24
defineprojectile 2704 PROJ_YREPEAT 24
defineprojectile 2704 PROJ_EXTRA 160
defineprojectile 2704 PROJ_SPAWNS EXPLOSION2


action JAMES_RGL_FRAMES -6 1 7
useractor notenemy 2704 0 JAMES_RGL_FRAMES enda


// GEO GRENADE
defineprojectile 5375 PROJ_TRAIL GUNSMOKE
defineprojectile 5375 PROJ_WORKSLIKE 2094
defineprojectile 5375 PROJ_HITRADIUS 2048
defineprojectile 5375 PROJ_VEL 700
defineprojectile 5375 PROJ_DROP -140
defineprojectile 5375 PROJ_ISOUND 630
defineprojectile 5375 PROJ_BSOUND 629
defineprojectile 5375 PROJ_BOUNCES 3
defineprojectile 5375 PROJ_XREPEAT 32
defineprojectile 5375 PROJ_YREPEAT 32
defineprojectile 5375 PROJ_EXTRA 280
defineprojectile 5375 PROJ_EXTRA_RAND 125
defineprojectile 5375 PROJ_SPAWNS GROUNDEXPLOSION

// GEO GL TRAJECTORY
defineprojectile 6480 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 6480 PROJ_WORKSLIKE 34830
defineprojectile 6480 PROJ_HITRADIUS 0
defineprojectile 6480 PROJ_VEL 700
defineprojectile 6480 PROJ_VEL_MULT 3
defineprojectile 6480 PROJ_DROP -420
defineprojectile 6480 PROJ_ISOUND 4
defineprojectile 6480 PROJ_BSOUND 4
defineprojectile 6480 PROJ_BOUNCES 3
defineprojectile 6480 PROJ_XREPEAT 32
defineprojectile 6480 PROJ_YREPEAT 32
defineprojectile 6480 PROJ_EXTRA 0
defineprojectile 6480 PROJ_EXTRA_RAND 0
defineprojectile 6480 PROJ_SPAWNS 8433

defineprojectile 14975 PROJ_WORKSLIKE 100366
defineprojectile 14975 PROJ_HITRADIUS 0
defineprojectile 14975 PROJ_VEL 700
defineprojectile 14975 PROJ_DROP -220
defineprojectile 14975 PROJ_ISOUND 4
defineprojectile 14975 PROJ_BSOUND 4
defineprojectile 14975 PROJ_SPAWNS 0
defineprojectile 14975 PROJ_BOUNCES 3
defineprojectile 14975 PROJ_XREPEAT 32
defineprojectile 14975 PROJ_YREPEAT 32
defineprojectile 14975 PROJ_EXTRA 0

// ARROW
defineprojectile 5010 PROJ_WORKSLIKE 2129922
defineprojectile 5010 PROJ_VEL 950
defineprojectile 5010 PROJ_EXTRA 135
defineprojectile 5010 PROJ_EXTRA_RAND 75
defineprojectile 5010 PROJ_HITRADIUS 8
defineprojectile 5010 PROJ_OFFSET 224
defineprojectile 5010 PROJ_CLIPDIST 20
defineprojectile 5010 PROJ_ISOUND 1632
defineprojectile 5010 PROJ_DROP -50

// COMPOUND ARROW
defineprojectile 18096 PROJ_WORKSLIKE 2129922
defineprojectile 18096 PROJ_VEL 950
defineprojectile 18096 PROJ_EXTRA 180
defineprojectile 18096 PROJ_EXTRA_RAND 45
defineprojectile 18096 PROJ_HITRADIUS 8
defineprojectile 18096 PROJ_OFFSET 224
defineprojectile 18096 PROJ_CLIPDIST 20
defineprojectile 18096 PROJ_ISOUND 1632
defineprojectile 18096 PROJ_DROP -30

// CROSSBOW BOLT
defineprojectile 5011 PROJ_WORKSLIKE 2129922
defineprojectile 5011 PROJ_VEL 950
defineprojectile 5011 PROJ_VEL_MULT 2
defineprojectile 5011 PROJ_EXTRA 75
defineprojectile 5011 PROJ_EXTRA_RAND 25
defineprojectile 5011 PROJ_HITRADIUS 8
defineprojectile 5011 PROJ_OFFSET 224
defineprojectile 5011 PROJ_CLIPDIST 20
defineprojectile 5011 PROJ_ISOUND 1632
defineprojectile 5011 PROJ_DROP -25

spritenopal 24489
spritenopal 24490

// GREEN BOLT
defineprojectile 24489 PROJ_WORKSLIKE 2
defineprojectile 24489 PROJ_VEL 950
defineprojectile 24489 PROJ_CSTAT 2
defineprojectile 24489 PROJ_EXTRA 35
defineprojectile 24489 PROJ_EXTRA_RAND 15
defineprojectile 24489 PROJ_XREPEAT 40
defineprojectile 24489 PROJ_YREPEAT 40
defineprojectile 24489 PROJ_OFFSET 224
defineprojectile 24489 PROJ_ISOUND MBOLT_IMPACT
defineprojectile 24489 PROJ_DROP 0
defineprojectile 24489 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 24489 PROJ_USERDATA 16 

// RED BOLT
defineprojectile 24490 PROJ_WORKSLIKE 2
defineprojectile 24490 PROJ_VEL 950
defineprojectile 24490 PROJ_CSTAT 2
defineprojectile 24490 PROJ_PAL 2
defineprojectile 24490 PROJ_EXTRA 25
defineprojectile 24490 PROJ_EXTRA_RAND 25
defineprojectile 24490 PROJ_XREPEAT 40
defineprojectile 24490 PROJ_YREPEAT 40
defineprojectile 24490 PROJ_OFFSET 224
defineprojectile 24490 PROJ_ISOUND MBOLT2_IMPACT
defineprojectile 24490 PROJ_DROP 0
defineprojectile 24490 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 24490 PROJ_USERDATA 32

useractor notenemy 24489 0 MICRO_MISSILE_FRAMES enda
action REDBOLT -1 1 5
useractor notenemy 24490 0 REDBOLT enda

// thrown dagger
defineprojectile 18067 PROJ_WORKSLIKE 2129922
defineprojectile 18067 PROJ_VEL 950
defineprojectile 18067 PROJ_EXTRA 50
defineprojectile 18067 PROJ_EXTRA_RAND 25
defineprojectile 18067 PROJ_HITRADIUS 8
defineprojectile 18067 PROJ_OFFSET 224
defineprojectile 18067 PROJ_CLIPDIST 20
defineprojectile 18067 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 18067 PROJ_DROP -75
defineprojectile 18067 PROJ_USERDATA 2048

useractor notenemy 18067 0 MICRO_MISSILE_FRAMES enda

// thrown anubis axe
defineprojectile 12782 PROJ_WORKSLIKE 2129922
defineprojectile 12782 PROJ_VEL 950
defineprojectile 12782 PROJ_EXTRA 10
defineprojectile 12782 PROJ_EXTRA_RAND 5
defineprojectile 12782 PROJ_HITRADIUS 8
defineprojectile 12782 PROJ_OFFSET 224
defineprojectile 12782 PROJ_CLIPDIST 20
defineprojectile 12782 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 12782 PROJ_DROP -25
defineprojectile 12782 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 12782 PROJ_USERDATA 2048

action ANUBIS_AXE_FRAMES 0 3 5
useractor notenemy 12782 0 ANUBIS_AXE_FRAMES enda

// thrown golden dagger
defineprojectile 18072 PROJ_WORKSLIKE 2129922
defineprojectile 18072 PROJ_VEL 950
defineprojectile 18072 PROJ_EXTRA 40
defineprojectile 18072 PROJ_EXTRA_RAND 15
defineprojectile 18072 PROJ_HITRADIUS 8
defineprojectile 18072 PROJ_OFFSET 224
defineprojectile 18072 PROJ_CLIPDIST 20
defineprojectile 18072 PROJ_ISOUND KNIFE_IMPACT
defineprojectile 18072 PROJ_DROP -75
defineprojectile 18072 PROJ_USERDATA 80

useractor notenemy 18072 0 MICRO_MISSILE_FRAMES enda

// SILVER BOLT
defineprojectile 12232 PROJ_WORKSLIKE 2129922
defineprojectile 12232 PROJ_VEL 950
defineprojectile 12232 PROJ_VEL_MULT 2
defineprojectile 12232 PROJ_EXTRA 60
defineprojectile 12232 PROJ_EXTRA_RAND 15
defineprojectile 12232 PROJ_HITRADIUS 8
defineprojectile 12232 PROJ_OFFSET 224
defineprojectile 12232 PROJ_CLIPDIST 20
defineprojectile 12232 PROJ_ISOUND 1632
defineprojectile 12232 PROJ_DROP -25
defineprojectile 12232 PROJ_USERDATA 256

// DART (ABOVE WATER)
defineprojectile 14509 PROJ_WORKSLIKE 2129954
defineprojectile 14509 PROJ_VEL 650
defineprojectile 14509 PROJ_EXTRA 35
defineprojectile 14509 PROJ_EXTRA_RAND 10
defineprojectile 14509 PROJ_HITRADIUS 8
defineprojectile 14509 PROJ_OFFSET 224
defineprojectile 14509 PROJ_CLIPDIST 20
defineprojectile 14509 PROJ_ISOUND 1632
defineprojectile 14509 PROJ_DROP -175

// DART (UNDERWATER)
defineprojectile 14510 PROJ_WORKSLIKE 2129954
defineprojectile 14510 PROJ_VEL 950
defineprojectile 14510 PROJ_TRAIL WATERBUBBLE
defineprojectile 14510 PROJ_VEL_MULT 2
defineprojectile 14510 PROJ_EXTRA 45
defineprojectile 14510 PROJ_EXTRA_RAND 30
defineprojectile 14510 PROJ_HITRADIUS 8
defineprojectile 14510 PROJ_OFFSET 224
defineprojectile 14510 PROJ_CLIPDIST 20
defineprojectile 14510 PROJ_ISOUND 1632
defineprojectile 14510 PROJ_DROP -5

defineprojectile SPELL9 PROJ_WORKSLIKE 32770
defineprojectile SPELL9 PROJ_VEL 600
defineprojectile SPELL9 PROJ_SPAWNS CRYSTALEXPLOSION
defineprojectile SPELL9 PROJ_EXTRA 6
defineprojectile SPELL9 PROJ_EXTRA_RAND 5
defineprojectile SPELL9 PROJ_XREPEAT 20
defineprojectile SPELL9 PROJ_YREPEAT 20
defineprojectile SPELL9 PROJ_HITRADIUS 8
defineprojectile SPELL9 PROJ_CLIPDIST 20
defineprojectile SPELL9 PROJ_DROP 0
defineprojectile SPELL9 PROJ_USERDATA 16


// THROWING STAR
defineprojectile 3789 PROJ_WORKSLIKE 2129922
defineprojectile 3789 PROJ_VEL 400
defineprojectile 3789 PROJ_SPAWNS -1
defineprojectile 3789 PROJ_EXTRA 5
defineprojectile 3789 PROJ_EXTRA_RAND 5
defineprojectile 3789 PROJ_SPAWNS SMALLSMOKE
defineprojectile 3789 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 3789 PROJ_HITRADIUS 16
defineprojectile 3789 PROJ_XREPEAT 5
defineprojectile 3789 PROJ_YREPEAT 5
defineprojectile 3789 PROJ_CLIPDIST 20
defineprojectile 3789 PROJ_DROP 0
defineprojectile 3789 PROJ_ISOUND METALCLINK
defineprojectile 3789 PROJ_SOUND 651

// THROWING STAR2
defineprojectile 3790 PROJ_WORKSLIKE 2129922
defineprojectile 3790 PROJ_VEL 400
defineprojectile 3790 PROJ_SPAWNS -1
defineprojectile 3790 PROJ_EXTRA 100
defineprojectile 3790 PROJ_SPAWNS SMALLSMOKE
defineprojectile 3790 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 3790 PROJ_EXTRA_RAND 25
defineprojectile 3790 PROJ_HITRADIUS 16
defineprojectile 3790 PROJ_XREPEAT 5
defineprojectile 3790 PROJ_YREPEAT 5
defineprojectile 3790 PROJ_CLIPDIST 20
defineprojectile 3790 PROJ_DROP 0
defineprojectile 3790 PROJ_ISOUND METALCLINK
defineprojectile 3790 PROJ_SOUND 651
defineprojectile 3790 PROJ_USERDATA 256

// SHURIKAN
defineprojectile 14970 PROJ_WORKSLIKE 2129922
defineprojectile 14970 PROJ_VEL 400
defineprojectile 14970 PROJ_SPAWNS SMALLSMOKE
defineprojectile 14970 PROJ_TRAIL FRAMEEFFECT1
defineprojectile 14970 PROJ_EXTRA 10
defineprojectile 14970 PROJ_EXTRA_RAND 15
defineprojectile 14970 PROJ_HITRADIUS 16
defineprojectile 14970 PROJ_XREPEAT 5
defineprojectile 14970 PROJ_YREPEAT 5
defineprojectile 14970 PROJ_CLIPDIST 20
defineprojectile 14970 PROJ_DROP 0
defineprojectile 14970 PROJ_ISOUND METALCLINK
defineprojectile 14970 PROJ_SOUND 651

// LASER BEAM
defineprojectile 19570 PROJ_WORKSLIKE 36866
defineprojectile 19570 PROJ_VEL 999
defineprojectile 19570 PROJ_SPAWNS 8433
defineprojectile 19570 PROJ_EXTRA 2000
defineprojectile 19570 PROJ_HITRADIUS 0
defineprojectile 19570 PROJ_XREPEAT 16
defineprojectile 19570 PROJ_YREPEAT 16
defineprojectile 19570 PROJ_CLIPDIST 2
defineprojectile 19570 PROJ_DROP 0
defineprojectile 19570 PROJ_ISOUND 4
defineprojectile 19570 PROJ_SOUND 4
defineprojectile 19570 PROJ_USERDATA 16

useractor notenemy 3833 killit enda


// ==========================================SPRITE SHADOWS

spriteshadow 12704
spriteshadow 12711

spriteshadow 12695

spriteshadow 12936
spriteshadow 12938
spriteshadow 12940

spriteshadow 26

spriteshadow 5010

spriteshadow CAR
spriteshadow 6283
spriteshadow PIG

spriteshadow 8672
spriteshadow 8673
spriteshadow 8674
spriteshadow 8675

spriteshadow 9404
spriteshadow 9405

spriteshadow 5597
spriteshadow 6104
spriteshadow 5331

spriteshadow AMULET

spriteshadow 2704

spriteshadow 1404

spriteshadow 9699
spriteshadow 9701
spriteshadow 9703

spriteshadow RUNEKEY
spriteshadow SCARABKEY
spriteshadow ABYSS_KEY
spriteshadow COG_PICKUP
spriteshadow GENERICKEY

spriteshadow NJIB
spriteshadow NJIB2
spriteshadow NJIB3
spriteshadow NJIB4
spriteshadow LIZMANHEAD3
spriteshadow SATYR_HEAD

spriteshadow 7904
spriteshadow 5968

spriteshadow NJIBI
spriteshadow NJIB2I
spriteshadow NJIB3I
spriteshadow NJIB4I

spriteshadow BRIMSTONE
spriteshadow SPIRIT_ARMOUR
spriteshadow FIRE_ARMOUR
spriteshadow SUPER_ARMOUR
spriteshadow BONE_SHARD
spriteshadow STYGIAN_ROCK

spriteshadow 2081
spriteshadow 2082
spriteshadow 2083
spriteshadow 2084
spriteshadow BOSS1MINIGUN

spriteshadow 6085

spriteshadow MINISHRINKERSPRITE
spriteshadow BARRETTRIFLESPRITE
spriteshadow SMGSPRITE
spriteshadow BLOODSTAFFSPRITE
spriteshadow LIZMANGUNSPRITE
spriteshadow PIGCOPGUNSPRITE
spriteshadow SKULLDUSTERSPRITE
spriteshadow FLESHSQUIRTERSPRITE
spriteshadow STYGIANGUNSPRITE
spriteshadow SAWNOFFSPRITE
spriteshadow TOMMYGUNSPRITE
spriteshadow RIOTGUNSPRITE
spriteshadow CROSSBOWSPRITE
spriteshadow MIAGUNSPRITE
spriteshadow LASERGUNSPRITE
spriteshadow TMISSILELSPRITE
spriteshadow CHAINSAWSPRITE
spriteshadow FLAMETHROWERSPRITE
spriteshadow SWORDSPRITE
spriteshadow MOPSPRITE
spriteshadow FNFALSPRITE
spriteshadow MP40SPRITE
spriteshadow JPLASMASPRITE
spriteshadow M16SPRITE
spriteshadow AK114SPRITE
spriteshadow RIOTGUN_MINIGUN_SPRITE
spriteshadow NAILGUN_SPRITE
spriteshadow RIOTGUN_GRENADEL_SPRITE
spriteshadow DARTGUN_SPRITE
spriteshadow GOROHEADSPRITE
spriteshadow 16087

spriteshadow FORTYMM_SLUGS
spriteshadow FORTYMM_CASELESS

spriteshadow SILVERAMMO_DRUM
spriteshadow TESLA_AMMO_SPRITE
spriteshadow MICRO_TORPEDO_PACK
spriteshadow MOUNTED_MINIGUN
spriteshadow DISCBOMB
spriteshadow DISCBOMB2
spriteshadow DISCBOMBFLOOR
spriteshadow DISCBOMBFLOOR2
spriteshadow 8568
spriteshadow 8689
spriteshadow 4081
spriteshadow 5375
spriteshadow ICE_DEBRIS
spriteshadow ROCKDEB1
spriteshadow ROCKDEB2
spriteshadow ROCKDEB1F
spriteshadow ROCKDEB3F 
spriteshadow ROCKDEB4F 
spriteshadow 9115
spriteshadow SHIELD
spriteshadow HEAVYARMOUR
spriteshadow 13772
spriteshadow 13780
spriteshadow 9MMSHELLF
spriteshadow RIFLESHELL
spriteshadow SRIFLESHELL
spriteshadow SHELL_LINK
spriteshadow SHELL_LINK_FLOOR
spriteshadow RIFLESHELLF
spriteshadow SRIFLESHELLF
spriteshadow EXSHELL
spriteshadow EXSHELLF
spriteshadow 40MM_SHELL
spriteshadow 40MM_SH_FLOOR
spriteshadow 3761
spriteshadow 12GSHELLF
spriteshadow PISTOLMAGAZINE
spriteshadow PISTOLMAGAZINEI
spriteshadow PISTOLMAGAZINE2
spriteshadow PISTOLMAGAZINE2I
spriteshadow SMGMAGAZINE
spriteshadow SMGMAGAZINEI
spriteshadow SMG_MAG2
spriteshadow SMG_MAG2I
spriteshadow RIFLEMAGAZINE
spriteshadow RIFLEMAGAZINEI
spriteshadow SHOTGUNBOXMAGAZINE
spriteshadow SHOTGUNBOXMAGI
spriteshadow DRUMMAGAZINE
spriteshadow DRUMMAGAZINEI
spriteshadow BETA_MAG
spriteshadow BETA_MAGI
spriteshadow 10475
spriteshadow GRENADE
spriteshadow H_GRENADE
spriteshadow J_GRENADE
spriteshadow SF_GRENADE
spriteshadow MC_GRENADE
spriteshadow MC_GRENADE_ONFLOOR
spriteshadow HOLYHANDG
spriteshadow 6200
spriteshadow 5880
spriteshadow 5674
spriteshadow 6826
spriteshadow 3789
spriteshadow 3790
spriteshadow SPELL8
spriteshadow HYPOSPRAY
spriteshadow HPOWDER
spriteshadow STEROIDS
spriteshadow HEATSENSOR
spriteshadow BOOTS
spriteshadow AIRTANK
spriteshadow 3688
spriteshadow FIRESUIT
spriteshadow GASMASK
spriteshadow HOLODUKE
spriteshadow JETPACK
spriteshadow FIRSTAID
spriteshadow 3622
spriteshadow DYNAMITESTICK
spriteshadow DYNAMITEBUNDLE
spriteshadow CLUSTER_PROJ
spriteshadow CLUSTER_BOMB
spriteshadow PROXBUNDLE
spriteshadow FIRSTGUNSPRITE
spriteshadow SHOTGUNSPRITE
spriteshadow CHAINGUNSPRITE
spriteshadow RPGSPRITE
spriteshadow TRIPBOMBSPRITE
spriteshadow SHRINKERSPRITE
spriteshadow DEVISTATORSPRITE
spriteshadow FREEZESPRITE
spriteshadow AMMO
spriteshadow SHOTGUNAMMO
spriteshadow BATTERYAMMO
spriteshadow RPGAMMO
spriteshadow GROWAMMO
spriteshadow CRYSTALAMMO
spriteshadow HBOMBAMMO
spriteshadow DEVISTATORAMMO
spriteshadow FREEZEAMMO
spriteshadow BLUEPLUG
spriteshadow REDPLUG
spriteshadow YELLOWPLUG
spriteshadow WOODSCRAP
spriteshadow CHAIR3
spriteshadow 17648
spriteshadow 3525
spriteshadow 5887
spriteshadow AMCSHIP
spriteshadow AMCSHIP2
spriteshadow 9048
spriteshadow 15329
spriteshadow 3575
spriteshadow LAVABALL
spriteshadow 3689
spriteshadow ROCKDEB1
spriteshadow 4087

spriteshadow 12416

spriteshadow 11249
spriteshadow 11250

spriteshadow 9520
spriteshadow 9521
spriteshadow 9522

spriteshadow 1777
spriteshadow 1773
spriteshadow 1769

spriteshadow 2214
spriteshadow 2215
spriteshadow 2216

spriteshadow 5664
spriteshadow 5665

// ==========================================SPRITE NOPAL

spritenopal 1660
spritenopal 1664
spritenopal 1665
spritenopal 230

spritenopal 2559

spritenopal 7402

spritenoshade 230
spritenoshade 1660
spritenoshade 1665

spritenopal PETRIFYRAY
spritenoshade PETRIFYRAY

spritenopal C4_PLACE_HERE
spritenopal SPARK
spritenopal 8623
spritenopal 3468
spritenopal BRUISERFIREBALL
spritenopal BRUISERFEXPLOSION

spritenopal 11695
spritenopal 11743

spritenopal SPIRIT_ARMOUR

spritenopal 7159
spritenopal 7161
spritenopal REDM_BLAST
spritenopal BLOOD_BLAST

spritenopal ENERGY_EXPLOSION

spritenopal HADESBLAST
spritenopal HADESBLASTH
spritenopal HADESFEXPLOSION

// Map beacons
spritenopal 3062
spritenopal 8946
spritenopal 8947
spritenopal 8948
spritenopal 8949
spritenopal 8950
spritenopal 8951 // Oxygen
spritenopal 8953 // Dynamite!
spritenopal 5408
spritenopal 3716
spritenopal 3809
spritenopal 8954
spritenopal 8955
spritenopal 8956
spritenopal 8957
spritenopal 8958
spritenopal 8959
spritenopal 7054 // VR station

spritenopal 7423

spritenopal BRIMSTONE

spritenopal 10610
spritenopal 10611
spritenopal 10612
spritenopal 10613

spritenopal MINE_DART
spritenopal IN_MINE_DART

spritenoshade 16339
spritenoshade 16356
spritenoshade 16369

spritenoshade 11679
spritenopal 11679

spritenoshade 490

spritenoshade 8507
spritenopal 8507

spritenoshade 17323
spritenopal 17323


spritenoshade 17295
spritenoshade 17296
spritenopal 17295
spritenopal 17296

defstate ITEM_BOX_STUFF
ifaction 0
	{
	ifn LOTAGSAVED 0 action ZERO
	ifn HITAGSAVED 0 action ZERO
	ifn EXTRASAVED -1 action ZERO
	ifn XVELSAVED 0 action ZERO
	ifn YVELSAVED 0 action ZERO
	ifn ZVELSAVED 0 action ZERO
	}
	
ifaction ZERO
	{
	   ifp palive
		 ifpdistl RETRIEVEDISTANCE
		  ifp pfacing
		   ife MOUSEUP 0
		    ife hit_key 0
		  {
		set player_use 0
		ifhitspace
			{
			set hit_key 30
			ifrnd 64
				{
				ifand NOISE_SAID 32 nullop else
					{
					set PLAYER_VOICEOVER 48
					xorvar NOISE_SAID 32
					}
				}
			ife TEMP7 512 soundonce OPEN_AMMO_B
			ife TEMP7 1024 soundonce OPEN_FREEZER
			set MOUSEUP 1
			getp[].ang PANG
			getp[].horiz PHORIZ
			set CHECKBOX THISACTOR
			geta[].pal TEMP5
			set CBOXSLOT1PAL TEMP5
			ifn LOTAGSAVED 0 set CBOXSLOT1 LOTAGSAVED
			ifn HITAGSAVED 0 set CBOXSLOT2 HITAGSAVED
			ifn EXTRASAVED 0 ifn EXTRASAVED -1 set CBOXSLOT3 EXTRASAVED
			ifn XVELSAVED 0 set CBOXSLOT4 XVELSAVED
			ifn YVELSAVED 0 set CBOXSLOT5 YVELSAVED
			ifn ZVELSAVED 0 set CBOXSLOT6 ZVELSAVED
			}
		}
		

			
	}


ife CHECKBOX THISACTOR
{
ife MISSIONUP 1 set MISSIONUP 0
set TEMP9 1

ifg MOUSEX 232
 ifl MOUSEX 241
  ifg MOUSEY 28
   ifl MOUSEY 38
	{
	ifand BITS_PRESS 4 
		{
		ife TEMP7 512 soundonce CLOSE_AMMO_B
		ife TEMP7 1024 soundonce CLOSE_FREEZER
		set MOUSEUP 0
		set CHECKBOX -1
		ife LOTAGSAVED 0 
		 ife HITAGSAVED 0
		  ife EXTRASAVED 0
		   ife XVELSAVED 0 
			ife YVELSAVED 0
			 ife ZVELSAVED 0
				killit // if empty, killit
		}
	}

	ifg MOUSEX 156
	 ifl MOUSEX 190
	  ifg MOUSEY 46
	   ifl MOUSEY 90
		{
		ifand BITS_PRESS 4 
		 ifn LOTAGSAVED 0
			set SELSLOT 1
		}
		

	ifg MOUSEX 194
	 ifl MOUSEX 228
	  ifg MOUSEY 46
	   ifl MOUSEY 90
		{
		ifand BITS_PRESS 4 
		 ifn HITAGSAVED 0
			set SELSLOT 2
		}
		
	ifg MOUSEX 156
	 ifl MOUSEX 190
	  ifg MOUSEY 80
	   ifl MOUSEY 116
		{
		ifand BITS_PRESS 4 
		 ifn EXTRASAVED 0
			set SELSLOT 3
		}
		
	ifg MOUSEX 194
	 ifl MOUSEX 228
	  ifg MOUSEY 80
	   ifl MOUSEY 116
		{
		ifand BITS_PRESS 4 
		 ifn XVELSAVED 0 
			set SELSLOT 4
		}
		
	ifg MOUSEX 156
	 ifl MOUSEX 190
	  ifg MOUSEY 117
	   ifl MOUSEY 152
		{
		ifand BITS_PRESS 4 
		 ifn YVELSAVED 0
			set SELSLOT 5
		}
		
	ifg MOUSEX 194
	 ifl MOUSEX 228
	  ifg MOUSEY 117
	   ifl MOUSEY 152
		{
		ifand BITS_PRESS 4 
		 ifn ZVELSAVED 0	
			set SELSLOT 6
			
		}

	ife SELSLOT 1
	{
	ifn LOTAGSAVED 0 { espawnvar LOTAGSAVED sound JMOVE6 }
	geta[RETURN].z TEMP
	sub TEMP -1024
	seta[RETURN].z TEMP
	set LOTAGSAVED 0
	set CBOXSLOT1 -1
	set SELSLOT 0
	}

	ife SELSLOT 2
	{
	ifn HITAGSAVED 0 { espawnvar HITAGSAVED sound JMOVE6 }
	geta[RETURN].z TEMP
	sub TEMP -1024
	seta[RETURN].z TEMP
	set HITAGSAVED 0
	set CBOXSLOT2 -1
	set SELSLOT 0
	}

	ife SELSLOT 3
	{
	ifn EXTRASAVED 0 ifn EXTRASAVED -1 { espawnvar EXTRASAVED sound JMOVE6 }
	geta[RETURN].z TEMP
	sub TEMP -1024
	seta[RETURN].z TEMP
	set EXTRASAVED 0
	set CBOXSLOT3 -1
	set SELSLOT 0
	}

	ife SELSLOT 4
	{
	ifn XVELSAVED 0 { espawnvar XVELSAVED sound JMOVE6 }
	geta[RETURN].z TEMP
	sub TEMP -1024
	seta[RETURN].z TEMP
	set XVELSAVED 0
	set CBOXSLOT4 -1
	set SELSLOT 0
	}

	ife SELSLOT 5
	{
	ifn YVELSAVED 0 { espawnvar YVELSAVED sound JMOVE6 }
	geta[RETURN].z TEMP
	sub TEMP -1024
	seta[RETURN].z TEMP
	set YVELSAVED 0
	set CBOXSLOT5 -1
	set SELSLOT 0
	}

	ife SELSLOT 6
	{
	ifn ZVELSAVED 0 { espawnvar ZVELSAVED sound JMOVE6 }
	geta[RETURN].z TEMP
	sub TEMP -1024
	seta[RETURN].z TEMP
	set ZVELSAVED 0
	set CBOXSLOT6 -1
	set SELSLOT 0
	}
	
	   ifp palive
		 ifpdistl 4096
		  ife hit_key 0
		   ife CHECKBOX THISACTOR
		   ifhitspace
			{
			set hit_key 30
			ife TEMP7 512 soundonce CLOSE_AMMO_B
			ife TEMP7 1024 soundonce CLOSE_FREEZER
			set MOUSEUP 0
			set CHECKBOX -1
			}
	
	ifp pjumping
	{
	ife TEMP7 512 soundonce CLOSE_AMMO_B
	ife TEMP7 1024 soundonce CLOSE_FREEZER
	set MOUSEUP 0
	set CHECKBOX -1
	}

	ifpdistg RETRIEVEDISTANCE
	{
	ife TEMP7 512 soundonce CLOSE_AMMO_B
	ife TEMP7 1024 soundonce CLOSE_FREEZER
	set MOUSEUP 0
	set CHECKBOX -1
	ife LOTAGSAVED 0 
	 ife HITAGSAVED 0
	  ife EXTRASAVED 0
	   ife XVELSAVED 0 
	    ife YVELSAVED 0
	     ife ZVELSAVED 0
			killit // if empty, killit
	}
}
ends

useractor notenemy 12031
cstat 32768
state ITEM_BOX_STUFF

ifn TEMP9 1
		{
		ifpdistl 2048
			ifrnd 8 spawn GLINT 
		else
			ifrnd 4 spawn GLINT
		}

enda

// *************************************************
// BREATHE VAPOUR
// *************************************************



action BREATHE_VAPOUR_FRAMES 0 4 1 1 20

move b_forward 30 0

useractor notenemy 10737
	ifaction 0
	{
	cstat 32768
	sizeat 2 2
	geta[].z TEMP
	sub TEMP 9096
	seta[].z TEMP
	
	ifn TEMP2 0
		{
		geta[].z TEMP3
		sub TEMP3 TEMP2
		seta[].z TEMP3
		}
	move b_forward geth
	action BREATHE_VAPOUR_FRAMES
	}

	ifaction BREATHE_VAPOUR_FRAMES
	{
	cstat 514
	sizeto 16 16
	  ifactioncount 4
	    killit
	}
enda

// *************************************************
// MAP BEACON
// *************************************************

action MINUSONE -1

defstate MAPBEACON
seta[].shade -127
seta[].ang player[].ang
getuserdef[].overhead_on TEMP
ife TEMP 2
	{
	ifactor 8953 action ZERO
	cstat 32
	getp[].zoom TEMP2
	sub TEMP2 2048
	mulvar TEMP2 -1
	divvar TEMP2 20
	ifl TEMP2 2 set TEMP2 2
	ifg TEMP2 256 set TEMP2 256
	seta[].xrepeat TEMP2
	seta[].yrepeat TEMP2
	}
else
	{
	ifactor 8953 { cstat 256 action MINUSONE } else
	cstat 32768
	}

ifactor 8953
	{
	ifhitweapon
	 ifwasweapon RADIUSEXPLOSION killit
	}

ends



// Rune keys
useractor notenemy 8954 state MAPBEACON enda

// Elder keys
useractor notenemy 8945 state MAPBEACON enda
useractor notenemy 8955 state MAPBEACON enda
useractor notenemy 8956 state MAPBEACON enda
useractor notenemy 8957 state MAPBEACON enda
useractor notenemy 8958 state MAPBEACON enda
useractor notenemy 8959 state MAPBEACON enda

useractor notenemy 3062 state MAPBEACON enda // supply drop

useractor notenemy 8946 state MAPBEACON enda // point of interest

useractor notenemy 8947 state MAPBEACON enda // Cog
useractor notenemy 8948 state MAPBEACON enda // Plug
useractor notenemy 8949 state MAPBEACON enda // Scarab Key
useractor notenemy 8950 state MAPBEACON enda // Generic Key!
useractor notenemy 8951 state MAPBEACON enda // Oxygen!
useractor notenemy 8953 state MAPBEACON enda // Dynamite!
useractor notenemy 7054 state MAPBEACON enda // VR station

useractor notenemy 5408 state MAPBEACON enda

useractor notenemy 3716 state MAPBEACON enda // Asian key

useractor notenemy 3809 state MAPBEACON ifpdistl 1024 killit enda

action BREAK 0

// MUSIC CHANGE===================================================================================

useractor notenemy 3729
cstat 32768

ifn HITAGSAVED 0
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	ifspritepal 100
		{
		stopallmusic
		killit
		}
	geta[].pal TEMP
	ifg EXTRASAVED -1
		{
		starttrackslot EXTRASAVED TEMP
		set MIDICHANGES TEMP
		killit
		}
		else
		{
		starttrackvar TEMP
		set MIDICHANGES TEMP
		killit
		}
	}
}
else
ifpdistl 1024
	{
	ifspritepal 100
		{
		stopallmusic
		killit
		}
	geta[].pal TEMP
	ifn EXTRASAVED -1 
		{
		starttrackslot EXTRASAVED TEMP
		set MIDICHANGES TEMP
		killit
		}
		else
		{
		starttrackvar TEMP
		set MIDICHANGES TEMP
		killit
		}
	}

enda

// RANDOM SOUNDS=================================================================================
// RANDOM AMBIENCE

// 0 = WOODLAND SOUNDS
// 1 = METAL GROANING SOUNDS
// 2 = CITY SOUNDS
// 3 = SPOOKY SOUNDS
// 4 = HELL/DIS SOUNDS
// 5 = WAR SOUNDS
// 6 = PA SOUNDS
// 7 = BIRDS SOUNDS



useractor notenemy 3728
cstat 32768

ifn cuts_txt -1 break

ifg OWNERSAVED 0
ife LOTAGSAVED 0
{
checkactivatormotion OWNERSAVED
ife RETURN 1 killit
}
else
ifg OWNERSAVED 0
ifn LOTAGSAVED 0
	{
	checkactivatormotion OWNERSAVED
	ife RETURN 1 { set LOTAGSAVED 0 set OWNERSAVED 0 }
	}

ifn LOTAGSAVED 0
{
add TEMP3 1
ifg TEMP3 LOTAGSAVED
	{
	ifrnd 64 { ifand TEMP2 1 ifn HITAGSAVED -1 soundoncevar HITAGSAVED } else
	ifrnd 64 { ifand TEMP2 2 ifn EXTRASAVED -1 soundoncevar EXTRASAVED } else
	ifrnd 64 { ifand TEMP2 4 ifn XVELSAVED -1 soundoncevar XVELSAVED } else
	ifrnd 64 { ifand TEMP2 8 ifn YVELSAVED -1 soundoncevar YVELSAVED } else
	ifrnd 64 { ifand TEMP2 16 ifn ZVELSAVED -1 soundoncevar ZVELSAVED }
	set TEMP3 0
	}
}
else
ifspritepal 0
{
	ifcount 104
	{
		ifn DAYNIGHT 0
		{
		ife DAYNIGHT 1 killit
		}
		ifrnd 32 soundonce OWLHOOT1 else
		ifrnd 32 soundonce OWLHOOT2
		resetcount
	}
}
else
ifspritepal 1
{
	ifcount 104
	{
		ifrnd 32 soundonce SHIPGROAN1 else
		ifrnd 32 soundonce SHIPGROAN2 else
		ifrnd 32 soundonce SHIPGROAN3 
		resetcount
	}
}
else
ifspritepal 2
{
	ifcount 208
	{
		ifrnd 16 soundonce WAR_AMBIENCE1 else
		ifrnd 16 soundonce WAR_AMBIENCE2 else
		ifrnd 16 soundonce WAR_AMBIENCE3 else
		ifrnd 16 soundonce WAR_AMBIENCE4 else
		ifrnd 16 soundonce DISTANT_SIREN else
		ifrnd 16 soundonce DISTANT_SIREN2
		resetcount
	}
}
else
ifspritepal 3
{
	ifcount 208
	{
		ifrnd 32 soundonce SPOOKY1 else
		ifrnd 32 soundonce SPOOKY2 else
		ifrnd 32 soundonce SPOOKY3 else
		ifrnd 32 soundonce SPOOKY4 
		resetcount
	}
}
else
ifspritepal 4
{
	ifcount 208
	{
		ifrnd 32 sound DIS_CRYING else
		ifrnd 16 sound DIS_VOICES else
		ifrnd 16 sound DIS_VOICES2
		resetcount
	}
}
else
ifspritepal 5
{
	ifcount 104
	{
		randvar TEMP4 90
		ifl TEMP4 10 soundonce DISTANT_GUNS else
		ifl TEMP4 20 soundonce DISTANT_COMB1 else
		ifl TEMP4 30 soundonce DISTANT_COMB2 else
		ifl TEMP4 40 soundonce DISTANT_COMB3 else
		ifl TEMP4 50 soundonce DISTANT_MGUN1 else
		ifl TEMP4 60 soundonce DISTANT_MGUN2 else
		ifl TEMP4 70 soundonce DISTANT_MGUN3 else
		ifl TEMP4 80 soundonce DISTANT_COMB4 else
		ifl TEMP4 90 soundonce DISTANT_COMB5
		resetcount
	}
}
else
ifspritepal 6
{
	ifcount 208
	{
		randvar TEMP4 50
		ifl TEMP4 10 soundonce PA_SYSTEM_1 else
		ifl TEMP4 20 soundonce PA_SYSTEM_2 else
		ifl TEMP4 30 soundonce PA_SYSTEM_3 else
		ifl TEMP4 40 soundonce PA_SYSTEM_4 else
		ifl TEMP4 50 soundonce PA_SYSTEM_5
		resetcount
	}
}
else
ifspritepal 7
{
	ifcount 208
	{
		randvar TEMP4 20
		ifl TEMP4 10 sound BIRDS_CHIRP1 else
		ifl TEMP4 20 sound BIRDS_CHIRP2 
		resetcount
	}
}
else
ifspritepal 8
{
	ifcount 208
	{
		randvar TEMP4 60
		ifl TEMP4 10 soundonce TRAFFIC_1 else
		ifl TEMP4 20 soundonce TRAFFIC_2 else
		ifl TEMP4 30 soundonce TRAFFIC_3 else
		ifl TEMP4 40 soundonce TRAFFIC_4 else
		ifl TEMP4 50 soundonce TRAFFIC_5 else
		ifl TEMP4 60 soundonce TRAFFIC_6
		resetcount
	}
}
else
ifspritepal 9
{
// ifactorsound THISACTOR HITAGSAVED nullop else soundvar HITAGSAVED
checkactivatormotion EXTRASAVED 
ife RETURN 1
	{
	set HITAGSAVED XVELSAVED
	set EXTRASAVED -1
	}
}
else
ifspritepal 10
{
ifactorsound THISACTOR PUBLIC_NOISE2 nullop else sound PUBLIC_NOISE2
checkactivatormotion EXTRASAVED 
ife RETURN 1
	{
	set HITAGSAVED XVELSAVED
	set EXTRASAVED -1
	}
}
else
ifspritepal 11
{
	ifcount 104
	{
		ifrnd 32 soundonce WOOD_GROAN1 else
		ifrnd 32 soundonce WOOD_GROAN2 else
		ifrnd 32 soundonce WOOD_GROAN3 else
		ifrnd 32 soundonce WOOD_GROAN4
		resetcount
	}
}
enda

// MEGA CLUSTER CHARGE =================================================================================

useractor notenemy 12969
fall

ifaction 0
	{
	resetcount
	action ZERO
	}
	
ifaction ZERO
	{
	sizeat 32 32
	ifcount 0 ife TEMP2 0 { quote 186 globalsound CLAXON_ALARM add TEMP2 1 }
	ifcount 26 ife TEMP2 1 { quote 187 globalsound CLAXON_ALARM add TEMP2 1 }
	ifcount 52 ife TEMP2 2 { quote 188 globalsound CLAXON_ALARM add TEMP2 1 }
	ifcount 78 ife TEMP2 3 { quote 189 globalsound CLAXON_ALARM add TEMP2 1 }
	ifcount 104 ife TEMP2 4 { quote 190 globalsound CLAXON_ALARM add TEMP2 1 }
	ifcount 130
		{
		quote 191
		hitradius 1024 50 100 150 300
		flash
		quake 200
		spawn EXPLOSION2
		globalsound C4_EXPLODE
		palfrom 20 20 20 20
		killit
		}
	}
enda

// PORTABLE FORCEFIELD =================================================================================

useractor notenemy 5208
ifspritepal 3 cstat 594 else
ifspritepal 8 cstat 594 else
ifspritepal 21 cstat 594 else
cstat 339

ifaction 0 
	{ 
	seta[].blend 255
	ifspawnedby APLAYER strength 10000
	sizeat 32 32 
	action ZERO 
	}
	
ifaction ZERO
	{
		strength 10000
		set TEMP3 player[].posx
		add TEMP3 512

		rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
		
		getp[].ang TEMP4
		ifspritepal 3 sub TEMP4 1024
		ifspritepal 8 sub TEMP4 1024
		ifspritepal 21 sub TEMP4 1024
		seta[].ang TEMP4

		updatesector TEMP5 TEMP6 TEMP7

		getp[].posz TEMP
		add TEMP 8192
		
		setsprite THISACTOR TEMP5 TEMP6 TEMP
		
		geta[].shade TEMP2
		ife PS_ITEM 0 
			{
			shoot SPARK2 
			shoot SPARK2 
			shoot SPARK2
			killit
			}

	ifhitweapon
		{
		ifspritepal 3 break
		ifspritepal 8 break
		ifspritepal 21 break
		sound SOMETHINGHITFORCE
		setactorsoundpitch THISACTOR SOMETHINGHITFORCE 1024
		set TEMP2 0
		seta[].shade TEMP2
		seta[TEMP8].shade 0
		setactorvar[TEMP8].TEMP2 0
		ifspawnedby APLAYER strength 1000
		}
	
	ifl TEMP2 25
		{
		add TEMP2 1 
		seta[].shade TEMP2
		}
	}
	
enda

// ====================================================================================================================
// ENEMY FORCEFIELD
// ====================================================================================================================

useractor notenemy 22923
ifspritepal 3 cstat 594 else
ifspritepal 8 cstat 594 else
ifspritepal 21 cstat 594 else
cstat 339

ifaction 0 
	{ 
	seta[].blend 255
	strength 1000
	sizeat 32 32 
	action ZERO 
	}
	
ifaction ZERO
	{
		set TEMP3 sprite[myowner].x
		add TEMP3 512

		rotatepoint sprite[myowner].x sprite[myowner].y TEMP3 sprite[myowner].y sprite[myowner].ang TEMP5 TEMP6
		
		geta[myowner].ang TEMP4
		ifspritepal 3 sub TEMP4 1024
		ifspritepal 8 sub TEMP4 1024
		ifspritepal 21 sub TEMP4 1024
		seta[].ang TEMP4

		updatesector TEMP5 TEMP6 TEMP7

		geta[myowner].z TEMP
		sub TEMP 4096
		
		setsprite THISACTOR TEMP5 TEMP6 TEMP
		
		geta[].shade TEMP2
		ifl sprite[myowner].extra 0 
			{
			soundonce BOS4_ATTACK 
			shoot SPARK2 
			shoot SPARK2 
			shoot SPARK2 
			setactorsoundpitch THISACTOR BOS4_ATTACK 1024 
			killit 
			}
		ifdead 
			{ 
			soundonce BOS4_ATTACK 
			shoot SPARK2 
			shoot SPARK2 
			shoot SPARK2 
			setactorsoundpitch THISACTOR BOS4_ATTACK 1024 
			ife SKILL_LEVEL 1 setactorvar[myowner].playsound 3000 
			ife SKILL_LEVEL 2 setactorvar[myowner].playsound 300
			ife SKILL_LEVEL 3 setactorvar[myowner].playsound 240
			ife SKILL_LEVEL 4 setactorvar[myowner].playsound 180
			ife SKILL_LEVEL 5 setactorvar[myowner].playsound 130
			killit 
			}	

	ifhitweapon
		{
		ifspritepal 3 break
		ifspritepal 8 break
		ifspritepal 21 break
		sound SOMETHINGHITFORCE
		setactorsoundpitch THISACTOR SOMETHINGHITFORCE 1024
		set TEMP2 0
		seta[].shade TEMP2
		seta[TEMP8].shade 0
		setactorvar[TEMP8].TEMP2 0
		ifspawnedby APLAYER strength 1000
		}
	
	ifl TEMP2 25
		{
		add TEMP2 1 
		seta[].shade TEMP2
		}
	}
	
enda

// DYNAMITE ON FLOOR

action OK 0

useractor notenemy DYNAMITEONFLOOR
fall
sizeat 32 32

ifaction 0 
	{
	ifspawnedby APLAYER action ZERO
	else action OK
	}
else
	ifaction ZERO ifpdistg RETRIEVEDISTANCE action OK

      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
		 ifaction OK
			{
			addweapon HANDBOMB_WEAPON 1
        		quote 55
  			palfrom 32 0 32
			ife CURWEAP 10 
			{ setp[].weapon_pos 10 setp[].curr_weapon 5 }
  			killit
			}

enda

useractor notenemy MC_GRENADE_ONFLOOR
fall
sizeat 32 32

ifaction 0 
	{
	ifspawnedby APLAYER action ZERO
	else action OK
	}
else
	ifaction ZERO ifpdistg RETRIEVEDISTANCE action OK

      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
		 ifaction OK
			{
			addweapon HANDBOMB_WEAPON 1
        		quote 55
  			palfrom 32 0 32
			ife CURWEAP 10 
			{ setp[].weapon_pos 10 setp[].curr_weapon 5 }
  			killit
			}

enda


useractor notenemy DISCBOMBFLOOR
sizeat 32 32
fall

ifaction 0 
	{
	ifspawnedby APLAYER action ZERO
	else action OK
	}
else
	ifaction ZERO ifpdistg RETRIEVEDISTANCE action OK

      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
		 ifaction OK
			{
			
			setarray PICKED_UP_GUN[5] 30
			set WEAP_SHOW 130
			
			addweapon HANDBOMB_WEAPON 1
			ife CURWEAP 10 
			{ setp[].weapon_pos 10 setp[].curr_weapon 5 }
  			killit
			}


ifcount 52
{
    debris SCRAP1 3
    debris SCRAP2 3
    debris SCRAP6 3
	spawn EXPLOSION2
	globalsound PIPEBOMB_EXPLODE
	hitradius PIPEBOMBRADIUS 100 150 200 250
	killit
}

enda

// ===============================================================================AMCTELEPORT


action ACAR2 0 1 5 1 1

spriteshadow 1425
spritenopal 1425

useractor notenemy 1425 // statue
ifaction 0 ifspritepal 27 action ACAR
enda

move PICKEDUP 0
move CARFALL 0
move CARTHROW 400 75

defstate CAR_THROW_CODE
ifmove 0
{
ifactor CAR sizeat 48 48 else
sizeat 40 40
cstat 257
clipdist 64
ifspritepal 3 nullop else fall
ifpdistl 1024
{
ifp pboosted
	{
	ife CHAR 0 set player_use 0
	ife CHAR 2 set player_use 0
	ife CHAR 7 set player_use 0
	ife CHAR 12 set player_use 0
	}
 ifhitspace
   ifcount 13
	{
	set hit_key 30
	switch CHAR
	case 0
	case 2
	case 7
  	ifp pboosted
	{
		soundonce CARSTRAIN
		set PLAYER_VOICEOVER 2
		move PICKEDUP
		resetcount
	}
	else quote 148
	break
	case 12
		soundonce CARSTRAIN
		set PLAYER_VOICEOVER 2
		move PICKEDUP
		resetcount
	break
	default
	quote 147
	break
	endswitch
	}
}
}

ifmove PICKEDUP
{
setp[].runspeed 33200
ifrnd 4 soundonce CARSTRAIN
cstat 0
seta[].x player[].posx
seta[].y player[].posy
getp[].posz TEMP
sub TEMP 2096
seta[].z TEMP
setp[].weapon_pos 10
ifhitspace 
 ifcount 13 
	{ 
	setp[].runspeed RUNNINGSPEED
	sound BIGTHROW
	stopsound CARSMASH
	seta[].ang player[].ang 
	move CARTHROW geth getv 
	resetcount 
	}
ifp pboosted nullop else { move CARFALL addphealth -500 }
}

ifmove CARFALL
{
iffloordistl 2 { soundonce CARSMASH ifcount 26 { debris SCRAP1 12 move 0 resetcount } }
fall
}

ifmove CARTHROW
{
cstat 257
ifcount 13 { hitradius 2048 10 50 150 300 }
iffloordistl 4 { ifcount 26 { debris SCRAP1 12 soundonce CARSMASH  move 0 resetcount } }
fall
}

ends

useractor notenemy CAR 200 ACAR state CAR_THROW_CODE enda
useractor notenemy 13683 200 ACAR state CAR_THROW_CODE enda

useractor notenemy 8684 ifaction 0 action ACAR enda

useractor notenemy 7410 

ifspritepal 0
{
 seta[].mdflags 16
 set command 32768
}

ifspawnedby RESPAWN sizeat 32 32
enda


useractor notenemy 11049

ifspritepal 0
{
 seta[].mdflags 16
 set command 32768
}

enda

// ============================================================================================HOVER SHIP STUFF



useractor notenemy 22520 // Advanced AMC Ship
cstat 32768
ife EXTRASAVED -1
	{
	readarrayfromfile BASE_RESEARCH 4003
	ife BASE_RESEARCH[7] 2
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED	
		}
		else
		{
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED	
		}
	killit
	}
else
{
checkactivatormotion EXTRASAVED
ife RETURN 1
	{
	readarrayfromfile BASE_RESEARCH 4003
	ife BASE_RESEARCH[7] 2
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED	
		}
		else
		{
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED	
		}
	killit
	}
}
enda

action AAMCSHIP 0 1 7 1 1
action HOVERSHIP 0 1 7 1 1

move CRASH 512 32
move CRASH_FAST 512 256
move FLYFORWARD 512 0
move FLYSLOW 60 0
move FLYUP 0 -96
move FLYDOWN 0 96

move CHOPPER_FLYBY 325 0

defstate HOVERSOUND
	ifactor AMCSHIP2
	{
	ifactorsound THISACTOR AMCSHIP2_HOVER nullop else
	sound AMCSHIP2_HOVER
	}
	else
	{
	ifactorsound THISACTOR AMCSHIP_HOVER nullop else
	sound AMCSHIP_HOVER
	}
ends

defstate HOVERSHIPCODE

ifspawnedby HOVERCARSPAWNER
{
ifg sprite[].xrepeat 8
	{
	state HOVERSOUND
	
 ifpdistl 1024
		{
		wackplayer
		soundonce CARSMASH
		addphealth -1000
		palfrom 60 60 0 0
		}
	
	}
move FLYFORWARD geth
ifnotmoving killit

}
else
ife LOTAGSAVED 0 cstator 1
else
ife LOTAGSAVED 1
{
state HOVERSOUND
move FLYFORWARD geth
ifnotmoving killit
}
else
ife LOTAGSAVED 2
{
state thisactor_getzrange
state HOVERSOUND
move FLYUP getv
state getceildist
ifl z 5 ifoutside killit
}
else
ife LOTAGSAVED 3
{
state HOVERSOUND
ifactor AMCSHIP move FLYFORWARD geth else 
ifactor 15329 move FLYFORWARD geth else
move FLYSLOW geth
ifnotmoving killit
}
else
ife LOTAGSAVED 4
{
state HOVERSOUND
move FLYSLOW geth
ifnotmoving killit
}
else
ife LOTAGSAVED 5
{
state HOVERSOUND
move FLYFORWARD geth
ifnotmoving killit
}
else
ife LOTAGSAVED 6
{
state HOVERSOUND
move FLYSLOW geth
ifnotmoving killit
}
else
ife LOTAGSAVED 7
{
ifmove 0 { sound WAR_AMBIENCE2 move CRASH geth getv }
ifrnd 16
	{ 
	espawn BIG_SMOKE
	shoot SPARK shoot SPARK
	seta[RETURN].xrepeat 96 
	seta[RETURN].yrepeat 96 
	seta[RETURN].cstat 2 
	seta[RETURN].pal 1
	}
ifnotmoving 
	{ 
		spawn EXPLOSION2
		ifpdistl 16000 wackplayer
		ifcansee palfrom 60 64 64 64
		flash
		hitradius 6096 100 20 400 500
		ifactor 15329 globalsound CARSMASH
		else globalsound CHOPPER_EXPLODE
		quake 76
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		debris SCRAP1 40 
		debris SCRAP2 32
		debris SCRAP3 32
		debris SCRAP4 32
		debris SCRAP5 32
		strength 0 
		ifvarn XVELSAVED 0
			{
			operateactivators XVELSAVED THISACTOR
			operaterespawns XVELSAVED
			operatemasterswitches XVELSAVED
			}
		killit
	}
}
else
ife LOTAGSAVED 8
{
state HOVERSOUND
move CHOPPER_FLYBY geth
ifnotmoving killit
}
else
ife LOTAGSAVED 9
{
state HOVERSOUND
move FLYFORWARD geth
geta[].xvel TEMP3
mulvar TEMP3 2
seta[].xvel TEMP3
ifnotmoving killit
}
else
ife LOTAGSAVED 10
{
state HOVERSOUND
move FLYDOWN getv
iffloordistl 32 { cstator 1 sound HOVERC_LAND set LOTAGSAVED 0 }
}
else
ife LOTAGSAVED 11
{
ifmove 0 { sound WAR_AMBIENCE2 move CRASH_FAST geth getv }
ifrnd 64
	{ 
	espawn BIG_SMOKE
	spawn EXPLOSION2
	shoot SPARK shoot SPARK
	seta[RETURN].xrepeat 96 
	seta[RETURN].yrepeat 96 
	seta[RETURN].cstat 2 
	seta[RETURN].pal 1
	}
ifnotmoving 
	{ 
		spawn EXPLOSION2
		ifpdistl 16000 wackplayer
		ifcansee palfrom 60 64 64 64
		flash
		hitradius 6096 100 20 400 500
		ifactor 15329 globalsound CARSMASH
		else globalsound CHOPPER_EXPLODE
		quake 76
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		debris SCRAP1 40 
		debris SCRAP2 32
		debris SCRAP3 32
		debris SCRAP4 32
		debris SCRAP5 32
		strength 0 
		ifvarn XVELSAVED 0
			{
			operateactivators XVELSAVED THISACTOR
			operaterespawns XVELSAVED
			operatemasterswitches XVELSAVED
			}
		killit
	}
}

ifspawnedby RESPAWN
{
ife LOTAGSAVED 3 sizeat 16 16 else
ife LOTAGSAVED 6 sizeat 16 16 else
	{
	ifactor 21612 sizeat 103 89 else
	ifactor 15329 sizeat 80 80 else
	sizeat 64 64
	}
ifmove 0 spritepal 3
}

ifspritepal 3
{
cstator 1
soundonce AMCSHIP_HOVER
set command 32768
}
else
ifspritepal 9
{
ifmove 0 { sound WAR_AMBIENCE2 move CRASH geth getv }
ifcount 4 
	{ 
	espawn SMALLSMOKE 
	seta[RETURN].xrepeat 96 
	seta[RETURN].yrepeat 96 
	seta[RETURN].cstat 2 
	seta[RETURN].pal 1
	resetcount 
	}
ifnotmoving 
	{ 
	quake 13 
	spawn EXPLOSION2 
	globalsound RPG_EXPLODE 
  	debris SCRAP1 10
  	debris SCRAP2 10
  	debris SCRAP3 10
  	debris SCRAP4 10
  	debris SCRAP5 10
	killit 
	}
}
ends

// COCKSLAP

spriteflags AMCSHIP SFLAG_SMOOTHMOVE
spriteflags AMCSHIP2 SFLAG_SMOOTHMOVE

useractor notenemy AMCSHIP 200 AAMCSHIP
seta[].mdflags 16
ife HITAGSAVED 0  sizeat 64 64
ife EXTRASAVED 1
	{ 
	readarrayfromfile BASE_RESEARCH 4003
	ife BASE_RESEARCH[7] 2 cactor AMCSHIP2 
	set EXTRASAVED -1
	}
state HOVERSHIPCODE
enda

useractor notenemy AMCSHIP2 200 AAMCSHIP
seta[].mdflags 16
ife HITAGSAVED 0  sizeat 64 64
state HOVERSHIPCODE
enda

spriteflags 21612 SFLAG_SMOOTHMOVE

useractor notenemy 21613 // Snowfall's ship landed

ifaction 0
{
ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 killit
	}
}

enda

useractor notenemy 21612 200 // Snowfall's ship
seta[].mdflags 16
ife HITAGSAVED 0 sizeat 64 64
state HOVERSHIPCODE
enda

spritenoshade 15329

useractor notenemy 15329
seta[].shade -32

ife HITAGSAVED 0 sizeat 80 80
state HOVERSHIPCODE

enda

useractor notenemy 17301
ifspritepal 3
 ifaction 0
	{
	seta[].mdflags 16
	set command 32768
	action ZERO
	}
enda

// *************************************************
// HOVER CAR
// *************************************************

defstate SPAWNHOVERCAR
ifrnd 64
{
randvar TEMP7 30
ifl TEMP7 11 espawn 8924
else ifl TEMP7 21 espawn 9388
else ifl TEMP7 31 espawn 8931
ifspritepal 6 
	{ 
	seta[RETURN].xrepeat 8 
	seta[RETURN].yrepeat 8
	geta[RETURN].mdflags spawntmp
    orvar spawntmp 1  // SPREXT_NOTMD
    seta[RETURN].mdflags spawntmp
	}
else { seta[RETURN].xrepeat 64 seta[RETURN].yrepeat 64 }

ife LOTAGSAVED 1 resetcount
else
	{
	geta[].x TEMP
	geta[].y TEMP2

	set TEMP3 TEMP
	randvar TEMP8 512
	add TEMP3 TEMP8

	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6


	geta[RETURN].z TEMP2
	randvar TEMP 20000
	sub TEMP 10000
	add TEMP2 TEMP
	seta[RETURN].z TEMP2
	resetcount
	}
}
ends

defstate SPAWN_CYCLOIDSHIP
ifrnd 64
{
espawn 15329
setactorvar[RETURN].HITAGSAVED 1
ifspritepal 8 
	{ 
	seta[RETURN].xrepeat 16
	seta[RETURN].yrepeat 16
	}
else { seta[RETURN].xrepeat 64 seta[RETURN].yrepeat 64 }

ife LOTAGSAVED 1 resetcount
else
	{
	geta[].x TEMP
	geta[].y TEMP2

	set TEMP3 TEMP
	randvar TEMP8 512
	add TEMP3 TEMP8

	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6


	geta[RETURN].z TEMP2
	randvar TEMP 20000
	sub TEMP 10000
	add TEMP2 TEMP
	seta[RETURN].z TEMP2
	resetcount
	}
}
ends



useractor notenemy HOVERCARSPAWNER
cstat 32768

ifn HITAGSAVED 0
{
checkactivatormotion HITAGSAVED
	ife RETURN 1 killit
}

ifspritepal 0 
{
ifcount 52 state SPAWNHOVERCAR
}
else
ifspritepal 1
{
ifcount 26 state SPAWNHOVERCAR
}
else
ifspritepal 2
{
ifcount 13 state SPAWNHOVERCAR
}
else
ifspritepal 6
{
ifcount 13 state SPAWNHOVERCAR
}
else
ifspritepal 8
{
ifcount 52 state SPAWN_CYCLOIDSHIP
}



enda

useractor notenemy 8924 200 HOVERSHIP
ifspawnedby HOVERCARSPAWNER nullop else
ife HITAGSAVED 0 sizeat 64 64
state HOVERSHIPCODE
enda

useractor notenemy 8931 200 

ifaction 0
	{
	
	ifspritepal 3
		{
		 geta[].mdflags TEMP
		 orvar TEMP 16
		 seta[].mdflags TEMP
		 set command 32768
		}
	
	ifrnd 16 seta[].pal 10 else
	ifrnd 32 seta[].pal 11 else
	ifrnd 48 seta[].pal 12 else
	ifrnd 64 seta[].pal 13 else
	ifrnd 80 seta[].pal 14 else
	ifrnd 96 seta[].pal 15 else
	ifrnd 112 seta[].pal 16 else
	ifrnd 128 seta[].pal 18 else
	ifrnd 144 seta[].pal 21 else
	ifrnd 160 seta[].pal 22 else
	ifrnd 176 seta[].pal 23 else
	ifrnd 192 seta[].pal 5 else
	spritepal 0
	action HOVERSHIP
	}

ifspawnedby HOVERCARSPAWNER nullop else
ife HITAGSAVED 0 sizeat 64 64
state HOVERSHIPCODE
enda

useractor notenemy 9388 200 

ifaction 0
	{
	ifrnd 16 seta[].pal 10 else
	ifrnd 32 seta[].pal 11 else
	ifrnd 48 seta[].pal 12 else
	ifrnd 64 seta[].pal 13 else
	ifrnd 80 seta[].pal 14 else
	ifrnd 96 seta[].pal 15 else
	ifrnd 112 seta[].pal 16 else
	ifrnd 128 seta[].pal 18 else
	ifrnd 144 seta[].pal 21 else
	ifrnd 160 seta[].pal 22 else
	ifrnd 176 seta[].pal 23 else
	ifrnd 192 seta[].pal 5 else
	spritepal 0
	action HOVERSHIP
	}

ifspawnedby HOVERCARSPAWNER nullop else
ife HITAGSAVED 0 sizeat 64 64
state HOVERSHIPCODE
enda

// *************************************************
// CAR
// *************************************************

defstate SPAWN_CAR
ifrnd 64
{
espawn CAR_MOVE

ife LOTAGSAVED 1 
	{
	setactorvar[RETURN].LOTAGSAVED HITAGSAVED
	ife XVELSAVED 0 { seta[RETURN].xrepeat 40 seta[RETURN].yrepeat 40 } else
	ife XVELSAVED 1 { seta[RETURN].xrepeat 20 seta[RETURN].yrepeat 20 } else
	ife XVELSAVED 2 { seta[RETURN].xrepeat 10 seta[RETURN].yrepeat 10 } 
	resetcount
	}
else
	{
	geta[].x TEMP
	geta[].y TEMP2

	set TEMP3 TEMP
	
	ife OWNERSAVED 0 set OWNERSAVED 2048
	randvarvar TEMP8 OWNERSAVED
	
	add TEMP3 TEMP8
	
	randvar TEMP4 2048

	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6

	setactorvar[RETURN].LOTAGSAVED HITAGSAVED
	ife XVELSAVED 0 { seta[RETURN].xrepeat 40 seta[RETURN].yrepeat 40 } else
	ife XVELSAVED 1 { seta[RETURN].xrepeat 20 seta[RETURN].yrepeat 20 } else
	ife XVELSAVED 2 { seta[RETURN].xrepeat 10 seta[RETURN].yrepeat 10 } 
	resetcount
	}
}
ends

move TRAFFIC_JAM 30 0
move SPEEDY 128 0



useractor notenemy CAR_SPAWNER
cstat 32768

ifspritepal 0 
{
ifcount 52 state SPAWN_CAR
}
else
ifspritepal 1
{
ifcount 26 state SPAWN_CAR
}
else
ifspritepal 2
{
ifcount 13 state SPAWN_CAR
}
else
ifspritepal 3
{
ifcount 76 state SPAWN_CAR
}
else
ifspritepal 4
{
ifcount 104 state SPAWN_CAR
}
else
ifspritepal 5
{
ifcount 6 state SPAWN_CAR
}
else
ifspritepal 6
{
ifcount 260
	{
	ifrnd 128 state SPAWN_CAR
	resetcount
	}
}

enda

spriteshadow CAR_MOVE

action ACAR_DRIVE 0 2 5 1 14

useractor notenemy CAR_MOVE 
fall

ifaction 0
	{
	ifrnd 16 seta[].pal 10 else
	ifrnd 32 seta[].pal 11 else
	ifrnd 48 seta[].pal 12 else
	ifrnd 64 seta[].pal 13 else
	ifrnd 80 seta[].pal 14 else
	ifrnd 96 seta[].pal 15 else
	ifrnd 112 seta[].pal 16 else
	ifrnd 128 seta[].pal 18 else
	ifrnd 144 seta[].pal 21 else
	ifrnd 160 seta[].pal 22 else
	ifrnd 176 seta[].pal 23 else
	ifrnd 192 seta[].pal 5 else
	spritepal 0
	action ACAR_DRIVE
	}

ife LOTAGSAVED 1
{
move FLYFORWARD geth
ifnotmoving killit
}
else
ife LOTAGSAVED 2
{
move FLYSLOW geth
ifnotmoving killit
}
else
ife LOTAGSAVED 3
{
move TRAFFIC_JAM geth
ifrnd 1 soundonce CAR_HORN
ifnotmoving killit
}
else
ife LOTAGSAVED 0
{
soundonce VEH_RUN2
move SPEEDY geth
ifnotmoving killit
}

ifspawnedby RESPAWN
{
ife LOTAGSAVED 3 sizeat 20 20 else
sizeat 48 48
}


enda

useractor notenemy 1480 // Car Waypoint
cstat 32768

ifcount 6
{
findnearactor CAR_MOVE 768 TEMP
	ifn TEMP -1
		{
		geta[].ang TEMP2
		seta[TEMP].ang TEMP2
		ifspritepal 1 setactorvar[TEMP].LOTAGSAVED 1
		ifspritepal 2 setactorvar[TEMP].LOTAGSAVED 2
		ifspritepal 3 setactorvar[TEMP].LOTAGSAVED 3
		}
resetcount
}

enda


// ===============================================================================FLOATING STUFF

defstate float_up_and_down
ifspritepal 3
{
ifmove 0 { move SUP getv resetcount }
ifcount 16 { ifmove SUP { move SDOWN getv resetcount } else ifmove SDOWN { move SUP getv resetcount } }
}
ends

useractor notenemy 6927 // floating mikko
	ifaction 0
	{
	 seta[].mdflags 16
	 ifspritepal 3 set command 32768
	 action ZERO
	}

enda

useractor notenemy 8142 // Strange alien head
	ifaction 0
	{
	seta[].mdflags 16
	ifspritepal 3 set command 32768
	 action ZERO
	}

enda

useractor notenemy 9215 // Shambler hand
	ifaction 0
	{
	seta[].mdflags 16
	ifspritepal 3 set command 32768
	action ZERO
	}

enda

useractor notenemy 9214 // LameDuke Alien weapon
	ifaction 0
	{
	seta[].mdflags 16
	ifspritepal 3 set command 32768
	action ZERO
	}

enda

useractor notenemy 9213 // Shrinker Ring
	ifaction 0
	{
	seta[].mdflags 16
	ifspritepal 3 set command 32768
	action ZERO
	}

enda

spriteshadow 23536

defstate item_slow_float
	ifaction 0
	{
	seta[].mdflags 16
	set command 65536
	action ZERO
	}
ends

useractor notenemy 23536 // seer
state item_slow_float
enda


useractor notenemy 5762 // floating fish
state item_slow_float
enda

useractor notenemy 11450 // floating fish
state item_slow_float
enda


useractor notenemy 17295 // floating shadow realm island
state item_slow_float
enda

useractor notenemy 17296 // floating shadow realm island
state item_slow_float
enda


useractor notenemy 23535 // floating VB blimp
state item_slow_float
enda

useractor notenemy 25335 // floating island 
state item_slow_float
enda

useractor notenemy 25336 // floating island 
state item_slow_float
enda

useractor notenemy 25337 // floating island 
state item_slow_float
enda

useractor notenemy 25338 // floating island 
state item_slow_float
enda

useractor notenemy 25339 // floating island 
state item_slow_float
enda

useractor notenemy 25340 // floating island 
state item_slow_float
enda

useractor notenemy 25341 // floating island 
state item_slow_float
enda

useractor notenemy 25342 // floating island 
state item_slow_float
enda

useractor notenemy 25343 // floating island 
state item_slow_float
enda

move AROUND 25
move PANIC 50

action AANIMALR 0 2 5 1 10
action AANIMALRPICK 0 2 5 1 10

defstate SMALLANIMAL

ifaction 0 
	{
	cstat 256
	sizeat 32 32
	action AANIMALR
	}

ifaction AANIMALR
	{
	fall
	ifnotmoving move AROUND geth
	ifactor 6283
	{
	ifmove AROUND
		{
		ifbulletnear 
		 ifrnd 64
		  ifcansee
			{
			sound CHICKEN_RUFFLE
			move PANIC
			}
		}
	ifmove PANIC
		{
		ifrnd 4 move AROUND geth
		}
	}
		
	ifpdistl 1024
 	 ifp pfacing
  	  ifp palive
	  {
	  set player_use 0
   	   ifhitspace
	    ifcount 13
		{
		set hit_key 30
		ifactor 6283 sound CHICKENC
		else ifactor PIG sound LPIG_ROAM
		action AANIMALRPICK
		resetcount
		}
	   }

	ifrnd 1 ifcansee { ifactor 6283 sound CHICKENC else ifactor PIG sound LPIG_ROAM }
	ifrnd 8 { move AROUND geth randomangle }
	ifhitweapon { ifactor 6283 sound CHICKDIE guts JIBS6 4 killit } 

	}

ifaction AANIMALRPICK
	{
	ifrnd 4 { ifactor 6283 sound CHICKENC else ifactor PIG sound LPIG_ROAM }
	cstat 256

	set TEMP3 player[].posx
	add TEMP3 512

	seta[].ang player[].ang

	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6

	updatesector TEMP5 TEMP6 TEMP7
	ife TEMP7 -1 action AANIMALR else
	{
	seta[].x TEMP5 
	seta[].y TEMP6
	}
	getp[].posz TEMP
	add TEMP 5600
	seta[].z TEMP
	setp[].weapon_pos 10

	ifp pstanding
	 ifhitspace
		action AANIMALR

	ifpdistg 1024 action AANIMALR
	ifp pjumping action AANIMALR

	}


ends

useractor notenemy 6283 state SMALLANIMAL enda

useractor notenemy PIG state SMALLANIMAL enda

action ASHEEP_STOP 0 1 5 1 8
action ASHEEP_WALK 0 4 5 1 24
action ASHEEP_PANIC 0 4 5 1 12
action ASHEEP_EAT 20 2 5 1 24
action ASHEEP_DIE 30 4 1 1 16
action ASHEEP_DEAD 33

spriteshadow 22966

move SHEEP_MOVE 48 0
move SHEEP_PAN 96 0

useractor notenemy 22966
fall

ifaction 0
	{
	sizeat 50 50
	strength 50
	cstator 257
	action ASHEEP_STOP
	}
	
ifaction ASHEEP_DEAD
	{
	move STOP
	break
	}
else
ifaction ASHEEP_DIE
	{
	move STOP
	ifactioncount 4 
		{
		spawn BLOODPOOL
		action ASHEEP_DEAD
		}
	}
else
ifaction ASHEEP_STOP
	{
	move STOP
	ifrnd 16
		{
		action ASHEEP_WALK
		}
	}
else
ifaction ASHEEP_WALK
	{
	ifrnd 4 sound SHEEP_BAH
	ifrnd 16 move SHEEP_MOVE geth randomangle
		ifrnd 16 action ASHEEP_STOP
		else ifrnd 16 action ASHEEP_EAT
	}
else
ifaction ASHEEP_PANIC
	{
	
	ifrnd 32
		{
		ifactorsound THISACTOR SHEEP_BAH nullop else sound SHEEP_BAH
		setactorsoundpitch THISACTOR SHEEP_BAH 512
		}
	ifnotmoving move SHEEP_PAN geth randomangle else move SHEEP_PAN geth fleeenemy
	ifpdistg 8192 
		ifrnd 16
		action ASHEEP_STOP
	}
else
ifaction ASHEEP_EAT
	{
	move STOP
	ifactioncount 2
		{
		ifrnd 32 action ASHEEP_WALK
		resetactioncount
		}
	}
	
ifhitweapon
	{
	spawn BLOOD
		ifdead
			{
			state rf
			action ASHEEP_DIE
			}
		else
		action ASHEEP_PANIC
	}

enda

// FLOODLIGHTS
useractor notenemy 3575 ifaction 0 action ACAR enda

// SMOKE
useractor notenemy 3665 ifspawnedby RESPAWN { sizeto 128 128 cstat 514 } enda


// ==================================================================NEW ACCESS SWITCHES======================================





action LOCKED 0
action UNLOCKING 0
action UNLOCKED 1

defstate checkcounterpart2

set TEMP 0
whilevarn TEMP 16384
{
  geta[TEMP].statnum STATNUM
  ifn STATNUM 1024
  {
    geta[TEMP].picnum TEMP2
    ife TEMP2 ACCESSSWITCH3
    {
       getactorvar[TEMP].LOTAGSAVED TEMP3
       ife LOTAGSAVED TEMP3 { seta[TEMP].picnum 3485 }
    }
    ife TEMP2 ACCESSSWITCH4
    {
       getactorvar[TEMP].LOTAGSAVED TEMP3
       ife LOTAGSAVED TEMP3 { seta[TEMP].picnum 3487 }
    }
    ife TEMP2 ACCESSSWITCH5
    {
       getactorvar[TEMP].LOTAGSAVED TEMP3
       ife LOTAGSAVED TEMP3 { seta[TEMP].picnum 3563 }
    }
  }
  add TEMP 1
}
 
ends

defstate CUSTOMACCESSSWITCH

ifaction 0 action LOCKED

ifpdistl 1024 ifp pfacing ifhitspace ifaction LOCKED 
{
	ifspritepal 0 // BLUE
		{
			ifand player[].got_access 1
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 0
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 0 }
		}
else
	ifspritepal 12 // GREY
		{
			ifand ACCESSKEY2 1
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 12
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 12 }
		}
else
	ifspritepal 11 // GREEN
		{
			ifand ACCESSKEY2 2
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 11
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 11 }
		}
else
	ifspritepal 15 // BROWN
		{
			ifand ACCESSKEY2 4
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 15
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 15 }
		}
else
	ifspritepal 49 // PURPLE
		{
			ifand ACCESSKEY2 8
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 49
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
		else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 49 }
		}
else
	ifspritepal 10 // DARK RED
		{
			ifand ACCESSKEY2 16
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 10
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
		else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 10 }
		}
else
	ifspritepal 21 // RED
		{
			ifand player[].got_access 2
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 21
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
		else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 21 }
		}
else
	ifspritepal 36 // DARK BROWN
		{
			ifand ACCESSKEY2 32
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 36
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
		else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 36 }
		}
else
	ifspritepal 23 // YELLOW
		{
			ifand player[].got_access 4
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 23
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
		else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 23 }
		}
else
	ifspritepal 16 // DARK BLUE
		{
			ifand ACCESSKEY2 64
				{
				ifinwater nullop else lockplayer 13
				set CKEYCARDPAL 16
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
		else { set door_locked 0 set key_icon ACCESSCARD2 set key_pal 16 }
		}
}

ifaction UNLOCKING
{
set KEYCARDTYPE 0
ife CUSTOMKEYCARDPOS 9
	{
	state checkcounterpart2
	ife HITAGSAVED 0 { ifactor ACCESSSWITCH5 sound CSWITCH2 else sound SWITCH_ON } else soundvar HITAGSAVED
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	action UNLOCKED
	ifspritepal 0 { getp[].got_access TEMP sub TEMP 1 setp[].got_access TEMP }
	ifspritepal 12 sub ACCESSKEY2 1 else
	ifspritepal 11 sub ACCESSKEY2 2 else
	ifspritepal 15 sub ACCESSKEY2 4 else
	ifspritepal 16 sub ACCESSKEY2 64 else
	ifspritepal 49 sub ACCESSKEY2 8 else
	ifspritepal 10 sub ACCESSKEY2 16 else
	ifspritepal 21 { getp[].got_access TEMP sub TEMP 2 setp[].got_access TEMP }
	ifspritepal 36 sub ACCESSKEY2 32
	ifspritepal 23 { getp[].got_access TEMP sub TEMP 4 setp[].got_access TEMP }
	}
}
ends

useractor notenemy ACCESSSWITCH3 state CUSTOMACCESSSWITCH enda
useractor notenemy ACCESSSWITCH4 state CUSTOMACCESSSWITCH enda
useractor notenemy ACCESSSWITCH5 state CUSTOMACCESSSWITCH enda

useractor notenemy SW_TECHLOCK

ifaction 0 action LOCKED

ifpdistl 1024 ifp pfacing ifhitspace ifaction LOCKED 
{
	ifspritepal 0 // BLUE
		{
			ifand SW_KEYS 1
				{
				action ZERO
				}
			else { set door_locked 0 set key_icon SW_TECHCARD set key_pal 0 }
		}
else
	ifspritepal 10 // DARK RED
		{
			ifand SW_KEYS 2
				{
				action ZERO
				}
		else { set door_locked 0 set key_icon SW_TECHCARD set key_pal 10 }
		}
else
	ifspritepal 11 // GREEN
		{
			ifand SW_KEYS 4
				{
				action ZERO
				}
			else { set door_locked 0 set key_icon SW_TECHCARD set key_pal 11 }
		}
else
	ifspritepal 23 // YELLOW
		{
		ifand SW_KEYS 8
				{
				action ZERO
				}
		else { set door_locked 0 set key_icon SW_TECHCARD set key_pal 23 }
		}
}

ifaction ZERO
{
set TEMP 0
whilevarn TEMP 16384
{
  geta[TEMP].statnum STATNUM
  ifn STATNUM 1024
  {
    geta[TEMP].picnum TEMP2
    ife TEMP2 SW_TECHLOCK
    {
	  ife TEMP THISACTOR add TEMP 1
       getactorvar[TEMP].LOTAGSAVED TEMP3
       ife LOTAGSAVED TEMP3 seta[TEMP].picnum 16337
    }
  }
  add TEMP 1
}
ife HITAGSAVED 0 sound SW_TECHK_UNLOCK else soundvar HITAGSAVED
operateactivators LOTAGSAVED THISACTOR
operaterespawns LOTAGSAVED
operatemasterswitches LOTAGSAVED
action UNLOCKED
ifspritepal 0 xorvar SW_KEYS 1 else
ifspritepal 10 xorvar SW_KEYS 2 else
ifspritepal 11 xorvar SW_KEYS 4 else
ifspritepal 23 xorvar SW_KEYS 8 
}

enda

useractor notenemy SW_OLDLOCK

ifaction 0 
{
ifspritepal 0 spritepal 15
action LOCKED
}

ifpdistl 1024 ifp pfacing ifhitspace ifaction LOCKED 
{
	ifspritepal 15 // Bronze
		{
			ifand SW_KEYS 16 action ZERO
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SW_OLDKEY set key_pal 15 }
		}
else
	ifspritepal 12 // Silver
		{
			ifand SW_KEYS 32 action ZERO
		else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SW_OLDKEY set key_pal 12 }
		}
else
	ifspritepal 23 // Yellow, failsafe incase I forget a gold key somewhere
		{
			ifand SW_KEYS 64 action ZERO
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SW_OLDKEY set key_pal 83 }
		}
else
	ifspritepal 83 // Gold
		{
			ifand SW_KEYS 64 action ZERO
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SW_OLDKEY set key_pal 83 }
		}
else
	ifspritepal 10 // Red
		{
		ifand SW_KEYS 128 action ZERO
		else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SW_OLDKEY set key_pal 10 }
		}
}

ifaction ZERO
{
ife HITAGSAVED 0 sound OLDKEY_UNLOCK else soundvar HITAGSAVED
operateactivators LOTAGSAVED THISACTOR
operaterespawns LOTAGSAVED
operatemasterswitches LOTAGSAVED
action UNLOCKED
ifspritepal 15 xorvar SW_KEYS 16 else
ifspritepal 12 xorvar SW_KEYS 32 else
ifspritepal 23 xorvar SW_KEYS 64 else
ifspritepal 10 xorvar SW_KEYS 128 
}

enda

useractor notenemy 22455

ifaction 0
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    ife TEMPLE_KEY 8
		{
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			set TEMPLE_KEY 0
			soundonce OLD_SWITCH
			action ONE
			}
		}

enda

// ===============================================================CUSTOM SWITCHES============================================

action CHAINPULL 0 2 1 1 10
action PULLED 2 1 1 1 0

defstate CUSTOMSWITCH

ifspritepal 1
 {
 ifmultiplayer spritepal 0 else killit
 }
 
ifaction 0 
 ifn sprite[].zvel 0
	{
	sleeptime 0
	checkactivatormotion sprite[].zvel
	 ife RETURN 1
		seta[].zvel 0
	}

ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    ife sprite[].zvel 0
	 ife player[].newowner -1
   {
   ife sprite[].xvel 2
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 break
	}
   ife sprite[].xvel 1 ifaction ONE break
   set player_use 0
    ifhitspace
     ifcount 13
      {
	  set hit_key 30
	  ifaction CHAINPULL break
	  ifaction PULLED break
      stopsound DUKE_SEARCH
      stopsound DUKE_SEARCH2
      ife HITAGSAVED 0
		{ 
		ifactor NEWSWITCH2 sound M_SWITCH else
		ifactor NEWSWITCH3 sound M_SWITCH else
		ifactor NEWSWITCH4 sound OLD_SWITCH else
		ifactor NEWSWITCH5 sound ANC_SWITCH else
		ifactor NEWSWITCH6 sound ANC_SWITCH else
		ifactor NEWSWITCH13 sound GIB_LAND1 else
		ifactor NEWSWITCH14 sound POOLBALLHIT else
		ifactor NEWSWITCH15 sound M_SWITCH2 else
		ifactor NEWSWITCH16 { sound DUKE_DRINKING sound EGYPT_SWITCH } else
		ifactor NEWSWITCH17 { sound LAVA_HIT sound EGYPT_SWITCH } else
		ifactor NEWSWITCH18 sound EGYPT_SWITCH else
		ifactor NEWSWITCH19 sound M_SWITCH2 else
		ifactor NEWSWITCH20 sound M_SWITCH else
		ifactor NEWSWITCH21 sound OLD_SWITCH3 else
		ifactor NEWSWITCH22 sound OLD_SWITCH2 else
		ifactor NEWSWITCH23 sound OLD_SWITCH2 else
		ifactor NEWSWITCH24 sound OLD_SWITCH4 else
		ifactor NEWSWITCH26 sound IW_SWITCH else 
		ifactor NEWSWITCH27 sound M_SWITCH3 else
		ifactor NEWSWITCH28 sound M_SWITCH3 else
		ifactor NEWSWITCH29 sound M_SWITCH3 else
		ifactor NEWSWITCH30 sound SW_SWITCH else
		ifactor NEWSWITCH31 sound SW_SWITCH else
		ifactor NEWSWITCH32 sound SW_SWITCH else
		ifactor NEWSWITCH33 sound SW_SWITCH else
		ifactor NEWSWITCH34 sound BUNK_BUTTON else
		ifactor NEWSWITCH35 sound SF_BUTTON else
		ifactor NEWSWITCH36 sound M_SWITCH else
		ifactor NEWSWITCH37 sound M_SWITCH else
		ifactor 18648 sound CY_SWITCH else
		ifactor VR_REALITY_SWITCH sound VR_REALITY else
		ifactor 9457 { quote 260 set TEMP 1 sound WRITING } else
		sound CSWITCH1 
		} 
	  else ifl HITAGSAVED 4096 soundvar HITAGSAVED
	  
	  ifactor NEWSWITCH24 action CHAINPULL 
	  else { ifaction 0 action ONE else ifaction ONE action 0 }
	  
      operateactivators LOTAGSAVED THISACTOR
      operaterespawns LOTAGSAVED
      operatemasterswitches LOTAGSAVED
      resetcount
      }
	}
ends

useractor notenemy NEWSWITCH1 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH2 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH3 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH4 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH5 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH6 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH7 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH8 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH9 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH10 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH11 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH12 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH13 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH14 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH15 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH16 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH17 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH18 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH19 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH20 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH21 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH22 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH23 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH24 state CUSTOMSWITCH
ifaction CHAINPULL ifactioncount 2 action PULLED
enda
useractor notenemy NEWSWITCH25 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH26 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH27 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH28 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH29 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH30 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH31 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH32 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH33 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH34 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH35 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH36 state CUSTOMSWITCH enda
useractor notenemy NEWSWITCH37 state CUSTOMSWITCH enda
useractor notenemy 18648 state CUSTOMSWITCH enda

action OPEN_FIRST 1
action OPEN_SECOND 2


useractor notenemy ENVIRO_SUIT_SWITCH

ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
   {
	set player_use 0
    ifhitspace
	{
     ifcount 13
      {
	  set hit_key 30
      stopsound DUKE_SEARCH
      stopsound DUKE_SEARCH2
      
		 
		ifaction 0 // Close the outer door
			{
			ife FIRE_SUIT 1 break
			sound M_SWITCH
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			action OPEN_FIRST 
			}
			else
		ifaction OPEN_FIRST // Open the inner door
			{
			ife FIRE_SUIT 0 // if the player is out of enviro-suit, open outer door
				{
				sound M_SWITCH
				operateactivators LOTAGSAVED THISACTOR
				operaterespawns LOTAGSAVED
				operatemasterswitches LOTAGSAVED
				action 0
				}
				else // open inner door
				{
				action OPEN_SECOND
				sound IW_SWITCH
				operateactivators HITAGSAVED THISACTOR
				operaterespawns HITAGSAVED
				operatemasterswitches HITAGSAVED
				}
			}
			else 
		ifaction OPEN_SECOND
			{
			action OPEN_FIRST
			sound IW_SWITCH
			operateactivators HITAGSAVED THISACTOR
			operaterespawns HITAGSAVED
			operatemasterswitches HITAGSAVED
			}

		  resetcount
		  }
	  }
	}
enda

useractor notenemy 9457 state CUSTOMSWITCH enda // Lease

useractor notenemy VR_REALITY_SWITCH state CUSTOMSWITCH enda

defstate addbabeachievement
spawn TRANSPORTERBEAM
globalsound SAVE_PERSON 

add CREDITS 30

ife VOLUME 0
 ife LEVEL 7
	{
	ifrnd 48 spawn SPIRIT_ARMOUR else
	ifrnd 48 spawn AMULET else
	ifrnd 48 spawn FIRE_ARMOUR else
	ifrnd 24 spawn HEAVYARMOUR else
	ifrnd 12 spawn SUPER_ARMOUR else
	ifrnd 4 spawn MEGASPHERE
	}

ends

// ==========================================================FLAMEST STUFF

move FLAMEMOVE 230 0
move FLAMEMOVE2 430 0

action FLALICK 1 11 1 1 8

spritenoshade 3296

useractor notenemy 3296

ifaction 0 
	{ 
	ifpdistg 16384 ifand THISACTOR 1 killit
	ifspawnedby RPG
		{
		seta[].blend 255
		seta[].shade -127
		cstat 642
		action FLALICK 
		sizeat 7 7
		set INTERNALCOUNT 0
		resetactioncount
		}
	else
	ifspawnedby 22536
		{
		seta[].blend 255
		seta[].shade -127
		cstat 642
		action FLALICK 
		sizeat 7 7
		set INTERNALCOUNT 0
		resetactioncount
		}
	else
	ifspawnedby APLAYER
		{
		seta[].blend 255
		seta[].shade -127
		geta[].z TEMP
		sub TEMP 8192
		seta[].z TEMP
		cstat 642
		action FLALICK 
		sizeat 14 14
		set INTERNALCOUNT 0
		resetactioncount
		}
	else
		{
		seta[].blend 255
		cstat 514 
		ifrnd 128 cstator 4
		ifrnd 128 cstator 8
		action FLALICK 
		sizeat 38 38
		seta[].shade -127
		set INTERNALCOUNT 0
		resetactioncount
		}
	}
else
ifaction FLALICK
	{
	add INTERNALCOUNT 1
	ife TEMP5 1 move FLAMEMOVE2 geth getv
	else move FLAMEMOVE geth getv
	ifactioncount 11 killit
	ifspawnedby APLAYER
	{
	ifactioncount 1
		{
		getp[].horiz TEMP
		sub TEMP 100
		mulvar TEMP -75
		seta[].zvel TEMP
		}
	}
	 findnearactor3d 5381 1024 TEMP9 ifn TEMP9 -1
		{
		getactorvar[TEMP9].myowner TEMP8
		getactorvar[TEMP8].FIRE_DAMAGE TEMP
		add TEMP 12
		setactorvar[TEMP8].FIRE_DAMAGE TEMP 
		}
	 findnearactor3d SHOOTME 1024 TEMP9 ifn TEMP9 -1
		{
		getactorvar[TEMP9].myowner TEMP8
		getactorvar[TEMP8].FIRE_DAMAGE TEMP
		add TEMP 12
		setactorvar[TEMP8].FIRE_DAMAGE TEMP 
		}
	 findnearactor3d SHOOTME3 1024 TEMP9 ifn TEMP9 -1
		{
		getactorvar[TEMP9].myowner TEMP8
		getactorvar[TEMP8].FIRE_DAMAGE TEMP
		add TEMP 12
		setactorvar[TEMP8].FIRE_DAMAGE TEMP 
		}
	ifpdistl 1024 
	ife TEMP5 0
		{ 
		ifg INTERNALCOUNT 13 
			{ 
			ife FIRE_SUIT 1 nullop
			else
				{
				wackplayer 
				addphealth -5 
				palfrom 20 20 0 0 
				}
			set INTERNALCOUNT 0 
			} 
		}
	ifinwater killit
	}

enda

// ***************************************************************************************************************************************************
// LIGHT CONDUCT
// ***************************************************************************************************************************************************

spritenoshade LIGHT_SPREAD
spritenopal LIGHT_SPREAD

action CONDUCT_LIGHT 0  5  1  1  4

useractor notenemy LIGHT_SPREAD
fall
ifaction 0 
	{
	cstat 0
	flash
	sizeat 48 48
	seta[].shade -127
	action CONDUCT_LIGHT
	resetactioncount
	}

ifaction CONDUCT_LIGHT
	{
	sizeto 96 96
	ifactioncount 5 { shoot SPARK2 shoot SPARK2 shoot SPARK2 killit }
	}
	
	
enda


// ===============================================================HELL GATE KEYS=========================================


action ABLOODCHALICE -5 1 1 1 1
action ASOULBOX -4 1 1 1 1
action ASKULLCROWN -3 1 1 1 1
action ADARKBOOK -2 1 1 1 1
action ABROKENTORCH -1 1 1 1 1


useractor notenemy 7668

ifaction 0
{
cstat 32768
action ZERO
}

ifvarvarand LOTAGSAVED HELLGKEYSA ifspritepal 0 { sets[].floorshade 0 sets[].floorpal 2 } else
ifspritepal 1
 {
 ife HELLGKEYSA 31 
	{ 
	quake 128
	palfrom 62 62
	globalsound DEMON_TELEPORT
	operaterespawns 666
	sets[].floorshade 0 
	sets[].floorstat 1 
	sets[].floorpicnum 7390 
	killit
	}
 }
else
ifspritepal 2
{
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
			{
			ife HITAGSAVED 1
				{
				ifand HELLGKEYS 1 
					{ 
					ifand HELLGKEYSA 1 break 
					action ABLOODCHALICE
					sub HELLGKEYS 1
					sound GET_MAGIC
					sizeat 32 32
					quote 283
					cstat 0
					add HELLGKEYSA 1
					break
					}
				}
			ife HITAGSAVED 2
				{
				ifand HELLGKEYS 2 
					{ 
					ifand HELLGKEYSA 2 break 
					action ASOULBOX
					sound GET_MAGIC
					sub HELLGKEYS 2
					sizeat 32 32
					quote 283
					cstat 0
					add HELLGKEYSA 2
					break
					}
				}
			ife HITAGSAVED 4
				{
				ifand HELLGKEYS 4 
					{ 
					ifand HELLGKEYSA 4 break 
					action ASKULLCROWN
					sound GET_MAGIC
					sub HELLGKEYS 4
					sizeat 32 32
					quote 283
					cstat 0
					add HELLGKEYSA 4
					break
					}
				}
			ife HITAGSAVED 8
				{
				ifand HELLGKEYS 8 
					{ 
					ifand HELLGKEYSA 8 break 
					action ADARKBOOK
					sound GET_MAGIC
					sub HELLGKEYS 8
					sizeat 32 32
					quote 283
					cstat 0
					add HELLGKEYSA 8
					break
					}
				}
			ife HITAGSAVED 16
				{
				ifand HELLGKEYS 16 
					{ 
					ifand HELLGKEYSA 16 break 
					action ABROKENTORCH
					sound GET_MAGIC
					sub HELLGKEYS 16
					sizeat 32 32
					quote 283
					cstat 0
					add HELLGKEYSA 16
					break
					}
				}
			}
}
else
ifspritepal 3
 {
 ife HELLGKEYSA 63 
	{ 
	quake 128
	palfrom 62 62
	globalsound DEMON_TELEPORT
      operatemasterswitches 666
	  operateactivators 666 THISACTOR
	sets[].floorpicnum 7417 
	killit 
	}
 }
enda


// ===============================================================DIS BASE REACTOR=========================================

useractor notenemy 7669

ifaction 0
{
cstat 32768
action ZERO
}

ifpdistl 1024
{
 ife HELLGKEYS 31
	{
	operateactivators 34 THISACTOR
	killit
	}
  else
  ifcount 26
	  {
	  quote 232
	  sound LOCKED_HITECH1
	  resetcount
	  }
}

enda

useractor notenemy 7672 

checkactivatormotion HITAGSAVED
ife RETURN 1
{
	ifaction 0
		{
		action ZERO
		resetcount
		}
}

ifaction ZERO
	{
	ifcount 26 ife LOTAGSAVED 1 { globalsound INTRUDER_ALERT ifn EXTRASAVED -1 operateactivators EXTRASAVED THISACTOR action ONE }
	ifcount 52 ife LOTAGSAVED 2 { globalsound INTRUDER_ALERT ifn EXTRASAVED -1 operateactivators EXTRASAVED THISACTOR action ONE }
	ifcount 78 ife LOTAGSAVED 3 { globalsound INTRUDER_ALERT ifn EXTRASAVED -1 operateactivators EXTRASAVED THISACTOR action ONE }
	ifcount 104 ife LOTAGSAVED 4 { globalsound INTRUDER_ALERT ifn EXTRASAVED -1 operateactivators EXTRASAVED THISACTOR action ONE }
	ifcount 130 ife LOTAGSAVED 5 { globalsound INTRUDER_ALERT ifn EXTRASAVED -1 operateactivators EXTRASAVED THISACTOR action ONE }
	ifcount 156 ife LOTAGSAVED 6 { globalsound INTRUDER_ALERT ifn EXTRASAVED -1 operateactivators EXTRASAVED THISACTOR action ONE }
	}
	
enda

useractor notenemy 7674 // countdown!

checkactivatormotion HITAGSAVED
ife RETURN 1
{
	ifaction 0
		{
		action ZERO
		resetcount
		}
}

ifaction ZERO
	{
	ifcount 208 
		{ 
		starttrackvar 29
		set MIDICHANGES 29
		globalsound CLAXON_ALARM 
		quake 26 
		set countdown 1
		set countdown_type 1 
		set countdown_minutes 3 
		set countdown_fail LOTAGSAVED
		action ONE 
		}
	}
	
ifaction ONE
{
	ifrnd 8 quake 13
	add count_timer 1
	ifg countdown_seconds -1 ife count_timer 28 { sub countdown_seconds 1 set count_timer 0 }
	else ife countdown_seconds -1 
		{
		ifg countdown_minutes 0
			{ sub countdown_minutes 1 set countdown_seconds 59 }
		else
			{
			set countdown_type 0
			setgamepalette 0
			operateactivators countdown_fail THISACTOR
			operatemasterswitches countdown_fail
			operaterespawns countdown_fail
			set countdown -1
			killit
			}
		}
	ifcount 40 { globalsound CLAXON_ALARM resetcount }
}
	
	
	
enda

// ===============================================================MISSION FAILED============================================


useractor notenemy 7679

checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	set SP_R 255 set SP_G 255 set SP_B 255 set SP_FADE 254
	set SLO_MO_SHOWOFF 70
	set FISSION_MAILED 1
	killit
	}

enda

// ===============================================================SLO MO TRIGGER============================================


useractor notenemy 10150

checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	ifg LOTAGSAVED 128 set LOTAGSAVED 128
	set SLO_MO_SHOWOFF LOTAGSAVED
	killit
	}

enda

// ===============================================================SPOOKY TRIGGER============================================



useractor notenemy 10151

checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	ifspritepal 8 set vr_glitched 98 else
	set player_spooked 98
	killit
	}

enda

// ===============================================================PLUG SOCKETS============================================


useractor notenemy BLUEPSOCKET
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    {
	set player_use 0
	 ifhitspace
	  {
	  set hit_key 30
		ifand PLUGKEY 1
			{		
			 ifcount 26
			  {
			  sound PLUGPUTIN
			  operateactivators LOTAGSAVED THISACTOR
			  operaterespawns LOTAGSAVED
			  operatemasterswitches LOTAGSAVED
			sub PLUGKEY 1
			seta[].picnum 3460
			resetcount
			  }
			}
		else
		{ set door_locked 0 set key_icon BLUEPLUG set key_pal 0 }
	  }
	}
enda

useractor notenemy REDPSOCKET
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    {
	set player_use 0
	 ifhitspace
	  {
	  set hit_key 30
		ifand PLUGKEY 2
			{		
			 ifcount 26
			  {
			  sound PLUGPUTIN
			  operateactivators LOTAGSAVED THISACTOR
			  operaterespawns LOTAGSAVED
			  operatemasterswitches LOTAGSAVED
			  sub PLUGKEY 2
			  seta[].picnum 3461
			  resetcount
			  }
			}
		else
		{ set door_locked 0 set key_icon REDPLUG set key_pal 0 }
	  }
	}
enda

useractor notenemy YELLOWPSOCKET
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    {
	set player_use 0
	 ifhitspace
	  {
	  set hit_key 30
		ifand PLUGKEY 4
			{		
			 ifcount 26
			  {
			  sound PLUGPUTIN
			  operateactivators LOTAGSAVED THISACTOR
			  operaterespawns LOTAGSAVED
			  operatemasterswitches LOTAGSAVED
			  sub PLUGKEY 4
			  seta[].picnum 3462
			  resetcount
			  }
			}
		else
		{ set door_locked 0 set key_icon YELLOWPLUG set key_pal 0 }
	  }
	}
enda

useractor notenemy 3460
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
     ifcount 26
      {
	ifand PLUGKEY 1 break
	set player_use 0
	    ifhitspace
		{
		set hit_key 30
	      sound PLUGPULLOUT
	      operateactivators LOTAGSAVED THISACTOR
	      operaterespawns LOTAGSAVED
	      operatemasterswitches LOTAGSAVED
		add PLUGKEY 1
		seta[].picnum BLUEPSOCKET
		resetcount
		}
      }
enda

useractor notenemy 3461
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
     ifcount 26
      {
	ifand PLUGKEY 2 break
	set player_use 0
	    ifhitspace
		{
		set hit_key 30
	    sound PLUGPULLOUT
	    operateactivators LOTAGSAVED THISACTOR
	    operaterespawns LOTAGSAVED
	    operatemasterswitches LOTAGSAVED
		add PLUGKEY 2
		seta[].picnum REDPSOCKET
		resetcount
		}
      }
enda

useractor notenemy 3462
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
     ifcount 26
      {
	ifand PLUGKEY 4 break
	set player_use 0
	    ifhitspace
		{
		set hit_key 30
	    sound PLUGPULLOUT
	    operateactivators LOTAGSAVED THISACTOR
	    operaterespawns LOTAGSAVED
	    operatemasterswitches LOTAGSAVED
		add PLUGKEY 4
		seta[].picnum YELLOWPSOCKET
		resetcount
		}
      }
enda

// *************************************************
// AIR BUBBLES
// *************************************************

useractor notenemy AIRBUBBLES

ifaction 0 { spawn 8951 action ZERO }

ifrnd 8 { espawn WATERBUBBLE geta[].z TEMP sub TEMP 7500 seta[RETURN].z TEMP }
getp[].airleft TEMP2

ifpdistl 812
 ifp palive
  ifp pfacing
    {
    ifg TEMP2 389 break
    soundonce DUKE_TAKEPILLS
    add TEMP2 10
    setp[].airleft TEMP2
    }

enda

// BOAT STUFF

useractor notenemy 631 ifspritepal 3 fall enda

// *************************************************
// WALL SCROLL POINT
// *************************************************


useractor notenemy 3828

ifaction 0
{
cstat 32768
geta[].x x
geta[].y y
geta[].sectnum TEMP
geta[].ang TEMP3

sin my TEMP3
cos mx TEMP3
geta[].z z

hitscan x y z TEMP mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280
action ZERO
}

ifn hitwall -1
{
	ifspritepal 0
	{
	getwall[hitwall].xpanning TEMP2
	sub TEMP2 LOTAGSAVED
	setwall[hitwall].xpanning TEMP2
	getwall[hitwall].ypanning TEMP2
	sub TEMP2 HITAGSAVED
	setwall[hitwall].ypanning TEMP2
	}
	else
	ifspritepal 1
	{
	getwall[hitwall].xpanning TEMP2
	add TEMP2 LOTAGSAVED
	setwall[hitwall].xpanning TEMP2
	getwall[hitwall].ypanning TEMP2
	add TEMP2 HITAGSAVED
	setwall[hitwall].ypanning TEMP2
	}
}

enda

// *************************************************
// WALL BLOCK
// *************************************************

useractor notenemy 12030

ifaction 0
{
geta[].x x
geta[].y y
geta[].sectnum TEMP
geta[].ang TEMP3

sin my TEMP3
cos mx TEMP3
geta[].z z

hitscan x y z TEMP mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280
action ZERO
}

ifaction ZERO
{
ifn hitwall -1
	{
		checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			getwall[hitwall].cstat TEMP6
			xorvar TEMP6 1
			setwall[hitwall].cstat TEMP6
			killit
			}
	}
}

enda

// *************************************************
// FLOOR CEILING SCROLL
// *************************************************

defstate SETSTAT
	gets[].ceilingstat TEMP
	xorvar TEMP 8192
	sets[].ceilingstat TEMP
ends

useractor notenemy 3829

ifspritepal 0 // SCROLL CEILING
{
ifaction 0 { state SETSTAT action ZERO }
gets[SECT_NUM].ceilingxpanning TEMP2 add TEMP2 LOTAGSAVED sets[SECT_NUM].ceilingxpanning TEMP2
gets[SECT_NUM].ceilingypanning TEMP2 add TEMP2 HITAGSAVED sets[SECT_NUM].ceilingypanning TEMP2
}

ifspritepal 1 // SCROLL FLOOR
{
ifaction 0 { state SETSTAT action ZERO }
gets[SECT_NUM].floorxpanning TEMP2 add TEMP2 LOTAGSAVED sets[SECT_NUM].floorxpanning TEMP2
gets[SECT_NUM].floorypanning TEMP2 add TEMP2 HITAGSAVED sets[SECT_NUM].floorypanning TEMP2
}

ifspritepal 2 // SCROLL BOTH
{
ifaction 0 { state SETSTAT action ZERO }
gets[SECT_NUM].floorxpanning TEMP2 add TEMP2 LOTAGSAVED sets[SECT_NUM].floorxpanning TEMP2
gets[SECT_NUM].floorypanning TEMP2 add TEMP2 HITAGSAVED sets[SECT_NUM].floorypanning TEMP2
gets[SECT_NUM].ceilingxpanning TEMP2 add TEMP2 LOTAGSAVED sets[SECT_NUM].ceilingxpanning TEMP2
gets[SECT_NUM].ceilingypanning TEMP2 add TEMP2 HITAGSAVED sets[SECT_NUM].ceilingypanning TEMP2
}

ifspritepal 3 // SCROLL CEILING BACKWARDS
{
ifaction 0 { state SETSTAT action ZERO }
gets[SECT_NUM].ceilingxpanning TEMP2 sub TEMP2 LOTAGSAVED sets[SECT_NUM].ceilingxpanning TEMP2
gets[SECT_NUM].ceilingypanning TEMP2 sub TEMP2 HITAGSAVED sets[SECT_NUM].ceilingypanning TEMP2
}

ifspritepal 4 // SCROLL FLOOR BACKWARDS
{
ifaction 0 { state SETSTAT action ZERO }
gets[SECT_NUM].floorxpanning TEMP2 sub TEMP2 LOTAGSAVED sets[SECT_NUM].floorxpanning TEMP2
gets[SECT_NUM].floorypanning TEMP2 sub TEMP2 HITAGSAVED sets[SECT_NUM].floorypanning TEMP2
}

ifspritepal 5 // SCROLL BOTH BACKWARDS
{
ifaction 0 { state SETSTAT action ZERO }
gets[SECT_NUM].floorxpanning TEMP2 sub TEMP2 LOTAGSAVED sets[SECT_NUM].floorxpanning TEMP2
gets[SECT_NUM].floorypanning TEMP2 sub TEMP2 HITAGSAVED sets[SECT_NUM].floorypanning TEMP2
gets[SECT_NUM].ceilingxpanning TEMP2 sub TEMP2 LOTAGSAVED sets[SECT_NUM].ceilingxpanning TEMP2
gets[SECT_NUM].ceilingypanning TEMP2 sub TEMP2 HITAGSAVED sets[SECT_NUM].ceilingypanning TEMP2
}

ifspritepal 6 // SCROLL CEILING SLOW FOR SKYBOXES
{
ifaction 0 { state SETSTAT action ZERO }
add INTERNALCOUNT 1
ifg INTERNALCOUNT 1
	{
	gets[SECT_NUM].ceilingxpanning TEMP2 add TEMP2 LOTAGSAVED sets[SECT_NUM].ceilingxpanning TEMP2
	gets[SECT_NUM].ceilingypanning TEMP2 add TEMP2 HITAGSAVED sets[SECT_NUM].ceilingypanning TEMP2
	set INTERNALCOUNT 0
	}
}

enda

// *************************************************
// DEAD MARINE FLASHLIGHT
// *************************************************

action FLASHON -1

useractor notenemy 5869
seta[].blend 255
ifaction 0 ifrnd 16 { ife camerasprite -1 sound FLASHLIGHT action FLASHON }

ifaction FLASHON ifrnd 16 { sound FLASHLIGHT action 0 }

enda

// *************************************************
// PENTAGRAM
// *************************************************

useractor notenemy PENTAGRAM

ifn LOTAGSAVED 1
{
	ifaction 0
	{
	seta[].shade -127
	seta[].blend 255
	ifspawnedby HADESPHERE
		{
		palfrom 20 20
		cstat 130
		}
	else
		{
		seta[].z sector[].floorz
		sizeat 16 16
		cstat 34
		}
	spriteflags 4
	soundonce COOKINGDEEPFRIER
	action ZERO
	}
	else
	ifaction ZERO
	{
	ifspawnedby HADESPHERE
		{
		sizeto 48 48
		ifg sprite[].xrepeat 47 killit
		ifg sprite[].xrepeat 5 { geta[].shade TEMP2 add TEMP2 1 seta[].shade TEMP2 }
		}
		else
		{
		fall
		geta[].shade TEMP
		add TEMP 1
		ifg TEMP 40 killit
		seta[].shade TEMP
		}
	}
}

enda


// *************************************************
// BLOODPOOL
// *************************************************

defstate bloodpool_state
ifpdistl 812
{
ifand sprite[].cstat 32
	{
	ifp pshrunk break
	setp[].footprintcount 4
	setp[].footprintpal 2
	}
}
ends

useractor notenemy 7400 state bloodpool_state enda
useractor notenemy 10567 state bloodpool_state enda
useractor notenemy 10568 state bloodpool_state enda
useractor notenemy 10586 state bloodpool_state enda
useractor notenemy 10643 state bloodpool_state enda
useractor notenemy 10644 state bloodpool_state enda

action REDPOOL -40
action GREENPOOL -44
action BLUEPOOL -43
action BLACKPOOL -42

spritenoshade 2284

useractor notenemy 2284
state lowperf

sizeto 36 36

ifg TEMP2 0 killit

ifaction 0
{
	seta[].hitag 0
	cstat 32
	set ALLY_MAG 0
	move 0 randomangle
	ifinspace killit
	
	updatesectorz sprite[].x sprite[].y sprite[].z TEMP8
		
	ifn TEMP8 -1 changespritesect THISACTOR TEMP8 else killit
	
	ife sprite[].sectnum -1 killit
	ifand sector[].floorstat 2 killit
	ifand sector[].floorstat 1 killit
	ife sector[].lotag 1 killit
	findnearactor3d 2284 768 TEMP ifn TEMP -1 killit
	resetcount
	 
	ifspawnedby ICE_DEBRIS_F action BLUEPOOL
	else ifspawnedby 8127 action BLUEPOOL
	else ifspawnedby 8129 action BLUEPOOL
	else ifspawnedby 8131 action BLUEPOOL
	else ifspawnedby 8132 action BLUEPOOL
	else ifspawnedby 8133 action BLUEPOOL
	else ifspawnedby 8134 action BLUEPOOL
	else ifspawnedby 19540 action BLACKPOOL
	else ifspawnedby 18112 action BLACKPOOL
	else ifspawnedby 4714 action GREENPOOL
	else ifspawnedby ALUDRAN { spritepal 30 action BLUEPOOL }
	else ifspritepal 14 action GREENPOOL
	else ifspritepal 8 action GREENPOOL
	else ifspritepal 1 action BLUEPOOL
	else action REDPOOL
}

ife TEMP4 1 
{
ifoutside killit
ifand sector[].ceilingstat 8192 killit // is the ceiling scrolling?
ifand sector[].ceilingstat 1024 killit // is it a TROR sector?
ifand sector[].ceilingstat 2 killit // is it a sloped sector?
seta[].pal sector[].ceilingpal
seta[].shade sector[].ceilingshade
seta[].z sector[].ceilingz 
ifrnd 4
 ifaction ZERO
  ifl ALLY_MAG 5
	{
	espawn WATERDRIP
	add ALLY_MAG 1
	ifaction GREENPOOL seta[RETURN].pal 8
	else ifspritepal 6 seta[RETURN].pal 8
	else ifaction BLACKPOOL seta[RETURN].pal 13
	else ifspritepal 14 seta[RETURN].pal 14
	else ifspritepal 30 seta[RETURN].pal 30
	else ifaction BLUEPOOL seta[RETURN].pal 16
	else seta[RETURN].pal 10
	}
}
else
{
ifand sector[].ceilingstat 8192 killit // is the floor scrolling?
ifand sector[].floorstat 1024 killit // is it a TROR sector?
ifand sector[].floorstat 2 killit // is it a sloped sector?
seta[].shade sector[].floorshade
seta[].pal sector[].floorpal
seta[].z sector[].floorz
}

ifpdistl 812
{
ifspritepal 3 break
	ifand sprite[].cstat 32
		{
		setp[].footprintcount 4
		ifaction ZERO setp[].footprintpal 2 else
		ifaction GREENPOOL setp[].footprintpal 8 else
		ifaction BLUEPOOL setp[].footprintpal 1 else
		ifaction BLACKPOOL setp[].footprintpal 13 else
		setp[].footprintpal sprite[].pal
		}
}
else
ifpdistg PARTICLE_DISTANCE sizeto 0 0

enda

// high-res flame ================================================

spritenoshade 24268
spritenopal 24268

useractor notenemy 24268 
ifaction 0
	{
	seta[].blend 255
	seta[].cstat 1026
	seta[].shade -127
	action ZERO
	}
enda

// LOGS ================================================

useractor notenemy 8002
ifspritepal 5 break
soundonce SOFTFIRE_AMBIENCE

ifrnd 1 { shoot SPARK sound FIRE_SPIT }

	ifrnd 96
	 ife ADVANCED_FLAME YES
	  ifpdistl PARTICLE_DISTANCE
		{
		espawn 14040
		seta[RETURN].cstat 32768
		geta[].x TEMP
		randvar TEMP2 64
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 64
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 128
		sub TEMP TEMP2
		randvar TEMP2 1024
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
enda

// HELL TORCH ================================================

useractor notenemy 7392
ifaction 0 
    {
    cstat 1024
    }

ife ALLY_MAG 0
	{
	espawn 24268
		seta[RETURN].xrepeat 11
		seta[RETURN].yrepeat 11
		seta[RETURN].pal 106
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 256
		sub TEMP TEMP2
		seta[RETURN].z TEMP
	espawn 7392
		setav[RETURN].ALLY_MAG 1
		seta[RETURN].xrepeat sprite[].xrepeat
		seta[RETURN].yrepeat sprite[].yrepeat
		seta[RETURN].pal sprite[].pal
		seta[RETURN].shade sprite[].shade
	killit
	}
enda

// EGYPT OIL BARREL ================================================

spriteshadow 23625

useractor notenemy 23625

ifaction 0
{
strength 5
sizeat 40 40
fall
cstator 257
action ZERO
}

ifaction ZERO
{
ifactorsound THISACTOR TORCHFIRE nullop else sound TORCHFIRE 
	ifrnd 96
	 ife ADVANCED_FLAME YES
	  ifpdistl PARTICLE_DISTANCE
		{
		espawn 14040
		seta[RETURN].cstat 32768
		geta[].x TEMP
		randvar TEMP2 32
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 32
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 180
		sub TEMP TEMP2
		randvar TEMP2 1024
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
		
	ifhitweapon
	{
	debris SCRAP3 2
	shoot SPARK
	ifdead
		{
		debris SCRAP3 16
		spawn GROUNDEXPLOSION 
		shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		flash 
		quake 13 
		sound BARREL_EXPLODE 
		hitradius 2048 100 125 175 250
		sound POTBREAK 
		killit
		}
	}
}
		
enda

useractor notenemy 20107
	ifrnd 96
	  ifpdistl PARTICLE_DISTANCE
		{
		soundonce SOFTFIRE_AMBIENCE
		espawn 14040
		seta[RETURN].cstat 32768
		geta[].x TEMP
		randvar TEMP2 32
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 32
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 128
		sub TEMP TEMP2
		randvar TEMP2 1024
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
enda


useractor notenemy 7936 // standard torch on wall
ifaction 0 
    {
    cstat 1024
    }
ife sprite[].httempang 0
	{
	espawn 24268
		seta[RETURN].xrepeat 20
		seta[RETURN].yrepeat 20
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 124
		sub TEMP TEMP2
		seta[RETURN].z TEMP
	espawn 7936
		seta[RETURN].httempang 1
		seta[RETURN].xrepeat sprite[].xrepeat
		seta[RETURN].yrepeat sprite[].yrepeat
		seta[RETURN].pal sprite[].pal
		seta[RETURN].shade sprite[].shade
	killit
	}
enda

useractor notenemy 10074
	ifrnd 96
	 ife ADVANCED_FLAME YES
	  ifpdistl PARTICLE_DISTANCE
		{
		espawn 14040
		seta[RETURN].pal sprite[].pal
		seta[RETURN].cstat 32768
		geta[].x TEMP
		randvar TEMP2 96
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 96
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 64
		sub TEMP TEMP2
		randvar TEMP2 512
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
enda

useractor notenemy 10082

ifn HITAGSAVED 0
{
	ifpdistl 1536
	 ifp palive
	  ifp pfacing
		{
		set player_use 0
			ifhitspace
				{
				set hit_key 30
				soundonce ZIPPOLIGHT
				soundonce ENGULF_FIRE
				palfrom 10 10 10 10
				operateactivators HITAGSAVED THISACTOR
				operaterespawns HITAGSAVED
				operatemasterswitches HITAGSAVED
				cactor 10078
				}
		}
}
		
enda

useractor notenemy 10078

ifaction 0
{
espawn 10082
seta[RETURN].xrepeat sprite[].xrepeat
seta[RETURN].yrepeat sprite[].yrepeat
seta[].blend 255
cstator 2
action ZERO
}

ifaction ZERO
{
	ifrnd 96
	 ife ADVANCED_FLAME YES
	  ifpdistl PARTICLE_DISTANCE
		{
		ifactorsound THISACTOR SOFTFIRE_AMBIENCE nullop else sound SOFTFIRE_AMBIENCE
		espawn 14040
		seta[RETURN].pal sprite[].pal
		seta[RETURN].cstat 32768
		geta[].x TEMP
		randvar TEMP2 64
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 64
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 184
		sub TEMP TEMP2
		randvar TEMP2 512
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
}
enda

useractor notenemy 11651
	ifrnd 96
	 ife ADVANCED_FLAME YES
	  ifpdistl PARTICLE_DISTANCE
		{
		espawn 14040
		seta[RETURN].pal sprite[].pal
		seta[RETURN].cstat 32768
		geta[].x TEMP
		randvar TEMP2 64
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 64
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		geta[].yrepeat TEMP2
		mulvar TEMP2 160
		sub TEMP TEMP2
		randvar TEMP2 512
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
enda

// *************************************************
// ENEMY MUZZLEFLASH
// *************************************************

defstate sprite_muzzleflash
ifaction 0
{
ifspritepal 3 break
spriteflags 2116
seta[].shade -127
seta[].blend 255
cstat 18
ifrnd 128 cstator 4 ifrnd 128 cstator 8
ifactor 16113 sizeat 5 5 else
sizeat 3 3
action ZERO
}

ifaction ZERO 
{
geta[].shade TEMP
add TEMP 64
ifg TEMP 40 killit
seta[].shade TEMP
}
ends

useractor notenemy 16113 state sprite_muzzleflash enda
useractor notenemy 16114 state sprite_muzzleflash enda
useractor notenemy 16115 state sprite_muzzleflash enda
useractor notenemy 16116 state sprite_muzzleflash enda
useractor notenemy 16117 state sprite_muzzleflash enda
useractor notenemy 16118 state sprite_muzzleflash enda
useractor notenemy 16119 state sprite_muzzleflash enda
useractor notenemy 16120 state sprite_muzzleflash enda
useractor notenemy 16121 state sprite_muzzleflash enda

// *************************************************
// BIG SMOKE
// *************************************************

action BIGSMOKE_FRAMES 0 6 1 1 30

move BIGSMOKE_UP 0 -60
move BIGSMOKE_DOWN 0 60
move BIGSMOKE_FORWARD 60 0
move BIGSMOKE_FORWARDUP 60 -60
move BIGSMOKE_FORWARDDOWN 60 60

useractor notenemy BIG_SMOKE
	ifaction 0
	{
	ifspawnedby ONFIREGUY sizeat 24 24
	ifspawnedby DISINTIGRATE_GUY sizeat 24 24
	ifrnd 128 cstat 6 else cstat 10
	ifspawnedby 14040 { seta[].blend 30 cstat 514 sizeat 24 24 }
	ifspawnedby MI_24_HIND { fall set YVELSAVED 5 sizeat 16 16 cstator 514 }
	ifspawnedby BLACK_HAWK { fall set YVELSAVED 5 sizeat 16 16 cstator 514 }
	ifspawnedby MELTA_BEAM { sizeat 16 16 cstator 514 ifpdistl 768 killit }
	ifspawnedby MDF_PLASMA { sizeat 16 16 cstator 514 }
	ifspawnedby 21594 { seta[].blend 30 spritepal 27 cstat 514 sizeat 24 24 }
	ifspawnedby 6495 { sizeat 16 16 spritepal 13 cstator 514 }
	action BIGSMOKE_FRAMES
	}

	ifaction BIGSMOKE_FRAMES
	{
	ife YVELSAVED 1 move BIGSMOKE_UP getv else
	ife YVELSAVED 2 move BIGSMOKE_DOWN getv else
	ife YVELSAVED 3 move BIGSMOKE_FORWARD geth else
	ife YVELSAVED 4 move BIGSMOKE_FORWARDUP geth getv else
	ife YVELSAVED 5 move BIGSMOKE_FORWARDDOWN geth getv
	ifactioncount 0
		{
		geta[].xrepeat TEMP5
		add TEMP5 2
		seta[].xrepeat TEMP5
		geta[].yrepeat TEMP5
		add TEMP5 2
		seta[].yrepeat TEMP5
		}
	ifactioncount 2 sizeto 255 255
	  ifactioncount 6
	    killit
	}
enda

// *************************************************
// BIG SMOKE 2
// *************************************************

action BIGSMOKE2_FRAMES 0 25 1 1 8
action BIGNUKE_FRAMES 0 25 1 1 30
action CHOPPER_SMOKE 8 17 1 1 10

move NSSLOW2 32 0

useractor notenemy BIG_SMOKE2
	ifaction 0
	{
	seta[].blend 168
	ifspawnedby RPG sizeat 32 32 else 
	ifspawnedby 3624 sizeat 32 32 else
	ifspawnedby 3586 sizeat 32 32 else
	ifspawnedby 5375 sizeat 32 32 else
	ifspawnedby 6085 sizeat 32 32 else
	sizeat 64 64
	cstat 642
	ifspawnedby 7677 action BIGNUKE_FRAMES else
	ifspawnedby NUCLEAR_EXPLOSION action BIGNUKE_FRAMES else
	ifspawnedby RESPAWN { move BIGSMOKE_FORWARD geth action CHOPPER_SMOKE } else
	ifspawnedby 18271 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby RPG { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby RPG7_ROCKET { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby 3624 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby ALUDRAN { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby 3586 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby 18134 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby 10475 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby 5375 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby ANUBIS_MUMMY { spritepal 19 move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby EXPLOSION2 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby 16616 { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby VILMOS_ROBOT { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby NUCLEAR_EXPLOSION { move BIGSMOKE_FORWARD geth randomangle action CHOPPER_SMOKE } else
	ifspawnedby MI_24_HIND action CHOPPER_SMOKE else
	ifspawnedby KA_50_BLACK_SHARK action CHOPPER_SMOKE else
	action BIGSMOKE2_FRAMES
	}

	ifspawnedby 7677 move NSSLOW2 geth
	ifspawnedby MI_24_HIND move BIGSMOKE_UP getv
	ifspawnedby KA_50_BLACK_SHARK move BIGSMOKE_UP getv
	
	ifaction CHOPPER_SMOKE
	{
	ifactioncount 1
		{
		geta[].xrepeat TEMP5
		ifl TEMP5 200 add TEMP5 6
		seta[].xrepeat TEMP5
		geta[].yrepeat TEMP5
		ifl TEMP5 200 add TEMP5 6
		seta[].yrepeat TEMP5
		}
	  ifactioncount 17
	    killit
	}
	
	ifaction BIGSMOKE2_FRAMES
	{
	ife YVELSAVED 1 move BIGSMOKE_UP getv else
	ife YVELSAVED 2 move BIGSMOKE_DOWN getv else
	ife YVELSAVED 3 move BIGSMOKE_FORWARD geth else
	ife YVELSAVED 4 move BIGSMOKE_FORWARDUP geth getv else
	ife YVELSAVED 5 move BIGSMOKE_FORWARDDOWN geth getv
	ifactioncount 1
		{
		geta[].xrepeat TEMP5
		ifl TEMP5 200 add TEMP5 6
		seta[].xrepeat TEMP5
		geta[].yrepeat TEMP5
		ifl TEMP5 200 add TEMP5 6
		seta[].yrepeat TEMP5
		}
	  ifactioncount 25
	    killit
	}
	
	ifaction BIGNUKE_FRAMES
	{
	move BIGSMOKE_FORWARD geth
	seta[].blend 255
	ifactioncount 1
		{
		geta[].xrepeat TEMP5
		ifl TEMP5 200 add TEMP5 6
		seta[].xrepeat TEMP5
		geta[].yrepeat TEMP5
		ifl TEMP5 200 add TEMP5 6
		seta[].yrepeat TEMP5
		}
	  ifactioncount 25
	    killit
	}
	
enda

// *************************************************
// BIG SMOKE3
// *************************************************

useractor notenemy 18360
	ifaction 0
	{
	ifspawnedby ONFIREGUY sizeat 24 24
	ifspawnedby DISINTIGRATE_GUY sizeat 24 24
	ifspawnedby 14040 sizeat 24 24
	ifrnd 128 cstat 6 else cstat 10
	ifspawnedby MI_24_HIND { fall set YVELSAVED 5 sizeat 16 16 cstator 514 }
	ifspawnedby BLACK_HAWK { fall set YVELSAVED 5 sizeat 16 16 cstator 514 }
	ifspawnedby MELTA_BEAM { sizeat 16 16 cstator 514 }
	ifspawnedby 6495 { sizeat 16 16 spritepal 13 cstator 514 }
	ifspawnedby PE_SENTRY { sizeat 16 16 cstator 514 set YVELSAVED 1 }
	action BIGSMOKE_FRAMES
	}

	ifaction BIGSMOKE_FRAMES
	{
	ife YVELSAVED 1 move BIGSMOKE_UP getv else
	ife YVELSAVED 2 move BIGSMOKE_DOWN getv else
	ife YVELSAVED 3 move BIGSMOKE_FORWARD geth else
	ife YVELSAVED 4 move BIGSMOKE_FORWARDUP geth getv else
	ife YVELSAVED 5 move BIGSMOKE_FORWARDDOWN geth getv
	ifactioncount 0
		{
		geta[].xrepeat TEMP5
		add TEMP5 2
		seta[].xrepeat TEMP5
		geta[].yrepeat TEMP5
		add TEMP5 2
		seta[].yrepeat TEMP5
		}
	ifactioncount 2 sizeto 255 255
	  ifactioncount 6 killit
	}
enda

// *************************************************
// DRIP
// *************************************************


useractor notenemy 5480

ifaction 0
	{
	ife sprite[].sectnum -1 killit
	geta[].cstat CSTATSAVED
	ife CSTATSAVED 0 set CSTATSAVED 514
	cstat 32768
	action ZERO
	resetcount
	}
	
ifaction ZERO
	{
	ifpdistl 16384
	 ifcount 60
	  ifrnd 48
		{
		espawn WATERDRIP
		seta[RETURN].pal sprite[].pal
		seta[RETURN].cstat CSTATSAVED
		seta[RETURN].shade sprite[].shade
		resetcount
		}
	}
	
enda

action DRIP_SPLASH 1 9 1 1 0

useractor notenemy 2379
fall
ifaction 0
	{
	ifpdistl 8192 
		{
		ifrnd 128 sound GENERIC_AMBIENCE12 else
		sound SEWER_AMBIENCE
		}
	sizeat 32 32
	cstat 514
	action DRIP_SPLASH
	}
	
ifaction DRIP_SPLASH
	{
	ifactioncount 9 killit
	}
	
enda


// *************************************************
// PARTICLE SPAWNER EFFECTOR
// *************************************************

spriteflags 3655 16

useractor notenemy 3655
ifaction 0
	{
	cstat 32768
	action ZERO
	}
ife LOTAGSAVED 0
 ifpdistl 16384
	{
	move 0
	ife HITAGSAVED 0 set HITAGSAVED 256

	set TEMP3 sprite[].x
	randvarvar TEMP4 HITAGSAVED
	add TEMP3 TEMP4
	randvar TEMP4 2048

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

	espawn GUNSMOKE

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6

	seta[RETURN].pal sprite[].pal
	}
else
ife LOTAGSAVED 1
	{
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
		else
		{
		ifrnd 2 { sound LAVABALL_THROW shoot LAVABALL }
		}
	}
else
ife LOTAGSAVED 2
 ifpdistl 16384
	{
	move 0
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
	else
		{
		ife HITAGSAVED 0 set HITAGSAVED 256

		set TEMP3 sprite[].x
		randvarvar TEMP4 HITAGSAVED
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		ifspritepal 2 espawn LAVASPLASH else espawn WFRAMES

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		seta[RETURN].pal sprite[].pal
		}
	}
else
ife LOTAGSAVED 3
	{
	move 0
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
	else
		{
		ife HITAGSAVED 0
			{
			ifrnd 4 
				{ sound SHORT_CIRCUIT shoot SPARK shoot SPARK shoot SPARK spawn 8433 }
			}
		else
		ife HITAGSAVED 1
			{
			ifrnd 16
				{ eshoot SPARK setthisprojectile[RETURN].pal sprite[].pal espawn 8433 seta[RETURN].pal sprite[].pal }
			}
		}
	}
else
ife LOTAGSAVED 4
	{
	move 0
	checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			ifrnd 16 { sound SHORT_CIRCUIT espawn 8433 shoot SPARK }
			}
	}
else
ife LOTAGSAVED 5
	{
	ife HITAGSAVED 0 set HITAGSAVED 256
	ife EXTRASAVED -1 set EXTRASAVED 8
	ife OWNERSAVED 1 fall
	
	ifspritepal 8
		{
		ifactorsound THISACTOR STEAM_HISSING nullop
		else sound STEAM_HISSING
		}
		
	ifn ZVELSAVED 0
		{
		checkactivatormotion ZVELSAVED
		ife RETURN 1 killit
		}
	
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
	else
	ifcount 6
		{

		set TEMP3 sprite[].x
		randvarvar TEMP4 HITAGSAVED
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		espawn 18360
		// espawn BIG_SMOKE2
		seta[RETURN].xrepeat EXTRASAVED
		seta[RETURN].yrepeat EXTRASAVED
		ifn YVELSAVED 0 setactorvar[RETURN].YVELSAVED YVELSAVED

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		seta[RETURN].pal sprite[].pal

		resetcount
		}
	}
else
ife LOTAGSAVED 6
 ifpdistl 16384
	{
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
	else
		{
		move 0
		ife HITAGSAVED 0 set HITAGSAVED 256

		set TEMP3 sprite[].x
		randvarvar TEMP4 HITAGSAVED
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		espawn 18574

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		seta[RETURN].pal sprite[].pal
		}
	}
else
ife LOTAGSAVED 7
	{
	move 0
	ife HITAGSAVED 0 set HITAGSAVED 256
	
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
	else
		{
		set TEMP3 sprite[].x
		randvarvar TEMP4 HITAGSAVED
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		espawn WATERBUBBLE

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		seta[RETURN].pal sprite[].pal
		}
	}
else
ife LOTAGSAVED 8 // glistening
	{
	move 0
	ife HITAGSAVED 0 set HITAGSAVED 256
	
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
	else
	 ifrnd 16
		{
		set TEMP3 sprite[].x
		randvarvar TEMP4 HITAGSAVED
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		espawn GLINT

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		updatesector TEMP5 TEMP6 TEMP8
		
		ifn TEMP8 -1 changespritesect THISACTOR TEMP8

		seta[RETURN].pal sprite[].pal
		}
	}
else
ife LOTAGSAVED 9 // spawn particles that fly inwards towards a sprite 23747
	{
	ifn HITAGSAVED 0
		{
		checkactivatormotion HITAGSAVED
		ife RETURN 1 set HITAGSAVED 0
		}
	else
	ifrnd 64
		{
		espawn 23746
		seta[RETURN].pal sprite[].pal
		set TEMP3 sprite[].x
		randvarvar TEMP4 1024
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		geta[RETURN].z TEMP2
		randvar TEMP 40000
		sub TEMP 20000
		add TEMP2 TEMP
		seta[RETURN].z TEMP2
		resetcount
		ifn XVELSAVED 0
			{
			checkactivatormotion XVELSAVED
			ife RETURN 1 killit
			}
		}
	}
else
ife LOTAGSAVED 10 // ghost ship cannon charge
	{
	ifg BIG_GUN_CHARGE 800
	 ifl BIG_GUN_CHARGE 1200
		{
		espawn 23746
		seta[RETURN].pal 21
		set TEMP3 sprite[].x
		randvarvar TEMP4 1024
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		geta[RETURN].z TEMP2
		randvar TEMP 40000
		sub TEMP 20000
		add TEMP2 TEMP
		seta[RETURN].z TEMP2
		resetcount
		}
	}
else
ife LOTAGSAVED 11
	{
	ife HITAGSAVED 0 set HITAGSAVED 256
	ife EXTRASAVED -1 set EXTRASAVED 8
	ife ZVELSAVED 1 fall
	
	ifspritepal 8
		{
		ifactorsound THISACTOR STEAM_HISSING nullop
		else sound STEAM_HISSING
		}
	
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 set XVELSAVED 0
		}
	else
	ifcount 6
		{

		set TEMP3 sprite[].x
		randvarvar TEMP4 HITAGSAVED
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		espawn BIG_SMOKE2
		seta[RETURN].xrepeat EXTRASAVED
		seta[RETURN].yrepeat EXTRASAVED
		ifn YVELSAVED 0 setactorvar[RETURN].YVELSAVED YVELSAVED

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		seta[RETURN].pal sprite[].pal

		resetcount
		}
	}
enda

move PARTICLE_FLY 60 0

spritenoshade 23746

spriteflags 23746 SFLAG_NOCLIP

useractor notenemy 23746 // flying particle

	ifaction 0
	{
	sizeat 4 4
	cstator 130
	spriteflags 10324
	seta[].shade 30
	seta[].blend 255
	action ZERO
	}
	
	ifaction ZERO
	{
	ifg sprite[].shade -127
		{
		geta[].shade TEMP2
		sub TEMP2 1
		seta[].shade TEMP2
		}
	move PARTICLE_FLY geth getv
	ifspawnedby MAEPHISTO set target myowner else
	findnearactor3d 23747 16384 target
	ife target -1 killit
	geta[target].x mx
	geta[target].y my
	geta[].x x
	geta[].y y
	sub mx x
	sub my y
	getangle ANGVAR mx my
	seta[].ang ANGVAR 
	ldist TEMP THISACTOR target
	geta[].z TEMP2
	sub TEMP2 8192 // Offset the Z. Assumes the center of the actor is the same as the player
	geta[target].z TEMP3
	
	ife target myowner sub TEMP3 10192 else
		{
		sub TEMP3 8592 // Offset the Z. assumes the center of the actor is the same as the player
		sub TEMP3 TEMP2
		}
	shiftvarl TEMP3 8
	ifn TEMP 0 divvarvar TEMP3 TEMP
	seta[].zvel TEMP3
	dist TEMP THISACTOR target
	ifl TEMP 546 { ifspritepal 21 shoot SPARK else shoot SPARK2 killit }
	}

enda

useractor notenemy 23747
cstat 32768
enda

// *************************************************
// NUKE EXPLOSION
// *************************************************

move MOVEUP 0 -30

useractor notenemy 7678

ifaction 0
{
seta[].blend 255
cstat 34
ifcount 2
	{
	geta[].xrepeat TEMP
	ifl TEMP 160
		{
		add TEMP 1
		seta[].xrepeat TEMP
		seta[].yrepeat TEMP
		}
	resetcount
	}
}

enda

defstate spawn_nuke_smokering
spawn BIG_SMOKE2
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 256 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 384 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 512 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 640 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 768 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 896 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1024 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1152 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1280 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1408 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1536 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1664 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1792 seta[RETURN].ang TEMP
espawn BIG_SMOKE2 geta[RETURN].ang TEMP add TEMP 1920 seta[RETURN].ang TEMP
ends

useractor notenemy 7677

ifaction 0
{
seta[].blend 255
cstat 2
sizeat 25 25
globalsound NUKE_EXPLODE
state spawn_nuke_smokering
action ZERO
}

ifaction ZERO
{
ifcount 6
	{
	geta[].xrepeat TEMP
	ifl TEMP 160
		{
		ife TEMP 50 state spawn_nuke_smokering
		ife TEMP 80 state spawn_nuke_smokering
		ife TEMP 100 state spawn_nuke_smokering
		add TEMP 2
		seta[].xrepeat TEMP
		}
	geta[].yrepeat TEMP
	ifl TEMP 110
		{
		add TEMP 1
		seta[].yrepeat TEMP
		}
	resetcount
	}
setp[].visibility 0
}

enda

// *************************************************
// THAT LENS FLARE EVERYBODY LOVES SO MUCH
// *************************************************

defstate oldflare
ifaction 0
	{
	seta[].blend 255
	ife HITAGSAVED 1 spriteflags 68
	action ZERO
	}
ends


useractor notenemy 1632
state oldflare
enda

useractor notenemy 1633
state oldflare
enda

useractor notenemy 1634
state oldflare
enda


// *************************************************
// CIVILIAN JETPACK
// *************************************************

defstate SPAWNJETCIV
sleeptime 0
ifrnd 64
{
ifspritepal 4 espawn 6249
else
	{
	ifrnd 96 espawn JETPACKCIV2 
	else ifrnd 96 espawn JETPACKCIV3
	else espawn JETPACKCIV1
	}

ife LOTAGSAVED 1 resetcount
else
	{
	set TEMP3 sprite[].x
	randvar TEMP8 512
	add TEMP3 TEMP8

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6


	geta[RETURN].z TEMP2
	randvar TEMP 20000
	sub TEMP 10000
	add TEMP2 TEMP
	seta[RETURN].z TEMP2
	resetcount
	}
}
ends



useractor notenemy JETPACKCIVSPAWNER
cstat 32768

ifspritepal 0 
{
ifcount 52 state SPAWNJETCIV
}
else
ifspritepal 1
{
ifcount 26 state SPAWNJETCIV
}
else
ifspritepal 2
{
ifcount 13 state SPAWNJETCIV
}
else
ifspritepal 4
{
ifaction 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 action ZERO
	}
ifaction ZERO 
  {
	ifcount 8 state SPAWNJETCIV
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 killit
  }
}


enda

move JETCGLIDE 140

defstate JETPACKCIV
state lowperf

ifaction ACAR
{
move JETCGLIDE geth
ifnotmoving killit
}

ifaction 0
{
sizeat 40 40
ifrnd 16 seta[].pal 10 else
ifrnd 32 seta[].pal 11 else
ifrnd 48 seta[].pal 12 else
ifrnd 64 seta[].pal 13 else
ifrnd 80 seta[].pal 14 else
ifrnd 96 seta[].pal 15 else
ifrnd 112 seta[].pal 16 else
ifrnd 128 seta[].pal 18 else
ifrnd 144 seta[].pal 21 else
ifrnd 160 seta[].pal 22 else
ifrnd 176 seta[].pal 23 else
ifrnd 192 seta[].pal 5
action ACAR
}
ends

useractor notenemy JETPACKCIV1 state JETPACKCIV enda
useractor notenemy JETPACKCIV2 state JETPACKCIV enda
useractor notenemy JETPACKCIV3 state JETPACKCIV enda

// *************************************************
// GHOSTS ORB
// *************************************************

spritenoshade 6249

useractor notenemy 6249
state lowperf

ifaction 0
{
cstat 642
seta[].shade -127
sizeat 2 2
spawn FRAMEEFFECT1
move JETCGLIDE geth
ifnotmoving killit
}

enda

// *************************************************
// RAIN/SNOW - RAIN CODE BY DEEPERTHOUGHT FROM DUKE PLUS
// *************************************************

define RAINSPRITE 2287

spriteflags RAINSPRITE SFLAG_NOCLIP SFLAG_NOEVENTS SFLAG_SMOOTHMOVE

spritenopal RAINSPRITE

action RAINFRAME -1627 1 1 1 1
action RAINFRAME2 -2 1 1 1 1

action GSNOWFRAME1 312 1 1 1 1
action GSNOWFRAME2 313 1 1 1 1
action GSNOWFRAME3 314 1 1 1 1
action GSNOWFRAME4 315 1 1 1 1

action FIRE_SPARKLE -44 1 1 1 1

action RAINSPLASH 93 9 1 1 3
move SNOWFALL 20 96

move FIRESPARKLEFLY 96 10

useractor notenemy RAINSPRITE 0
ife PERFMODE 0 killit
ifg raining 0 fall 
ifoutside nullop else killit
ife NUKE_ACTIVE 1 killit

ifaction 0
{
seta[].pal rainpal
ifn ceiltext -1
	{
	ifvarvarn sector[].ceilingpicnum ceiltext killit
	}
	ifg raining 0
	{
	ifspritepal 3
		{
		seta[].pal 128
		action RAINFRAME2
		sizeat 64 128
		cstat 514
		ifrnd 128 cstator 4
		ifrnd 128 cstator 8
		}
		else
		{
		ifand raincstat 512 cstator 514 else
		ifand raincstat 2 cstator 2
		action RAINFRAME
		sizeat 10 15
		}
	}
	else
	{
		geta[].z z
			ife TIMEZONE 3
			{
			cstator 2
			seta[].shade -127
			seta[].blend 255
			action FIRE_SPARKLE
			}
			else
			{
			ifrnd 64 action GSNOWFRAME1
			else ifrnd 128 action GSNOWFRAME2
			else ifrnd 192 action GSNOWFRAME3
			else action GSNOWFRAME4
			}
		ifrnd 128 cstator 4
		ifrnd 128 cstator 8
		ifaction FIRE_SPARKLE move FIRESPARKLEFLY geth getv randomangle else
		move SNOWFALL geth randomangle
		randvar x 3
		randvar y 3
		ifaction FIRE_SPARKLE nullop
		else
			{
			add x 4
			add y 4
			}
		seta[].xrepeat x
		seta[].yrepeat y
		add x y // between 6 and 12
		set mtype 1040
		mulvar x 32
		sub mtype x
	}

}
else
ifaction RAINFRAME
{
	ifl raining 1 killit

	iffloordistl 2 {  ifcansee spawn 13762 action RAINSPLASH } else
	ifnotmoving { action RAINSPLASH }
} 
else
ifaction RAINFRAME2
{
	ifl raining 1 killit
	iffloordistl 2 killit else
	ifnotmoving killit
} 
else
ifaction RAINSPLASH 
{
	ifactioncount 9 killit
}
else
{
	geta[].z z
	add z mtype //768
	updatesectorz sprite[].x sprite[].y z mysector
	ife mysector -1 killit else
	{
		seta[].z z
		changespritesect THISACTOR mysector
	}
	ifpdistg 16384 killit

}

enda


defstate raincode

set INTERNALCOUNT 0
set INTERNALCOUNT_2 raining
ifmultiplayer nullop else
ifg INTERNALCOUNT_2 framerate set INTERNALCOUNT_2 framerate
ifl INTERNALCOUNT_2 0 mulvar INTERNALCOUNT_2 -1
ifg INTERNALCOUNT_2 64 set INTERNALCOUNT_2 64
whilevarvarn INTERNALCOUNT INTERNALCOUNT_2
{
	add INTERNALCOUNT 1
	set xydist player[].posx
	randvarvar TEMP rainradius // the random component of the distance from player
	add TEMP 512
	add xydist TEMP
	randvar ANGVAR 2047
	
	rotatepoint player[].posx player[].posy xydist player[].posy ANGVAR TEMP2 y
	// TEMP2 and y are the new x and y coords
	updatesector TEMP2 y mysector
	ifn mysector -1
	{
		ifand sector[mysector].ceilingstat 1
		{
			getceilzofslope mysector TEMP2 y z // z is the return var
			ifl raining 0 // don't put snow too high up
			{
				getp[].posz TEMP
				set TEMP3 TEMP // save posz in TEMP3
				sub TEMP z // positive value is distance above player to ceiling
				ifg TEMP snowceiling 
				{
					sub TEMP3 snowceiling 
					set z TEMP3 
				}
			}
			updatesectorz TEMP2 y z mysector
			ifn mysector -1
			{
			ifn HITAGSAVED 0
			ifn ceiltext -1
				{
				ifvarvarn sector[mysector].ceilingpicnum ceiltext nullop else
					{
					espawn RAINSPRITE
					seta[RETURN].x TEMP2
					seta[RETURN].y y
					seta[RETURN].z z
					seta[RETURN].sectnum mysector
					}
				}
				else
				ife HITAGSAVED 0 
					{
					espawn RAINSPRITE
					seta[RETURN].x TEMP2
					seta[RETURN].y y
					seta[RETURN].z z
					seta[RETURN].sectnum mysector
					}				
			}
		}
	}
}
ends



useractor notenemy RAINSNOWEFFECT

ifaction 0 
	{ 
	gets[].ceilingpicnum ceiltext  
	action ZERO
	}

ifn raining 0 state raincode
enda

useractor notenemy RAINSNOWSOUND
cstat 32768

ifg raining 0
	{
	ifspritepal 1 soundonce RAIN_HIT_DIRT
	else ifspritepal 2 soundonce RAIN_HIT_METAL
	else ifspritepal 3 soundonce RAIN_HIT_WINDOW
	else { ifoutside soundonce RAIN else soundonce RAININ }
	}

enda

useractor notenemy RAINSNOWSTARTER
cstat 32768

ifpdistl 2048
	{
	ifspritepal 0
		{
		set rainradius 12000
		ife XVELSAVED 0 set raining 16 else set raining XVELSAVED
		geta[].cstat raincstat
		geta[].pal rainpal
		ifn YVELSAVED 0
		{
		set TEMP 0
		whilevarvarn TEMP NUMSECTORS
			{
	  		ifand sector[TEMP].ceilingstat 1
	  			{
				switch sector[TEMP].floorpicnum
	    			case 755 sets[TEMP].floorpicnum 4846 break
	    			case 772 sets[TEMP].floorpicnum 5068 break
	    			case 780 sets[TEMP].floorpicnum 4849 break
	    			case 782 sets[TEMP].floorpicnum 5065 break
	    			case 790 sets[TEMP].floorpicnum 5823 break
					case 805 sets[TEMP].floorpicnum 9142 break 
	    			case 814 sets[TEMP].floorpicnum 4858 break	
	    			case 815 sets[TEMP].floorpicnum 4861 break
					case 823 sets[TEMP].floorpicnum 4840 break
	    			case 4151 sets[TEMP].floorpicnum 4855 break
					case 4276 sets[TEMP].floorpicnum 4843 break
	    			case 442 sets[TEMP].floorpicnum 4852 break
					case 9578 sets[TEMP].floorpicnum 10990 break
				endswitch
					ifand sector[TEMP].ceilingstat 1 
						{
						ife sector[TEMP].ceilingpicnum LOTAGSAVED sets[TEMP].ceilingpicnum HITAGSAVED
						sets[TEMP].visibility 0
						}
	  			}
	  		add TEMP 1
			}
		}
	}
	else
	ifspritepal 1 // Stop rain
		{
		set rainstart 0
		set raining 0
		set rainradius 0
		set RAINREPLACE -1
		stopsound RAIN 
		stopsound RAININ
		
			ifn YVELSAVED 0
			{
			set TEMP 0
			set TEMP3 0
			whilevarvarn TEMP NUMSECTORS
				{
				ifand sector[TEMP].ceilingstat 1
					{
					switch sector[TEMP].floorpicnum
						case 4846 sets[TEMP].floorpicnum 755 break
						case 5068 sets[TEMP].floorpicnum 772 break
						case 4849 sets[TEMP].floorpicnum 780 break
						case 5065 sets[TEMP].floorpicnum 782 break
						case 5823 sets[TEMP].floorpicnum 790 break
						case 9142 sets[TEMP].floorpicnum 805 break
						case 4858 sets[TEMP].floorpicnum 814 break	
						case 4861 sets[TEMP].floorpicnum 815 break
						case 4840 sets[TEMP].floorpicnum 823 break
						case 4855 sets[TEMP].floorpicnum 4151 break
						case 4843 sets[TEMP].floorpicnum 4276 break
						case 4852 sets[TEMP].floorpicnum 442 break
						case 10990 sets[TEMP].floorpicnum 9578 break
					endswitch
					}
					
						/*
						gets[TEMP].floorshade TEMP2
						sub TEMP2 10
						sets[TEMP].floorshade TEMP2
						gets[TEMP].ceilingshade TEMP2
						sub TEMP2 10
						sets[TEMP].ceilingshade TEMP2
						*/
					
				add TEMP 1
				}
				/*
				whilevarvarn TEMP3 NUMWALLS
					{
					getwall[TEMP3].shade TEMP4
					sub TEMP4 10
					setwall[TEMP3].shade TEMP4
					add TEMP3 1
					}
				*/
			}
		}
	killit
	}


enda

useractor notenemy 17057
ifaction 0
	{
	cstat 32768
	ifg raining 0 { action MINUSONE seta[].cstat CSTATSAVED }
	}
enda

// *************************************************
// BROWN STAIN - COFFEE, BEER....Maybe something else less wholesome
// *************************************************

useractor notenemy BROWNSTAIN
fall

ifaction 0
{
ifspawnedby POT1 { cstat 34 sizeto 24 24 spritepal 8 } else
ifspawnedby POT2 { cstat 34 sizeto 24 24 spritepal 2 } else
ifspawnedby COFFEEMUG { cstat 34 sizeto 12 12 } else
ifspawnedby COFFEEMACHINE { cstat 34 sizeto 32 32 } else
ifspawnedby COFFEEMACHINE2 { cstat 34 sizeto 24 24 } else
ifspawnedby COFFEEMACHINE3 { cstat 34 sizeto 12 12 } else
ifspawnedby FECES { cstat 32 sizeto 24 24 } else
ifspawnedby MOP { spritepal 27 cstat 34 sizeto 32 32 } else
{ cstat 34 sizeto 32 32 }
seta[].shade sector[].floorshade

ifpdistl 1024
 ifp palive
	{
	ifp pshrunk break
  	setp[].footprintcount 4
	ifspritepal 0 set TEMP 19 else set TEMP sprite[].pal
	setp[].footprintpal TEMP
	}

}

enda

// *************************************************
// DEBRIS SPAWNER
// *************************************************


defstate debris_stuff

	ifspritepal 2
		{
		sound BUST_CONCRETE
		spawn BIG_SMOKE2
		spawn BIG_SMOKE2
		}
	ifspritepal 3
		{
		spawn BIG_SMOKE2
		spawn BIG_SMOKE2
		}

	ife LOTAGSAVED 1 // WOOD
		{
		sound WOODBREAK
		shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
		shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
		killit
		}
	else
	ife LOTAGSAVED 2 // STONE
		{
		shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
		shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
		shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
		shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
		killit
		}
	else
	ife LOTAGSAVED 3 // ROCK DEBRIS 3
		{
		shoot ROCKDEB3 shoot ROCKDEB3 shoot ROCKDEB3
		shoot ROCKDEB3 shoot ROCKDEB3 shoot ROCKDEB3
		shoot ROCKDEB3 shoot ROCKDEB3 shoot ROCKDEB3
		shoot ROCKDEB3 shoot ROCKDEB3 shoot ROCKDEB3
		killit
		}
	else
	ife LOTAGSAVED 4 // ROCK DEBRIS 4
		{
		shoot ROCKDEB4 shoot ROCKDEB4 shoot ROCKDEB4
		shoot ROCKDEB4 shoot ROCKDEB4 shoot ROCKDEB4
		shoot ROCKDEB4 shoot ROCKDEB4 shoot ROCKDEB4
		shoot ROCKDEB4 shoot ROCKDEB4 shoot ROCKDEB4
		killit
		}
	else
	ife LOTAGSAVED 5 // scrap debris
		{
		sound VENT_BUST
		sound BUST_METAL
		debris SCRAP1 40 
		debris SCRAP2 32
		debris SCRAP3 32
		debris SCRAP4 32
		debris SCRAP5 32
		killit
		}
	else
	ife LOTAGSAVED 6 // heavy scrap debris
		{
		sound BUST_METAL
		quake 26
		ifrnd 128 globalsound STRUCT_DAMAGE1
		else globalsound STRUCT_DAMAGE2
		debris SCRAP1 40 
		debris SCRAP2 32
		debris SCRAP3 32
		debris SCRAP4 32
		debris SCRAP5 32
		killit
		}
	else
	ife LOTAGSAVED 7 // WOOD
		{
		globalsound WOOD_DEBRIS
		quake 26
		sound WOODBREAK
		shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
		shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
		shoot SWOODSCRAP shoot SWOODSCRAP shoot SWOODSCRAP
		shoot SWOODSCRAP shoot SWOODSCRAP shoot SWOODSCRAP
		killit
		}
ends

useractor notenemy 3624
cstat 256

ifaction 0 action ONE
strength 1

ifn XVELSAVED 0
 {
 ife destruct_trigger XVELSAVED state debris_stuff
 }
ifhitweapon
 ifwasweapon RADIUSEXPLOSION
	{
	ifn XVELSAVED 0 set destruct_trigger XVELSAVED
	ifn HITAGSAVED 0 operaterespawns HITAGSAVED
	state debris_stuff
	}
	

enda

// *************************************************
// WOOD PLANK SNAP
// *************************************************

useractor notenemy 8055
ifaction 0 
{
ifn HITAGSAVED 0 action ZERO
else 
	{
	ifand sprite[].cstat 32 // if it's a flat sprite
		{
		ifrnd 128 cstator 4
		ifrnd 128
			{
			geta[].ang TEMP
			sub TEMP 1024
			seta[].ang TEMP
			}
		}
	action FORMED
	}
}

ifaction ZERO
{
sleeptime 0
ifpdistl 1024 soundonce WOOD_STRAIN
checkactivatormotion HITAGSAVED
ife RETURN 1 action FORM
}

ifaction FORM
{
sleeptime 0
ifpdistl 1024
	{
	sound WOOD_SNAP
	shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
	killit
	}
}

enda

// *************************************************
// DOOR TRANSPORT
// *************************************************

useractor notenemy DOORTRANSPORTEXIT cstat 32768 enda

useractor notenemy DOORTRANSPORT
cstat 32768

ifmultiplayer set YVELSAVED 13
 ife YVELSAVED 0 set YVELSAVED 26

ifaction 0
{
set TEMP 0
whilevarn TEMP 16384
{
  ifn sprite[TEMP].statnum 1024
  {
    ife sprite[TEMP].picnum DOORTRANSPORTEXIT
    {
     getactorvar[TEMP].HITAGSAVED TEMP3
     ife LOTAGSAVED TEMP3 
		{  
		geta[TEMP].x ENDPOINTX
		geta[TEMP].y ENDPOINTY
		geta[TEMP].z ENDPOINTZ
		geta[TEMP].ang TEMP7
		set TEMP 16383
		}
    }
  }
  add TEMP 1
}
ifn HITAGSAVED 0 action FORM else
action ZERO
}

ifaction FORM
ifn HITAGSAVED 0
{
sleeptime 0

		ifpdistl 1524
		ifcansee
		 ifp pfacing
		  ifp palive
		   ifn sprite[].pal 8 // if NOT the ship
		  {
		  ifspritepal 5 set player_door -10 else 
		  ifspritepal 7 set player_door -10 else 
		  set player_door 0
		 
			ifcount 13
			   ifhitspace
				{
				set hit_key 30
				set INTERNALCOUNT 0
				ifn HITAGSAVED 0 
					{ 
					set door_locked 0 
					set key_icon 3587
					ifspritepal 10
						{
						quote 8599
						soundonce OLDKEY_LOCKED
						}
					}
				}
			}

checkactivatormotion HITAGSAVED
ife RETURN 1 { set HITAGSAVED 0 action ZERO }
}

ifspritepal 11
{
ifpdistl 768
 ifcansee
  ifp pfacing
   ifp palive
	ifaction ZERO
		  {
		lockplayer 60
		set INTERNALCOUNT 0
		action OK
		  }
}
else
	{
		ifpdistl 1524
		ifcansee
		 ifp pfacing
		  ifp palive
		   ifaction ZERO
		  {
		  ifspritepal 5 set player_door -10 else 
		  ifspritepal 7 set player_door -10 else 
		  ifspritepal 8 set player_ship 0 else
		  ifspritepal 18 set player_unlock 0 else
		  set player_door 0
		 
		ifcount 13
		   ifhitspace
			{
			set hit_key 30
			set INTERNALCOUNT 0
			ifn HITAGSAVED 0 
				{ 
				set door_locked 0 
				set key_icon 3587
				ifspritepal 10
					{
					quote 8599
					soundonce OLDKEY_LOCKED
					}
				}
			else
				{
				action OK
				ifspritepal 5
				{
				set END_LEVEL 60
				}
				else
				ifspritepal 4
				 ifn OWNERSAVED -1
					{
					operateactivators OWNERSAVED THISACTOR
					operatemasterswitches OWNERSAVED
					operaterespawns OWNERSAVED
					}
				else
				ifspritepal 18
				 ifn OWNERSAVED -1
					{
					operateactivators OWNERSAVED THISACTOR
					operatemasterswitches OWNERSAVED
					operaterespawns OWNERSAVED
					quote 8600
					globalsound OLDKEY_UNLOCK
					screensound OLDKEY_UNLOCK
					spritepal 0
					}
				ifn XVELSAVED 0 globalsoundvar XVELSAVED
				resetcount
				}
			}
		  }
	}
  
ifaction BREAK
{
add INTERNALCOUNT 1
ifg INTERNALCOUNT 30 { set PLAYER_PROTECTED 0 action ZERO } 
}

ifaction OK
	{
	add INTERNALCOUNT 1
	set PLAYER_PROTECTED 1

	ifspritepal 6
	{
		ife INTERNALCOUNT 2 palfrom 6 64 64 64
		else ife INTERNALCOUNT 4  palfrom 12 64 64 64
		else ife INTERNALCOUNT 6 palfrom 18 64 64 64
		else ife INTERNALCOUNT 8 palfrom 24 64 64 64
		else ife INTERNALCOUNT 10 palfrom 30 64 64 64
		else ife INTERNALCOUNT 12 palfrom 36 64 64 64
		else ife INTERNALCOUNT 14 palfrom 42 64 64 64
		else ife INTERNALCOUNT 16 palfrom 48 64 64 64
		else ife INTERNALCOUNT 18 palfrom 54 64 64 64
		else ife INTERNALCOUNT 20 palfrom 60 64 64 64
		else ifg INTERNALCOUNT 22 palfrom 64 64 64 64
	}
	else
	ifspritepal 7
	{
		ife INTERNALCOUNT 2 palfrom 6 64 64 64
		else ife INTERNALCOUNT 4  palfrom 12 64 64 64
		else ife INTERNALCOUNT 6 palfrom 18 64 64 64
		else ife INTERNALCOUNT 8 palfrom 24 64 64 64
		else ife INTERNALCOUNT 10 palfrom 30 64 64 64
		else ife INTERNALCOUNT 12 palfrom 36 64 64 64
		else ife INTERNALCOUNT 14 palfrom 42 64 64 64
		else ife INTERNALCOUNT 16 palfrom 48 64 64 64
		else ife INTERNALCOUNT 18 palfrom 54 64 64 64
		else ife INTERNALCOUNT 20 palfrom 60 64 64 64
		else ifg INTERNALCOUNT 22 palfrom 64 64 64 64
	}
	else
	ifspritepal 5
	nullop
	else
	{
		ife INTERNALCOUNT 2 palfrom 6 0 0 0
		else ife INTERNALCOUNT 4  palfrom 12 0 0 0
		else ife INTERNALCOUNT 6 palfrom 18 0 0 0
		else ife INTERNALCOUNT 8 palfrom 24 0 0 0
		else ife INTERNALCOUNT 10 palfrom 30 0 0 0
		else ife INTERNALCOUNT 12 palfrom 36 0 0 0
		else ife INTERNALCOUNT 14 palfrom 42 0 0 0
		else ife INTERNALCOUNT 16 palfrom 48 0 0 0
		else ife INTERNALCOUNT 18 palfrom 54 0 0 0
		else ife INTERNALCOUNT 20 palfrom 60 0 0 0
		else ifg INTERNALCOUNT 22 palfrom 64 0 0 0
	}
		
		
	updatesectorz ENDPOINTX ENDPOINTY ENDPOINTZ TEMP8
	 ifn TEMP8 -1
	  ifg INTERNALCOUNT YVELSAVED
		{
		ifspritepal 4
		 ifn OWNERSAVED -1
			{
			operateactivators OWNERSAVED THISACTOR
			operatemasterswitches OWNERSAVED
			operaterespawns OWNERSAVED
			}
		ifspritepal 15 set screen_pal 11
		ifspritepal 16 set screen_pal 10
		ifn ZVELSAVED 0 globalsoundvar ZVELSAVED 
		setp[].cursectnum TEMP8
		setp[].posx ENDPOINTX
		setp[].posy ENDPOINTY
		setp[].posz ENDPOINTZ
		setp[].ang TEMP7
		set INTERNALCOUNT 0
		ifn ALLYSLOT1 -1
			{
			getactorvar[ALLYSLOT1].FOLLOW_PLAYER TEMP6
			ife TEMP6 0 nullop else
				{
				set TEMP3 ENDPOINTX
				add TEMP3 256
				randvar TEMP4 1024
				rotatepoint ENDPOINTX ENDPOINTY TEMP3 ENDPOINTY TEMP4 TEMP5 TEMP6
				updatesector TEMP5 TEMP6 TEMP2
				ifn TEMP2 -1
					{
					seta[ALLYSLOT1].x TEMP5 
					seta[ALLYSLOT1].y TEMP6
					seta[ALLYSLOT1].z ENDPOINTZ
					changespritesect ALLYSLOT1 TEMP2
					}
				}
			}
		ifn ALLYSLOT2 -1
			{
			getactorvar[ALLYSLOT2].FOLLOW_PLAYER TEMP6
			ife TEMP6 0 nullop else
				{
				set TEMP3 ENDPOINTX
				add TEMP3 256
				randvar TEMP4 1024
				rotatepoint ENDPOINTX ENDPOINTY TEMP3 ENDPOINTY TEMP4 TEMP5 TEMP6
				updatesector TEMP5 TEMP6 TEMP2
				ifn TEMP2 -1
					{
					seta[ALLYSLOT2].x TEMP5 
					seta[ALLYSLOT2].y TEMP6
					seta[ALLYSLOT2].z ENDPOINTZ
					changespritesect ALLYSLOT2 TEMP2
					}
				}	
			}
		ifn ALLYSLOT3 -1
			{
			getactorvar[ALLYSLOT3].FOLLOW_PLAYER TEMP6
			ife TEMP6 0 nullop else
				{
				set TEMP3 ENDPOINTX
				add TEMP3 256
				randvar TEMP4 1024
				rotatepoint ENDPOINTX ENDPOINTY TEMP3 ENDPOINTY TEMP4 TEMP5 TEMP6
				updatesector TEMP5 TEMP6 TEMP2
				ifn TEMP2 -1
					{
					seta[ALLYSLOT3].x TEMP5 
					seta[ALLYSLOT3].y TEMP6
					seta[ALLYSLOT3].z ENDPOINTZ
					changespritesect ALLYSLOT3 TEMP2
					}
				}
			}
		ifn ALLYSLOT4 -1
			{
			getactorvar[ALLYSLOT4].FOLLOW_PLAYER TEMP6
			ife TEMP6 0 nullop else
				{
				set TEMP3 ENDPOINTX
				add TEMP3 256
				randvar TEMP4 1024
				rotatepoint ENDPOINTX ENDPOINTY TEMP3 ENDPOINTY TEMP4 TEMP5 TEMP6
				updatesector TEMP5 TEMP6 TEMP2
				ifn TEMP2 -1
					{
					seta[ALLYSLOT4].x TEMP5 
					seta[ALLYSLOT4].y TEMP6
					seta[ALLYSLOT4].z ENDPOINTZ
					changespritesect ALLYSLOT4 TEMP2
					}
				}
			}
		ifspritepal 20 killit
		action BREAK
		}
	else
	 ife TEMP8 -1
		{
		addlogvar ENDPOINTX
		addlogvar ENDPOINTY
		addlogvar ENDPOINTZ
		addlogvar TEMP8
		quote 513
		killit
		}
	}

enda


// *************************************************
// LANTERN
// *************************************************

useractor notenemy 4081 
ifspritepal 0 fall
cstator 257

ifaction 0 action ZERO

ifaction ZERO 
	{
	cstat 257
	}


ifpdistl 1024
 ifp pfacing
  ifp palive
   ifspritepal 0
    ifaction ZERO
  {
  set player_use 0
   ifhitspace
    ifcount 13
	{
	set hit_key 30
	action OK
	resetcount
	}
  }

ifaction OK
	{
	cstat 256

	set TEMP3 player[].posx
	add TEMP3 256

	getp[].ang TEMP4

	rotatepoint player[].posx player[].posy TEMP3 player[].posy TEMP4 TEMP5 TEMP6

	updatesector TEMP5 TEMP6 TEMP7
	ife TEMP7 -1 action ZERO else
	{
	seta[].x TEMP5 
	seta[].y TEMP6
	}
	getp[].posz TEMP
	add TEMP 5600
	seta[].z TEMP
	setp[].weapon_pos 10

	ifhitspace
	 ifcount 13
		{
		action ZERO
		resetcount
		}

	}

getp[].cursectnum TEMP
getp[].oposx TEMP2
getp[].oposy TEMP3
getp[].oposz TEMP4
updatesectorz TEMP2 TEMP3 TEMP4 TEMP5
ifaction OK 
{
ifvarvarn TEMP TEMP5
{
gets[TEMP].visibility TEMP6
sets[TEMP].visibility 0
sets[TEMP5].visibility TEMP6
}
}

enda

// *************************************************
// BULLETHOLES
// *************************************************

useractor notenemy 3778 // Wood
ifaction 0
{
cstat 144
randvar TEMP 6
ifl TEMP 2 set TEMP 2
seta[].xrepeat TEMP
seta[].yrepeat TEMP
action ZERO
}
enda

useractor notenemy 3780 // Stone
ifaction 0
{
cstat 144
randvar TEMP 3
ifl TEMP 1 set TEMP 1
seta[].xrepeat TEMP
seta[].yrepeat TEMP
action ZERO
}
enda

// *************************************************
// BLOODPOOLS
// *************************************************

defstate CUSTOMBLOODPOOLS

ifspritepal 3 nullop else
{
fall
state lowperf

ifaction 0 
	{ 
	cstat 32 
	action ZERO 
	ifand sector[].floorstat 2 killit
	ife sector[].lotag 1 killit
	}

ifaction ZERO
	{
	sizeto 32 32
	ifg sector[].floorpal 25 seta[].pal sector[].floorpal
	ifpdistl 1024
	 ifp palive
		{
		ifp pshrunk break
		setp[].footprintcount 4
		ifactor 4679 set TEMP 8 else set TEMP 2
		setp[].footprintpal TEMP
		}
	}
}

ends

useractor notenemy 7990 state CUSTOMBLOODPOOLS enda
useractor notenemy 7991 state CUSTOMBLOODPOOLS enda
useractor notenemy 16368 state CUSTOMBLOODPOOLS enda
useractor notenemy 4679 seta[].shade -127 state CUSTOMBLOODPOOLS enda

// *************************************************
// WELCOME MAT
// *************************************************

useractor notenemy 7997

ifaction 0
{
ifand sprite[].cstat 32 action OK else action ZERO
}

ifaction OK
{
ifpdistl 812
	{
	ifg player[].footprintcount 0
       ife player[].footprintpal 2
		{
		action ONE
		setp[].footprintcount 0
		setp[].footprintpal 0
		}
	}
}



enda

// *************************************************
// OLD KEYS
// *************************************************



// 1 = Flame Key
// 2 = Spider Key
// 4 = Dagger Key
// 8 = Moon key
// 16 = Skull key
// 32 = Eye Key

useractor notenemy OLDLOCK 
ifaction 0 action LOCKED

ifvarvarand HITAGSAVED OLDKEYS { ifrnd 4 spawn GLINT }

ifpdistl 1024 ifhitspace ifaction LOCKED 
{
	ife HITAGSAVED 0 // Generic Key
		{
		ifg GENERIC_KEYS 0 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon GENERICKEY }
		}
else
	ifand HITAGSAVED 1 // Flame Key
		{
		ifand OLDKEYS 1 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon FLAMEKEY }
		}
else
	ifand HITAGSAVED 2 // Spider Key
		{
		ifand OLDKEYS 2 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SPIDERKEY }
		}
else
	ifand HITAGSAVED 4 // Dagger Key
		{
		ifand OLDKEYS 4 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon DAGGERKEY }
		}
else
	ifand HITAGSAVED 8 // Moon Key
		{
		ifand OLDKEYS 8 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon MOONKEY }
		}
else
	ifand HITAGSAVED 16 // Skull key
		{
		ifand OLDKEYS 16 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SKULLKEY }
		}
else
	ifand HITAGSAVED 32 // Eye key
		{
		ifand OLDKEYS 32 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon EYEKEY }
		}
else
	ifand HITAGSAVED 64 // Normal key 1
		{
		ifand NORMAL_KEYS 1 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY1 }
		}
else
	ifand HITAGSAVED 128 // Normal key 2
		{
		ifand NORMAL_KEYS 2 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY2 }
		}
else
	ifand HITAGSAVED 256 // Normal key 3
		{
		ifand NORMAL_KEYS 4 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY3 }
		}
else
	ifand HITAGSAVED 512 // Normal key 4
		{
		ifand NORMAL_KEYS 8 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY4 }
		}
else
	ifand HITAGSAVED 1024 // Normal key 5
		{
		ifand NORMAL_KEYS 16 action UNLOCKING else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY5 }
		}
}

ifaction UNLOCKING
{
globalsound OLDKEY_UNLOCK
operateactivators LOTAGSAVED THISACTOR
operaterespawns LOTAGSAVED
operatemasterswitches LOTAGSAVED
action UNLOCKED
ife HITAGSAVED 0 sub GENERIC_KEYS 1 else
ifand HITAGSAVED 1 xorvar OLDKEYS 1 else
ifand HITAGSAVED 2 xorvar OLDKEYS 2 else
ifand HITAGSAVED 4 xorvar OLDKEYS 4 else
ifand HITAGSAVED 8 xorvar OLDKEYS 8 else
ifand HITAGSAVED 16 xorvar OLDKEYS 16 else
ifand HITAGSAVED 32 xorvar OLDKEYS 32 else
ifand HITAGSAVED 64 xorvar NORMAL_KEYS 1 else
ifand HITAGSAVED 128 xorvar NORMAL_KEYS 2 else
ifand HITAGSAVED 256 xorvar NORMAL_KEYS 4 else
ifand HITAGSAVED 512 xorvar NORMAL_KEYS 8 else
ifand HITAGSAVED 1024 xorvar NORMAL_KEYS 16
}
enda


// *************************************************
// RANDOM TREE/ROCK CODE
// *************************************************

useractor notenemy 5676 fall enda

useractor notenemy TREESPAWNER
cstat 32768

ifrnd 32
{
espawn 7944
ifn LOTAGSAVED 0 setactorvar[RETURN].LOTAGSAVED LOTAGSAVED

	set TEMP3 sprite[].x
	randvar TEMP8 1536
	add TEMP3 TEMP8
	
	randvar TEMP4 2048

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6
	seta[RETURN].ang sprite[].ang
	resetcount
}

enda

move TREESPEEDUP 256

action TREE_DEAD

defstate TREE_FIRE_STUFF
ifg FIRE_DAMAGE 0
	{
	ifrnd 190
	 ifg framerate 15
		{
		espawn 14040
		geta[].x TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		sub TEMP 8096
		randvar TEMP2 4096
		ifrnd 128 add TEMP TEMP2
		else sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
	addstrength -1
	ifdead { ifaction TREE_DEAD nullop else { sound ENGULF_FIRE action TREE_DEAD } }
	sub FIRE_DAMAGE 1
	soundonce FLESH_BURNING
	}
ends

move TREE_SLOW 48

defstate RANDOMTREE

ife TIMEZONE 5
{
sleeptime 0
ife global_trigger 6363 killit
}

ifspawnedby 8939
	{
	fall
	ife LOTAGSAVED 3 move TREE_SLOW geth
	else move TREESPEEDUP geth
	ifnotmoving killit
	}

ifaction 0
{
strength 300
 ifspritepal 4 break
 ifand sector[].ceilingstat 8192 nullop else spawn 5381 // spawn targetting sprite
 ifspritepal 3 nullop
 else
	 {
	  ifrnd 128
		cstat 5
	  else
		cstat 1
	randvar GTEMP 64
	ifactor 23543 add GTEMP 128 else
	add GTEMP 32
	seta[].xrepeat GTEMP
	seta[].yrepeat GTEMP
	}
action ZERO
}

ifaction ZERO
	{
	setactor[].pal sector[].floorpal
	state GREEN_BOOK_ARTIFACT
	ifhitweapon
		{
		ifwasweapon RADIUSEXPLOSION
			{
			set FIRE_DAMAGE 96
			}
		else
		ifwasweapon ATOM_BOMB
			{
			set FIRE_DAMAGE 96
			}
		else
		ifwasweapon RPG
			{
			set FIRE_DAMAGE 96
			}
		}
		
ifpdistl 3072
ife player_in_vehicle 1
	{
	cstat 0
	quake 13
	sound TREE_FALL
	shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
	spritepal 8
	debris SCRAP3 18
	espawn 13243
	seta[RETURN].cstat 34
	seta[RETURN].xrepeat 16
	seta[RETURN].yrepeat 16
	seta[RETURN].z sector[].floorz
	seta[RETURN].shade sector[].floorshade
	randvar GTEMP 2048
	seta[RETURN].ang GTEMP
	killit
	}
		
		
}
	
ifaction TREE_DEAD
	{
	ifrnd 4 set FIRE_DAMAGE 0
	geta[].shade TEMP
	ifl TEMP 30
		{
		add TEMP 1
		seta[].shade TEMP
		}
	geta[].xrepeat TEMP
	ifg TEMP 4
		{
		sub TEMP 1
		seta[].xrepeat TEMP
		}
	spriteflags 5
	}
	
state TREE_FIRE_STUFF

ends

defstate RANDOMROCK

ifaction 0
	{
	ifand sprite[].cstat 8 nullop else
		{
		  ifrnd 128
			cstat 261
		  else
			cstat 257
		randvarvar GTEMP 48
		add GTEMP 8
		seta[].xrepeat GTEMP
		seta[].yrepeat GTEMP
		}
	action ZERO
	}

ends

action STEPON 0

useractor notenemy 5381 // targeting sprite for foliage for flame thrower .etc
cstat 32768
sizeat 32 32
spriteflags 2048
ife sprite[myowner].extra 0 killit
ife sprite[myowner].statnum -1 killit
ife sprite[myowner].cstat 32768 killit
ife sprite[myowner].statnum 1024 killit
enda

defstate RANDOMFOLIAGE

ife global_trigger 6363 killit

ifaction 0
	{
	ifspritepal 3 break
	  ifrnd 128
		cstat 4
	  else
		cstat 0
	randvarvar GTEMP 32
	add GTEMP 8
	strength 1
	spriteflags 2176
	ifand sector[].ceilingstat 8192 nullop else spawn 5381 // spawn targetting sprite
	seta[].xrepeat GTEMP
	seta[].yrepeat GTEMP
	action ZERO
	}

ifpdistl 32768 ifstrength 0 { ifand sector[].ceilingstat 8192 nullop else spawn 5381 strength 1 } else strength 0

ifaction ZERO
	{
	state GREEN_BOOK_ARTIFACT
	ifpdistl 612
		{
		geta[].yrepeat TEMP2
		ifg TEMP2 32 sound RUSTLE_BUSH
		seta[].yrepeat 10
		action STEPON
		}
	}

ifaction STEPON
ifpdistg 612
	{
	ifg TEMP2 32 sound RUSTLE_BUSH
	seta[].yrepeat TEMP2
	action ZERO
	}

state TREE_FIRE_STUFF

ifaction TREE_DEAD
	{
	geta[].shade TEMP
	ifl TEMP 30
		{
		add TEMP 1
		seta[].shade TEMP
		}
	geta[].xrepeat TEMP
	ifg TEMP 4
		{
		sub TEMP 1
		seta[].xrepeat TEMP
		}
		else
		killit
	spriteflags 5
	}

ends

useractor notenemy 3868 state RANDOMTREE 

ifn DAYNIGHT 0
	{
	gettimedate TEMP TEMP TEMP2 TEMP TEMP3 TEMP TEMP TEMP
	ife TEMP3 8 { spawn 13916 cactor 4071 } // Autumn tree
	ife TEMP3 9 { spawn 13916 cactor 4071 } // Autumn tree
	ife TEMP3 10 { spawn 13916 cactor 4071 } // Autumn tree
	ife TEMP3 11 cactor 5835 // Winter tree
	ife TEMP3 0 cactor 5835 // Winter tree
	ife TEMP3 1 cactor 5835 // Winter tree
	}

enda

useractor notenemy 22740 state RANDOMTREE 

ifn DAYNIGHT 0
	{
	gettimedate TEMP TEMP TEMP2 TEMP TEMP3 TEMP TEMP TEMP
	ife TEMP3 8 { spawn 13916 cactor 22742 } // Autumn tree
	ife TEMP3 9 { spawn 13916 cactor 22742 } // Autumn tree
	ife TEMP3 10 { spawn 13916 cactor 22742 } // Autumn tree
	ife TEMP3 11 cactor 22743 // Winter tree
	ife TEMP3 0 cactor 22743 // Winter tree
	ife TEMP3 1 cactor 22743 // Winter tree
	}

enda

defstate TREE_RUNOVER
ifpdistl 4500
ife player_in_vehicle 1
	{
	cstat 0
	quake 13
	sound TREE_FALL
	shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
	spritepal 8
	debris SCRAP3 18
	espawn 13243
	seta[RETURN].cstat 34
	seta[RETURN].xrepeat 16
	seta[RETURN].yrepeat 16
	seta[RETURN].z sector[].floorz
	seta[RETURN].shade sector[].floorshade
	randvar GTEMP 2048
	seta[RETURN].ang GTEMP
	killit
	}
ends
 
useractor notenemy 3863 
state TREE_FIRE_STUFF 
ifaction 0
	{
	ifrnd 96 cactor 23652
	else ifrnd 96 cactor 23653
	action ZERO
	}
state TREE_RUNOVER
enda

useractor notenemy 23652
state TREE_FIRE_STUFF 
state TREE_RUNOVER
enda

useractor notenemy 23653
state TREE_FIRE_STUFF 
state TREE_RUNOVER
enda



useractor notenemy 3862 state RANDOMTREE enda
useractor notenemy 4718 state RANDOMTREE enda
useractor notenemy 4720 state RANDOMTREE enda
useractor notenemy 4722 state RANDOMTREE enda
useractor notenemy 5675 state RANDOMTREE enda
useractor notenemy 4071 state RANDOMTREE enda
useractor notenemy 5835 state RANDOMTREE enda
useractor notenemy 7943 state RANDOMTREE enda
useractor notenemy 7944 state RANDOMTREE enda
useractor notenemy 8670 state RANDOMTREE enda
useractor notenemy 8671 state RANDOMTREE enda
useractor notenemy 10059 state RANDOMTREE enda
useractor notenemy 11664 state RANDOMTREE enda
useractor notenemy 11665 state RANDOMTREE enda
useractor notenemy 11666 state RANDOMTREE enda
useractor notenemy 11667 state RANDOMTREE enda
useractor notenemy 11668 state RANDOMTREE enda
useractor notenemy 14335 state RANDOMTREE enda
useractor notenemy 17919 state RANDOMTREE enda
useractor notenemy 20353 state RANDOMTREE enda
useractor notenemy 23649 state RANDOMTREE enda
useractor notenemy 23654 state RANDOMTREE enda
useractor notenemy 23655 state RANDOMTREE enda
useractor notenemy 23656 state RANDOMTREE enda
useractor notenemy 23657 state RANDOMTREE enda
useractor notenemy 23543 state RANDOMTREE enda
useractor notenemy 23548 state RANDOMTREE enda
useractor notenemy 23549 state RANDOMTREE enda

useractor notenemy 22742 state RANDOMTREE enda
useractor notenemy 22743 state RANDOMTREE enda

useractor notenemy 25115 state RANDOMTREE enda
useractor notenemy 25116 state RANDOMTREE enda
useractor notenemy 25117 state RANDOMTREE enda
useractor notenemy 25120 state RANDOMTREE enda

useractor notenemy 5748 state RANDOMTREE enda

useractor notenemy 5857 state RANDOMROCK enda
useractor notenemy 5828 fall state RANDOMROCK enda
useractor notenemy 5829 fall state RANDOMROCK enda

useractor notenemy 23547 state RANDOMROCK enda

useractor notenemy 5420 state RANDOMFOLIAGE enda
useractor notenemy 5421 state RANDOMFOLIAGE enda
useractor notenemy 5422 state RANDOMFOLIAGE enda
useractor notenemy 5623 state RANDOMFOLIAGE enda
useractor notenemy 8065 state RANDOMFOLIAGE enda
useractor notenemy 16372 state RANDOMFOLIAGE enda
useractor notenemy 16373 state RANDOMFOLIAGE enda
useractor notenemy 23650 state RANDOMFOLIAGE enda
useractor notenemy 23651 state RANDOMFOLIAGE enda

useractor notenemy 25202 state RANDOMFOLIAGE enda
useractor notenemy 25211 state RANDOMFOLIAGE enda
useractor notenemy 25213 state RANDOMFOLIAGE enda

useractor notenemy 5830

ife global_trigger 6363 killit

ifaction 0
	{
	strength 1
	state rf
	spriteflags 2176
	ife sector[].ceilingstat 8192 nullop else spawn 5381 // spawn targetting sprite
	action ZERO
	}

ifpdistl 32768 ifstrength 0 { ifand sector[].ceilingstat 8192 nullop else spawn 5381 strength 1 } else strength 0

ifaction ZERO
	{
	ifpdistl 612
		{
		geta[].yrepeat TEMP2
		sound RUSTLE_BUSH
		seta[].yrepeat 10
		action STEPON
		}
	}

ifaction STEPON
ifpdistg 612
	{
	sound RUSTLE_BUSH
	seta[].yrepeat TEMP2
	action ZERO
	}

state TREE_FIRE_STUFF

ifaction TREE_DEAD
	{
	geta[].shade TEMP
	ifl TEMP 30
		{
		add TEMP 1
		seta[].shade TEMP
		}
	geta[].xrepeat TEMP
	ifg TEMP 4
		{
		sub TEMP 1
		seta[].xrepeat TEMP
		}
		else
		killit
	spriteflags 5
	}

enda

// *************************************************
// PADLOCK
// *************************************************

action PADLOCKUN 0 7 1 1 10
action PADLOCKUNL 6

useractor notenemy 8038 

ifaction 0 action ZERO

ifp palive
 ifp pfacing
  ifpdistl 1536
   ifaction ZERO
   {
   set player_use 0
    ifhitspace
	{
	set hit_key 30
	ifand HITAGSAVED 64 // Generic Key
		{
		ifg GENERIC_KEYS 0 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } else 
			{ set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon GENERICKEY }
		}
	ifand HITAGSAVED 1 // Flame Key
		{
		ifand OLDKEYS 1 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } else 
			{ set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon FLAMEKEY }
		}
	ifand HITAGSAVED 2 // Spider Key
		{
		ifand OLDKEYS 2 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } else 
			{ set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SPIDERKEY }
		}
	else
	ifand HITAGSAVED 4 // Dagger Key
		{
		ifand OLDKEYS 4 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } else 
			{ set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon DAGGERKEY }
		}
	else
	ifand HITAGSAVED 8 // Moon Key
		{
		ifand OLDKEYS 8 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } else 
			{ set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon MOONKEY }
		}
	else
	ifand HITAGSAVED 16 // Skull key
		{
		ifand OLDKEYS 16 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } else 
			{ set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon SKULLKEY }
		}
	else
	ifand HITAGSAVED 32 // Eye key
		{
		ifand OLDKEYS 32 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } else 
			{ set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon EYEKEY }
		}
	else
		ifand HITAGSAVED 64 // Normal key 1
			{
			ifand NORMAL_KEYS 1 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } 
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY1 }
			}
	else
		ifand HITAGSAVED 128 // Normal key 2
			{
			ifand NORMAL_KEYS 2 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } 
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY2 }
			}
	else
		ifand HITAGSAVED 256 // Normal key 3
			{
			ifand NORMAL_KEYS 4 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } 
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY3 }
			}
	else
		ifand HITAGSAVED 512 // Normal key 4
			{
			ifand NORMAL_KEYS 8 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } 
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY4 }
			}
	else
		ifand HITAGSAVED 1024 // Normal key 5
			{
			ifand NORMAL_KEYS 16 { stopsound OLDKEY_LOCKED globalsound OLDKEY_UNLOCK quote 8 action PADLOCKUN } 
			else { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon NORMAL_KEY5 }
			}
	}
   }

ifaction PADLOCKUN
	{
	set door_locked 26
	set PLAYER_VOICEOVER 0
	ifactioncount 7
		{
		action PADLOCKUNL
		ifand HITAGSAVED 0 sub GENERIC_KEYS 1 else
		ifand HITAGSAVED 1 xorvar OLDKEYS 1 else
		ifand HITAGSAVED 2 xorvar OLDKEYS 2 else
		ifand HITAGSAVED 4 xorvar OLDKEYS 4 else
		ifand HITAGSAVED 8 xorvar OLDKEYS 8 else
		ifand HITAGSAVED 16 xorvar OLDKEYS 16 else
		ifand HITAGSAVED 32 xorvar OLDKEYS 32 else
		ifand HITAGSAVED 64 xorvar NORMAL_KEYS 1 else
		ifand HITAGSAVED 128 xorvar NORMAL_KEYS 2 else
		ifand HITAGSAVED 256 xorvar NORMAL_KEYS 4 else
		ifand HITAGSAVED 512 xorvar NORMAL_KEYS 8 else
		ifand HITAGSAVED 1024 xorvar NORMAL_KEYS 16
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED
		}
	}


enda

// *************************************************
// CUSTOM NUKE SWITCH
// *************************************************

action NUKEIDLE 0 1 1 1 1
action NUKEOPEN 0 3 1 1 26
action NUKEHANG 2 1 1 1 1 
action NUKEHITA 3 1 1 1 1

defstate CUSTOM_NUKESWITCH
ifaction 0 
	{
	readarrayfromfile BEAT_EPISODES 4053
	action NUKEIDLE
	}


ifpdistl 812
 ifp palive
  ifp pfacing
   ifcansee
    {
	set player_use 0
    ifhitspace
     ifaction NUKEIDLE 
      { 
	  set hit_key 30
	soundonce NUKESWITCH_OPEN
      action NUKEOPEN
      }
	}

ifaction NUKEOPEN
ifactioncount 3
ifp palive
{
action NUKEHANG
setp[].fist_incs 1
}

ifaction NUKEHANG
{
ife player[].fist_incs 25 ife EXTRASAVED -1 set END_LEVEL 60
ife player[].fist_incs 30 { ifactor CUSTOMNUKESWITCH sound GLASS_HEAVYBREAK action NUKEHITA }
}

ifaction NUKEHITA
{
ifp pdead resetplayer
ifg player[].fist_incs 41
	{
	action NUKEHITA
	ifn EXTRASAVED -1
	{
	operateactivators EXTRASAVED THISACTOR
	operaterespawns EXTRASAVED
	operatemasterswitches EXTRASAVED
	setp[].fist_incs 0
	}
	else
		{
		ife VOLUME 0
		 ife LEVEL 4 // Dis base secret level
			{
			ifand BEAT_EPISODES[1] 2 nullop else 
				{ 
				set TEMP BEAT_EPISODES[1]
				xorvar TEMP 2 
				setarray BEAT_EPISODES[1] TEMP
				writearraytofile BEAT_EPISODES 4053
				}
			
			ifn CHEATED 1
				{
				readarrayfromfile SKILL_MEDALS 4030
				ifl SKILL_MEDALS[2] SKILL_LEVEL setarray SKILL_MEDALS[2] SKILL_LEVEL
				writearraytofile SKILL_MEDALS 4030		
				}
			
			}
			
			ife VOLUME 1 // Episode 2?
				{
				
				ife LEVEL 10 // Repent your sins
					{ 
					ifand BEAT_EPISODES[2] 64 nullop else 
						{ 
						set TEMP BEAT_EPISODES[2]
						xorvar TEMP 64
						setarray BEAT_EPISODES[2] TEMP
						writearraytofile BEAT_EPISODES 4053
						}
					
					ifn CHEATED 1
						{
						readarrayfromfile SKILL_MEDALS 4030
						ifl SKILL_MEDALS[20] SKILL_LEVEL setarray SKILL_MEDALS[20] SKILL_LEVEL
						writearraytofile SKILL_MEDALS 4030		
						}
					
					} 
				
				ife LEVEL 18 // Xuglop train
					{ 
					ifand BEAT_EPISODES[2] 512 nullop else 
						{ 
						set TEMP BEAT_EPISODES[2]
						xorvar TEMP 512
						setarray BEAT_EPISODES[2] TEMP
						writearraytofile BEAT_EPISODES 4053
						}
					
					ifn CHEATED 1
						{
						readarrayfromfile SKILL_MEDALS 4030
						ifl SKILL_MEDALS[24] SKILL_LEVEL setarray SKILL_MEDALS[24] SKILL_LEVEL
						writearraytofile SKILL_MEDALS 4030		
						}
					
					} 
				}
			setp[].fist_incs 0
			clearmapstate LEVEL
			state save_arrays
			state fatigue_system
			ife ZVELSAVED 1 nullop else state budget_system
			ife XVELSAVED 1 ifn base_level -1 ifn base_volume -1 startlevel base_volume base_level else
			ife XVELSAVED 2 ifn base_level -1 ifn base_volume -1 ifn base_volume VOLUME startlevel base_volume base_level
				else
			startlevel HITAGSAVED LOTAGSAVED
			
			
			}
	}
}

ends

useractor notenemy CUSTOMNUKESWITCH state CUSTOM_NUKESWITCH enda
useractor notenemy IWNUKESWITCH state CUSTOM_NUKESWITCH enda

// ==================================================================RUNE SWITCH======================================

defstate checkcounterpart4

set TEMP 0
whilevarn TEMP 16384
{
  ifn sprite[TEMP].statnum 1024
  {
    ife sprite[TEMP].picnum RUNESWITCH
    {
       getactorvar[TEMP].LOTAGSAVED TEMP3
       ife LOTAGSAVED TEMP3 { seta[TEMP].picnum 8107 }
    }
  }
  add TEMP 1
}
 
ends

defstate RUNESWITCHCODE

ifaction 0 action LOCKED

ifpdistl 1024 ifhitspace ifaction LOCKED 
{
	ifspritepal 0 // BLUE
		{
			ifand RUNEKEYS 1
				{
				lockplayer 13
				set CKEYCARDPAL 0
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon RUNEKEY set key_pal 0 }
		}
else
	ifspritepal 21 // RED
		{
			ifand RUNEKEYS 2
				{
				lockplayer 13
				set CKEYCARDPAL 21
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon RUNEKEY set key_pal 21 }
		}
else
	ifspritepal 23 // YELLOW
		{
			ifand RUNEKEYS 4
				{
				lockplayer 13
				set CKEYCARDPAL 23
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon RUNEKEY set key_pal 23 }
		}
else
	ifspritepal 12 // GREY
		{
			ifand RUNEKEYS 8
				{
				lockplayer 13
				set CKEYCARDPAL 12
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon RUNEKEY set key_pal 12 }
		}
else
	ifspritepal 11 // GREEN
		{
			ifand RUNEKEYS 16
				{
				lockplayer 13
				set CKEYCARDPAL 11
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon RUNEKEY set key_pal 11 }
		}
else
	ifspritepal 49 // PURPLE
		{
			ifand RUNEKEYS 32
				{
				lockplayer 13
				set CKEYCARDPAL 49
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon RUNEKEY set key_pal 49 }
		}
}

ifaction UNLOCKING
{
set KEYCARDTYPE 1
ife CUSTOMKEYCARDPOS 9
	{
	state checkcounterpart4
	ife HITAGSAVED 0 { sound RUNE_USE } else { soundvar HITAGSAVED }
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	action UNLOCKED
	ifspritepal 0 sub RUNEKEYS 1
	else ifspritepal 21 sub RUNEKEYS 2
	else ifspritepal 23 sub RUNEKEYS 4
	else ifspritepal 12 sub RUNEKEYS 8
	else ifspritepal 11 sub RUNEKEYS 16
	else ifspritepal 49 sub RUNEKEYS 32
	}
}
ends

useractor notenemy RUNESWITCH state RUNESWITCHCODE enda

// ==================================================================SWIPE CARDS========================================

defstate SWIPEUNLOCK
	lockplayer 13
	action UNLOCKING
ends

defstate SWIPE_CODE

ifaction 0 action LOCKED

ifpdistl 1024 ifp pfacing ifhitspace ifaction LOCKED 
{
	ifspritepal 0 // BLUE
		{	
			ifvare SWIPECARDS 64 state SWIPEUNLOCK
			else ifand SWIPECARDS 1 state SWIPEUNLOCK
			else { set door_locked 0 set key_icon SWIPE_CARD set key_pal 0 }
		}
else
	ifspritepal 21 // RED
		{
			ifvare SWIPECARDS 64 state SWIPEUNLOCK
			else ifand SWIPECARDS 2 state SWIPEUNLOCK
			else { set door_locked 0 set key_icon SWIPE_CARD set key_pal 21 }
		}
else
	ifspritepal 23 // YELLOW
		{
			ifvare SWIPECARDS 64 state SWIPEUNLOCK
			else ifand SWIPECARDS 4 state SWIPEUNLOCK
			else { set door_locked 0 set key_icon SWIPE_CARD set key_pal 23 }
		}
else
	ifspritepal 12 // GREY
		{
			ifvare SWIPECARDS 64 state SWIPEUNLOCK
			else ifand SWIPECARDS 8 state SWIPEUNLOCK
			else { set door_locked 0 set key_icon SWIPE_CARD set key_pal 12 }
		}
else
	ifspritepal 11 // GREEN
		{
			ifvare SWIPECARDS 64 state SWIPEUNLOCK
			else ifand SWIPECARDS 16 state SWIPEUNLOCK
			else { set door_locked 0 set key_icon SWIPE_CARD set key_pal 11 }
		}
else
	ifspritepal 49 // PURPLE
		{
			ifvare SWIPECARDS 64 state SWIPEUNLOCK
			else ifand SWIPECARDS 32 state SWIPEUNLOCK
			else { set door_locked 0 set key_icon SWIPE_CARD set key_pal 49 }
		}
else
	ifspritepal 15 // BROWN
		{
			ifvare SWIPECARDS 64 state SWIPEUNLOCK
			else ifand SWIPECARDS 128 state SWIPEUNLOCK
			else { set door_locked 0 set key_icon SWIPE_CARD set key_pal 15 }
		}
}

ifaction UNLOCKING
{
	sound PC_LOAD_FLOPPY
	setactorsoundpitch THISACTOR PC_LOAD_FLOPPY 2048
	setp[].weapon_pos 10
	ifvare SWIPECARDS 64 action THREE
	else action TWO
	resetactioncount
}

ifaction TWO
{
ifactioncount 60 
	{ 
	stopsound PC_LOAD_FLOPPY
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	sound SWIPE_UNLOCK 
	action ONE 
	}
}

ifaction THREE
{
ifactioncount 60 
	{ 
	stopsound PC_LOAD_FLOPPY
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	sound SWIPE_UNLOCK 
	action ONE 
	}
}

ends

useractor notenemy SWIPE_LOCK state SWIPE_CODE enda

// ==================================================================SCARAB SWITCH======================================

defstate SCARABSWITCHCODE

ifaction 0 { action LOCKED }

ifpdistl 1024 ifhitspace ifaction LOCKED 
{
	ifspritepal 0 // BLUE
		{
			ifand SCARABKEYS 1
				{
				lockplayer 13
				set CKEYCARDPAL 0
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 0 }
		}
else
	ifspritepal 21 // RED
		{
			ifand SCARABKEYS 2
				{
				lockplayer 13
				set CKEYCARDPAL 21
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 21 }
		}
else
	ifspritepal 23 // YELLOW
		{
			ifand SCARABKEYS 4
				{
				lockplayer 13
				set CKEYCARDPAL 23
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 23 }
		}
else
	ifspritepal 11 // GREEN
		{
			ifand SCARABKEYS 8
				{
				lockplayer 13
				set CKEYCARDPAL 11
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 11 }
		}
else
	ifspritepal 49 // PURPLE
		{
			ifand SCARABKEYS 16
				{
				lockplayer 13
				set CKEYCARDPAL 49
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 49 }
		}
else
	ifspritepal 35 // ORANGE
		{
			ifand SCARABKEYS 32
				{
				lockplayer 13
				set CKEYCARDPAL 35
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 35 }
		}
else
	ifspritepal 15 // BROWN
		{
			ifand SCARABKEYS 64
				{
				lockplayer 13
				set CKEYCARDPAL 15
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 15 }
		}
else
	ifspritepal 37 // LIGHT BLUE
		{
			ifand SCARABKEYS 128
				{
				lockplayer 13
				set CKEYCARDPAL 37
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 37 }
		}
else
	ifspritepal 12 // GREY
		{
			ifand SCARABKEYS 256
				{
				lockplayer 13
				set CKEYCARDPAL 12
				set CUSTOMKEYCARDPOS 21
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon SCARABKEY set PLAYER_VOICEOVER 3 set key_pal 12 }
		}
}

ifaction UNLOCKING
{
set KEYCARDTYPE 2
ife CUSTOMKEYCARDPOS 9
	{
	ife HITAGSAVED 0 { sound SCARAB_KEY sound EGYPT_SWITCH } else soundvar HITAGSAVED
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	action UNLOCKED
	ifspritepal 0 xorvar SCARABKEYS 1
	else ifspritepal 21 xorvar SCARABKEYS 2
	else ifspritepal 23 xorvar SCARABKEYS 4
	else ifspritepal 11 xorvar SCARABKEYS 8
	else ifspritepal 49 xorvar SCARABKEYS 16
	else ifspritepal 35 xorvar SCARABKEYS 32
	else ifspritepal 15 xorvar SCARABKEYS 64
	else ifspritepal 37 xorvar SCARABKEYS 128
	else ifspritepal 12 xorvar SCARABKEYS 256
	}
}
ends

useractor notenemy SCARABSWITCH state SCARABSWITCHCODE enda

// ==================================================================ABYSS SWITCH======================================

defstate ABYSS_SWITCHCODE

ifaction 0 action LOCKED

ifpdistl 1024 ifhitspace ifaction LOCKED 
{
	ifspritepal 0 // BLUE
		{
			ifand ABYSS_KEYS 1
				{
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ABYSS_KEY set key_pal 0 }
		}
else
	ifspritepal 21 // RED
		{
			ifand ABYSS_KEYS 2
				{
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ABYSS_KEY set key_pal 21 }
		}
else
	ifspritepal 23 // YELLOW
		{
			ifand ABYSS_KEYS 4
				{
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ABYSS_KEY set key_pal 23 }
		}
else
	ifspritepal 11 // GREEN
		{
			ifand ABYSS_KEYS 8
				{
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ABYSS_KEY set key_pal 11 }
		}
else
	ifspritepal 49 // PURPLE
		{
			ifand ABYSS_KEYS 16
				{
				action UNLOCKING
				}
			else { set door_locked 0 set key_icon ABYSS_KEY set key_pal 49 }
		}
}

ifaction UNLOCKING
{
set KEYCARDTYPE 2
ifcount 6
	{
	ife HITAGSAVED 0 { globalsound DIS_CRYING sound OLD_SWITCH } else soundvar HITAGSAVED
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	action UNLOCKED
	ifspritepal 0 xorvar ABYSS_KEYS 1
	else ifspritepal 21 xorvar ABYSS_KEYS 2
	else ifspritepal 23 xorvar ABYSS_KEYS 4
	else ifspritepal 11 xorvar ABYSS_KEYS 8
	else ifspritepal 49 xorvar ABYSS_KEYS 16
	resetcount
	}
}
ends

useractor notenemy ABYSS_LOCK state ABYSS_SWITCHCODE enda

// *************************************************
// LADDER CODE BY DEEPERTHOUGHT FROM DUKE PLUS
// *************************************************

useractor notenemy 18481
ifn HITAGSAVED 0
	{
	cstat 32768
	ife global_trigger HITAGSAVED
		{
		set HITAGSAVED 0
		seta[].cstat CSTATSAVED
		}
	}
enda

useractor notenemy 3803

	ife TEMP9 0
	{
		set TEMP9 1
		set TEMP 0
		whilevarn TEMP 16384
		{
			ife sprite[TEMP].picnum 3803 ifvarvarn TEMP THISACTOR
			{
					getactorvar[TEMP].HITAGSAVED TEMP3
					ife HITAGSAVED TEMP3 // it is the other of the pair
					{
						set myspawner TEMP
						set TEMP9 1
						set TEMP 16383 // we can stop the loop now
						ifg sprite[].z sprite[myspawner].z
						{
							set mtype 1 // the bottom of the ladder
							set ALLY_MAG sprite[myspawner].z
						}
					}
			}
			add TEMP 1
		}
		ife myspawner -1 quote 125
	}


ifn YVELSAVED 0
{
checkactivatormotion YVELSAVED
ife RETURN 1
	{
	set YVELSAVED 0
	}
}
else
ifn ZVELSAVED 0
	{
	ife mtype 0
		{
		ifpdistl 1536
			{
			set player_use 0
		     ife ROPE 1
				{
				setp[].inven_icon 11
				
				 ifhitspace
					{
					set hit_key 30
					soundonce THROWSOMET
					set global_trigger ZVELSAVED
					setp[].inven_icon 0
					set ROPE 0
					set ZVELSAVED 0
					}
				}
			else
				{
				ifhitspace
					 {
					 set hit_key 30
					 set door_locked 0
					 set key_icon 17916
					 set key_pal 0
					 }
				}
			}
			else
			ifpdistg 1536
			{
			ife player[].inven_icon 11 setp[].inven_icon 0
			}
		}
	ife global_trigger ZVELSAVED set ZVELSAVED 0
	}
else
	ife mtype 1
	{
		getp[].posz mz
		ifp pducking sub mz 4096
		ifg mz ALLY_MAG ifl mz sprite[].z
		{
			ldist xydist THISACTOR player[].i
			
			ifspritepal 3
			{
			ifl xydist 512 // 192 512
				{
				set LADDERTYPE 2
				ife onladder 0
					{
					getp[].posx lastladderx
					getp[].posy lastladdery
					}
				set onladder 3
				ifn LOTAGSAVED 0 set laddersound LOTAGSAVED else set laddersound -1
				}
			}
			else
			ifangdiffl 384 ifl xydist 256 // 192 512
			{
				set LADDERTYPE XVELSAVED
				ife onladder 0
				{
					getp[].posx lastladderx
					getp[].posy lastladdery
				}
				set onladder 3
				ifn LOTAGSAVED 0 set laddersound LOTAGSAVED else set laddersound -1
			}
		}
	}
else
	ife mtype 0
	{
	ifpdistl 1536
	 ifp pfacing
	  ifcansee
	  ife onladder 0
	  {
	  set player_use 0
		ifhitspace
			{
			set hit_key 30
			soundonce JMOVE6
			setp[].one_eighty_count -1024
			setp[].posx sprite[].x
			setp[].posy sprite[].y
			setp[].posz sprite[].z
			}
	  }
	  
	}
enda

defstate laddercode
    setp[].weapon_pos 10
    ifp ponground { stopsound SLIDE_DOWN set bpress 0 }
    setp[].falling_counter 0


ife fpress 0 ife bpress 0
{
	 set laddervel -256
	 getp[].posx lastladderx
	 getp[].posy lastladdery
}
 else
 {
	 ifcount 13 ifg fpress 0 
		{ 
		ifrnd 8 set PLAYER_VOICEOVER 25
		ife laddersound 408
			{
			ifrnd 96 sound WOOD_LADDER1
			else ifrnd 96 sound WOOD_LADDER2
			else sound WOOD_LADDER3
			}
			else
		ife laddersound 2617
			{
			ifrnd 96 sound ROCK_CLIMB1
			else ifrnd 96 sound ROCK_CLIMB2
			else sound ROCK_CLIMB3
			}
			else
			ifn laddersound -1 soundvar laddersound 
			resetcount 
		}
	 ife LADDERTYPE 2 { ifg bpress 0 { soundonce SLIDE_DOWN } }
	 ife LADDERTYPE 1 { ifg bpress 0 { soundonce SLIDE_DOWN } }
	 else ife LADDERTYPE 0 
		{ ifcount 13 
			ifg bpress 0 
				{
				ife laddersound 408
				{
				ifrnd 96 soundonce WOOD_LADDER1
				else ifrnd 96 soundonce WOOD_LADDER2
				else soundonce WOOD_LADDER3
				}
				else
			ife laddersound 2617
				{
				ifrnd 96 soundonce ROCK_CLIMB1
				else ifrnd 96 soundonce ROCK_CLIMB2
				else soundonce ROCK_CLIMB3
				}
				else
				{ soundvar laddersound resetcount } 
				}
		}
	 updatesectorz lastladderx lastladdery player[].posz mysector
	 ifn mysector -1
	 {
		 setp[].posx lastladderx
		 setp[].posy lastladdery
		 getp[].i spriteid
		 seta[spriteid].x lastladderx
		 seta[spriteid].y lastladdery
	 }
 }
ifp ponground set laddervel 0 else
{
	setp[].posxv 0
	setp[].posyv 0
}
sub onladder 1
setp[].poszv laddervel

ends


// *************************************************
// CROW
// *************************************************

move CROWFLY 128 0

useractor notenemy 8576
sizeat 16 16
move CROWFLY geth
ifnotmoving killit
soundonce CROWFLAP
ifrnd 4 soundonce CROWCAW
enda


// *************************************************
// MOUNTED MINIGUN
// *************************************************

action MGUN_IDLE 0 1 5 1 1
action MGUN_USE 0 1 5 1 1

defstate disengage_minigun
	set firing_count 0
	sound MINIGUN_STOP
	stopsound MINIGUN_SPIN
	stopsound MINIGUN_FIRE
	setp[].movement_lock 0 
	set using_minigun -1 
	action MGUN_IDLE 
	resetcount 
ends

useractor 6 MOUNTED_MINIGUN
fall
sizeat 28 28

ifaction 0
{
cstat 257
action MGUN_IDLE
}

ifaction MGUN_IDLE
{
cstat 257
ifpdistl 812
 ifp pfacing
  ife player_using_hovercraft -1
  ife player_using_mech -1
  ife using_minigun -1
  {
  set player_use 0
  ifhitspace
   ifcount 16
   ife using_minigun -1
		{
		set hit_key 30
		sound MINIGUN_START
		set using_minigun THISACTOR
		resetcount
		}
	}
}

ife using_minigun THISACTOR action MGUN_USE

ifaction MGUN_USE
{
	// geta[].x mx
	// geta[].y my
	// getp[].posx x
	// getp[].posy y
	// sub mx x
	// sub my y
	// getangle ANGVAR mx my
	// setp[].ang ANGVAR
ifp pdead state disengage_minigun
ifpdistg 1224 state disengage_minigun
ifmultiplayer cstat 32768 else
{
ife player[].over_shoulder_on 1 cstat 256 else cstat 32768
}
soundonce MINIGUN_SPIN 
ifhitspace 
 ifcount 16 
	state disengage_minigun
}

enda

// *************************************************
// MOUNTED .50 CAL
// *************************************************

defstate disengage_50cal
	set firing_count 0
	setp[].movement_lock 0 
	set using_50cal -1 
	action MGUN_IDLE 
	resetcount 
ends

useractor 6 22437
fall
sizeat 32 32

ifaction 0
{
cstat 257
ifspritepal 3
	{
	set using_50cal THISACTOR
	setp[].posx sprite[].x
	setp[].posy sprite[].y
	geta[].z TEMP4
	sub TEMP4 8192
	setp[].posz TEMP4
	action MGUN_USE
	}
else
action MGUN_IDLE
}

ifaction MGUN_IDLE
{
cstat 257
ifpdistl 812
 ifp pfacing
  ife player_using_hovercraft -1
  ife player_using_mech -1
  ife using_50cal -1
  {
  set player_use 0
  ifhitspace
   ifcount 16
   ife using_50cal -1
		{
		set hit_key 30
		set using_50cal THISACTOR
		resetcount
		}
	}
}

ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		ife using_50cal THISACTOR state disengage_50cal
		killit
		}
	}

ife using_50cal THISACTOR action MGUN_USE

ifaction MGUN_USE
{
	// geta[].x mx
	// geta[].y my
	// getp[].posx x
	// getp[].posy y
	// sub mx x
	// sub my y
	// getangle ANGVAR mx my
	// setp[].ang ANGVAR
ifp pdead state disengage_50cal
ifpdistg 1224 ifn sprite[].pal 3 state disengage_50cal
ifmultiplayer cstat 32768 else
{
ife player[].over_shoulder_on 1 cstat 256 else cstat 32768
}
ifhitspace 
 ifcount 16 
	state disengage_50cal
	

}

enda

// *************************************************
// LIGHT FLICKER
// *************************************************

defstate LIGHT_FLICKER
ifn SHADESAVED 255
	{
	ife SHADESAVED -128 set SHADESAVED -126 // manual fix for sprites set to max vis
	ifrnd 128
		{
		set TEMP SHADESAVED
		ifrnd 128 sub TEMP 1 else add TEMP 1
		seta[].shade TEMP
		}
		else
		seta[].shade SHADESAVED
	}
ends

spritenopal 19518
spritenopal 19519

useractor notenemy 19518 state LIGHT_FLICKER enda
useractor notenemy 19519 state LIGHT_FLICKER enda
useractor notenemy 19571 state LIGHT_FLICKER enda
useractor notenemy 23693 state LIGHT_FLICKER enda


// *************************************************
// EXPLOSION FLASH
// *************************************************

spritenoshade 8433
spritenopal 8433

defstate FLASHBANG_STATE
stopallsounds
ife SKILL_LEVEL 1 set flash_banged 30
else ife SKILL_LEVEL 2 set flash_banged 60
else ife SKILL_LEVEL 3 set flash_banged 90
else ife SKILL_LEVEL 4 set flash_banged 120
else ife SKILL_LEVEL 5 set flash_banged 150
dist TEMP6 THISACTOR player[].i
ifg TEMP6 4096 // reduce effectiveness if further away than 4096 units
	{
	div TEMP6 4096
	div flash_banged TEMP6
	}
ends

spriteflags 8433 SFLAG_NOCLIP

useractor notenemy 8433
ifaction 0
{
geta[].htowner TEMP4
geta[TEMP4].picnum SPRITE_PICNUM
switch SPRITE_PICNUM
	case HADESPHERE action ZERO spritepal 2 cstat 2 seta[].shade -127 break
	case SIREN action ZERO cstat 2 spritepal 1 seta[].shade -127 break
	case 12261 action ZERO spritepal 27 seta[].shade -127 cstat 130 break
	case 12267 action ZERO spritepal 27 seta[].shade -127 cstat 130 break
	case HEARTLEECHFLOAT action ZERO spritepal 2 seta[].shade -127 cstat 130 break
	case PROXONFLOOR action ZERO spritepal 8 seta[].shade -127 cstat 130 break
	case PROXONFLOOR_2 action ZERO spritepal 2 seta[].shade -127 cstat 130 break
	case 9844 action ZERO spritepal 1 seta[].shade -127 cstat 130 break
	case 15331 action ZERO spritepal 1 seta[].shade -127 cstat 130 break
	case 22610 action ONE spritepal 1 seta[].shade -127 cstat 130 sizeat 4 4 break
	case 6480 action ZERO spritepal 2 cstat 130 break
	case RUBYBLAST_EX action ZERO spritepal 2 cstat 130 break
	case 14422 action ZERO spritepal 23 cstat 130 break
	case 13214 action ZERO spritepal 3 cstat 130 break
	case 12203
	case 4963
	case 13383
	case WALLLIGHT3
	case WALLLIGHT4
	case 14604
	case 14605
	case 12053
	case 12204
	case 8515
	case 13404
	case 4961
	case 4483
	case 6874
	case 6875
	case 4954
	case 12358
	case 19802
	case 16076 
	case 5010
	case 5011
	case 18096
	case 12232
	case 4960 
	case 19
	case 4430
	case 17637
	case 4433
	case 4480
	case 12432
	case SHOTSPARK1
	case 22442
	case 19707
	case 19570 
	case 22631
	case 6826
	case 6816
	case 18067
	case 18072
		action ONE 
		cstat 130 
		break
	case SMALLSMOKE action ONE cstat 130 spritepal 0 break
	case 16615 action ZERO spritepal 1 cstat 130 break
	case 18133 action ZERO spritepal 27 cstat 130 break
	case 3655 action ONE spritepal 0 cstat 130 break
	case 11772 action ZERO spritepal 1 cstat 130 break
	case TRANSPORTERBEAM action ZERO spritepal 1 cstat 130 break
	case SORCERER action ZERO cstator 128 spritepal 2 cstat 130 break
	case 11284 action ZERO cstator 128 spritepal 2 cstat 130 break
	case FL_GRENADE  action ZERO spritepal 27 soundonce FLASHBANG ifp pfacing ifcansee state FLASHBANG_STATE else ifcansee ifpdistl 8096 palfrom 64 64 64 64 cstat 130 break
	case ENERGY_EXPLOSION action ZERO cstat 130 break
	default action ZERO spritepal 21 cstat 130 break
endswitch

ifrnd 128 cstator 4 ifrnd 128 cstator 8
seta[].blend 255
}

ifaction ZERO
{
seta[].shade -127
geta[].xrepeat TEMP add TEMP 10 seta[].xrepeat TEMP
geta[].yrepeat TEMP add TEMP 10 seta[].yrepeat TEMP
ifg TEMP 96 killit
}
else
ifaction ONE
{
seta[].shade -16
geta[].xrepeat TEMP add TEMP 1 seta[].xrepeat TEMP
geta[].yrepeat TEMP add TEMP 1 seta[].yrepeat TEMP
ifg TEMP 8 killit
}

enda

spritenoshade 9284
spritenoshade 9285
spritenoshade 9286
spritenoshade 9287
spritenoshade 9288

defstate bullet_spark
ifaction 0
	{
	cstat 1154
	sizeat 1 1
	ifrnd 128 cstator 4 ifrnd 128 cstator 8
	seta[].blend 255
	action ZERO
	}
ifaction ZERO
	{
	seta[].shade -16
	geta[].xrepeat TEMP add TEMP 2 seta[].xrepeat TEMP
	geta[].yrepeat TEMP add TEMP 2 seta[].yrepeat TEMP
	ifg TEMP 8 killit
	}
ends

useractor notenemy 9284 state bullet_spark enda
useractor notenemy 9285 state bullet_spark enda
useractor notenemy 9286 state bullet_spark enda
useractor notenemy 9287 state bullet_spark enda

useractor notenemy 9288
ifaction 0
	{
	cstat 1058
	sizeat 1 1
	randvar TEMP 2048
	ifceilingdistl 4 seta[].z sector[].ceilingz
	seta[].ang TEMP
	seta[].blend 255
	action ZERO
	}
ifaction ZERO
	{
	seta[].shade -16
	geta[].xrepeat TEMP add TEMP 2 seta[].xrepeat TEMP
	geta[].yrepeat TEMP add TEMP 2 seta[].yrepeat TEMP
	ifg TEMP 8 killit
	}
enda

// *************************************************
// WATER RIPPLE
// *************************************************

spritenoshade 8435

useractor notenemy 8435

ifaction 0
	{
	findnearactor 8435 32 TEMP
	ifn TEMP -1 killit
	seta[].z sector[].floorz
	seta[].shade sector[].floorshade
	seta[].blend 255
	cstat 34
	sizeat 4 4
	action ZERO
	}
else
ifaction ZERO
	{
	sizeto 64 64
	geta[].shade TEMP
	add TEMP 1
	ifg TEMP 35 killit
	seta[].shade TEMP
	}

enda

// *************************************************
// RAIN RIPPLE
// *************************************************

spritenoshade 13762

useractor notenemy 13762

seta[].shade sector[].floorshade
geta[].xrepeat TEMP add TEMP 4 seta[].xrepeat TEMP
geta[].yrepeat TEMP add TEMP 4 seta[].yrepeat TEMP
ifg TEMP 32 killit else
ifg TEMP 16 cstat 546 else
ifg TEMP 8 cstat 34 else
cstat 32

enda

// *************************************************
// COG MACHINERY
// *************************************************


action COGS_NOWORK 1
action COGS_WORK 3

useractor notenemy COG_MACHINERY

ifaction 0 action ZERO

ifaction ZERO
 {
 ifp pfacing
  ifp palive
   ifpdistl 1024
    ifhitspace
		{
		ifg COGS 0 
			{
			sub COGS 1
			sound OLD_SWITCH2
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			action COGS_WORK
			}
		else
			{
			quote 216
			action COGS_NOWORK
			}
		}
 }
 
 ifaction COGS_WORK soundonce COG_WORK
 ifaction COGS_NOWORK { ifcount 104 { action ZERO resetcount } }

enda

// *************************************************
// COMBAT CHECK
// *************************************************

useractor notenemy 22446
cstat 32768

ifn LOTAGSAVED -1
	{
	checkactivatormotion LOTAGSAVED
		ife RETURN 1
			{
			set COMBAT_CHECK HITAGSAVED
			resetcount
			action ZERO
			}
	}
else
	{
	set COMBAT_CHECK HITAGSAVED
	resetcount
	action ZERO
	}
	
ifaction ZERO
{
ifcount 30 { action FORM resetcount }
}
	
ifaction FORM
{
ifn EXTRASAVED -1 set CC_MUSIC EXTRASAVED
	ife ENEMIES_CLEARED 150
		{
		ifn EXTRASAVED -1 stopsoundvar CC_MUSIC
		ifn XVELSAVED 0 globalsoundvar XVELSAVED
		ifspritepal 12 { palfrom 64 64 64 64 }
		ifspritepal 13 { palfrom 64 0 0 0 }
		operateactivators COMBAT_CHECK THISACTOR
		operaterespawns COMBAT_CHECK
		operatemasterswitches COMBAT_CHECK
		set COMBAT_CHECK -1
		killit
		}
}

enda

// *************************************************
// C4 PLACE HERE
// *************************************************

action PREPLACED -2
action MINUSTWO -2

useractor notenemy C4_PLACE_HERE

ifaction 0 
	{
	sizeat 22 22
	cstat 658
	seta[].blend 255
	ifspritepal 9 cstator 256
	ifn EXTRASAVED 0 action PREPLACED
	else action ZERO
	}
else
ifaction PREPLACED
	{
	checkactivatormotion EXTRASAVED
	ife RETURN 1 { set INTERNALCOUNT 0 action MINUSTWO }
	}
ifaction ZERO
	{
	ifpdistl 4096
	 ifg GOT_EXPLOSIVE 0
		{
		geta[].xrepeat TEMP
		add TEMP 1 ifg TEMP 36 set TEMP 22
		seta[].xrepeat TEMP
		seta[].yrepeat TEMP
		}
	else sizeat 22 22
	
	ifpdistl 1024
	 ifp pfacing
	 {
	 set player_use 0
	  ifhitspace
	   ifcount 13
	  {
	  ife GOT_EXPLOSIVE 0 quote 185
	  else ifg GOT_EXPLOSIVE 0 
		{ 
		set hit_key 30
		setp[].weapon_pos 10
		set TEMP2 0
		globalsound C4_ATTACH
		set PLAYER_VOICEOVER 24
		sub GOT_EXPLOSIVE 1
		set INTERNALCOUNT 0
		action MINUSTWO
		ifn HITAGSAVED 0
			{
			operateactivators HITAGSAVED THISACTOR
			operaterespawns HITAGSAVED
			operatemasterswitches HITAGSAVED
			}
		}
	  resetcount
	  }
	}
	
	ifspritepal 9
		{
		strength 0
		ifhitweapon
		 ifwasweapon RADIUSEXPLOSION
			{
			hitradius 4096 50 100 150 300
			spawn EXPLOSION2
			globalsound C4_EXPLODE
			palfrom 20 20 20 20
			ifn LOTAGSAVED 0
				{
				operateactivators LOTAGSAVED THISACTOR
				operaterespawns LOTAGSAVED
				operatemasterswitches LOTAGSAVED
				}
			killit			
			}
		 }
	
	}
else
ifaction MINUSTWO
	{
	sleeptime 0
	seta[].blend 0
	sizeat 16 16
	cstat 144
	add INTERNALCOUNT 1
	ife INTERNALCOUNT 2 { quote 186 sound C4_BEEP setactorsoundpitch THISACTOR C4_BEEP -256 }
	ife INTERNALCOUNT 30 { quote 187 sound C4_BEEP setactorsoundpitch THISACTOR C4_BEEP -128 }
	ife INTERNALCOUNT 60 { quote 188 sound C4_BEEP setactorsoundpitch THISACTOR C4_BEEP 0 }
	ife INTERNALCOUNT 90 { quote 189 sound C4_BEEP setactorsoundpitch THISACTOR C4_BEEP 128 }
	ife INTERNALCOUNT 120 { quote 190 sound C4_BEEP setactorsoundpitch THISACTOR C4_BEEP 256 }
	ife INTERNALCOUNT 150
		{
		quote 191
		ifspritepal 3 hitradius 256 1 1 1 1
		else
		hitradius 4096 50 100 150 300
		quake 26
		spawn EXPLOSION2
		globalsound C4_EXPLODE
		palfrom 20 20 20 20
		ifn LOTAGSAVED 0
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			}
		killit
		}
	}
	


enda

// *************************************************
// CODEC BLIPPY THING
// *************************************************

action CBT0 0
action CBT1 1
action CBT2 2
action CBT3 3
action CBT4 4
action CBT5 5
action CBT6 6

useractor notenemy 9124

ifcount 2
{
ifrnd 8 action CBT0 else
ifrnd 16 action CBT1 else
ifrnd 16 action CBT2 else
ifrnd 16 action CBT3 else
ifrnd 16 action CBT4 else
ifrnd 16 action CBT5 else
ifrnd 32 action CBT6
resetcount
}

enda

// *************************************************
// COUNTDOWN
// *************************************************


useractor notenemy 3806
cstat 32768

ifspritepal 0
ifaction 0
{
ife LOTAGSAVED 0
	{
	ifspawnedby 19340
		{
		set countdown_type 1
		set EXTRASAVED 31976
		set HITAGSAVED 1
		}
	set countdown THISACTOR
	set countdown_minutes HITAGSAVED
	ifn XVELSAVED 0 set countdown_seconds XVELSAVED
	ifn EXTRASAVED -1 set countdown_fail EXTRASAVED
	action ZERO
	}
else
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		set countdown THISACTOR
		set countdown_minutes HITAGSAVED
		ifn XVELSAVED 0 set countdown_seconds XVELSAVED
		ifn EXTRASAVED -1 set countdown_fail EXTRASAVED
		action ZERO
		}
	}
}
else
ifspritepal 1
{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		quote 194
		set countdown -1
		ifg countdown_type 0 { setgamepalette 0 set countdown_type 0 }
		ifn YVELSAVED 0 globalsoundvar YVELSAVED
		action ZERO
		}
}
else
ifspritepal 2
ifaction 0
{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		set countdown THISACTOR
		set countdown_minutes HITAGSAVED
		palfrom 32 64 0 0
		quake 104
		set countdown_type 2
		ifn EXTRASAVED -1 set countdown_fail EXTRASAVED
		action ZERO
		}
}
else
ifspritepal 3
ifaction 0
{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		set countdown THISACTOR
		set countdown_minutes HITAGSAVED
		palfrom 32 64 0 0
		quake 104
		set countdown_type 3
		ifn EXTRASAVED -1 set countdown_fail EXTRASAVED
		action ZERO
		}
}

ifaction ZERO
{
    ife countdown -1 killit
	ife countdown_type 1
		{
		ifn player[].palette 5 setgamepalette 5
		ifrnd 8 quake 13
		ifcount 40 { globalsound CLAXON_ALARM resetcount }
		}
	ife countdown_type 2
		{
		ifrnd 8 quake 13
		ifcount 50 { globalsound CY_CLAXON resetcount }
		}
	ife countdown_type 3
		{
		ifrnd 8 quake 13
		ifcount 160 { globalsound CLAXON_ALARM5 resetcount }
		}
	add count_timer 1
	ifg countdown_seconds -1 ife count_timer 28 { sub countdown_seconds 1 set count_timer 0 }
	else ife countdown_seconds -1 
		{
		ifg countdown_minutes 0
			{ sub countdown_minutes 1 set countdown_seconds 59 }
		else
			{
			ifn countdown_fail -1 
				{
				set countdown_type 0
				setgamepalette 0
				operateactivators countdown_fail THISACTOR
				operatemasterswitches countdown_fail
				operaterespawns countdown_fail
				set countdown -1
				killit
				}
			else
				{
				palfrom 64 64 64 64
				set SLO_MO_SHOWOFF 70
				set FISSION_MAILED 1
				set countdown -1
				killit
				}
			}
		}
}
enda

// *************************************************
// WEAK DOOR
// *************************************************

useractor notenemy 9693 250

ifaction 0 action ZERO

ifstrength 125 action ONE

ifpdistl 1024
 ifp pfacing
  ifhitspace
   ifcount 16
	{
	set PLAYER_VOICEOVER 4
	soundonce LOCKED_GATE1
	quote 219
	resetcount
	}

ifhitweapon
	{
	ifwasweapon KNEE 
		{
		shoot SWOODSCRAP shoot SWOODSCRAP 
		sound WOOD_DOORKICK 
		}
		else sound HITWOOD
	ifdead 
		{
	  quake 13
	  globalsound DOOR_KICK2
	  shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
	  shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
	  killit
		}
	}

enda

// *************************************************
// ALARM SYSTEM
// *************************************************

useractor notenemy ALARM_SYSTEM
cstat 32768

ifn HITAGSAVED 0
{
ifg ALARM_ACTIVE 0
	{
   operateactivators HITAGSAVED THISACTOR
   operatemasterswitches HITAGSAVED
   operaterespawns HITAGSAVED
   killit
	}
}
else
ifpdistl 16384
	{
	set ALARM_DETECT 2
	ifg ALARM_COUNTER 100
		{
		ife SKILL_LEVEL 1 set ALARM_ACTIVE 240
		else ife SKILL_LEVEL 2 set ALARM_ACTIVE 360
		else ife SKILL_LEVEL 3 set ALARM_ACTIVE 480
		else ife SKILL_LEVEL 4 set ALARM_ACTIVE 760
		resetcount
		}
		
	ifg ALARM_ACTIVE 0
		{
		set ALARM_COUNTER 0
		set PLAYER_VOICEOVER 37
		ifcount 26 { ifn LOTAGSAVED 0 soundvar LOTAGSAVED palfrom 10 10 0 0 resetcount }
		ifspritepal 3 nullop else killit
		}
		
	}

enda

action ALARM_ON -2

useractor notenemy 553

ife HITAGSAVED 1
{
	ifaction 0
		{
		ifg ALARM_ACTIVE 0
			{
			action ALARM_ON
			}
		}
	else
	ifaction ALARM_ON
		{
		ife LOTAGSAVED 0 { ifactorsound THISACTOR CLAXON_ALARM nullop else sound CLAXON_ALARM }
		else { ifactorsound THISACTOR LOTAGSAVED nullop else globalsoundvar LOTAGSAVED }
		ife ALARM_ACTIVE 0
			{
			stopsoundvar LOTAGSAVED
			stopsound CLAXON_ALARM
			action 0
			}
		}
}

enda

spritenoshade 552

useractor notenemy 552

ifn HITAGSAVED 0
{
checkactivatormotion HITAGSAVED
	ifvare RETURN 1
		{
		seta[].shade -127
		cactor 551
		espawn 18427  
		ifand sprite[].cstat 8 nullop else
			{
			geta[].sectnum TEMP3
			seta[RETURN].z sector[TEMP3].ceilingz
			}
		geta[].pal TEMP4
		ife TEMP4 0 seta[RETURN].pal 2
		else seta[RETURN].pal TEMP4
		setactorvar[RETURN].myowner THISACTOR
		}
}

ifhitweapon
{
	sound GLASS_BREAKING
	lotsofglass 8
	espawn 3179
	seta[RETURN].xrepeat sprite[].xrepeat
	seta[RETURN].yrepeat sprite[].yrepeat
	seta[RETURN].cstat sprite[].cstat
	seta[RETURN].pal sprite[].pal
	killit
}

enda

// *************************************************
// TARGET RANGE SILHOUETTE
// *************************************************


useractor enemy 8088
	strength 1

ife HITAGSAVED 0
	{
	ifhitweapon
	ifaction 0
		{
		operateactivators LOTAGSAVED THISACTOR
		action ZERO
		}
	}
else
ife HITAGSAVED 1
	{
	ifaction 0
	ifhitweapon
		{
		ife sprite[].htpicnum SHOTGUN
			{
			operateactivators LOTAGSAVED THISACTOR
			action ZERO
			}
		strength 1
		}
	}
else
ife HITAGSAVED 2
	{
	ifaction 0
	 ifhitweapon
		{
		ife sprite[].htpicnum 6826
			{
			shoot SPARK
			shoot SPARK
			sound HITARMOUR
			operateactivators LOTAGSAVED THISACTOR
			action ZERO
			}
			else
			sound PROTECT_DING2
		strength 1
		}	
	}
enda

// *************************************************
// STRIP WEAPONS
// *************************************************


defstate strip_ammo_and_weapons
set GUNSAKIMBO 0
set GUNFIREMODE 0
set GUNFIREMODE_2 0
set temp_weapon 0
set silver_ammo 0
set silver_bolts 0
set explosive_shells 0
set tesla_ammo 0
set flechete_shells 0
set RIOTSHIELD 0
set magnum_shells 0
set dragon_shells 0
set micro_torpedo 0
set heat_seek_card 0
set atomic_bomb 0
set DUP_missile_ammo 0
set fortymm_grenades 0 
set fortymm_shells 0 
set fortymm_MIA_shells 0 
set fortymm_plasma 0 
set fortymm_caseless 0 
set fortymm_slug 0 
set fortymm_electro 0 
set fortymm_cryo 0
set SHOTGUNMAG 0
set SHOTGUNBOXMAG 0
set GUNMAG 0
set RIFLEMAG 0
set ALTMAG 0
set TEMP 1
set SCOPE 0
	ifspritepal 6 // hard remove
	{
	whilevarn TEMP 12
		{
		setp[].gotweapon TEMP 0
		setp[].ammo_amount TEMP 0
		add TEMP 1
		}
	ife TEMP 12 setp[].curr_weapon 0
	whilevarn TEMP 16
		{
		setarray AMMO_TYPES[TEMP] 0
		add TEMP 1
		}
	}
	else
	{
	whilevarn TEMP 12
		{
		ifspritepal 4 ife TEMP 1 nullop else
		ifand WEAPON_SPECIAL[TEMP] 256 nullop else
			{
			setp[].gotweapon TEMP 0
			setp[].ammo_amount TEMP 0
			}
		add TEMP 1
		}
	ife TEMP 12 setp[].curr_weapon 0
	whilevarn TEMP 12
		{
		ifspritepal 4 ife TEMP 1 nullop else
		ifand WEAPON_SPECIAL[TEMP] 256 nullop else
			{
			setarray AMMO_TYPES[TEMP] 0
			}
		add TEMP 1
		}
	}
ends

defstate strip_keys
set ACCESSKEY2 0
set PLUGKEY 0
set HELLGKEYS 0
set HELLGKEYSA 0
set RUNEKEYS 0
set SWIPECARDS 0
set OLDKEYS 0
set GENERIC_KEYS 0
set ABYSS_KEYS 0
set NORMAL_KEYS 0
set SW_KEYS 0
set EGYPT_KEYS 0
ends

defstate strip_inventory
set HEAT_SINKS 0
set GOT_EXPLOSIVE 0
set AIR_FILTER 0
set FIRE_SUIT 0
set JUGGERN_SUIT 0
set GAS_MASK 0
set GOT_FLIPPER 0
set JUMP_BOOTS 0
set TOOLBOX 0
set ROPE 0
set GOT_FIREWALL 0
set COGS 0
set FLOPPY_DISK 0
set P_SPIRIT_ARMOUR 0
set P_FIRE_ARMOUR 0
set EGYPT_ARTIFACTS 0
setp[].boot_amount 0
setp[].firstaid_amount 0
setp[].heat_amount 0
setp[].holoduke_amount 0
setp[].jetpack_amount 0
setp[].scuba_amount 0
setp[].steroids_amount 0
setp[].inven_icon 0
ends

useractor notenemy 3610
cstat 32768

ifaction 0
{
seta[].mdflags 16
	ife HITAGSAVED 0
	{
	ifspritepal 10
		{
		ifpdistl 1024
			{
			setp[].ammo_amount 0 0
			set temp_weapon 0
			}
		}
	else
		{
		ife CHARSELECT 1 nullop else
			{
			ifspritepal 0 { state strip_inventory state strip_keys state strip_ammo_and_weapons set give_loadout 0 } else
			ifspritepal 1 { state strip_keys state strip_inventory } else
			ifspritepal 2 state strip_ammo_and_weapons else
			ifspritepal 3
				{
				state strip_inventory state strip_ammo_and_weapons state strip_keys
				globalsound WEAPON_TAKE
				quote 228
				state PISSED_QUOTES
				palfrom 20 20 20 20
				}
			else
			ifspritepal 4 { state strip_inventory state strip_ammo_and_weapons state give_assigned_weapon } 
			else
			ifspritepal 5 state strip_keys
			else
			ifspritepal 6 { state strip_inventory state strip_keys state strip_ammo_and_weapons set give_loadout 0 } else
			ifspritepal 8 
				{ 
				state strip_inventory
				state strip_ammo_and_weapons
				ifl PHEALTH PMAXHEALTH addphealth 255
				setp[].shield_amount 0
				ife CHAR -1 set CHARSELECT 1
				addweapon 1 48
				} 
			killit
			}
		}
	}
	else
	{
		checkactivatormotion HITAGSAVED
		ife RETURN 1
		{
		ifspritepal 0 { state strip_inventory state strip_keys state strip_ammo_and_weapons } else
		ifspritepal 1 { state strip_inventory state strip_keys } else
		ifspritepal 2 state strip_ammo_and_weapons else
		ifspritepal 3
			{
			state strip_inventory state strip_keys state strip_ammo_and_weapons
			globalsound WEAPON_TAKE
			quote 228
			palfrom 20 20 20 20
			}
		killit
		}
	}
}

enda

// *************************************************
// ZIPWIRE
// *************************************************

move SLFORWARD 512 0
move SLFORWARD2 512 0
move SLSTOP 0


action SLSTATIONARY 0
action SLRESET 0
action SLMOVE 0

spritenopal 8940

useractor notenemy 8940
clipdist 128

ifaction 0 
{
cstat 16
action SLSTATIONARY
}

ifaction SLSTATIONARY
{
move SLSTOP 0 
ifpdistl 1524
 ifp pfacing
  ifp palive
  {
  set player_use 0
   ifhitspace
	{ set hit_key 30 action SLMOVE }
  }
}
  
    ifaction SLRESET
		{
		seta[].x TEMP7
		seta[].y TEMP8
		seta[].z TEMP9
		updatesectorz TEMP7 TEMP8 TEMP9 TEMP5
		seta[].sectnum TEMP5
		action SLSTATIONARY
		}
	
	ifaction SLMOVE
		{
		ifspritepal 3 move SLFORWARD2 geth getv else
		move SLFORWARD geth getv
		ifmove SLFORWARD
			{
			geta[].z TEMP2
			add TEMP2 384
			seta[].z TEMP2
			}
		else
		ifmove SLFORWARD2
			{
			geta[].z TEMP2
			add TEMP2 1024
			seta[].z TEMP2
			}
		ifp pdead { set on_tripwire 0 action SLRESET }
		else
			ifp palive
			{
			set on_tripwire 1
			geta[].z TEMP4
			updatesectorz sprite[].x sprite[].y sprite[].z TEMP5
			setp[].cursectnum TEMP5
			setp[].posx sprite[].x
			setp[].posy sprite[].y
			add TEMP4 4096
			setp[].posz TEMP4
            setp[].poszv 128
			setp[].ang sprite[].ang
			setp[].jumping_counter 0
			setp[].falling_counter 0
			setp[].hard_landing 0
			state STOPSTEPSOUNDS
			soundonce ZIPLINE
			ifnotmoving 
				{ 
				pkick 
				stopsound ZIPLINE 
				getp[].ang knockbackang
				set knockback2 8
				set on_tripwire 0
				action SLRESET 
				}
			else
			ifn sprite[].pal 9
				{
				ifand BITS_PRESS 1
					{
					pkick 
					stopsound ZIPLINE 
					getp[].ang knockbackang
					set knockback2 8
					set on_tripwire 0
					action SLRESET 
					}
				else
				ifand BITS_PRESS 2
					{
					stopsound ZIPLINE 
					set on_tripwire 0
					action SLRESET 
					}
				}
			}
		}

enda

// *************************************************
// EARTH SPRITE
// *************************************************

action EARTHNIGHT 11

useractor notenemy 8448

ifspritepal 3
	{
	ifmultiplayer break
	ifaction 0
		{
		gettimedate TEMP TEMP TEMP2 TEMP TEMP TEMP TEMP TEMP
		ifg TEMP2 19 action EARTHNIGHT else
		ifl TEMP2 6 action EARTHNIGHT else
		action ZERO
		}
	}

enda

// *************************************************
// GRANDFATHER CLOCK
// *************************************************

action NOCHIME 0
action CHIME 0


useractor notenemy 3745

ifaction 0 { cstat 32768 action NOCHIME }

ifaction CHIME
	{
	soundonce OLDCLOCK_CHIME
	stopsound OLDCLOCK_TICK
	ifcount 104 { spawn 3745 killit }
	}
else
ifaction NOCHIME
	{
	ifmultiplayer nullop else
		{
		ifn LOTAGSAVED 0
			{
			gettimedate TEMP3 TEMP2 TEMP TEMP TEMP TEMP TEMP TEMP
			ife TEMP3 0
			 ife TEMP2 0
				{ operateactivators LOTAGSAVED THISACTOR action CHIME resetcount }
			}
		}
	soundonce OLDCLOCK_TICK
	}
enda

// *************************************************
// BELL
// *************************************************

action BELLFORWARD 0 3 1FRAME 1 16 // Go forward
action BELLFSTOP 3 // Bell forward stopped
action BELLFBACK 3 3 1FRAME -1 16 // Go back from forward
action BELLMSWING 0 // Bell mid swing
action BELLBACK 0 3 1FRAME -1 16 // Go back
action BELLBSTOP -3 // Bell back stopped
action BELLBACKF -3 3 1FRAME 1 16 // Go forward from back

useractor notenemy 9630

ifaction 0 action ZERO

ifaction ZERO { ifg BELLTIME 0 action BELLFORWARD }
ifaction BELLFORWARD { ifactioncount 3 
						{ 
						sub BELLTIME 1 
						ifpdistg 32767 globalsound BIG_BELL_DIST else globalsound BIG_BELL 
						action BELLFSTOP 
						resetactioncount 
						} 
					}
ifaction BELLFSTOP { ifactioncount 8 { action BELLFBACK resetactioncount } }
ifaction BELLFBACK { ifactioncount 3 { action BELLMSWING resetactioncount } }
ifaction BELLMSWING { ifactioncount 3 { action BELLBACK resetactioncount } }
ifaction BELLBACK { ifactioncount 3 { action BELLBSTOP resetactioncount } }
ifaction BELLBSTOP { ifactioncount 8 { action BELLBACKF resetactioncount } }
ifaction BELLBACKF { ifactioncount 3 { action ZERO resetactioncount } }

enda

// *************************************************
// BIG CLOCK
// *************************************************

action CLOCK12 0
action CLOCK1N2 1
action CLOCK3 2
action CLOCK45 3
action CLOCK6 4
action CLOCK78 5
action CLOCK9 6
action CLOCK1011 7

useractor notenemy 9615
	ifmultiplayer killit
	gettimedate TEMP4 TEMP2 TEMP3 TEMP TEMP TEMP TEMP TEMP

	ifspritepal 0
		{
		ifl TEMP2 7 action CLOCK12 else
		ifl TEMP2 15 action CLOCK1N2 else
		ifl TEMP2 22 action CLOCK3 else
		ifl TEMP2 30 action CLOCK45 else
		ifl TEMP2 37 action CLOCK6 else
		ifl TEMP2 45 action CLOCK78 else
		ifl TEMP2 52 action CLOCK9 else
		ifl TEMP2 60 action CLOCK1011
		}
	
	ifspritepal 3
		{
		switch TEMP3
		case 0 case 12
		action CLOCK12 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 12 break // Noon/midnight
		case 1 case 13
		action CLOCK1N2 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 1 break // 1 o clock
		case 2 case 14
		action CLOCK1N2 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 2 break // 2 o clock		
		case 3 case 15 // 3 o clock
		action CLOCK3 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 3  break
		case 4 case 16 // 4 o clock
		action CLOCK45 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 4  break
		case 5 case 17 // 5 o clock
		action CLOCK45 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 5  break
		case 6 case 18 // 6 o clock
		action CLOCK6 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 6  break
		case 7 case 19 // 7 o clock
		action CLOCK78 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 7  break
		case 8 case 20 // 8 o clock
		action CLOCK78 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 8  break
		case 9 case 21 // 9 o clock
		action CLOCK9 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 9  break
		case 10 case 22 // 10 o clock
		action CLOCK1011 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 10  break
		case 11 case 23 // 11 o clock
		action CLOCK1011 ife TEMP2 0 ife TEMP4 0 ife BELLTIME 0 set BELLTIME 11  break
		endswitch
		}
	

enda

// *************************************************
// WEB
// *************************************************

action WEBOK 0
action WEBREAK 0 3 1 1 8
action WEBROKE 3

useractor notenemy 9585

ifaction 0 { cstator 257 action WEBOK }

ifaction WEBOK
{
ifpdistl 1024
	{
	quote 201
	set caught_in_web 26
	geta[].cstat TEMP 
	sub TEMP 257 
	seta[].cstat TEMP 
	action WEBREAK
	}
else
ifhitweapon
	{
	geta[].cstat TEMP 
	sub TEMP 257 
	seta[].cstat TEMP 
	action WEBREAK
	}
}

ifaction WEBREAK ifactioncount 3 action WEBROKE

enda

// *************************************************
// TESLA GENERATOR
// *************************************************

spritenoshade 9602
spritenoshade 9603
spritenoshade 9606

useractor notenemy 9602 // Tesla Generator

checkactivatormotion LOTAGSAVED

ife RETURN 1
ifaction 0
   {
   set GENERATOR_ACTIVE LOTAGSAVED
   operateactivators HITAGSAVED THISACTOR
   operatemasterswitches HITAGSAVED
   operaterespawns HITAGSAVED
   action ZERO
   }
   
ife LOTAGSAVED GENERATOR_ACTIVE action ZERO
	
ifaction ZERO
	{
	spritepal 0
	seta[].shade -64
	}

enda

useractor notenemy 9603 // Tesla ball

ifspritepal 3 action ZERO

ifaction ZERO
{
ifrnd 16 shoot SPARK2

ifspritepal 3
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	killit
	}
}
}

ifaction 0 
{
cstator 32768

ife LOTAGSAVED GENERATOR_ACTIVE
	{
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	action ZERO
	seta[].shade -64
	geta[].cstat TEMP
	xorvar TEMP 32768
	seta[].cstat TEMP
	}
 }
 
enda

useractor notenemy 9606 // Tesla beam

ifaction ZERO
	{
	ifpdistl 2048
		{
		getp[].posx mx
		getp[].posy my
		sub mx sprite[].x
		sub my sprite[].y
		getangle knockbackang mx my
		set knockback 3
		addphealth -2
		palfrom 30 20 0 60
		wackplayer
		soundonce THUNDERBALL_HIT
		}
	soundonce TESLA_ARC
	}

ifaction 0 
{ 
cstator 32768 

ife LOTAGSAVED GENERATOR_ACTIVE
	{
	action ZERO
	seta[].shade -64
	geta[].cstat TEMP
	xorvar TEMP 32768
	seta[].cstat TEMP
	}
}

enda

// *************************************************
// LOCKED DOOR
// *************************************************


action LOCK_DOOR_A -9

useractor notenemy 3744
cstator 1

ifaction 0 action LOCK_DOOR_A

ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 killit
		}

ifpdistl 1024
 ifp pfacing
  ifp palive
  {
  ifn HITAGSAVED 0 ifg GENERIC_KEYS 0 set player_unlock 0 else
  set player_use 0
   ifhitspace
    ifcount 26
	{
	set hit_key 30
	ifn LOTAGSAVED 0
		{
		ifspritepal 16 nullop else 
			{
			set PLAYER_VOICEOVER 4
			quote 219
			}
		ifspritepal 0 sound LOCKED_DOOR1 else
		ifspritepal 1 sound LOCKED_GATE1 else
		ifspritepal 2 sound LOCKED_DOOR2 else
		ifspritepal 3 sound LOCKED_HITECH1 else
		ifspritepal 4 sound LOCKED_DOOR3 else
		ifspritepal 5 sound LOCKED_DOOR4 else
		ifspritepal 6 sound LOCKED_HITECH2
		}
		else
	ifn HITAGSAVED 0
	 ifg GENERIC_KEYS 0
		{
		sub GENERIC_KEYS 1
		globalsound OLDKEY_UNLOCK
		operateactivators HITAGSAVED THISACTOR
		killit
		}
	else
	ifn XVELSAVED 0
		{
		quote 233
		ifspritepal 0 sound LOCKED_DOOR1 else
		ifspritepal 1 sound LOCKED_GATE1 else
		ifspritepal 2 sound LOCKED_DOOR2 else
		ifspritepal 3 sound LOCKED_HITECH1 else
		ifspritepal 4 sound LOCKED_DOOR3 else
		ifspritepal 5 sound LOCKED_DOOR4 else
		ifspritepal 6 sound LOCKED_HITECH2
		checkactivatormotion XVELSAVED
		ife RETURN 1 killit
		}
	else
		{
		ifn HITAGSAVED 0 { set PLAYER_VOICEOVER 3 set door_locked 0 set key_icon GENERICKEY } else quote 4
		set TEMP9 26
		ifspritepal 0 sound LOCKED_DOOR1 else
		ifspritepal 1 sound LOCKED_GATE1 else
		ifspritepal 2 sound LOCKED_DOOR2 else
		ifspritepal 3 sound LOCKED_HITECH1 else
		ifspritepal 4 sound LOCKED_DOOR3 else
		ifspritepal 5 sound LOCKED_DOOR4 else
		ifspritepal 6 sound LOCKED_HITECH2 else
		ifspritepal 20 { sound LOCKED_DOOR2 set INTERNALCOUNT 20 }
		}
	resetcount
	}
 }
 
 ifn INTERNALCOUNT 0
 {
 sub INTERNALCOUNT 1
 ife INTERNALCOUNT 1 soundonce PISS_OFF
 }
 
 ifg TEMP9 0
	{
	sub TEMP9 1
	 ife TEMP9 1
		set PLAYER_VOICEOVER 5
	}
	
ifn LOTAGSAVED 0
{
cstator 256
ifhitweapon
	{
	ifspritepal 16
		{
		globalsound BUST_CONCRETE
		operateactivators LOTAGSAVED THISACTOR
		killit
		}
		else
		{
		ifwasweapon KNEE
			{
			ifspritepal 16
			globalsound BUST_CONCRETE
			else
			globalsound DOOR_KICK
			operateactivators LOTAGSAVED THISACTOR
			killit
			}
			else strength 1
		}
	}
}


enda

// ------------------------------------------------------------
// FOOTPRINT IN SNOW
// ------------------------------------------------------------

defstate FOOTPRINT_SNOW
ifaction 0 
	{
	insertspriteq 
	sizeat 24 24 
	cstat 32 
	action ZERO
	}
fall 
ends

useractor notenemy SNOWPRINT1 state FOOTPRINT_SNOW enda
useractor notenemy SNOWPRINT2 state FOOTPRINT_SNOW enda

// ------------------------------------------------------------
// GLASS CRACK
// ------------------------------------------------------------

useractor notenemy 19615
ifn HITAGSAVED 0
	{
	cstat 32768
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		seta[].cstat CSTATSAVED
		globalsound HITGLASS
		globalsound SOMETHINGFROZE
		set HITAGSAVED 0
		}
	}
ifn LOTAGSAVED 0
	{
	checkactivatormotion LOTAGSAVED
	 ife RETURN 1 killit
	}
enda

// ------------------------------------------------------------
// CEILING FAN
// ------------------------------------------------------------


useractor notenemy 9682
ifand sprite[].cstat 32
ife LOTAGSAVED 0
{
ifaction 0
	{
	seta[].mdflags 16
	action ZERO
	}
ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 set HITAGSAVED 0
	}
else
	set command 256
}

enda

// ------------------------------------------------------------
// TORCH OFF
// ------------------------------------------------------------

useractor notenemy 9687
cstat 32768
killit
enda

// ------------------------------------------------------------
// GAS!
// ------------------------------------------------------------

defstate gas_stuff
ifn player_in_vehicle 1
	{
	ife FIRE_SUIT 0
		ife GAS_MASK 0
		   {
		  set ingas 10
		  soundonce CHOKING
		  getp[].posxv TEMP divvar TEMP 2 setp[].posxv TEMP divvar TEMP 2
		  getp[].posyv TEMP divvar TEMP 2 setp[].posyv TEMP divvar TEMP 2
		  switch CHAR
			  case 12
			  case 13
			  case 14
			  ifg PARMOUR 0 { getp[].shield_amount TEMP sub TEMP 1 setp[].shield_amount TEMP }
			  else addphealth -1
		  break
			  default
			  addphealth -1
		  break
		  endswitch
		  ifn player[].palette 2 setgamepalette 2
		  palfrom 40 20 20 0
		   }
		else
		  {
		  setp[].sound_pitch -256
		  ife ingas 0 { set GAS_MASK_PUTON 0 soundonce PUT_ON_EQUIP }
		  set ingas 26
		  ife FIRE_SUIT 0 set GAS_MASK 2
		  ifn player[].palette 2 setgamepalette 2
		   }
	}
ends

defstate heat_stuff
ife player_in_vehicle 0
	{
		soundonce COOKINGDEEPFRIER
		ife FIRE_SUIT 0
		   {
		  getp[].posxv TEMP divvar TEMP 2 setp[].posxv TEMP divvar TEMP 2
		  getp[].posyv TEMP divvar TEMP 2 setp[].posyv TEMP divvar TEMP 2
		  addphealth -2
		  palfrom 40 60 0 0
		   }
		else
		ife FIRE_SUIT 1 palfrom 10 60 0 0
	}
ends

useractor notenemy 7924
cstat 32768

ifaction ZERO
{
	ifn YVELSAVED 0
		{
		checkactivatormotion YVELSAVED
		ife RETURN 1 action 0
		}

}
else
ifaction 0
{
	ife ZVELSAVED 1 { action ZERO set ZVELSAVED 0 }
	ifn XVELSAVED 0
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 action ZERO
		}

	ifl EXTRASAVED 1
	{
	ifpdistl 6000
		{
		ifn ALLYSLOT1 -1 { setactorvar[ALLYSLOT1].FOLLOW_PLAYER 0 set ALLYSLOT1 -1 }
		ifn ALLYSLOT2 -1 { setactorvar[ALLYSLOT2].FOLLOW_PLAYER 0 set ALLYSLOT2 -1 }
		ifn ALLYSLOT3 -1 { setactorvar[ALLYSLOT3].FOLLOW_PLAYER 0 set ALLYSLOT3 -1 }
		ifn ALLYSLOT4 -1 { setactorvar[ALLYSLOT4].FOLLOW_PLAYER 0 set ALLYSLOT4 -1 }
		}
		ifpdistl 5000
		ifcansee
		{
		ifspritepal 0 state gas_stuff
		else ifspritepal 2 state heat_stuff
		}
	}
	else
	ife EXTRASAVED 1
	{
	getp[].i PLAYER_IDENTITY
		ife sprite[PLAYER_IDENTITY].sectnum sprite[].sectnum
		{
		ifn ALLYSLOT1 -1 { setactorvar[ALLYSLOT1].FOLLOW_PLAYER 0 set ALLYSLOT1 -1 }
		ifn ALLYSLOT2 -1 { setactorvar[ALLYSLOT2].FOLLOW_PLAYER 0 set ALLYSLOT2 -1 }
		ifn ALLYSLOT3 -1 { setactorvar[ALLYSLOT3].FOLLOW_PLAYER 0 set ALLYSLOT3 -1 }
		ifn ALLYSLOT4 -1 { setactorvar[ALLYSLOT4].FOLLOW_PLAYER 0 set ALLYSLOT4 -1 }
		ifspritepal 0 state gas_stuff
		else ifspritepal 2 state heat_stuff
		}
	}
	else
	ife EXTRASAVED 2
	{
	getp[].i PLAYER_IDENTITY

		ife sprite[PLAYER_IDENTITY].sectnum sprite[].sectnum
		 ifg player[].posz sprite[].z
		{
		ifn ALLYSLOT1 -1 { setactorvar[ALLYSLOT1].FOLLOW_PLAYER 0 set ALLYSLOT1 -1 }
		ifn ALLYSLOT2 -1 { setactorvar[ALLYSLOT2].FOLLOW_PLAYER 0 set ALLYSLOT2 -1 }
		ifn ALLYSLOT3 -1 { setactorvar[ALLYSLOT3].FOLLOW_PLAYER 0 set ALLYSLOT3 -1 }
		ifn ALLYSLOT4 -1 { setactorvar[ALLYSLOT4].FOLLOW_PLAYER 0 set ALLYSLOT4 -1 }
		ifspritepal 0 state gas_stuff
		else ifspritepal 2 state heat_stuff
		}
	}
	else
	{
	dist TEMP6 THISACTOR player[].i
	ifl TEMP6 EXTRASAVED
		{
			ifn ALLYSLOT1 -1 { setactorvar[ALLYSLOT1].FOLLOW_PLAYER 0 set ALLYSLOT1 -1 }
			ifn ALLYSLOT2 -1 { setactorvar[ALLYSLOT2].FOLLOW_PLAYER 0 set ALLYSLOT2 -1 }
			ifn ALLYSLOT3 -1 { setactorvar[ALLYSLOT3].FOLLOW_PLAYER 0 set ALLYSLOT3 -1 }
			ifn ALLYSLOT4 -1 { setactorvar[ALLYSLOT4].FOLLOW_PLAYER 0 set ALLYSLOT4 -1 }
			ifcansee
			{
			ifspritepal 0 state gas_stuff
			else ifspritepal 2 state heat_stuff
			}
		}
	}
	ifspritepal 3
	{
	ifpdistl 1024
		{
		stopsound JGASMASK
		setp[].sound_pitch 0 
		setgamepalette 0
		ifg ingas 0 sub ingas 1
		killit
		}
	}
}

enda

// ------------------------------------------------------------
// SEASONAL STUFF
// ------------------------------------------------------------

defstate XMAS_TYME
	ifaction 0
		{
		ifspritepal 3 break
		gettimedate TEMP TEMP TEMP TEMP TEMP2 TEMP TEMP TEMP
		ife TEMP2 11 action ZERO else killit
		}
ends

defstate HALOWEEN_TYME
	ifaction 0
		{
		ifspritepal 3 nullop else
			{
			gettimedate TEMP TEMP TEMP TEMP TEMP2 TEMP TEMP TEMP
			ife TEMP2 9 action ZERO else killit
			}
		}
ends

defstate AUTUMN_TYME
fall
	ifaction 0
		{
		ifspritepal 3 nullop else
			{
			gettimedate TEMP TEMP TEMP TEMP TEMP2 TEMP TEMP TEMP
			ife TEMP2 8 action ZERO else 
			ife TEMP2 9 action ZERO else 
			ife TEMP2 10 action ZERO else 
			killit
			}
		}
ends

defstate BIRTHDAYS
	ifaction 0
		{
		gettimedate TEMP TEMP TEMP TEMP3 TEMP2 TEMP TEMP TEMP
		ife TEMP2 HITAGSAVED 
			{
			ife TEMP3 LOTAGSAVED action ONE else killit
			}
		else ifvarvarn TEMP2 HITAGSAVED killit
		}
ends

useractor notenemy 4726 state XMAS_TYME enda
useractor notenemy 9697 state XMAS_TYME enda
useractor notenemy 9699 state XMAS_TYME enda
useractor notenemy 9701 state XMAS_TYME enda
useractor notenemy 9702 state XMAS_TYME enda

useractor notenemy 12514 state BIRTHDAYS enda

useractor notenemy 9703 state HALOWEEN_TYME // pumpkin

ifaction ZERO
	{
	ifrnd 16 seta[].shade 2
	else ifrnd 32 seta[].shade 3
	else ifrnd 64 seta[].shade 0
	else seta[].shade -2
	}

enda

spritenoshade 13916

useractor notenemy 13916 // fallen leaves

		 ifaction 0
			{
			randvar TEMP 64
			add TEMP 64
			seta[].xrepeat TEMP
			seta[].yrepeat TEMP
			seta[].shade sector[].floorshade
			randvar TEMP 2048
			seta[].ang TEMP
			cstat 32
			ifrnd 64 cstator 4
			ifrnd 64 cstator 8
			action ZERO
			}

state AUTUMN_TYME 
enda

// ------------------------------------------------------------
// Lift arrow
// ------------------------------------------------------------


useractor notenemy 19623
ifn LOTAGSAVED 0
	{
	checkactivatormotion LOTAGSAVED
	 ife RETURN 1 { set LOTAGSAVED 0 spritepal 8 }
	}
enda

useractor notenemy 19624
ifn LOTAGSAVED 0
	{
	checkactivatormotion LOTAGSAVED
	 ife RETURN 1 { set LOTAGSAVED 0 spritepal 8 }
	}
enda

// ------------------------------------------------------------
// INVISIBLE BANG
// ------------------------------------------------------------

useractor notenemy 10510
sizeat 2 2
cstat 32768
hitradius 1024 20 20 20 128
ifspritepal 1 soundonce BUST_CONCRETE
ifspritepal 2 soundonce BUST_METAL
ifspritepal 3 { quake 26 soundonce BUST_CONCRETE }
ifspritepal 4 { quake 26 soundonce BUST_METAL }
ifspritepal 5 quake 26
ifspritepal 6 { quake 26 globalsound SLAB_FALL }
killit
enda

// ------------------------------------------------------------
// DOCUMENTS
// ------------------------------------------------------------


defstate document_evidence

			ife DOCUMENT 7670 // Are they reading the Dis Base mission sheet?
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 2 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 2
						savegamevar EVIDENCE
						soundonce READ_DOCUMENT
						add TREASURE_FOUND 4
						quote 220
						set DOCUMENT -1				
						killit
						}
				}
			ife DOCUMENT 7671 // Are they reading the gate opening sheet?
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 64 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 64
						savegamevar EVIDENCE
						soundonce READ_DOCUMENT
						add TREASURE_FOUND 4
						quote 220
						set DOCUMENT -1
						
						killit
						}
				}
			ife DOCUMENT 9696 // Are they reading the 'For Providence' stock sheet?
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 4 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 4
						savegamevar EVIDENCE
						soundonce READ_DOCUMENT
						add TREASURE_FOUND 4
						quote 220
						set DOCUMENT -1
						
						killit
						}
				}
			ife DOCUMENT 9705 // Are they reading the 'Snow base' letter from Robinson?
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 8 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 8
						savegamevar EVIDENCE
						soundonce READ_DOCUMENT
						add TREASURE_FOUND 4
						quote 220
						set DOCUMENT -1
						
						killit
						}
				}
			ife DOCUMENT 9706 // Are they reading the 'Snow base' letter from Costanza?
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 16 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 16
						savegamevar EVIDENCE
						soundonce READ_DOCUMENT
						add TREASURE_FOUND 4
						quote 220
						set DOCUMENT -1				
						killit
						}
				}
			ifg DOCUMENT 9709 // Are they reading Lilith's diary from Providence?
			 ifl DOCUMENT 9714 
				{
				set STORY_TRIGGER1 1
				readgamevar EVIDENCE
				ifand EVIDENCE 32 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 32
						savegamevar EVIDENCE
						soundonce BOOK_CLOSE
						add TREASURE_FOUND 4
						quote 220
						set DOCUMENT -1
						set MAXPAGES 0					
						killit
						}
				}
			ife DOCUMENT 13848 // Are they reading the 'med-lab' letter from megabase?
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 128 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 128
						savegamevar EVIDENCE
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1			
						killit
						}
				}
			ife DOCUMENT 13849 // Are they reading the 'precog-lab' letter from megabase?
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 256 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 256
						savegamevar EVIDENCE
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						
						killit
						}
				}
			ifg DOCUMENT 13912 // Are they reading Dr Jekyl's diary?
			 ifl DOCUMENT 13916
				{
				readgamevar EVIDENCE
				ifand EVIDENCE 512 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE 512
						savegamevar EVIDENCE
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						
						killit
						}
				}
			
			// ======================================================
			// EPISODE 2 DOCUMENTS
			// ======================================================
		
			ife DOCUMENT 17028 // Are they reading the letter to Yeung from Cheung?
				{
				readgamevar EVIDENCE_EP2
				set GOT_PASSWORD 1
				ifand EVIDENCE_EP2 1 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 1
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
			ife DOCUMENT 17253 // Are they reading the note to Cheung about Yakuza?
				{
				readgamevar EVIDENCE_EP2
				ifand EVIDENCE_EP2 32 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 32
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
			ife DOCUMENT 17255 // Are they reading the note from Cheung to Yoshima?
				{
				readgamevar EVIDENCE_EP2
				ifand EVIDENCE_EP2 16 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 16
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
			ife DOCUMENT 18396 // Are they reading the password to the EAF file?
				{
				readgamevar EVIDENCE_EP2
				set GOT_PASSWORD 2
				ifand EVIDENCE_EP2 4 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 4
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
			ife DOCUMENT 17325 // Are they reading captain's diary
				{
				readgamevar EVIDENCE_EP2
				ifand EVIDENCE_EP2 64 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 64
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
			ife DOCUMENT 17257 // Are they reading the PC password thing 2?
				{
				readgamevar EVIDENCE_EP2
				set GOT_PASSWORD 3
				ifand EVIDENCE_EP2 128 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 128
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
			ifg DOCUMENT 18338 // Are they reading the PATCOS project info?
			ifl DOCUMENT 18342
				{
				readgamevar EVIDENCE_EP2
				ifand EVIDENCE_EP2 1024 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 1024
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
			ifg DOCUMENT 20148 // Are they reading the Zeta base beyonder file?
			ifl DOCUMENT 20154
				{
				readgamevar EVIDENCE_EP2
				ifand EVIDENCE_EP2 2048 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP2 2048
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
				
			// ======================================================
			// EPISODE 3 DOCUMENTS
			// ======================================================
			ife DOCUMENT 23737 // Are they reading the Gorrilla diary?
				{
				readgamevar EVIDENCE_EP3
				ifand EVIDENCE_EP3 1 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP3 1
						savegamevar EVIDENCE_EP3
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
				
			ife DOCUMENT 23801 // Are they reading the substance 34 report?
				{
				readgamevar EVIDENCE_EP3
				ifand EVIDENCE_EP3 8 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP3 8
						savegamevar EVIDENCE_EP3
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
	
			ife DOCUMENT 23804 // Are they reading the Shrinker theory?
				{
				readgamevar EVIDENCE_EP3
				ifand EVIDENCE_EP3 16 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP3 16
						savegamevar EVIDENCE_EP3
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
				
			ife DOCUMENT 23805 // Are they reading the SMART suit info?
				{
				readgamevar EVIDENCE_EP3
				ifand EVIDENCE_EP3 32 set DOCUMENT -1
					else
						{
						xorvar EVIDENCE_EP3 32
						savegamevar EVIDENCE_EP3
						add TREASURE_FOUND 4
						soundonce READ_DOCUMENT
						quote 220
						set DOCUMENT -1
						killit
						}
				}
				
ends

action DOC_SHEET -5300
action DOC_CLIPBOARD -210
action DOC_BOOK -1708

useractor notenemy 9695
ifaction 0
{
set TEMP9 0
ifspritepal 1
	{
	spritepal 0
	action DOC_SHEET
	}
else
ifspritepal 2
	{
	spritepal 0
	action DOC_CLIPBOARD
	}
else
ifspritepal 3
	{
	spritepal 0
	action DOC_BOOK
	}
else
	{
	action ZERO
	cstat 32768
	}
}

ife TEMP9 0
{
ifpdistl 2048
	ifrnd 8 spawn GLINT 
	else
ifrnd 4 spawn GLINT
}

ifpdistl 1024
{
ifn DOCUMENT -1
	{
	ifcount 13
	ifhitspace
		{
		ifaction DOC_BOOK soundonce BOOK_CLOSE
		else ifspritepal 5 soundonce BOOK_CLOSE
		state document_evidence
		set DOCUMENT -1
		set MAXPAGES 0
		set PAGETURNSOUND 0
		set TEMP9 1
		resetcount
		}
	}
else
 ifp pfacing
  ifcansee
  ife DOCUMENT -1
  {
   set player_use 0
   ifcount 13
   ifhitspace
		{
		set hit_key 30
		set TEMP9 1
		ifaction DOC_BOOK soundonce BOOK_OPEN 
		else ifspritepal 5 soundonce BOOK_OPEN
		else ifn LOTAGSAVED 0 soundoncevar LOTAGSAVED 
		else soundonce READ_DOCUMENT
		set DOCUMENT HITAGSAVED
		ife EXTRASAVED -1 set MAXPAGES 0
		ifg EXTRASAVED 0 { set MAXPAGES EXTRASAVED set PAGENUMBER 0 }
		ifaction DOC_BOOK set PAGETURNSOUND 1199 else
		set PAGETURNSOUND XVELSAVED
		lockplayer 13
		resetcount
		}
   }
}
enda

// ------------------------------------------------------------
// LIGHT
// ------------------------------------------------------------

action NULLL 0

useractor notenemy 5792
ifspritepal 3 break

ife DAYNIGHT 1 killit
else ife DAYNIGHT 3 killit

ifaction 0
{
geta[].pal TEMP
randvar TEMP2 10
ifl TEMP2 5 action ZERO else spritepal 4
}

ifaction ZERO
{
ifcount 520
	{
	ifrnd 6 cstat 32768 else seta[].pal TEMP
	resetcount
	}
}

enda

// ------------------------------------------------------------
// EVIDENCE FOR PROVIDENCE
// ------------------------------------------------------------

useractor notenemy 9666

ifpdistl 1024
 ifp pfacing
  ifcansee
  {
  readgamevar EVIDENCE
  ifand EVIDENCE 1 break
   set player_use 0
   ifhitspace
	    {
		set hit_key 30
		xorvar EVIDENCE 1
		add TREASURE_FOUND 4
		soundonce READ_DOCUMENT
		savegamevar EVIDENCE
		quote 220
		killit
		}
   }


enda

// *************************************************
// AUTOSAVE
// *************************************************

useractor notenemy 9412
cstat 32768

ife userdef[].autosave 1
{
ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		set saving AUTOSAVE_START
		killit
		}
	}
else
	ifpdistl 1024
	{
	set saving AUTOSAVE_START
	killit
	}
}

enda

// *************************************************
// NIGHT
// *************************************************

useractor notenemy 3821
cstat 32768
ifmultiplayer killit
ife DAYNIGHT 0
	{
	gettimedate TEMP TEMP TEMP2 TEMP TEMP3 TEMP TEMP TEMP
		ifg TEMP3 9 // if it's near winter, become darker 'earlier'
			{
			ifg TEMP2 15 set DAYNIGHT 2 else
			ifg TEMP2 13 set DAYNIGHT 3 else
			ifl TEMP2 6 set DAYNIGHT 2 else
			ifl TEMP2 9 set DAYNIGHT 4 else
			set DAYNIGHT 1 
			}
			else
			{
			ifg TEMP2 19 set DAYNIGHT 2 else // Night
			ifg TEMP2 17 set DAYNIGHT 3 else // Evening
			ifl TEMP2 5 set DAYNIGHT 2 else // Early morning
			ifl TEMP2 8 set DAYNIGHT 4 else // Morning
			set DAYNIGHT 1  // Daytime
			}
	}

ifspritepal 0
{
		set TEMP 0
		whilevarvarn TEMP NUMSECTORS
		{
  		ifand sector[TEMP].ceilingstat 1
  			{
				ifn sector[TEMP].ceilingpicnum 179
				{
				ife DAYNIGHT 1 
					{				
					ife TEMP3 11 sets[TEMP].ceilingpicnum 13260 else
						{
						sets[TEMP].ceilingpicnum 94
						sets[TEMP].ceilingpal 1
						}
					}
				ife DAYNIGHT 2 sets[TEMP].ceilingpicnum 95
				ife DAYNIGHT 3 sets[TEMP].ceilingpicnum 99
				ife DAYNIGHT 4 sets[TEMP].ceilingpicnum 94
				}
			ife sector[TEMP].visibility 0 
				{
				ife DAYNIGHT 1 
					{
					ife TEMP3 11 sets[TEMP].visibility 244 else
					sets[TEMP].visibility 240
					}
				ife DAYNIGHT 2 sets[TEMP].visibility 0
				ife DAYNIGHT 3 sets[TEMP].visibility 244
				ife DAYNIGHT 4 sets[TEMP].visibility 244
				}
  			}
  		add TEMP 1
		}
		killit
}
else
ifspritepal 1
{
ife DAYNIGHT 2 killit else
ifn DAYNIGHT 2
	{
	geta[].ang TEMP3

	sin my TEMP3
	cos mx TEMP3

	hitscan sprite[].x sprite[].y sprite[].z sprite[].sectnum mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280

	ifn hitwall -1
		{
		setwall[hitwall].picnum HITAGSAVED
		ife LOTAGSAVED 0
			{
			setwall[hitwall].xrepeat 32
			setwall[hitwall].yrepeat 32
			}
		setwall[hitwall].shade sprite[].shade
		}
		
	killit
	}
}
else
ifspritepal 2
{
ife DAYNIGHT 2 killit else
ifn DAYNIGHT 2
	{
	geta[].ang TEMP3

	sin my TEMP3
	cos mx TEMP3

	hitscan sprite[].x sprite[].y sprite[].z sprite[].sectnum mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280

	ifn hitwall -1
		{
		setwall[hitwall].picnum HITAGSAVED
		ife LOTAGSAVED 0
			{
			setwall[hitwall].xrepeat 128
			setwall[hitwall].yrepeat 128
			}
		setwall[hitwall].shade sprite[].shade
		}
		
	killit
	}
}
else
ifspritepal 3 // AMC Base
{
set AMC_BASE 1
ifaction 0
	{
	gettimedate TEMP TEMP TEMP2 TEMP TEMP3 TEMP TEMP TEMP
	ife TEMP3 11 action ZERO
	else ife TEMP3 1 action ZERO
	else ife TEMP3 2 action ZERO
	else
		{
		readgamevar randomstart
		ifrnd 2
			{
			set rainpal 13
			set raincstat 514
			set rainstart 16
			set raining 16
			set rainradius 12000
			set RAINREPLACE 1
			set TEMP9 1
			}
		action ZERO
		}
	}

gettimedate TEMP TEMP TEMP2 TEMP TEMP3 TEMP TEMP TEMP
		set TEMP 0
		whilevarvarn TEMP NUMSECTORS
		{
			ifand sector[TEMP].ceilingstat 1
				{
					ife sector[TEMP].ceilingpicnum 95
					{
					ife DAYNIGHT 1 
						{
						ife TEMP3 11 sets[TEMP].ceilingpicnum 13260 // December?
						else ife TEMP3 0 sets[TEMP].ceilingpicnum 13260 // January?
						else ife TEMP3 1 sets[TEMP].ceilingpicnum 13260 // Febuary?
						else 
							{
							ife TEMP9 1 sets[TEMP].ceilingpicnum 79
							else 
								{
								sets[TEMP].ceilingpal 1
								sets[TEMP].ceilingpicnum 94 // Default
								}
							}
						}
					ife DAYNIGHT 2 
						{
						ife TEMP3 11 sets[TEMP].ceilingpicnum 78 // December?
						else ife TEMP3 0 sets[TEMP].ceilingpicnum 78 // January?
						else ife TEMP3 1 sets[TEMP].ceilingpicnum 78 // Febuary?
						else sets[TEMP].ceilingpicnum 95 // Default
						}
					ife DAYNIGHT 3 sets[TEMP].ceilingpicnum 99
					ife DAYNIGHT 4 sets[TEMP].ceilingpicnum 94
					}
				ife sector[TEMP].visibility 0 
					{
					ife DAYNIGHT 1 
						{
						ife TEMP3 11 sets[TEMP].visibility 244 // December?
						else ife TEMP3 0 sets[TEMP].visibility 244 // January?
						else ife TEMP3 1 sets[TEMP].visibility 244 // Febuary?
						else sets[TEMP].visibility 240
						}
					ife DAYNIGHT 2 sets[TEMP].visibility 0
					ife DAYNIGHT 3 sets[TEMP].visibility 244
					ife DAYNIGHT 4 sets[TEMP].visibility 244
					}
				}
  		add TEMP 1
		}
		killit
}
else
ifspritepal 6 // AMC Base
{
set AMC_BASE 2
ifaction 0
	{
	gettimedate TEMP TEMP TEMP2 TEMP TEMP3 TEMP TEMP TEMP
	ife TEMP3 11 action ZERO
	else ife TEMP3 1 action ZERO
	else ife TEMP3 2 action ZERO
	else
		{
		readgamevar randomstart
		ifrnd 96 
			{
			set rainpal 13
			set raincstat 514
			set rainstart 16
			set raining 16
			set rainradius 12000
			set RAINREPLACE 1
			set TEMP9 1
			}
		action ZERO
		}
	}

gettimedate TEMP TEMP TEMP2 TEMP TEMP3 TEMP TEMP TEMP
		set TEMP 0
		whilevarvarn TEMP NUMSECTORS
		{
			ifand sector[TEMP].ceilingstat 1
				{
					ife sector[TEMP].ceilingpicnum 95
					{
					ife DAYNIGHT 1 
						{
						ife TEMP3 11 sets[TEMP].ceilingpicnum 13260 // December?
						else ife TEMP3 0 sets[TEMP].ceilingpicnum 13260 // January?
						else ife TEMP3 1 sets[TEMP].ceilingpicnum 13260 // Febuary?
						else 
							{
							ife TEMP9 1 sets[TEMP].ceilingpicnum 79
							else 
								{
								sets[TEMP].ceilingpal 1
								sets[TEMP].ceilingpicnum 94 // Default
								}
							}
						}
					ife DAYNIGHT 2 
						{
						ife TEMP3 11 sets[TEMP].ceilingpicnum 78 // December?
						else ife TEMP3 0 sets[TEMP].ceilingpicnum 78 // January?
						else ife TEMP3 1 sets[TEMP].ceilingpicnum 78 // Febuary?
						else sets[TEMP].ceilingpicnum 95 // Default
						}
					ife DAYNIGHT 3 sets[TEMP].ceilingpicnum 99
					ife DAYNIGHT 4 sets[TEMP].ceilingpicnum 94
					}
				ife sector[TEMP].visibility 0 
					{
					ife DAYNIGHT 1 
						{
						ife TEMP3 11 sets[TEMP].visibility 244 // December?
						else ife TEMP3 0 sets[TEMP].visibility 244 // January?
						else ife TEMP3 1 sets[TEMP].visibility 244 // Febuary?
						else sets[TEMP].visibility 240
						}
					ife DAYNIGHT 2 sets[TEMP].visibility 0
					ife DAYNIGHT 3 sets[TEMP].visibility 244
					ife DAYNIGHT 4 sets[TEMP].visibility 244
					}
				}
  		add TEMP 1
		}
		killit
}
else
ifspritepal 8
	{
	geta[].sectnum TEMP
	ife DAYNIGHT 1 
		{
		ife TEMP3 11 sets[TEMP].visibility 244 // December?
		else ife TEMP3 0 sets[TEMP].visibility 244 // January?
		else ife TEMP3 1 sets[TEMP].visibility 244 // Febuary?
		else sets[TEMP].visibility 240
		}
	ife DAYNIGHT 2 sets[TEMP].visibility 0
	ife DAYNIGHT 3 sets[TEMP].visibility 244
	ife DAYNIGHT 4 sets[TEMP].visibility 244
	killit
	}
else ifspritepal 10 // SHOOTING RANGE
	{
	ifpdistl 6096 ifcansee 
	 ife AMC_BASE 1
		{
		set HIDE_CROSSHAIR 0
		set AMC_BASE 0
		}
		else
	ifpdistg 6095
		ife AMC_BASE 0
		{
		set HIDE_CROSSHAIR 1
		set AMC_BASE 1
		}
	}

enda

// ====================================================================================
// SEASON CHANGER
// ====================================================================================

useractor notenemy 13559
cstat 32768

	ifspritepal 3 // changes floor to snow if it's winter
	{
		gettimedate TEMP TEMP TEMP TEMP TEMP2 TEMP TEMP TEMP
		ife TEMP2 11 sets[].floorpicnum 9704
		ife TEMP2 0 sets[].floorpicnum 9704
		ife TEMP2 1 sets[].floorpicnum 9704
		killit
	}
	else
	ifspritepal 4 // changes floor to leaves if it's autumn
	{
		gettimedate TEMP TEMP TEMP TEMP TEMP2 TEMP TEMP TEMP
		ife TEMP2 8 sets[].floorpicnum 13917
		ife TEMP2 9 sets[].floorpicnum 13917
		ife TEMP2 10 sets[].floorpicnum 13917
		killit
	}
	else
	ifspritepal 5 // sets weather to cold and snowy if it's Winter, or just cold if Autumn
	{
		gettimedate TEMP TEMP TEMP TEMP TEMP2 TEMP TEMP TEMP
		ife TEMP2 8 // September?
			{
			set weather_type 1
			}	
			else
		ife TEMP2 9 // October?
			{
			set weather_type 1
			}	
			else
		ife TEMP2 10 // November?
			{
			set weather_type 1
			}	
			else
		ife TEMP2 11 // December?
			{
			set RAINREPLACE 0
			set weather_type 1
			set rainstart -8
			set raining -8
			set rainradius 12000
			set snowceiling 65536
			set ceiltext -1 
			}	
			else
		ife TEMP2 0 // January?
			{
			set RAINREPLACE 0
			set weather_type 1
			set rainstart -8
			set raining -8
			set rainradius 12000
			set snowceiling 65536
			set ceiltext -1 
			}	
			else
		ife TEMP2 1 // Feburary?
			{
			set RAINREPLACE 0
			set weather_type 1
			set rainstart -8
			set raining -8
			set rainradius 12000
			set snowceiling 65536
			set ceiltext -1 
			}				
			
			else killit
	}

enda

//
// ------------------------------------------------------------
// ABYSS FORMING PATH
// ------------------------------------------------------------
//

useractor notenemy 8444

ifaction 0
{
ifspritepal 3 break
sizeat 1 1
cstat 32768
spawn 10353
ifn HITAGSAVED 0 action BREAK
else action ZERO
}

ifaction BREAK
{
sleeptime 0
checkactivatormotion HITAGSAVED
ife RETURN 1 action ZERO
}
else
ifaction ZERO
{
ifpdistl 3072
	{	
	seta[].cstat TEMP4
	action FORM
	}
}
else
ifaction FORM
{
geta[].ang TEMP3
add TEMP3 256
seta[].ang TEMP3
geta[].xrepeat TEMP2
add TEMP2 2
seta[].xrepeat TEMP2
seta[].yrepeat TEMP2
ifg TEMP2 24
	{
	sizeat 24 24
	seta[].ang TEMP8
	ifspritepal 6 sound RETRO_DOOR else
	sound ROCK_IMPACT
	action FORMED
	}
}
else
ifaction FORMED
{
move 0
ifpdistg 3071
	{
	action UNFORM
	}
}
else
ifaction UNFORM
{
geta[].ang TEMP3
sub TEMP3 256
seta[].ang TEMP3
sizeto 1 1
ife sprite[].xrepeat 1
	{
	seta[].ang TEMP8
	cstat 32768
	spawn GUNSMOKE
	action ZERO
	}
}
enda

//
// ------------------------------------------------------------
// EGYPT FORMING PATH
// ------------------------------------------------------------
//

useractor notenemy 23784

ifaction 0
{
ifspritepal 3 break
sizeat 1 1
cstat 32768
seta[].blend 255
spawn 10353
ifn HITAGSAVED 0 action BREAK
else action ZERO
}

ifaction BREAK
{
sleeptime 0
checkactivatormotion HITAGSAVED
ife RETURN 1 action ZERO
}
else
ifaction ZERO
{
ifpdistl 3072
	{	
	seta[].cstat 35
	action FORM
	}
}
else
ifaction FORM
{
geta[].ang TEMP3
add TEMP3 256
seta[].ang TEMP3
geta[].xrepeat TEMP2
add TEMP2 2
seta[].xrepeat TEMP2
seta[].yrepeat TEMP2
ifg TEMP2 24
	{
	sizeat 24 24
	seta[].ang TEMP8
	sound SANG_SHIELD_UP
	action FORMED
	}
}
else
ifaction FORMED
{
move 0
ifpdistg 3071
	{
	action UNFORM
	}
}
else
ifaction UNFORM
{
geta[].ang TEMP3
sub TEMP3 256
seta[].ang TEMP3
sizeto 1 1
ife sprite[].xrepeat 1
	{
	seta[].ang TEMP8
	cstat 32768
	action ZERO
	}
}
enda

//
// ------------------------------------------------------------
// DAMAGED WIRE
// ------------------------------------------------------------
//

defstate shorted_stuff

ifaction 0
 ifrnd 8
  ifcansee
	{
	action ONE
	shoot SPARK shoot SPARK shoot SPARK
	espawn 8433
	seta[RETURN].pal 1
	sound SHORT_CIRCUIT
	resetcount
	}
	
ifaction ONE
 ifcount 4
	{
	action 0
	resetcount
	}

ends

useractor notenemy 4430 state shorted_stuff enda
useractor notenemy 4433 state shorted_stuff enda
useractor notenemy 4480 state shorted_stuff enda


//
// ------------------------------------------------------------
// ZAX BOSS
// ------------------------------------------------------------
//

useractor notenemy 5460

ife LOTAGSAVED 1 
{
	ifaction 0
	{
	cstat 257
	strength 1
	action ONE
	}

	ifaction ONE
	{
	ifhitweapon
		{
		spawn EXPLOSION2
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		spawn 8433
		hitradius 2048 60 70 80 90
		quake 26
		globalsound LASERTRIP_EXPLODE
		ifn HITAGSAVED 0
			{
			operateactivators HITAGSAVED THISACTOR 
			operaterespawns HITAGSAVED 
			operatemasterswitches HITAGSAVED
			}
		killit
		}
	}
}
else
{
	ifaction 0
	{
	cstator 257
	ifspritepal 3 strength 1600 else
	strength 600
	action ONE
	}

	ifaction ONE
	{
	ifspritepal 3 nullop else
		{
		ifcansee
		ifcanseetarget
		 set CURBOSS THISACTOR
		
		
		ifhitweapon palfrom 20 20 0 20
		}
	ifdead killit
	 
	}
}

enda

//
// ------------------------------------------------------------
// NET
// ------------------------------------------------------------
//

action NETOPENUP 0 4 1 1 15
action NETOPEN 3

move NETFLY 248

spriteshadow 10298

useractor notenemy 10298 // NET FLY

ifaction 0
{
sizeat 32 32
move NETFLY geth
geta[].z TEMP
sub TEMP 4098
seta[].z TEMP
action NETOPENUP
}

ifaction NETOPENUP
{
ifactioncount 3 { action NETOPEN resetcount }
}

ifaction NETOPEN
{
ifnotmoving { sound ROPE_CLIMB sound METALCLINK killit }
else
ifcount 24 { fall iffloordistl 4 { spawn 10301 killit } }
}

ifpdistl 898
{
sound ROPE_CLIMB
sound METALCLINK
wackplayer
ife SKILL_LEVEL 1 set caught_in_net 30 else
ife SKILL_LEVEL 2 set caught_in_net 50 else
ife SKILL_LEVEL 3 set caught_in_net 60 else
ife SKILL_LEVEL 4 set caught_in_net 70
killit
}

enda

useractor notenemy 10301 // NET ON FLOOR
fall

ifaction 0
	{
	cstat 32
	sizeat 32 32
	move 0
	resetcount
	action ZERO
	}
	
ifcount 256 killit
enda

//
// ------------------------------------------------------------
// SCANNER DATA
// ------------------------------------------------------------
//

useractor notenemy 10330 cstat 32768 set SCAN_MODULE 1 killit enda

defstate scan_info_blips

ife MISSIONUP 1 
 ife MISSIONPOS 100 
  ife MISSIONSCREEN 5
   ifp pfacing
   { 
   ife TEMP3 0 
	{ 
	add CREDITS 2
	set TEMP3 1
	ifactor 10352
		{
		ifn LOTAGSAVED 0
				{
				ife LOTAGSAVED 5 // Charon mission?
					{
					readgamevar EVIDENCE_EP3
					ifand EVIDENCE_EP3 4 nullop
					else
						{
						xorvar EVIDENCE_EP3 4
						savegamevar EVIDENCE_EP3
						globalsound PROMOTION
						palfrom 16 64 64 64
						quote 289
						killit
						}
					}
				else
					{
					readgamevar FOUND_ADS
					ifvarvarand FOUND_ADS LOTAGSAVED nullop
						else
							{
							soundonce RESEARCH_DATA
							xorvarvar FOUND_ADS LOTAGSAVED
							savegamevar FOUND_ADS
							ife LOTAGSAVED 1 quote 284 // MDF Plasma gun?
                                                        else quote 135
							ife LOTAGSAVED 2 // acupressure melee research?
								{
								readarrayfromfile MELEE_RESEARCH 4020
								ife MELEE_RESEARCH[3] 0
									{
									set DISP_RES -240
									set DISP_RES_PAL 22
									set DISP_RES_PIC 13344
									setarray MELEE_RESEARCH[3] 1
									writearraytofile MELEE_RESEARCH 4020
									}
								}
							ife LOTAGSAVED 4 // scuba research?
								{
								readarrayfromfile PERSONEL_RESEARCH 4002
								ife PERSONEL_RESEARCH[17] 0
									{
									set DISP_RES -240
									set DISP_RES_PAL 1
									set DISP_RES_PIC 22500
									setarray PERSONEL_RESEARCH[17] 1
									writearraytofile PERSONEL_RESEARCH 4002
									}
								}
							}
					}
				}
		}
	}
   sizeto 16 16
   cstat 1152
   ifaction 0 { soundonce PU_PICKUP action ZERO }
   } 
   else 
   { 
   action 0
   sizeat 2 2 
   cstat 32768 
   }

  
ends

useractor notenemy 10334 state scan_info_blips enda
useractor notenemy 10335 state scan_info_blips enda
useractor notenemy 10336 state scan_info_blips enda
useractor notenemy 10337 state scan_info_blips enda
useractor notenemy 10338 state scan_info_blips enda
useractor notenemy 10339 state scan_info_blips enda
useractor notenemy 10340 state scan_info_blips enda
useractor notenemy 10341 state scan_info_blips enda
useractor notenemy 10342 state scan_info_blips enda
useractor notenemy 10343 state scan_info_blips enda
useractor notenemy 10344 state scan_info_blips enda
useractor notenemy 10345 state scan_info_blips enda
useractor notenemy 10346 state scan_info_blips enda
useractor notenemy 10347 state scan_info_blips enda
useractor notenemy 10348 state scan_info_blips enda
useractor notenemy 10349 state scan_info_blips enda
useractor notenemy 10350 state scan_info_blips enda
useractor notenemy 10351 state scan_info_blips enda
useractor notenemy 10353 state scan_info_blips enda
useractor notenemy 10354 state scan_info_blips enda
useractor notenemy 10359 state scan_info_blips enda
useractor notenemy 10360 state scan_info_blips enda
useractor notenemy 10361 state scan_info_blips enda
useractor notenemy 10362 state scan_info_blips enda
useractor notenemy 10352 state scan_info_blips enda

//
// ------------------------------------------------------------
// POSTERS
// ------------------------------------------------------------
//

useractor notenemy 7038

ifaction 0
	{
	seta[].blend 255
	espawn 10352
	set TEMP3 sprite[].x
	add TEMP3 64
	geta[].ang TEMP4
	add TEMP4 512
	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
	seta[RETURN].x TEMP5
	seta[RETURN].y TEMP6
	setactorvar[RETURN].LOTAGSAVED 1
	action ZERO
	}

enda

useractor notenemy 17133

ifaction 0
	{
	seta[].blend 255
	espawn 10352
	set TEMP3 sprite[].x
	add TEMP3 64
	geta[].ang TEMP4
	add TEMP4 512
	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
	seta[RETURN].x TEMP5
	seta[RETURN].y TEMP6
	setactorvar[RETURN].LOTAGSAVED 2
	action ZERO
	}

enda

useractor notenemy 22495 // Scuba research

ifaction 0
	{
	seta[].blend 255
	espawn 10352
	set TEMP3 sprite[].x
	add TEMP3 64
	geta[].ang TEMP4
	add TEMP4 512
	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
	seta[RETURN].x TEMP5
	seta[RETURN].y TEMP6
	setactorvar[RETURN].LOTAGSAVED 4
	action ZERO
	}

enda

//
// ------------------------------------------------------------
// DOOR LIFT
// ------------------------------------------------------------
//

useractor notenemy DOOR_LIFT
cstat 32768

ifaction 0
{
ifg TEMP9 0 sub TEMP9 1
ifpdistl 768
 ifp pfacing
	switch CHAR
	case 0
	case 1
	case 2
	case 7
	case 12
    ife SPRINTING 100
	ife TEMP9 0
	{
	set player_use 0
	ifhitspace
		{
		ifp pducking
			{
			set hit_key 30
			action ZERO
			operateactivators HITAGSAVED THISACTOR 
			operaterespawns HITAGSAVED 
			operatemasterswitches HITAGSAVED
			ife CHAR 0 soundonce JSTRUGGLE
			setp[].movement_lock 15
			resetcount
			}
		else quote 246
		}
	}
	break
	default
	break
	endswitch
}

ifaction ZERO
{
add TEMP9 1 // This is the counter
setp[].weapon_pos 10
ife CHAR 0 soundonce JSTRUGGLE
ifrnd 6 wackplayer

set player_use 0
sub SPRINTING 2
	ife player_hitspace 1 
		{ 
		set hit_key 30
		randvar TEMP 7
		add TEMP 2
		sub TEMP SKILL_LEVEL
		ifp pboosted add SPRINTING 20 else add SPRINTING TEMP 
		set player_hitspace 2 
		ifrnd 128 setp[].rotscrnang -16 else setp[].rotscrnang 16
		}

ifl SPRINTING 0 // If the player runs out of strength...
	{
	stopsound JSTRUGGLE
	ife CHAR 0 sound JGASP2
	wackplayer
	setp[].movement_lock 0
	operateactivators HITAGSAVED THISACTOR 
	operaterespawns HITAGSAVED 
	operatemasterswitches HITAGSAVED
	action 0
	}
else
ifg TEMP9 LOTAGSAVED // Otherwise, success!
	{
	setp[].movement_lock 0
	killit
	}
}


enda

//
// ------------------------------------------------------------
// SANG BLOOD SIGIL
// ------------------------------------------------------------
//

action SIGIL_UNLOCK 0
action SIGIL_OPEN 0

useractor notenemy 9433

ifaction 0
{
seta[].blend 255
geta[].shade TEMP
ifl TEMP 15 ifcount 1 { add TEMP 1 seta[].shade TEMP resetcount }
spritepal 5
ifpdistl 1024
 ifp pfacing
  ife CHAR 4
	{
	action ZERO
	}
}

ifaction ZERO
{
spritepal 0
geta[].shade TEMP
ifg TEMP -15 ifcount 3 { sub TEMP 1 seta[].shade TEMP resetcount }
ifpdistg 1024 action 0
 else
  ifp pfacing
  {
  set player_use 0
   ifhitspace
	{
	ifl PHEALTH 20 set PLAYER_VOICEOVER 14
	else
		{
		set hit_key 30
		globalsound CULTIST_HAUNT
		action SIGIL_UNLOCK
		setp[].movement_lock 15
		resetcount
		}
	}
  }
}

ifaction SIGIL_UNLOCK
{
palfrom 20 40 0 0
setp[].weapon_pos 10
ifcount 26
	{
	addphealth -20
	soundonce HEART_LEECHF
	soundonce SHURT2
	wackplayer
	action SIGIL_OPEN
	setp[].movement_lock 0
	}
}

ifaction SIGIL_OPEN
{
geta[].shade TEMP
ifl TEMP 25 ifcount 1 { add TEMP 1 seta[].shade TEMP resetcount }
ife TEMP 25 { operateactivators HITAGSAVED THISACTOR operaterespawns HITAGSAVED operatemasterswitches HITAGSAVED killit }
}

enda

//
// ------------------------------------------------------------
// WOOD BOARDS
// ------------------------------------------------------------
//

action WBROKE 0

defstate WOOD_BOARD_STUFF
ifspritepal 5 { ifaction 0 {  action WBROKE strength 0 set TEMP4 0 spritepal 3 } }
ifspritepal 3
{
ifaction 0 { action ZERO strength 500 cstat 273 set TEMP4 1 }


ifaction ZERO 
{
cstat 273

ifcount 13
	{
	findnearactor3d SHOOTME3 1024 TEMP
	ifn TEMP -1
		{
		sound ZOMBIE_BATTER
		geta[].extra TEMP2
		sub TEMP2 3
		ifl TEMP2 0
			{
			set TEMP4 0
			sound WOODBREAK
			shoot WOODSCRAP
			shoot WOODSCRAP
			shoot WOODSCRAP
			shoot WOODSCRAP
			shoot WOODSCRAP
			action WBROKE
			break
			}
		seta[].extra TEMP2
		}
	resetcount
	}
}


ifhitweapon
ife TEMP4 1
{
ifstrength 0
	{
	set TEMP4 0
	sound WOODBREAK
	shoot WOODSCRAP
	shoot WOODSCRAP
	shoot WOODSCRAP
	shoot WOODSCRAP
	shoot WOODSCRAP
	action WBROKE
	}
}


ifaction WBROKE
{
cstat 32768
ife TEMP4 2
	{
	strength 500
	action ZERO
	set TEMP4 1
	}
}

}
ends

useractor notenemy 3906 state WOOD_BOARD_STUFF enda
useractor notenemy 8172 state WOOD_BOARD_STUFF enda
useractor notenemy 10646 state WOOD_BOARD_STUFF enda
useractor notenemy 12429 state WOOD_BOARD_STUFF enda

//
// ------------------------------------------------------------
// WOODEN BOARDS TO REBUILD
// ------------------------------------------------------------
//

spriteshadow 10578

defstate rebuild_board
ifn TEMP -1
{
getactorvar[TEMP].TEMP4 TEMP2
ife TEMP2 0
	{
	setactorvar[TEMP].TEMP4 2
	quote 238
	set PLAYER_VOICEOVER 11
	soundonce COFFIN_KNOCK
	ifmultiplayer
		{
		qgetsysstr 356 STR_PLAYERNAME
		qstrcat 356 551
		userquote 356
		}
	killit
	}
}
ends

useractor notenemy 10578 
fall
sizeat 16 16
cstator 257

ifaction 0 action ZERO

ifaction ZERO cstat 257

ifpdistl 1024
 ifp pfacing
  ifp palive
  ifaction ZERO
  {
  set player_use 0
   ifhitspace
    ifcount 13
	{
	set hit_key 30
	set PLAYER_VOICEOVER 2
	sound LANDWOOD
	action OK
	resetcount
	}
  }

ifaction OK
	{
	ifp pstanding
		{
		findnearactor3d 8172 1024 TEMP state rebuild_board
		findnearactor3d 3906 1024 TEMP state rebuild_board
		findnearactor3d 10646 1024 TEMP state rebuild_board
		}
	cstat 256
	setp[].runspeed 45200
	set TEMP3 player[].posx
	add TEMP3 512
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6

	updatesector TEMP5 TEMP6 TEMP7
	ife TEMP7 -1 action ZERO else
	{
	seta[].x TEMP5 
	seta[].y TEMP6
	}
	getp[].posz TEMP
	add TEMP 5600
	seta[].z TEMP
	setp[].weapon_pos 10

	ifhitspace
	 ifcount 13
		{
			sound LANDWOOD
			setp[].runspeed RUNNINGSPEED
			action ZERO
		resetcount
		}

	ifpdistg 1024 { sound LANDWOOD setp[].runspeed RUNNINGSPEED action ZERO }

	}

enda

//
// ------------------------------------------------------------
// LIVES SYSTEM (DEPRECATED)
// ------------------------------------------------------------
//

useractor notenemy 10716
cstat 32768
enda

//
// ------------------------------------------------------------
// ALLY MEDIKIT
// ------------------------------------------------------------
//

spriteshadow ALLY_MEDIKIT

useractor notenemy ALLY_MEDIKIT 
fall
sizeat 14 14


ifaction 0 action ZERO

ifaction ZERO
{
 cstat 257

ifpdistl 1024
 ifp pfacing
  ifp palive
  {
  set player_use 0
   ifhitspace
    ifcount 13
	{
	set hit_key 30
	getp[].i TEMP7
	geta[TEMP7].yvel TEMP9
	sound ENDSEQVOL2SND1
	action OK
	resetcount
	}
  }
 }

ifaction OK
	{
	findnearspritez SHOOTME2 512 16384 target
		ifn target -1
			{
			getactorvar[target].myowner TEMP6
			geta[TEMP6].picnum TEMP8
			geta[TEMP6].extra TEMP7
			ife TEMP8 VLADMIR
				{
				ifg TEMP7 1499 nullop
				else
					{
					set TEMP7 1500 seta[TEMP6].extra TEMP7
					sound USE_MEDIKIT 
					killit
					}
				}
			ife TEMP8 RUSSIAN
				{
				ifg TEMP7 99 nullop
				else
					{
					set TEMP7 100 seta[TEMP6].extra TEMP7
					sound USE_MEDIKIT 
					killit
					}
				}
			}
		else
		ifpdistl 512
			{
			ife player[].i TEMP9 break
			addphealth 100
			palfrom 60 0 60 0
			sound USE_MEDIKIT 
			killit
			}
			else
			ifpdistl 1024
			ifhitspace
			ifcount 13
			{
			sound ENDSEQVOL2SND1
			action ZERO
			resetcount
			}
			

	set TEMP3 player[TEMP9].posx
	add TEMP3 512

	rotatepoint player[TEMP9].posx player[TEMP9].posy TEMP3 player[TEMP9].posy player[TEMP9].ang TEMP5 TEMP6

	updatesector TEMP5 TEMP6 TEMP7
	ife TEMP7 -1 action ZERO else
	{
	seta[].x TEMP5 
	seta[].y TEMP6
	}
	getp[TEMP9].posz TEMP
	add TEMP 2600
	seta[].z TEMP
	setp[TEMP9].weapon_pos 10
	}

enda

//
// ------------------------------------------------------------
// HEALTH CHARGER
// ------------------------------------------------------------
//

defstate MED_CHARGER
ifaction 0 
	{
		ifactor MEDCHARGER2 espawn 9467
		else ifactor MEDCHARGER espawn 9465
		set TEMP3 sprite[].x
		add TEMP3 4
		seta[RETURN].ang sprite[].ang
		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6

		updatesector TEMP5 TEMP6 TEMP7
		ife TEMP7 -1 nullop else
		{
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		}
		geta[].z TEMP
		seta[RETURN].z TEMP
		seta[RETURN].xrepeat sprite[].xrepeat
		seta[RETURN].yrepeat sprite[].yrepeat
		set INTERNALCOUNT_2 RETURN
	ife INTERNALCOUNT 0
		{
		ife SKILL_LEVEL 1 set INTERNALCOUNT 100 else
		ife SKILL_LEVEL 2 set INTERNALCOUNT 75 else
		set INTERNALCOUNT 50
		}
	action ZERO
	}
	
seta[INTERNALCOUNT_2].pal sprite[].pal
ifl INTERNALCOUNT 25 spritepal 21
else ifl INTERNALCOUNT 50 spritepal 23
else ifl INTERNALCOUNT 75 spritepal 11
else spritepal 0

ifpdistl 1024
 ifp pfacing
  ifg INTERNALCOUNT 0
    {
   ifl PHEALTH PMAXHEALTH
		{
		set player_use 0
		 ifhitspace
		   ifcount 2
		   ifaction ZERO
			   {
				palfrom 20 0 10 0
				soundonce MEDACTIVE
				addphealth 1
				ifg INTERNALCOUNT 2000 nullop else sub INTERNALCOUNT 1
				resetcount
			   }
		}
	else
	ife PERSONEL_RESEARCH[13] 2 // medical foam converter?
	 ifl player[].firstaid_amount PMAXHEALTH
		{
		set player_use 0
		 ifhitspace
		   ifcount 2
		   ifaction ZERO
			   {
				palfrom 20 0 10 0
				soundonce MEDACTIVE
				setp[].inven_icon 1
				getp[].firstaid_amount TEMP
				add TEMP 1
				setp[].firstaid_amount TEMP
				ifg INTERNALCOUNT 2000 nullop else sub INTERNALCOUNT 1
				resetcount
			   }		
		}
	else
		{
		set player_use 0
		 ifhitspace
		   ifcount 2
		   ifaction ZERO
			   {
				soundonce RED_COMPBEEP
				stopsound MEDACTIVE
				}
		}
	}

ife INTERNALCOUNT 0
ifaction ZERO
{
setactorvar[INTERNALCOUNT_2].TEMP 1
stopsound MEDACTIVE
soundonce RED_COMPBEEP
action ONE
}

ends

useractor notenemy MEDCHARGER state MED_CHARGER enda
useractor notenemy MEDCHARGER2 state MED_CHARGER enda

spritenoshade 9467

useractor notenemy 9467 

ifaction 0
	{
	seta[].htflags 2052
	seta[].shade -127
	seta[].blend 255
	cstat 18
	action ZERO
	}

ifaction ZERO ife TEMP 1 killit

enda

spritenoshade 9465

useractor notenemy 9465 

ifaction 0
	{
	seta[].htflags 2052
	seta[].shade -127
	seta[].blend 255
	cstat 18
	action ZERO
	}

ifaction ZERO ife TEMP 1 action ONE

enda

//
// ------------------------------------------------------------
// ARMOUR CHARGER
// ------------------------------------------------------------
//

defstate ARM_CHARGER
ifaction 0 
	{
		ifactor VEST_CHARGER espawn 9463
		set TEMP3 sprite[].x
		add TEMP3 4
		seta[RETURN].ang sprite[].ang
		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6

		updatesector TEMP5 TEMP6 TEMP7
		ife TEMP7 -1 nullop else
		{
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		}
		geta[].z TEMP
		seta[RETURN].z TEMP
		seta[RETURN].xrepeat sprite[].xrepeat
		seta[RETURN].yrepeat sprite[].yrepeat
		set INTERNALCOUNT_2 RETURN
		ife INTERNALCOUNT 0
			{
			ife SKILL_LEVEL 1 set INTERNALCOUNT 100 else
			ife SKILL_LEVEL 2 set INTERNALCOUNT 75 else
			set INTERNALCOUNT 50
			}
	action ZERO
	}
	
switch CHAR
	case 0
	case 7
	case 12
	case 13
	case 14
	ifpdistl 1024
	 ifp pfacing
	  ifg INTERNALCOUNT 0
		{
	   ifl PARMOUR 100
			{
			set player_use 0
			 ifhitspace
			   ifcount 2
			   ifaction ZERO
				   {
					palfrom 20 0 10 0
					soundonce ARMCHARG
					getp[].shield_amount TEMP
					add TEMP 1
					setp[].shield_amount TEMP
					sub INTERNALCOUNT 1
					resetcount
				   }
			}
		else
			{
			set player_use 0
			 ifhitspace
			   ifcount 2
			   ifaction ZERO
				   {
					soundonce RED_COMPBEEP
					stopsound ARMCHARG
					}
			}
		}
	break
	default
		ifpdistl 1024
		 ifp pfacing
			ifhitspace
			 ifaction ZERO
					quote 380
	break
endswitch

ife INTERNALCOUNT 0
ifaction ZERO
{
setactorvar[INTERNALCOUNT_2].TEMP 1
stopsound ARMCHARG
soundonce RED_COMPBEEP
action ONE
}

ends

useractor notenemy VEST_CHARGER state ARM_CHARGER enda

spritenoshade 9463

useractor notenemy 9463 

ifaction 0
	{
	seta[].htflags 2052
	seta[].shade -127
	seta[].blend 255
	cstat 18
	action ZERO
	}

ifaction ZERO ife TEMP 1 action ONE

enda


//
// ------------------------------------------------------------
// SPRITE ELEVATOR
// ------------------------------------------------------------
//

useractor notenemy SPRITE_LIFT
cstat 32768

ifaction 0
{
ifspritepal 1 
	{
	set SPRITE_ELEV_MOVEMENT 2
	seta[].z SPRITE_LIFT_TOP
	}
action ZERO
}

ifn HITAGSAVED 0 killit
ife SPRITE_ELEV_MOVEMENT 1
{
ifn EXTRASAVED -1 soundoncevar EXTRASAVED
ife sprite[].z SPRITE_LIFT_TOP { soundoncevar ZVELSAVED stopsoundvar EXTRASAVED set SPRITE_ELEV_MOVEMENT 2 }
else ifl sprite[].z SPRITE_LIFT_TOP { soundoncevar ZVELSAVED stopsoundvar EXTRASAVED set SPRITE_ELEV_MOVEMENT 2 }
set TEMP 0
		whilevarn TEMP 128
		{
			set TEMP4 TRAIN[TEMP]
			seta[TEMP4].statnum 1
			geta[TEMP4].z TEMP5
			sub TEMP5 XVELSAVED
			seta[TEMP4].z TEMP5
			ifn SPRITE_LIFT_SIDE 0
				{
				geta[].ang TEMP6
				sub TEMP6 512
				cos TEMP7 TEMP6
				sin TEMP8 TEMP6
				set TEMP6 64
				mulvarvar TEMP6 SPRITE_LIFT_SIDE
				divvarvar TEMP7 TEMP6
				divvarvar TEMP8 TEMP6
				movesprite TEMP4 TEMP7 TEMP8 0 0 TEMP9
				ifn player[].spritebridge 0
				ife player[].sbs TEMP4
							{
							geta[].ang TEMP6
							sub TEMP6 512
							cos xvel TEMP6
							sin yvel TEMP6
							getp[].posxv TEMP9
							add xvel TEMP9
							setp[].posxv xvel
							getp[].posyv TEMP9
							add yvel TEMP9
							setp[].posyv yvel
							}
				}
			add TEMP 1
		}
		geta[].z TEMP5
		sub TEMP5 XVELSAVED
		seta[].z TEMP5
}

ife SPRITE_ELEV_MOVEMENT 3
{
soundoncevar EXTRASAVED
ife TEMP5 SPRITE_LIFT_BOTTOM { soundoncevar ZVELSAVED stopsoundvar EXTRASAVED set SPRITE_ELEV_MOVEMENT 0 }
set TEMP 0
		whilevarn TEMP 128
		{
			set TEMP4 TRAIN[TEMP]
			seta[TEMP4].statnum 1
			geta[TEMP4].z TEMP5
			add TEMP5 XVELSAVED
			seta[TEMP4].z TEMP5
			ifn SPRITE_LIFT_SIDE 0
				{
				geta[].ang TEMP6
				add TEMP6 512
				cos TEMP7 TEMP6
				sin TEMP8 TEMP6
				set TEMP6 64
				mulvarvar TEMP6 SPRITE_LIFT_SIDE
				divvarvar TEMP7 TEMP6
				divvarvar TEMP8 TEMP6
				movesprite TEMP4 TEMP7 TEMP8 0 0 TEMP9
				ifn player[].spritebridge 0
				ife player[].sbs TEMP4
							{
							geta[].ang TEMP6
							add TEMP6 512
							cos xvel TEMP6
							sin yvel TEMP6
							getp[].posxv TEMP9
							add xvel TEMP9
							setp[].posxv xvel
							getp[].posyv TEMP9
							add yvel TEMP9
							setp[].posyv yvel
							}
				}
			add TEMP 1
		}
		geta[].z TEMP5
		add TEMP5 XVELSAVED
		seta[].z TEMP5		
}

checkactivatormotion LOTAGSAVED
 ife RETURN 1
	{
	ife SPRITE_ELEV_MOVEMENT 0
		{
		soundoncevar YVELSAVED
		set SPRITE_ELEV_MOVEMENT 1
		}
	else
	ife SPRITE_ELEV_MOVEMENT 2
		{
		soundoncevar YVELSAVED
		set SPRITE_ELEV_MOVEMENT 3
		}
	}


enda

//
// ------------------------------------------------------------
// STALAG...STALAGM....CEILING THING
// ------------------------------------------------------------
//

spritenoshade 10546

action STALAG_FALL

useractor notenemy 10546

ife HITAGSAVED 1
	{
	ifaction 0
		{
		clipdist 128
		ifrnd 128 cstat 269 else
		cstat 265
		action ZERO
		}
		
	ifaction ZERO
	ifhitweapon
		{
		shoot ROCKDEB1
		shoot ROCKDEB1
		fall
		action STALAG_FALL
		}
		
	ifaction STALAG_FALL
		{
		fall
		geta[].shade TEMP
		 ifcount 3
			{
			sub TEMP 1
			seta[].shade TEMP
			resetcount
			}
		iffloordistl 8
			{
			quake 13
			globalsound BOLDSTOP
			shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
			shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
			hitradius 4096 512 1024 2048 4096
			killit
			}
		}
	}

enda

//
// ------------------------------------------------------------
// BOULDER
// ------------------------------------------------------------
//

spriteshadow 10547

move MBOULDER_SLOW 50 0 
move MBOULDER_ROLL 200 0

action BOULDER_ROLL_SLOW 0 15 1 1 40
action BOULDER_ROLL 0 15 1 1 10

useractor notenemy 10547
fall
	seta[].ang TEMP7

ifaction 0
{
strength 100
sizeat 48 48
cstat 257
ife sector[].lotag 1
	{
	ife sector[].floorpicnum 10526 spawn 10039
	ife sector[].floorpicnum 10030 spawn 10039
	}
action ZERO
}

ifaction ZERO
	{
	ifn HITAGSAVED 0
		{
		checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			soundonce SLABMOVE
			action BOULDER_ROLL_SLOW
			}
		}
	else
	ifspawnedby RESPAWN
		{
		soundonce SLABMOVE
		action BOULDER_ROLL_SLOW
		}
	else
	ifpdistl 2048
	 ifp pfacing
	 {
	 ifand NOISE_SAID 2 nullop else { set PLAYER_VOICEOVER 41 xorvar NOISE_SAID 2 }
	   ifangdiffl 512
		{
		ifhitweapon
			{
			 ifwasweapon KNEE
				 {
				 quake 6
				 sound SPUNCHHIT
				 ifmultiplayer { sound SLABMOVE action BOULDER_ROLL_SLOW } else
				  ifdead
					{
					sound SLABMOVE
					action BOULDER_ROLL_SLOW
					}
				 }
			 else strength 100
			}
		}
	 }
	}
	
ifaction BOULDER_ROLL_SLOW
	{
	move MBOULDER_SLOW geth
	ifactioncount 5
		{
		action BOULDER_ROLL
		}
	}
	
ifaction BOULDER_ROLL
	{
	move MBOULDER_ROLL geth
	soundonce EARTHQUAKE
	hitradius 1024 64 128 256 512
	ifpdistl 4096 quake 13
		ifnotmoving
			{
			strength -16
			quake 26
			globalsound BOLDSTOP
			shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
			shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
			hitradius 4096 256 1048 3096 4192
			killit
			}
	}

enda


//
// ------------------------------------------------------------
// ENEMY SPAWNER
// ------------------------------------------------------------
//

action ALARM_SP 0

action ALARM_OFF 0

useractor notenemy MONS_SPAWNER

ifaction 0
{
cstat 32768
ife OWNERSAVED 1 setvar INVASION 1
ife ZVELSAVED 1 action ALARM_SP
else ife HITAGSAVED 0 action ZERO
else ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 action ZERO
	}
}

ifaction ALARM_SP
{
ifg ALARM_ACTIVE 0
ifpdistl 32768
	{
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT YVELSAVED
		{
		ifspritepal 3
			{
			ifcansee
			 ifcanseetarget
				{
				ife XVELSAVED 1 spawn TRANSPORTERBEAM
				espawnvar EXTRASAVED
				add TEMP2 1
				set INTERNALCOUNT 0
				}
			else set INTERNALCOUNT 0
			}
		else
			{
			ife XVELSAVED 1 spawn TRANSPORTERBEAM
			espawnvar EXTRASAVED
			add TEMP2 1
			set INTERNALCOUNT 0
			}
		}
	ife TEMP2 LOTAGSAVED action ALARM_OFF
	}
}

ifaction ALARM_OFF
	{
	ife ALARM_ACTIVE 0 action ALARM_SP
	}

ifaction ZERO
{
add INTERNALCOUNT 1
ifg INTERNALCOUNT YVELSAVED
	{
	ifspritepal 3
		{
		ifcansee
		 ifcanseetarget
			{
			ife XVELSAVED 1 spawn TRANSPORTERBEAM
			espawnvar EXTRASAVED
			add TEMP2 1
			set INTERNALCOUNT 0
			}
		else set INTERNALCOUNT 0
		}
	else
		{
		ife XVELSAVED 1 spawn TRANSPORTERBEAM
		espawnvar EXTRASAVED
		add TEMP2 1
		set INTERNALCOUNT 0
		}
	}
ife TEMP2 LOTAGSAVED killit
ifn ZVELSAVED 0
	{
	checkactivatormotion ZVELSAVED
	ife RETURN 1 killit
	}
}
enda

//
// ------------------------------------------------------------
// MINIGUN AMMO
// ------------------------------------------------------------
//

spriteshadow 10573

useractor notenemy 10573 
fall
sizeat 16 16
cstator 257

findnearactor3d MOUNTED_MINIGUN 1024 TEMP
ifn TEMP -1
{
getactorvar[TEMP].stationary_gun_ammo TEMP2
add TEMP2 1000
setactorvar[TEMP].stationary_gun_ammo TEMP2
quote 237
soundonce BIG_AMMO
killit
}

ifaction 0 action ZERO

ifaction ZERO cstat 257

ifpdistl 1024
 ifp pfacing
  ifp palive
  ifaction ZERO
  {
  set player_use 0
   ifhitspace
    ifcount 13
	{
	set hit_key 30
	set PLAYER_VOICEOVER 2
	sound METALB_PICKUP
	action OK
	resetcount
	}
  }

ifaction OK
	{
	cstat 256
	setp[].runspeed 45200

	set TEMP3 player[].posx
	add TEMP3 512

	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6

	updatesector TEMP5 TEMP6 TEMP7
	ife TEMP7 -1 action ZERO else
	{
	seta[].x TEMP5 
	seta[].y TEMP6
	}
	getp[].posz TEMP
	add TEMP 5600
	seta[].z TEMP
	setp[].weapon_pos 10

	ifhitspace
	 ifcount 13
		{
		sound METALB_PICKUP
		setp[].runspeed RUNNINGSPEED
		action ZERO
		resetcount
		}

	ifpdistg 1024 { sound METALB_PICKUP setp[].runspeed RUNNINGSPEED action ZERO }

	}

enda

//
// ------------------------------------------------------------
// FLAME TURRET AMMO
// ------------------------------------------------------------
//

spriteshadow 12984

useractor notenemy 12984 
fall
sizeat 32 32
cstator 257

findnearactor3d 12972 1024 TEMP
ifn TEMP -1
{
getactorvar[TEMP].ALLY_MAG TEMP2
set TEMP2 1000
setactorvar[TEMP].ALLY_MAG TEMP2
quote 1052
soundonce BIG_AMMO
killit
}

ifaction 0 action ZERO

ifaction ZERO cstat 257

ifpdistl 1024
 ifp pfacing
  ifp palive
  ifaction ZERO
  {
  set player_use 0
   ifhitspace
    ifcount 13
	{
	set hit_key 30
	set PLAYER_VOICEOVER 2
	sound METALB_PICKUP
	action OK
	resetcount
	}
  }

ifaction OK
	{
	cstat 256
	setp[].runspeed 45200

	set TEMP3 player[].posx
	add TEMP3 512
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	ife TEMP7 -1 action ZERO else
	{
	seta[].x TEMP5 
	seta[].y TEMP6
	}
	getp[].posz TEMP
	add TEMP 5600
	seta[].z TEMP
	setp[].weapon_pos 10

	ifhitspace
	 ifcount 13
		{
		sound METALB_PICKUP
		setp[].runspeed RUNNINGSPEED
		action ZERO
		resetcount
		}

	ifpdistg 1024 { sound METALB_PICKUP setp[].runspeed RUNNINGSPEED action ZERO }

	}

enda

//
// ------------------------------------------------------------
// DISINTIGRATE GUY!
// ------------------------------------------------------------
//

action DISOLVE_GUY 0 6 1 1 16
action DISOLVED 5 1 1 1 1
action DISOLVED_COOL 5 1 1 1 1

spriteshadow DISINTIGRATE_GUY

useractor notenemy DISINTIGRATE_GUY
fall

ifaction 0
{
espawn TRANSPORTERSTAR
geta[RETURN].z TEMP
sub TEMP 3096
seta[RETURN].z TEMP
shoot SPARK2 shoot SPARK2 shoot SPARK2 
shoot SPARK2 shoot SPARK2 shoot SPARK2
shoot SPARK2 shoot SPARK2 shoot SPARK2
sound ENERGY_BURST
flash
ifspawnedby GORILLA sizeat 36 36 else
ifspawnedby ANUBIS sizeat 32 32 else
ifspawnedby ANUBIS_MUMMY sizeat 36 36 else
sizeat 24 24
cstat 1
action DISOLVE_GUY
}

ifaction DISOLVED
	{
	ifrnd 4 { espawn BIG_SMOKE seta[RETURN].pal 17 }
	ifcount 256 action DISOLVED_COOL
	}
	
ifaction DISOLVE_GUY
	{
	ifrnd 32 { shoot SPARK2 shoot SPARK2 }
	ifrnd 4 { espawn BIG_SMOKE geta[RETURN].z TEMP sub TEMP 4096 seta[RETURN].z TEMP seta[RETURN].pal 17 }
	ifactioncount 6 { cstat 0 resetcount action DISOLVED }
	}

enda

//
// ------------------------------------------------------------
// SPIRIT DEATH GUY!
// ------------------------------------------------------------
//

action SPIRIT_DISOLVE_GUY 0 17 1 1 16
action SPIRIT_DISOLVED 17 1 1 1 1

spriteshadow SPIRIT_DEATH_GUY
spritenoshade SPIRIT_DEATH_GUY

useractor notenemy SPIRIT_DEATH_GUY
fall
ifaction 0
{
sound SPD_1
ifspawnedby GORILLA sizeat 40 40 else
ifspawnedby ANUBIS_MUMMY sizeat 40 40 else
sizeat 30 30
cstat 257
ifrnd 128 cstator 4
fall
seta[].shade -16
action SPIRIT_DISOLVE_GUY
}
	
ifaction SPIRIT_DISOLVE_GUY
{
ifrnd 64 { shoot SPARK2 shoot SPARK2 }
ifactioncount 9 { soundonce SPD_2 seta[].shade sector[].floorshade }
ifactioncount 15 soundonce SPD_3
ifactioncount 17 { geta[].cstat TEMP xorvar TEMP 257 seta[].cstat TEMP resetcount action SPIRIT_DISOLVED }
}

enda

//
// ------------------------------------------------------------
// ONFIRE GUY!
// ------------------------------------------------------------
//

spritenoshade ONFIREGUY
spriteshadow ONFIREGUY

action FIRERUN 0 6 5 1 8
action FIREDIE 31 5 1 1 17
action FIREBOD 35 1 1 1 17

action BURN_OUT 4229 4 1 1 17
action BURNED_OUT 4233 1 

move ASSONFIRE 140
move NOMOVE 0

useractor notenemy ONFIREGUY
fall

ifaction 0
{
sound ENGULF_FIRE
shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
ifspawnedby ZSCIEN sizeat 22 22 else
ifspawnedby GORILLA sizeat 40 40 else
ifspawnedby ANUBIS_MUMMY sizeat 40 40 else
sizeat 26 26 
ifspawnedby RESPAWN
	{
	ifrnd 64 sound MERC_ONFIRE1
	else ifrnd 64 sound MERC_ONFIRE2
	else ifrnd 64 sound MERC_ONFIRE3
	else sound MERC_ONFIRE4
	}
cstat 257
seta[].shade -127
strength 100
action FIRERUN
move ASSONFIRE geth
set TEMP8 0
}

ifaction FIRERUN
{
add TEMP8 1
soundonce FIRE_CRACKLE
ifrnd 8 { shoot SPARK espawn BIG_SMOKE geta[RETURN].z TEMP sub TEMP 8096 seta[RETURN].z TEMP seta[RETURN].pal 17 }
ifg TEMP8 130
	{
	action FIREDIE
	move NOMOVE
	}
ifrnd 8
{
move ASSONFIRE geth randomangle
}

ifnotmoving
{
move ASSONFIRE geth randomangle
}

ifinwater { action FIREDIE move NOMOVE }
ifonwater { action FIREDIE move NOMOVE }

ifhitweapon ifdead { action FIREDIE move NOMOVE }

}

ifaction BURN_OUT
ifactioncount 4
{
		ifrnd 128
		cstat 4
		else
		cstat 0
		spriteflags 1
		seta[].pal sector[].floorpal
		seta[].shade sector[].floorshade
action BURNED_OUT
move NOMOVE
}

ifaction FIREDIE
ifactioncount 5
{
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
action FIREBOD
move NOMOVE
}

ifaction FIREBOD
{
	move NOMOVE
	cstat 0
	ifcansee nullop
	else
	action BURN_OUT 
}


enda

//
// ------------------------------------------------------------
// REACTOR PHLEG
// ------------------------------------------------------------
//

useractor notenemy 10615
ife LOTAGSAVED 1
{
spritepal 2
ifg REACTOR_BREACH 0 seta[].cstat CSTATSAVED else cstat 32768
}
enda

useractor notenemy 3507

ifaction 0
{
set REACTOR_VAR 1000
ifspritepal 5 cstat 32768 else cstat 257
action ZERO
}

ifg REACTOR_BREACH 0 sub REACTOR_BREACH 1

ifl REACTOR_VAR 100 { ifrnd 32 quake 13 }

ifl REACTOR_VAR 500 
	{
	ifn player[].palette 5 setgamepalette 5
	}

ifl REACTOR_VAR 0
	{
	palfrom 64 64 64 64
	set SLO_MO_SHOWOFF 70
	set FISSION_MAILED 1
	killit
	}

ifcount 30
{
	findnearactorz SHOOTME 4096 32768 TEMP
	ifn TEMP -1 
		{ 
		set REACTOR_BREACH 28
		palfrom 30 30 0 0 
		quake 6 
		ifspritepal 3 globalsound CLAXON_ALARM 
		sub REACTOR_VAR 5
		ifn LOTAGSAVED 0
		{
			ifl REACTOR_VAR 820 
			 ifg REACTOR_VAR 780 
			  ife INTERNALCOUNT 0
				{ 
				operateactivators LOTAGSAVED THISACTOR 
				operatemasterswitches LOTAGSAVED 
				operaterespawns LOTAGSAVED 
				add LOTAGSAVED 1 
				set INTERNALCOUNT 1
				}
			ifl REACTOR_VAR 620 
			 ifg REACTOR_VAR 580 
			  ife INTERNALCOUNT 1
				{ 
				operateactivators LOTAGSAVED THISACTOR 
				operatemasterswitches LOTAGSAVED 
				operaterespawns LOTAGSAVED 
				add LOTAGSAVED 1 
				set INTERNALCOUNT 2
				}
			ifl REACTOR_VAR 420 
			 ifg REACTOR_VAR 380 
			  ife INTERNALCOUNT 2
				{ 
				operateactivators LOTAGSAVED THISACTOR 
				operatemasterswitches LOTAGSAVED 
				operaterespawns LOTAGSAVED 
				add LOTAGSAVED 1 
				set INTERNALCOUNT 3
				}
			ifl REACTOR_VAR 220 
			 ifg REACTOR_VAR 180
			  ife INTERNALCOUNT 3
				{ 
				operateactivators LOTAGSAVED THISACTOR 
				operatemasterswitches LOTAGSAVED 
				operaterespawns LOTAGSAVED 
				add LOTAGSAVED 1 
				set INTERNALCOUNT 4
				}
			}
		}
	resetcount 
}

enda

//
// ------------------------------------------------------------
// SOUND PLAY
// ------------------------------------------------------------
//

useractor notenemy 3602
ifaction 0 { cstat 32768 action ZERO ifspritepal 5 action FORMED }

ifaction ZERO
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	ifspritepal 3 action FORM
	else
		{
		globalsoundvar LOTAGSAVED
		screensound LOTAGSAVED
		killit
		}
	}
}

ifaction FORM
	{
	soundoncevar LOTAGSAVED
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT EXTRASAVED killit
	}
	
ifaction FORMED soundoncevar LOTAGSAVED
	

enda

//
// ------------------------------------------------------------
// PRELOAD MUSIC
// ------------------------------------------------------------
//

useractor notenemy PRELOAD_MUSIC
cstat 32768
ifaction 0
	{
	ifn HITAGSAVED 0 starttrackvar HITAGSAVED
	ifn LOTAGSAVED 0 starttrackvar LOTAGSAVED
	ifn EXTRASAVED -1 starttrackvar EXTRASAVED
	ifn XVELSAVED 0 starttrackvar XVELSAVED
	ifn YVELSAVED 0 starttrackvar YVELSAVED
	ifn ZVELSAVED 0 starttrackvar ZVELSAVED
	starttrackvar LEVEL
	killit
	}
enda

//
// ------------------------------------------------------------
// WEATHER TYPE
// ------------------------------------------------------------
//

useractor notenemy 10742
ifaction 0
{
cstat 32768
ifn LOTAGSAVED 0 
	{
	gets[].floorstat TEMP
	xorvar TEMP 8192
	sets[].floorstat TEMP
	killit
	}
ifspritepal 0 set weather_type 0 else
ifspritepal 1 set weather_type 1 else
ifspritepal 2 set weather_type 2 else
ifspritepal 3 set weather_type 3
killit
}

enda

//
// ------------------------------------------------------------
// UNLOCKABLE DISPLAY STUFF
// ------------------------------------------------------------
//

useractor notenemy 10390 // James' 1911s
ifmultiplayer killit

ifaction 0
{
readarrayfromfile IW_COMPLETE 4006	
ife IW_COMPLETE[1] 1 action ZERO
 else killit
}

enda

// ********************************************************************************
// DARK N STORMY
// ********************************************************************************

defstate change_visibility
set TEMP 0
		whilevarvarn TEMP NUMSECTORS
			{
	  		gets[TEMP].ceilingstat TEMP4
	  		ifand TEMP4 1
	  			{
				gets[TEMP].ceilingpal TEMP5
				ifn TEMP5 3 
					{
					ifspritepal 3 sets[TEMP].visibility 0 
					else
					ifspritepal 5
						{
						gets[TEMP].ceilingstat TEMP7
						ifand TEMP7 1
							{
							gets[TEMP].ceilingpicnum TEMP5 
							ifn TEMP5 179 sets[TEMP].ceilingpicnum LOTAGSAVED
							sets[TEMP].ceilingpal 0
							sets[TEMP].visibility 0
							sets[TEMP].ceilingypanning 0
							}
						}
					else
					ifspritepal 1
						{
						gets[TEMP].ceilingstat TEMP7
						ifand TEMP7 1
							{
							gets[TEMP].ceilingpicnum TEMP5 
							ifn TEMP5 179 sets[TEMP].ceilingpicnum LOTAGSAVED
							sets[TEMP].ceilingpal 0
							sets[TEMP].visibility 240
							sets[TEMP].ceilingypanning 0
							}
						}
					else sets[TEMP].visibility 80
					}
	  			}
	  		add TEMP 1
			}
ends


useractor notenemy 12430

ifaction 0
{
cstat 32768
ife HITAGSAVED 0 { state change_visibility action ZERO }
else
ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 { state change_visibility action ZERO }
	}
}

ifaction ZERO
	{
	ifspritepal 1 killit
	ifspritepal 5 killit
	ifrnd 1 { flash ifrnd 128 globalsound LIGHTNING_SLAP2 else globalsound LIGHTNING_SLAP }
	}
	
enda

// ********************************************************************************
// BUG
// ********************************************************************************

move FLYMOVE 80

spriteshadow 11669

action AFLYMOVE 0 2 5 1 10

useractor notenemy 11669

ifaction 0 { sizeat 22 22 action AFLYMOVE }

ifmove 0
{
geta[].x TEMP
geta[].y TEMP2
move FLYMOVE geth randomangle
}

ifnotmoving
{
move FLYMOVE geth randomangle
}

enda

// ********************************************************************************
// FIXABLE SWITCHES
// ********************************************************************************


defstate TOOLBOX_USE_CODE
			ifmultiplayer
				{
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 550
				userquote 356
				}
			soundonce TOOLBOXUSE
			ifspritepal 3
			{ quote 254 set TOOLBOX 0 }
			else
				{
				set PLAYER_VOICEOVER 13
				ife CHAR 3 { ifrnd 128 quote 253 else { quote 254 set TOOLBOX 0 } }
				else ife CHAR 5 { ifrnd 128 quote 253 else { quote 254 set TOOLBOX 0 } }
				else ife CHAR 10 { ifrnd 128 quote 253 else { quote 254 set TOOLBOX 0 } }
				else ife CHAR 13 quote 253 
				else { quote 254 set TOOLBOX 0 }
				}
			setp[].inven_icon 0
ends

useractor notenemy 4483

ifn LOTAGSAVED 0
{
ifrnd 2
	{
	spawn 8433 shoot SPARK shoot SPARK
	sound SHORT_CIRCUIT
	}
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
     ifcount 13
	{
	ife TOOLBOX 1
		{
		setp[].inven_icon 10
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			state TOOLBOX_USE_CODE
      		seta[].picnum 164
			strength 1
			seta[].statnum 0
			seta[].lotag LOTAGSAVED
			seta[].hitag HITAGSAVED
			break
			}
		}
	else 
	ife TOOLBOX 0 
		ifhitspace 
			{ 
			set PLAYER_VOICEOVER 12
			quote 252 
			}
	}
}

enda



useractor notenemy 4954

ifn LOTAGSAVED 0
{
ifrnd 2
	{
	spawn 8433 shoot SPARK shoot SPARK
	sound SHORT_CIRCUIT
	}
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    ifcount 13
	{
	 ife TOOLBOX 1
		{
		setp[].inven_icon 10
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			state TOOLBOX_USE_CODE
			seta[].picnum 860
			seta[].lotag LOTAGSAVED
			seta[].hitag HITAGSAVED
			seta[].statnum 0
			break
			}
		}
	else 
	ife TOOLBOX 0 
		ifhitspace 
			{ 
			set PLAYER_VOICEOVER 12
			quote 252 
			}
	}
}

enda

useractor notenemy 12358

ifn LOTAGSAVED 0
{
ifrnd 2
	{
	spawn 8433 shoot SPARK shoot SPARK
	sound SHORT_CIRCUIT
	}
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    ifcount 13
	{
	 ife TOOLBOX 1
      {
		setp[].inven_icon 10
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			state TOOLBOX_USE_CODE
			seta[].picnum 12356
			seta[].lotag LOTAGSAVED
			seta[].hitag HITAGSAVED
			break
			}
		}
	else 
	ife TOOLBOX 0 
		ifhitspace 
			{ 
			set PLAYER_VOICEOVER 12
			quote 252 
			}
	}
}

enda


useractor notenemy 12432

ifaction 0
{
cstat 32768
action ZERO
}

ifspritepal 3 ifrnd 32 { spawn SMALLSMOKE shoot SPARK shoot SPARK espawn 8433 sound SHORT_CIRCUIT }

ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
     ifcount 13
	{
	set player_use 0
	ife TOOLBOX 1
      {
	setp[].inven_icon 10
		 ifhitspace
			{
			set hit_key 30
			state TOOLBOX_USE_CODE
      		operateactivators LOTAGSAVED THISACTOR
      		operaterespawns LOTAGSAVED
      		operatemasterswitches LOTAGSAVED
			ifn XVELSAVED 0 globalsoundvar XVELSAVED
			ifn HITAGSAVED 0 
				{ 
				espawn 5
				seta[RETURN].hitag 6000
				seta[RETURN].lotag HITAGSAVED
				}
			ifn YVELSAVED 0
				{
				seta[].picnum YVELSAVED
				seta[].cstat CSTATSAVED
				}
				else
			killit
			}
	  }
	else 
	ife TOOLBOX 0 
		ifhitspace 
			{ 
			set PLAYER_VOICEOVER 12
			quote 252 
			}
	}

enda

useractor notenemy 17100

ifn LOTAGSAVED 0
{
ifrnd 2
	{
	spawn 8433 shoot SPARK shoot SPARK
	sound SHORT_CIRCUIT
	}
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    ifcount 13
	{
	 ife TOOLBOX 1
      {
		setp[].inven_icon 10
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			state TOOLBOX_USE_CODE
			seta[].picnum 17125
			seta[].lotag LOTAGSAVED
			seta[].hitag HITAGSAVED
			break
			}
		}
	else 
	ife TOOLBOX 0 
		ifhitspace 
			{ 
			set PLAYER_VOICEOVER 12
			quote 252 
			}
	}
}

enda


useractor notenemy 19707

ifn LOTAGSAVED 0
{
ifrnd 2
	{
	spawn 8433 shoot SPARK shoot SPARK
	sound SHORT_CIRCUIT
	}
ifpdistl 1548
 ifp palive
  ifp pfacing
   ifcansee
    ifcount 13
	{
	 ife TOOLBOX 1
      {
		setp[].inven_icon 10
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			state TOOLBOX_USE_CODE
			seta[].picnum NEWSWITCH35
			seta[].lotag LOTAGSAVED
			seta[].hitag HITAGSAVED
			break
			}
		}
	else 
	ife TOOLBOX 0 
		ifhitspace 
			{ 
			set PLAYER_VOICEOVER 12
			quote 252 
			}
	}
}

enda

//
// ------------------------------------------------------------
// BATTERY
// ------------------------------------------------------------
//

action BATT_FULLP -3
action BATT_LOWP -2
action BATT_DEAD -1

useractor notenemy 12437

ife TEMP2 0
	{
	ifspritepal 3 cstat 32768
	action BATT_DEAD
	ifpdistl 1024
		ifp pfacing
		 ifp palive
			{
			set player_use 0
			 ifhitspace { set hit_key 30 quote 255 }
			}
	}
else
ife TEMP2 1
	{
	ifn HITAGSAVED 0 
		{
		operateactivators HITAGSAVED THISACTOR
		operatemasterswitches HITAGSAVED
		operaterespawns HITAGSAVED
		}
	ife LOTAGSAVED 0
		{
		ifspritepal 3 killit
		action BATT_FULLP
		}
	else
	ifn LOTAGSAVED 0
		{
		set TEMP6 LOTAGSAVED
		set TEMP2 2
		action BATT_FULLP
		}
	}
else
ife TEMP2 2
	{
	add TEMP3 1
	ifg TEMP3 1560
		{
		sub TEMP6 1
		ife TEMP6 0
			{
			operateactivators HITAGSAVED THISACTOR
			operatemasterswitches HITAGSAVED
			operaterespawns HITAGSAVED
			soundonce PLUGPULLOUT
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			action BATT_DEAD
			set TEMP2 24
			}
		else
		ife TEMP6 1
			{
			action BATT_LOWP
			soundonce INTRUDER_ALERT
			}
		set TEMP3 0
		}
	}
else ifg TEMP2 2
	{
	sub TEMP2 1
	ifl TEMP2 5 set TEMP2 0
	}

enda

spriteshadow BATTERY_SPRITE

useractor notenemy BATTERY_SPRITE
fall

ifaction 0 
	{
	sizeat 28 28
	cstat 257
	action ZERO
	}

ifpdistl 1024
 ifp pfacing
  ifp palive
  ifaction ZERO
  {
  set player_use 0
   ifhitspace
    ifcount 13
	{
	set hit_key 30
	set PLAYER_VOICEOVER 2
	action OK
	resetcount
	}
  }

ifaction OK
	{
	ifp pstanding
		{
		findnearactor3d 12437 1536 TEMP
			ifn TEMP -1
			{
			getactorvar[TEMP].TEMP2 TEMP2
			ife TEMP2 0
				{
				globalsound PLUGPUTIN
				quote 256
				setactorvar[TEMP].TEMP2 1
				killit
				}
			}
		}
	cstat 256

	set TEMP3 player[].posx
	add TEMP3 512

	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6

	updatesector TEMP5 TEMP6 TEMP7
	ife TEMP7 -1 action ZERO else
		{
		seta[].x TEMP5 
		seta[].y TEMP6
		}
	getp[].posz TEMP
	add TEMP 6600
	seta[].z TEMP
	setp[].weapon_pos 10

	ifhitspace
	 ifcount 13
		{
		action ZERO
		resetcount
		}

	ifpdistg 1024 { setp[].runspeed RUNNINGSPEED action ZERO }

	}

enda

// *************************************************
// VR STATION POD
// *************************************************

action P_NEAR -5557
action P_ENEAR -5570

useractor notenemy VR_BOOTH

ifaction 0
{
seta[].blend 255
set TEMP 0
whilevarn TEMP 16384
{
  ifn sprite[TEMP].statnum 1024
  {
    ife sprite[TEMP].picnum DOORTRANSPORTEXIT
    {
     getactorvar[TEMP].HITAGSAVED TEMP3
     ife LOTAGSAVED TEMP3 
	{  
	geta[TEMP].x ENDPOINTX
	geta[TEMP].y ENDPOINTY
	geta[TEMP].z ENDPOINTZ
	geta[TEMP].ang TEMP7
	set TEMP 16383
	}
    }
  }
  add TEMP 1
}
action ZERO
}

ifpdistl 2048
ifcansee
  ifp palive
  ifaction ZERO
   {
   ife CHAR 6 { sound RED_COMPBEEP ifspritepal 2 action P_ENEAR else action P_NEAR }
   ife CHAR 7 { sound RED_COMPBEEP ifspritepal 2 action P_ENEAR else action P_NEAR }
   }

ifaction P_NEAR
{
ifpdistl 1024
ifcansee
 ifp pfacing
  ifp palive
  {
  switch CHAR
  case 6
  case 7
  case 16
	   set player_use 0
		ifcount 13
	   ifhitspace
		{
		set hit_key 30
		ifspritepal 0 
			{
			globalsound ENTER_VR
			set CONTROL_VR APLAYER
			set VR_ACTION_POINTS 10
			ifmultiplayer nullop else 
				{
				espawn 1404
				setactorvar[RETURN].EXTRASAVED CHAR
				state SPAWN_IN_FRONT
				setactorvar[RETURN].TEMP9 CONTROL_VR
				}
			}
		ifspritepal 3
			{
			globalsound ENTER_VR
			set CONTROL_VR APLAYER
			set VR_ACTION_POINTS 10
			ifmultiplayer nullop else 
				{
				espawn 1404
				setactorvar[RETURN].EXTRASAVED CHAR
				state SPAWN_IN_FRONT
				setactorvar[RETURN].TEMP9 CONTROL_VR
				}
			}
		action ONE
		resetcount
		}
	break
	default
	break
	endswitch
  }
else
ifpdistg 2048 action ZERO
}

ifaction P_ENEAR
{
ifpdistl 1024
ifcansee
 ifp pfacing
  ifp palive
  {
  switch CHAR
  case 6
  case 7
  case 16
	   set player_use 0
		ifcount 13
	   ifhitspace
		{
		set hit_key 30
			set screen_pal 0
			setgamepalette 0
			set VR_ACTION_POINTS 0
			globalsound EXIT_VR
			set CONTROL_VR -1
			seta[TEMP9].xrepeat 0
			ifn EXTRASAVED -1
				{
				operateactivators EXTRASAVED THISACTOR
				operaterespawns EXTRASAVED
				operatemasterswitches EXTRASAVED
				}
		action ONE
		resetcount
		}
	break
	default
	break
	endswitch
  }
else
ifpdistg 2048 action ZERO
}

ifaction ONE
	{
	palfrom 64 64 64 64
	add INTERNALCOUNT 1
	updatesectorz ENDPOINTX ENDPOINTY ENDPOINTZ TEMP8
	 ifn TEMP8 -1
	  ifg INTERNALCOUNT 26
		{
		setp[].cursectnum TEMP8
		setp[].posx ENDPOINTX
		setp[].posy ENDPOINTY
		setp[].posz ENDPOINTZ
		setp[].ang TEMP7
		set INTERNALCOUNT 0
		ifspritepal 3 killit
		action ZERO
		}
	else
	 ife TEMP8 -1
		{
		addlogvar ENDPOINTX
		addlogvar ENDPOINTY
		addlogvar ENDPOINTZ
		addlogvar TEMP8
		quote 513
		killit
		}
	}

enda

useractor notenemy VR_SWITCH

ifaction 0
{
seta[].blend 255
cstator 273
action ZERO
}

ifaction ZERO
{
ifspritepal 36 // If it's a virus door
			{
			ife HACK_UNLOCK HITAGSAVED
				{
				action ONE
				soundonce VR_HACK
				cstat 18
				resetcount
				set HACK_UNLOCK -1
				}
			}
else 
ifspritepal 49 // If it's a download door
			{
			ife HACK_UNLOCK HITAGSAVED
				{
				action ONE
				soundonce VR_HACK
				cstat 18
				resetcount
				set HACK_UNLOCK -1
				}
			}
else 
ifpdistl 1024
 ifp pfacing
  ifp palive
   ifcount 13
    ifcansee
	{
	set player_use 0
	 ifhitspace
		{
		set hit_key 30
		ifspritepal 0 // If it's blue, it's a free door
			{
			action ONE
			soundonce VR_HACK
			cstat 18
			resetcount
			}
		else ifspritepal 11 // If it's green, it needs one point
			{
			ifg VR_ACTION_POINTS 0
				{
				action ONE
				soundonce VR_HACK
				cstat 18
				sub VR_ACTION_POINTS 1
				resetcount
				}
				else 
				{
				soundonce VR_FAIL
				resetcount
				}
			}
		else ifspritepal 23 // If it's yellow, it needs two points
			{
			ifg VR_ACTION_POINTS 1
				{
				action ONE
				soundonce VR_HACK
				cstat 18
				sub VR_ACTION_POINTS 2
				resetcount
				}
				else 
				{
				soundonce VR_FAIL
				resetcount
				}
			}
		else ifspritepal 21 // If it's red, it needs three points
			{
			ifg VR_ACTION_POINTS 2
				{
				action ONE
				soundonce VR_HACK
				cstat 18
				sub VR_ACTION_POINTS 3
				resetcount
				}
				else 
				{
				soundonce VR_FAIL
				resetcount
				}
			}
		else ifspritepal 13 // If it's black, it's free but can short out and subtract points
			{
			ifrnd 128
				{
				action ONE
				soundonce VR_HACK
				cstat 18
				resetcount
				}
				else 
				{
				sub VR_ACTION_POINTS 4
				ifl VR_ACTION_POINTS 0 set VR_ACTION_POINTS 0
				wackplayer
				soundonce THUNDERBALL_HIT
				palfrom 40 0 0 40
				soundonce VR_FAIL
				action ONE
				cstat 18
				resetcount
				}
			}
		}
	}
}

ifaction ONE
{
ife CONTROL_VR -1
	{
	seta[].cstat CSTATSAVED
	action ZERO
	}
}

enda

useractor notenemy 13867 // FIREWALL
ifaction 0
 ifn LOTAGSAVED 0
  action ZERO

ifaction ZERO
{
sleeptime 0
ife FIREWALL_ID LOTAGSAVED { cstat 32768 action FORM }
}

ifaction FORM
{
sleeptime 0
ife FIREWALL_ID LOTAGSAVED nullop
else
	{
	seta[].cstat CSTATSAVED
	action ZERO
	}
}
  
enda

useractor notenemy FIREWALL_SLOT

ifpdistl 1536
 ifp pfacing
  ifp palive
   ifcount 13
    ifcansee
	{
	ifaction 0
	 ife GOT_FIREWALL 1 
		{
		set player_use 0
		setp[].inven_icon 12
		 ifhitspace
			{
			set hit_key 30
			setp[].inven_icon 0
			set GOT_FIREWALL 0
			action ONE
			sound PLUGPUTIN
			set FIREWALL_ID HITAGSAVED
			resetcount
			}
		}
	else
	 ifaction ONE
	  ife GOT_FIREWALL 0
		{
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			set GOT_FIREWALL 1
			action 0
			sound PLUGPULLOUT
			set FIREWALL_ID 0
			resetcount
			}
		}
	}
else
ifpdistg 1536
 ife player[].inven_icon 12 setp[].inven_icon 0

enda


action USED 0
action HACKED 0
action HACKED_2 0

useractor notenemy 12533 // CHARGE/DOWNLOADING STATIONS

ifaction 0
{
cstator 16
action ZERO
}

ifaction ZERO
{
ifpdistl 1024
 ifp pfacing
  ifp palive
   ifcount 13
    ifcansee
	{
	set player_use 0
	 ifhitspace
		{
		set hit_key 30
		ifspritepal 0
			{
			action USED
			soundonce VR_CHARGE
			set VR_ACTION_POINTS 10
			resetcount
			}
		ifspritepal 49
			{
			quote 750
			action HACKED
			soundonce VR_CHARGE
			set HACKING_PROGRESS 130
			resetcount
			}
		ifspritepal 36
			{
			quote 751
			action HACKED
			soundonce VR_CHARGE
			set HACKING_PROGRESS 130
			resetcount
			}
		}
	}
}

ifaction USED
{
spritepal 12
ife CONTROL_VR -1
	{
	spritepal 0
	action ZERO
	}
}

ifaction HACKED
{
ife HACKING_PROGRESS 0
	{
	ifspritepal 49 quote 752 
	else ifspritepal 36 { setgamepalette 5 quote 753 }
	soundonce VR_DOWNLOAD
	set HACK_UNLOCK HITAGSAVED
	ifn LOTAGSAVED 0
		{
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED
		}
	spritepal 27
	action HACKED_2
	}
}

enda

// *************************************************
// SKIP PORTAL
// *************************************************

useractor notenemy 11775
ifspritepal 54 nullop
else
	{
	ife VOLUME 1
	 ife LEVEL 0
		{
		readarrayfromfile BEAT_EPISODES 4053
		ifn BEAT_EPISODES[2] 0 action ZERO
		else killit
		}
		
	ife VOLUME 2
	 ife LEVEL 0
		{
		readarrayfromfile BEAT_EPISODES 4053
		ifspritepal 64 // base two skip?
			{
			ifand BEAT_EPISODES[3] 64 action ZERO
			else killit
			}
			else
			{
			ifn BEAT_EPISODES[3] 0 action ZERO
			else killit
			}
		}
		
	ifpdistl 1524
	ifcansee
	 ifp pfacing
	  ifp palive
	  ifn HITAGSAVED 0
	  {
		   set player_use 0
			ifcount 13
		   ifhitspace
			{
			set hit_key 30
			globalsound USE_TIMEPORTAL
			ifspritepal 64 startlevel 2 26
			else
				{
				ife VOLUME 1 startlevel 1 1
				ife VOLUME 2 startlevel 2 1
				}
			set CHAR -1
			set CHARSELECT 1
			killit
			}
	  }
	}
	
enda

// *************************************************
// TIME PORTAL
// *************************************************

spritenopal 11772
spritenoshade 11772

useractor notenemy 11772

ifaction 0
{
sizeat 32 32
seta[].mdflags 16
seta[].blend 255
cstat 2
set TEMP 0
whilevarn TEMP 16384
{
  ifn sprite[TEMP].statnum 1024
  {
    ife sprite[TEMP].picnum DOORTRANSPORTEXIT
    {
     getactorvar[TEMP].HITAGSAVED TEMP3
     ife LOTAGSAVED TEMP3 
		{  
		geta[TEMP].x ENDPOINTX
		geta[TEMP].y ENDPOINTY
		geta[TEMP].z ENDPOINTZ
		geta[TEMP].ang TEMP7
		set TEMP 16383
		}
    }
  }
  add TEMP 1
}
action ZERO
}

ifpdistl 1524
ifcansee
 ifp pfacing
  ifp palive
  ifn LOTAGSAVED 0
  {
	ife CHAR 0
	{
	ifand NOISE_SAID 8 nullop else { set PLAYER_VOICEOVER 14 xorvar NOISE_SAID 8 }
	   set player_use 0
		ifcount 13
	   ifhitspace
		{
		set hit_key 30
		globalsound USE_TIMEPORTAL
		spawn 8433
		action USED
		resetcount
		}
	}
  }

ifaction USED
	{
	palfrom 60 60 60 60
	updatesectorz ENDPOINTX ENDPOINTY ENDPOINTZ TEMP8
	 ifn TEMP8 -1
		{
		setp[].cursectnum TEMP8
		setp[].posx ENDPOINTX
		setp[].posy ENDPOINTY
		setp[].posz ENDPOINTZ
		setp[].ang TEMP7
		action ZERO
		}
	else
	 ife TEMP8 -1
		{
		addlogvar ENDPOINTX
		addlogvar ENDPOINTY
		addlogvar ENDPOINTZ
		addlogvar TEMP8
		quote 513
		killit
		}
	}

enda

// *************************************************
// SUPPORT RADIO STUFF
// *************************************************

useractor notenemy 13262

ifpdistl 1500
 ife CHAR 3
  ifp pfacing
   ifp palive
   ifaction 0
	{
	set player_use 0
	 ifhitspace
		{
		set hit_key 30
	    ifpinventory GET_HOLODUKE 0
		{
		set PLAYER_VOICEOVER 15
		soundonce RADIO
		quote 263
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED
		setp[].holoduke_amount 0
		setp[].inven_icon 0
		action ONE
		}
		else 
			{
			set PLAYER_VOICEOVER 14
			quote 262
			}
		}
	}

enda

// *************************************************
// TIME PORTAL STUFF
// *************************************************


useractor notenemy 10672 // Property sign
ifcount 26
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 killit
	resetcount
	}
enda

useractor notenemy 12401 // chainlink fence
ifcount 26
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 killit
	resetcount
	}
enda


useractor notenemy MAKE_SWITCH // Make a switch!
cstat 32768

	checkactivatormotion HITAGSAVED
	ife RETURN 1 
		{
		cstat 16
		seta[].picnum ZVELSAVED
		}

enda

// *************************************************
// BARB_WIRE
// *************************************************

useractor notenemy 10729
ifaction 0
{
cstator 1
action ZERO
}
enda

// *************************************************
// TIME ZONE STUFF
// *************************************************

gamevar HUB_MAP 0 0

useractor notenemy 11493
cstat 32768

ifspritepal 0 nullop // For future stuff....
else
ifspritepal 1 { set TIMEZONE 1 set SCAN_MODULE 0 killit } // Highwire Revolution period
else
ifspritepal 2 { set HUB_MAP 1 setuserdef[].volume_number base_volume } // base
else
ifspritepal 3 { set TIMEZONE 2 set SCAN_MODULE 0 killit } // Micky Begins
else
ifspritepal 4 { set TIMEZONE 3 killit } // turns snow into fire particles
else
ifspritepal 5 { set TIMEZONE 5 killit } // Snowfall future
else
ifspritepal 6 { set TIMEZONE 6 set GOT_KNIFE 0 killit  } // Snowfall VR stuff
else
ifspritepal 8 { set TIMEZONE 8 killit } // VR stuff
else
ifspritepal 9 { set TIMEZONE 9 killit } // cutscene
else
ifspritepal 10 { setuserdef[].volume_number base_volume }

enda

// *************************************************
// DIGIT
// *************************************************

move DIG_MOVE 32 -32

spritenoshade 6142

useractor notenemy 6142
ifaction 0
{
sizeat 32 32
spritepal 8
cstat 2050
seta[].shade 0
seta[].blend 255
ifrnd 128 action ONE else action ZERO
move DIG_MOVE getv spin randomangle
resetcount
}
else
{
geta[].shade TEMP
add TEMP 1
seta[].shade TEMP
sizeto 64 64
ifg TEMP 40 killit
}

enda

// *************************************************
// MB SUIT
// *************************************************

useractor notenemy 16414

ifaction 0 action ACAR

ifaction ACAR
{
ifpdistl 1024
 ifcansee
  ifp pfacing
  {
  set player_use 0
   ifhitspace
	{
	set hit_key 30
	screensound PUT_ON_EQUIP
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	killit
	}
   }
}

enda

// *************************************************
// HOLO SWITCH
// *************************************************

useractor notenemy 22321

ifaction 0
{
ifpdistl 1024
 ifcansee
  ifp pfacing
  {
  set player_use 0
   ifhitspace
	{
	set hit_key 30
	setp[].weapon_pos 10
	ifspritepal 0 { set HOLO_ACCESS 1 sound HOLO_SWITCH action EIGHT }
	else
		{
		ife CHAR 0 xorvar HOLO_ACCESS 2
		ife CHAR 1 xorvar HOLO_ACCESS 4
		ife CHAR 2 xorvar HOLO_ACCESS 8
		ife CHAR 3 xorvar HOLO_ACCESS 16
		ife CHAR 4 xorvar HOLO_ACCESS 32
		ife CHAR 5 xorvar HOLO_ACCESS 64
		ife CHAR 6 xorvar HOLO_ACCESS 128
		ife CHAR 7 xorvar HOLO_ACCESS 256
		ife CHAR 13 xorvar HOLO_ACCESS 512
		ife CHAR 14 xorvar HOLO_ACCESS 1024
		ife CHAR 15 { sound HOLO_SW_ERROR ife PLAYER_VOICEOVER 0 set PLAYER_VOICEOVER 14 break }
		sound HOLO_SWITCH
		action EIGHT
		}
	}
  }
}

enda

useractor notenemy 22332

ifaction 0
{
ifpdistl 1024
 ifcansee
  ifp pfacing
  {
  ifn HOLO_ACCESS 0
	  {
	  set player_use 0
	   ifhitspace
		{
		set hit_key 30
		setp[].weapon_pos 10
		sound HOLO_SWITCH
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED
		action FIVE
		resetactioncount
		}
	  }
	 else
	  ifhitspace
		{
		set hit_key 30
		action MINUSONE
		sound HOLO_SW_ERROR
		}
  }
}

ifaction MINUSONE ifactioncount 8 action 0

ifaction FIVE ifactioncount 2 { action SIX resetactioncount }
ifaction SIX ifactioncount 2 { action SEVEN resetactioncount }
ifaction SEVEN ifactioncount 2 { action EIGHT resetactioncount }
ifaction EIGHT ifactioncount 2 { action NINE resetactioncount }

enda

useractor notenemy 22342

ifaction 0
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	sound INTRO4_2
	action ONE
	}
}

ifaction ONE
{
soundonce INTRO4_2
checkactivatormotion HITAGSAVED
ifn RETURN 1
	{
	stopsound INTRO4_2
	action 0
	}
}

enda


// *************************************************
// HITSCAN END
// *************************************************

useractor notenemy 5064
ifcount 1 killit
enda

// *************************************************
// LASER SIGHT
// *************************************************

spriteflags 3023 16

spritenopal 3023
spritenoshade 3023

useractor notenemy 3023
seta[].blend 255
cstat 1154
iffloordistl 4 cstator 32
else ifceilingdistl 4 cstator 32
sizeat 6 6
seta[].shade -127
ifcount 1 killit
enda

// *************************************************
// IW SPRITE DOOR
// *************************************************


action DCLOSED 0 1 1 1 0
action DOPEN   0 6 1 1 5
action DOPENED 5 1 1 1 0
action DCLOSE  5 6 1 -1 5

useractor notenemy 13050
cstat 273 

ifaction 0
{
set INTERNALCOUNT 0
action DCLOSED
break
}

ifaction DCLOSED
 ifpdistl 1024
  ifp pfacing
   ifp palive
  {
  set player_use 0
	ifhitspace
	{
	set hit_key 30
	sound SOPEN
	action DOPEN
	}
  }

ifaction DOPEN
ifactioncount 6
{
action DOPENED
}

ifaction DOPENED
{
cstat 16

ifcount 1
{
add INTERNALCOUNT 1
resetcount
}

ife INTERNALCOUNT 50
	{
	sound SCLOSE
	action DCLOSE
	set INTERNALCOUNT 0
	}
}


ifaction DCLOSE
{
	ifactioncount 6
	{
	action DCLOSED
	cstat 273
	}
}

enda

// *************************************************
// SPRITE DOOR 2
// *************************************************


action D2CLOSED 0 1 1 1 0
action D2OPEN   0 7 1 1 5
action D2OPENED 6 1 1 1 0
action D2CLOSE  6 7 1 -1 5

useractor notenemy 18201

ifaction 0
{
cstat 273 
set INTERNALCOUNT 0
action D2CLOSED
break
}

ifaction D2CLOSED
{
ifn HITAGSAVED 0
	{
	sleeptime 0
	ifpdistl 1536 ifp pfacing { set player_use 0 ifhitspace { set hit_key 30 set door_locked 0 set key_icon 3587 soundonce LOCKED_HITECH2 } }
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		sound SOPEN
		action D2OPEN
		}
	}
	else
 ifpdistl 1536
  ifp pfacing
   ifp palive
	{
	  set player_use 0
		ifhitspace
		{
		set hit_key 30
		sound SOPEN
		action D2OPEN
		}
	}
 }

ifaction D2OPEN
ifactioncount 7
{
action D2OPENED
}

ifaction D2OPENED
{
cstat 16
ifn HITAGSAVED 0 nullop else
	{
	ifcount 1
		{
		add INTERNALCOUNT 1
		resetcount
		}
	ife INTERNALCOUNT 128
		{
		sound SCLOSE
		action D2CLOSE
		set INTERNALCOUNT 0
		}
	}
}


ifaction D2CLOSE
{
	ifactioncount 7
	{
	action D2CLOSED
	cstat 273
	}
}

enda

// *************************************************
// RUSTY GLASS
// *************************************************

useractor notenemy 401
ifspritepal 5
{
cstator 257
ifhitweapon
	{
	sound HITGLASS
	lotsofglass 5
	strength 1
	cactor 505
	}
}
enda

useractor notenemy 505
cstator 257
ifhitweapon
	{
	sound GLASS_BREAK3
	lotsofglass 25
	killit
	}
	else
	ifpdistl 1024
	ifp prunning
	{
	sound GLASS_BREAK3
	wackplayer
	ifrnd 32 { addphealth -10 palfrom 20 20 0 0 }
	lotsofglass 25
	killit
	}
enda


// *************************************************
// MINE DART THINGY
// *************************************************

defstate FIRE_RING
		spawn 3296
		set TEMP 0
		espawn 3296 add TEMP 128 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 256 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 384 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 512 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 640 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 768 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 896 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1024 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1152 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1280 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1408 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1536 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1664 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1792 seta[RETURN].ang TEMP
		espawn 3296 add TEMP 1920 seta[RETURN].ang TEMP
ends

action MINE_IDLE 0

spritenoshade 6814

useractor notenemy 6814
ifaction 0
{
cstat 0
seta[].shade -127
sizeat 16 16
findnearactor3d SHOOTME 768 TEMP9 
ife TEMP9 -1 findnearactor3d SHOOTME3 768 TEMP9
ifn TEMP9 -1 { action ZERO resetcount }
else { action MINE_IDLE resetcount }
}
else
ifaction ZERO
{
	seta[].x sprite[TEMP9].x
	seta[].y sprite[TEMP9].y
	geta[TEMP9].z TEMP3
	add TEMP3 -7120
	seta[].z TEMP3
	
		getactorvar[TEMP9].myowner TEMP8
		ifl sprite[TEMP8].extra 10 
			{ globalsound BARREL_EXPLODE spawn EXPLOSION2 hitradius 1524 50 75 125 250 ifspritepal 2 state FIRE_RING killit } 
		
	geta[].owner TEMP4
	getactorvar[TEMP4].RUSTY_MINE_GUN TEMP6
	ife TEMP6 1 
		{ 
		globalsound BARREL_EXPLODE
		espawn EXPLOSION2 
		seta[RETURN].cstat 130
		seta[RETURN].blend 255
		hitradius 1524 50 75 125 250 
		ifspritepal 2 state FIRE_RING
		killit
		}  
}
else
ifaction MINE_IDLE
{
geta[].owner TEMP4
getactorvar[TEMP4].RUSTY_MINE_GUN TEMP6
ifg TEMP6 0 
	{ globalsound BARREL_EXPLODE spawn EXPLOSION2 hitradius 1524 50 75 125 250 ifspritepal 2 state FIRE_RING killit }  
}

enda

// **************************************************************************************************
// AMC BASE STUFF
// **************************************************************************************************

useractor notenemy 10563

ifspritepal 3
	{
	ife VOLUME 0 killit
	}

enda

// *************************************************
// RANDOM GUNFIRE
// *************************************************

useractor notenemy 13214

ifmultiplayer killit

ife STOP_EFFECTS 1 killit

ifaction 0
{
cstat 32768
sleeptime 0
ife HITAGSAVED 0 action ZERO
else
	{
	checkactivatormotion HITAGSAVED
	 ife RETURN 1
	  action ZERO
	}
}

ifaction ZERO
{
ifn LOTAGSAVED 0 
	{
	checkactivatormotion LOTAGSAVED
	 ife RETURN 1
	  action 0
	}

	ifrnd 8
	ifg framerate 15
	{
	randvar TEMP3 2048
	ifrnd 128 mulvar TEMP3 -1
	ifspritepal 0 zshoot TEMP3 BLUELASERSHOT 
	else ifspritepal 1 zshoot TEMP3 13215
	else ifspritepal 2 spawn GROUNDEXPLOSION
	else ifspritepal 3 spawn EXPLOSION2
	else ifspritepal 6 
		{ ifrnd 8 sound EXPLOSION_LARGE else ifrnd 8 sound EXPLOSION_MEDIUM else ifrnd 8 sound EXPLOSION_BIG
		shoot SPARK shoot SPARK spawn BIG_EXPLOSION }
	else ifspritepal 8 spawn 8433
	}
}

enda

// *************************************************
// PROJECTILE FLARE
// *************************************************

spritenopal PROJECTILE_FLARE
spritenoshade PROJECTILE_FLARE

useractor notenemy PROJECTILE_FLARE
seta[].blend 255
ifaction 0
{
	ifspawnedby REDM_BLAST
	{
	seta[].shade -127
	sizeat 76 76
	spritepal 2
	cstat 642
	}
	ifspawnedby BLOOD_BLAST
	{
	seta[].shade -127
	sizeat 48 48
	spritepal 2
	cstat 642
	}
	ifspawnedby HADESBLAST
	{
	seta[].shade -127
	sizeat 16 16
	spritepal 2
	cstat 642
	}
	ifspawnedby LAVABALL
	{
	seta[].shade -127
	sizeat 24 24
	spritepal 2
	cstat 642
	}
	ifspawnedby 6221 // Aludran purple blast
		{
		seta[].shade -127
		sizeat 40 40
		spritepal 30
		cstat 642
		}
	ifspawnedby 9115
	{
	seta[].shade -127
	sizeat 24 24
	spritepal 2
	cstat 642
	}
	ifspawnedby 12712 // Anubis magic blast
		{
		seta[].shade -127
		sizeat 32 32
		spritepal 1
		cstat 642
		}
	ifspawnedby 12717 // SIREN Curse blast
		{
		seta[].shade -127
		sizeat 32 32
		spritepal 2
		cstat 642
		}
	ifspawnedby 14644
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 8
	cstat 642
	}
	ifspawnedby RUBYBLAST
	{
	seta[].shade -127
	sizeat 24 24
	spritepal 2
	cstat 642
	}
	ifspawnedby HADESBLASTH
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 2
	cstat 642
	}
	ifspawnedby BRUISERFIREBALL
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 2
	cstat 642
	}
	ifspawnedby 15175
	{
	seta[].shade -127
	sizeat 40 40
	spritepal 2
	cstat 642
	}
	ifspawnedby 7163
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 2
	cstat 642
	}
	ifspawnedby SPELL2
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 1
	cstat 642
	}
	ifspawnedby GOLD_SPELL2
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 7
	cstat 642
	}
	ifspawnedby HEAT_SINK
	{
	seta[].blend 255
	seta[].shade -12
	sizeat 12 12
	spritepal 2
	cstat 642
	}
	ifspawnedby 6198
	{
	seta[].shade -127
	sizeat 12 12
	spritepal 1
	cstat 642
	}
	ifspawnedby 7159
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 1
	cstat 642
	}
	ifspawnedby 9376
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 19
	cstat 642
	}
	ifspawnedby SHRINKSPARK
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 8
	cstat 642
	}
	ifspawnedby SPELL4
	{
	seta[].shade -127
	sizeat 32 32
	spritepal 2
	cstat 642
	}
	ifspawnedby BRUISER
	{
	seta[].shade -127
	sizeat 64 64
	spritepal 2
	cstat 1666
	}
	ifspawnedby SPELL5
	{
	seta[].shade -127
	sizeat 16 16
	spritepal 2
	cstat 642
	}
	ifspawnedby SPELL14
	{
	seta[].shade -127
	sizeat 16 16
	spritepal 2
	cstat 642
	}
	ifspawnedby SPELL8
	{
	seta[].shade -127
	sizeat 20 20
	spritepal 49
	cstat 642
	}
	ifspawnedby 7047
	{
	seta[].shade -127
	sizeat 48 48
	spritepal 2
	cstat 642
	}
	ifspawnedby 22828
	{
	seta[].shade -127
	sizeat 48 48
	spritepal 2
	cstat 642
	}
	ifspawnedby 7052
	{
	seta[].shade -127
	sizeat 48 48
	spritepal 2
	cstat 642
	}
	ifspawnedby PRIEST_BLAST
	{
	seta[].shade -127
	sizeat 24 24
	spritepal 19
	cstat 642
	}
	action ZERO
}
ifcount 1 killit
enda


// *************************************************
// MECH TUBE
// *************************************************

useractor notenemy 10637

ifspritepal 3
 ifpdistl 4096
  ifn player_using_mech -1
   killit

enda

// *************************************************
// ACTIVATE STUFF IF INVENTORY INVEN ACTIVE
// ACTIVATE IF NEAR
// *************************************************

useractor notenemy 3347
cstat 32768

ife HITAGSAVED 0 set HITAGSAVED 1024

dist TEMP6 THISACTOR player[].i

ifn XVELSAVED 0
{
action ZERO
checkactivatormotion XVELSAVED
ife RETURN 1 { action 0 set XVELSAVED 0 }
}

ifl TEMP6 HITAGSAVED
 ifaction 0
	{
	ifg EXTRASAVED 0
		{
		screensound EXTRASAVED
		}
	ifspritepal 0
		{
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED
		killit		
		}
	ifspritepal 100
	 ife player_in_vehicle 0
		{
		operateactivators LOTAGSAVED THISACTOR
		operaterespawns LOTAGSAVED
		operatemasterswitches LOTAGSAVED
		killit		
		}
	ifspritepal 1
		{
		ifg GOT_EXPLOSIVE 0 
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	ifspritepal 2
		{
		ifg GAS_MASK 0 
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	ifspritepal 3
		{
		ifg TOOLBOX 0 
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	ifspritepal 4
		{
		ifg JUMP_BOOTS 0 
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	ifspritepal 6
		{
		ifcansee
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	ifspritepal 7
		{
		ifcansee
		 ifp pfacing
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	ifspritepal 8
		{
		ifn player_using_mech -1
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	ifspritepal 10
		{
		ife TEMPLE_KEY 4
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		ifand TEMPLE_KEY 1
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	}

enda

// *************************************************
// RADIATION SCREEN
// *************************************************

useractor notenemy 14034

ifaction 0
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		action TWO
		}
	}

enda

// *************************************************
// WELD POINT
// *************************************************

action MELTED -7

useractor notenemy 6582

ifaction 0
	{
	cstat 257
	action ONE
	}
	
ifaction ONE
	{
	strength 100
		ifhitweapon
			{
				ife sprite[].htpicnum MELTA_BEAM
					{
					getactorvar[myowner].TEMP6 TEMP6
					add TEMP6 1
					setactorvar[myowner].TEMP6 TEMP6
					sound COOKINGDEEPFRIER
					shoot SPARK
					sizeto 32 32
					action MELTED
					resetcount
					}
				strength 1
			}
	}
	
	ifaction MELTED
		{
		seta[].blend 255
		cstat 146
		ifcount 26 sizeto 8 8
		ifcount 32 spritepal 4
		ifcount 52 killit
		}


enda

action MELTED_2 -6

useractor notenemy 6581 // master weld point

ifaction 0
	{
	cstat 32768
	set TEMP4 0
	set TEMP 0
		whilevarn TEMP 16384
		{
		  ifn sprite[TEMP].statnum 1024
		  {
			ife sprite[TEMP].picnum 6582
				{
				getactorvar[TEMP].HITAGSAVED TEMP8
				ife TEMP8 HITAGSAVED
					{
					add TEMP4 1
					setactorvar[TEMP].myowner THISACTOR
					}
				}
		  }
		  add TEMP 1
		}
	sub TEMP4 1
	action ZERO
	}
	
ifaction ZERO
	{
		ifg TEMP6 TEMP4
			{
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
	}
	
enda

useractor notenemy 14038 // slashed grate

ifaction 0 { cstator 257 strength 100 action ZERO }

ifaction ZERO
	{
	ifp pfacing
	 ifpdistl 2048
	 ife FIRE_SUIT 1
		{
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			sound COOKINGDEEPFRIER
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			action ONE
			}
		}
	
		ifn sprite[].htextra 0
			{
				ife sprite[].htpicnum MELTA_BEAM
					{
					sound COOKINGDEEPFRIER
					shoot SPARK
					shoot SPARK
					shoot SPARK
					shoot SPARK
					operateactivators LOTAGSAVED THISACTOR
					operaterespawns LOTAGSAVED
					operatemasterswitches LOTAGSAVED
					action ONE
					}
				strength 1
			}
	}
	


enda

// *************************************************
// TIME DELAY
// *************************************************

useractor notenemy 3592
cstat 32768


ifaction 0
	{
	checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			action ZERO
			set INTERNALCOUNT 0
			ifspritepal 1 set END_LEVEL 90
			}
	}
	
ifaction ZERO
	{
	ifspritepal 1
		{
		 ife END_LEVEL 0
			{
			ifn XVELSAVED 0 globalsoundvar XVELSAVED
			ifn YVELSAVED 0 set destruct_trigger YVELSAVED
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}
	else
		{
		add INTERNALCOUNT 1
		ifspritepal 3 addlogvar INTERNALCOUNT
		 ife INTERNALCOUNT EXTRASAVED
			{
			ifn XVELSAVED 0 globalsoundvar XVELSAVED
			ifn YVELSAVED 0 set destruct_trigger YVELSAVED
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		}

	}

enda

// *************************************************
// WORLD TRIGGER
// *************************************************

useractor notenemy 22771
ifaction 0 { cstat 32768 action ZERO }

ifvarvarand WORLD_TRIGGER LOTAGSAVED killit

ifn HITAGSAVED 0
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	xorvarvar WORLD_TRIGGER LOTAGSAVED
	killit
	}
}
else
ife sprite[].sectnum player[].cursectnum
{
xorvarvar WORLD_TRIGGER LOTAGSAVED
killit
}

enda

// ****************************************************************************************************************************************************************************************************
// SPRITE DETECTOR
// ****************************************************************************************************************************************************************************************************

useractor notenemy SPRITE_DETECT
ifaction 0
	{
	cstat 32768
	ife HITAGSAVED 0 set HITAGSAVED 1024
	action ZERO
	}
sleeptime 0
ifcount 30
	{
	ifspritepal 0 findnearsprite3dvar BATTERY_SPRITE HITAGSAVED TEMP
	ifn TEMP -1
		{
		operateactivators LOTAGSAVED THISACTOR
		operatemasterswitches LOTAGSAVED
		operaterespawns LOTAGSAVED
		killit
		}
	resetcount
	}

enda

// ****************************************************************************************************************************************************************************************************
// SPECIAL EFFECTS
// ****************************************************************************************************************************************************************************************************

defstate PATCOS_SMASH
operateactivators LOTAGSAVED THISACTOR
set PATCOS_CHARGE 120
ifpdistl 1536 { palfrom 60 60 0 0 addphealth -60 }
killit
ends

useractor notenemy 3586
cstat 32768

ifspritepal 1
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	palfrom 64 0 64 0
	globalsound TELEPORTER
	killit
	}
}
ifspritepal 3
{
ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		palfrom 64 64 64 64 
		wackplayer
		stopallsounds
		globalsound MIND_ATTACK
		killit
		}
	}
	else
	ifpdistl 1024
	 ifcansee
	  ifp palive
		{
		palfrom 64 64 64 64 
		wackplayer
		stopallsounds
		globalsound MIND_ATTACK
		killit
		}
}
ifspritepal 4
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	set STOP_EFFECTS 1
	stopallsounds
	killit
	}
}
ifspritepal 5
{
ifn HITAGSAVED 0
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	set skybox_tile LOTAGSAVED
	}
}
else
ifn EXTRASAVED -1
{
ifpdistl 1024
	{
	ife EXTRASAVED 0 set skybox_tile -1
	else set skybox_tile EXTRASAVED
	}
}
else
	{
	set skybox_tile LOTAGSAVED
	killit
	}
}
ifspritepal 6
{
ifpdistl 1024
	{
	ifn ALLYSLOT1 -1 { setactorvar[ALLYSLOT1].FOLLOW_PLAYER 0 set ALLYSLOT1 -1 }
	ifn ALLYSLOT2 -1 { setactorvar[ALLYSLOT2].FOLLOW_PLAYER 0 set ALLYSLOT2 -1 }
	ifn ALLYSLOT3 -1 { setactorvar[ALLYSLOT3].FOLLOW_PLAYER 0 set ALLYSLOT3 -1 }
	ifn ALLYSLOT4 -1 { setactorvar[ALLYSLOT4].FOLLOW_PLAYER 0 set ALLYSLOT4 -1 }
	}
}
ifspritepal 7 // an ugly hack to temporarily fix the glitches in shadow realm until hopefully the E32 team can fix them
{
ifaction 0
	{
	gets[].floorpicnum TEMP
	gets[].ceilingpicnum TEMP2
	ife EXTRASAVED -1 set EXTRASAVED 4608
	ife EXTRASAVED 0 set EXTRASAVED 4608
	action ZERO
	}
ifaction ZERO
	{
	sleeptime 0
	ifpdistg 81920
		{
		ife TEMP3 0
			{
			sets[].floorpicnum EXTRASAVED
			sets[].ceilingpicnum EXTRASAVED
			set TEMP3 1
			}
		}
		else
		{
		ife TEMP3 1
			{
			sets[].floorpicnum TEMP
			sets[].ceilingpicnum TEMP2
			set TEMP3 0
			}
		}
	}
}
ifspritepal 8
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	set CIVS_PANIC 1
	killit
	}
}
ifspritepal 9 // Digging spot for combat shovel
{
ife GOT_KNIFE 3
	{
	ifpdistl 1536
	 ifp palive
		{
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			action ZERO
			}
		}
	}
ifaction ZERO
	{
	setp[].weapon_pos 10
		add INTERNALCOUNT 1
		ife INTERNALCOUNT 2 { sound DIG_UP palfrom 6 0 0 0 }
		else ife INTERNALCOUNT 4 palfrom 18 0 0 0
		else ife INTERNALCOUNT 6 palfrom 30 0 0 0
		else ife INTERNALCOUNT 8 palfrom 42 0 0 0
		else ife INTERNALCOUNT 10 palfrom 54 0 0 0
		else ifg INTERNALCOUNT 12 ifl INTERNALCOUNT 240 
			{
			ifrnd 2 set PLAYER_VOICEOVER 2
			palfrom 64 0 0 0
			}
		else ife INTERNALCOUNT 240
			{
			palfrom 64 0 0 0
			operateactivators HITAGSAVED THISACTOR
			operaterespawns HITAGSAVED
			operatemasterswitches HITAGSAVED
			}
		else ifg INTERNALCOUNT 240
			{
			palfrom 64 0 0 0
			}
		ifg INTERNALCOUNT 300 killit
	}
}
ifspritepal 10 // TANK RUN OVER
{
ifpdistl 6100
 {
 getactorvar[PLAYER_IDENTITY].ANGLE TEMP
 ifn TEMP 0
	 {
	 operateactivators HITAGSAVED THISACTOR
	 operaterespawns HITAGSAVED
	 operatemasterswitches HITAGSAVED
	 lotsofglass 15
	 quake 20
	 sound GLASS_BREAKING
	 spawn BIG_SMOKE2 spawn BIG_SMOKE2 spawn BIG_SMOKE2
	 debris SCRAP1 20
	 debris SCRAP2 20
	 soundonce CARSMASH
	 killit
	 }
 }
else // check for enemy tank
	{
	ifcount 5
		 {
		 findnearactor3d 13608 4000 TEMP3
		 ifn TEMP3 -1
			{
			 operateactivators HITAGSAVED THISACTOR
			 operaterespawns HITAGSAVED
			 operatemasterswitches HITAGSAVED
			 lotsofglass 15
			 quake 20
			 sound GLASS_BREAKING
			 spawn BIG_SMOKE2 spawn BIG_SMOKE2 spawn BIG_SMOKE2
			 debris SCRAP1 20
			 debris SCRAP2 20
			 soundonce CARSMASH
			 killit
			}
		resetcount
		}
	}
}
ifspritepal 11 // deactivates hard-coded forcefield on trigger
{
ifaction 0
	{
	set TEMP7 0
	whilevarvarn TEMP7 NUMWALLS
		{
			ife wall[TEMP7].picnum 663
			 ife wall[TEMP7].hitag HITAGSAVED
				{
				set TEMP5 TEMP7
				action ZERO
				}
		add TEMP7 1
		}
	action ZERO
	}	
ifaction ZERO
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		setwall[TEMP5].overpicnum 0
		setwall[TEMP5].cstat 0
		getwall[TEMP5].nextwall TEMP6
		setwall[TEMP6].overpicnum 0
		setwall[TEMP6].cstat 0
		}
	}
	
}
ifspritepal 12 // flashes the screen blue
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	wackplayer
	palfrom 64 0 0 64
	killit
	}
}
ifspritepal 13 // simple floor change actor
{
sleeptime 0
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
			sets[].floorpicnum LOTAGSAVED
			}
}
ifspritepal 14 // activate this on level start 
{
operateactivators HITAGSAVED THISACTOR
operaterespawns HITAGSAVED
operatemasterswitches HITAGSAVED
killit
}
ifspritepal 15 // quick and dirty floor + ceiling pic changer
{
		ifcount 13
			ife sector[].floorshade sprite[].shade
			{
			sets[].floorpicnum LOTAGSAVED
			sets[].ceilingpicnum HITAGSAVED
			resetcount
			}
}
ifspritepal 16 // sets it to play water wading sounds, for sprite water stuff
{
	gets[].floorstat TEMP
	xorvar TEMP 65536
	sets[].floorstat TEMP
killit
}
ifspritepal 17 // PATCOS ATTACK POINT
{
ifaction 0
	{
	ifg PATCOS_CHARGE 0 action ZERO
	}
ifaction ZERO
	{
	ifpdistl 1024
	 ifp palive
	 ife PATCOS_CHARGE 0
		{
		sound CARSTRAIN
		screensound CARSTRAIN
		quake 26
		action FORM
		}
	}
ifaction FORM
	{
	add INTERNALCOUNT 1
	ife SKILL_LEVEL 1 ifg INTERNALCOUNT 120 state PATCOS_SMASH
	else ife SKILL_LEVEL 2 ifg INTERNALCOUNT 90 state PATCOS_SMASH
	else ife SKILL_LEVEL 3 ifg INTERNALCOUNT 60 state PATCOS_SMASH
	else ife SKILL_LEVEL 4 ifg INTERNALCOUNT 30 state PATCOS_SMASH
	else ife SKILL_LEVEL 5 ifg INTERNALCOUNT 20 state PATCOS_SMASH
	}	
}
ifspritepal 18
{
sleeptime 0
findnearactor3d 1404 512 TEMP
ifn TEMP -1
	{
	setactorvar[TEMP].ZVELSAVED 1
	setactorvar[TEMP].ZPOS_SAVED sprite[THISACTOR].z
	killit
	}
}
ifspritepal 19
{
ife HITAGSAVED 0
ife LOTAGSAVED 0
	{
	set INJURED EXTRASAVED
	ifcount 30 killit
	}
else
ifn LOTAGSAVED 0
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		set INJURED EXTRASAVED killit
		}
	}
else
ifn HITAGSAVED 0
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		set INJURED 0 killit
		}
	}
}
ifspritepal 20
{
sleeptime 0
setp[].weapon_pos 10
set HIDE_CROSSHAIR 1
checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		set HIDE_CROSSHAIR 0
		killit
		}
}
ifspritepal 21 // Vacation stuff
{
set INVEN_REPLACE 1
killit
}
ifspritepal 22 // electric floor
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		gets[].floorstat TEMP
		xorvar TEMP 16384
		sets[].floorstat TEMP
		killit
		}
	}
ifspritepal 23
{
ifcansee
	{
	ifg sector[].floorz sprite[].z
		{
		ifactorsound THISACTOR LOTAGSAVED nullop else soundvar LOTAGSAVED
		}
	}
}
ifspritepal 24 // play sound until activated
	{
	ifactorsound THISACTOR LOTAGSAVED nullop else soundvar LOTAGSAVED
	checkactivatormotion HITAGSAVED ife RETURN 1 killit
	}
ifspritepal 25 // low gravity
	{
	gets[].ceilingstat TEMP
	xorvar TEMP 16384
	sets[].ceilingstat TEMP
	killit
	}
ifspritepal 26 // club doom music
{
ifaction 0 
	{
	set INTERNALCOUNT 0
	starttrack 15
	action BREAK
	}
ifaction BREAK
	{
	ifcansee break
	getmusicposition TEMP
	starttrack 39
	setmusicposition TEMP
	action ZERO
	}
ifaction ZERO
 ifcansee
	{
	getmusicposition TEMP
	starttrack 15
	setmusicposition TEMP
	action BREAK
	}
}
ifspritepal 27 // activate this
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	operateactivators HITAGSAVED THISACTOR
	operaterespawns HITAGSAVED
	operatemasterswitches HITAGSAVED
	killit
	}
}
ifspritepal 28
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	set global_trigger HITAGSAVED
	killit
	}

}
ifspritepal 29 // water bubbles
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	spawn WATERBUBBLE spawn WATERBUBBLE spawn WATERBUBBLE spawn WATERBUBBLE spawn WATERBUBBLE
	killit
	}
}
ifspritepal 30 // water push
{
ifpdistl 1024
	{
	getp[].ohoriz TEMP sub TEMP 12 setp[].ohoriz TEMP
	palfrom 20 0 0 20
	}
}
ifspritepal 31
ifpdistl 16384
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	ifactorsound THISACTOR EXTRASAVED nullop else soundoncevar EXTRASAVED
	action ZERO
	}
else
ifaction ZERO
	{
	stopsoundvar EXTRASAVED
	soundoncevar HITAGSAVED
	action 0
	}
}
ifspritepal 32 // curtain (used for walking through masked walls)
{
ifpdistl 1024
 ifaction 0
	{
	sound CURTAIN_PULLB
	action ZERO
	}
ifaction ZERO ifpdistg 1024 action 0
}
ifspritepal 33 // air current
{
ife HITAGSAVED 0 set HITAGSAVED 256
getp[].i PLAYER_IDENTITY
	ife sprite[PLAYER_IDENTITY].sectnum sprite[].sectnum
	{
	ifp phigher nullop
		else
			{
			ife player[].jumping_toggle 0
				{
				setp[].jumping_counter 361
				setp[].jumping_toggle 1
				}
			setp[].falling_counter 0
			getp[].poszv TEMP
			sub TEMP HITAGSAVED
			setp[].poszv TEMP
			getp[].posz TEMP2
			sub TEMP2 8
			setp[].posz TEMP2
			}
	}
}
ifspritepal 34 // force floorz
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	sets[].floorz sprite[].z
	killit
	}
}
ifspritepal 35 // kill all in sector
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	geta[].sectnum mysector

	headspritesect spriteid mysector
	whilevarn spriteid -1
		{
		addlogvar spriteid
			ife sprite[spriteid].hitag HITAGSAVED
				{
				seta[spriteid].htextra 140
				seta[spriteid].htpicnum RADIUSEXPLOSION
				seta[spriteid].htowner spriteid
				seta[spriteid].xrepeat 0
				seta[spriteid].yrepeat 0
				}
			nextspritesect spriteid spriteid
		}	
	killit
	}
}
ifspritepal 36 // teleport break
{
ifpdistl 1024
	{
	spawn TRANSPORTERBEAM
	globalsound SOMETHINGHITFORCE
	globalsound SHORT_CIRCUIT
	shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	palfrom 16 64 64 64
	killit
	}
}
ifspritepal 37 // testing purposes
{
ifpdistl 1024
	{
	globalsound RESEARCH_DATA
	set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13331
	killit
	}
}
ifspritepal 38 // remove gravity protection from 1404
{
sleeptime 0
findnearactor3d 1404 512 TEMP
ifn TEMP -1
	{
	setactorvar[TEMP].ZVELSAVED 0
	killit
	}
}
ifspritepal 39 // sector that player can't reach, use to stop plants spawning targetting stuff .etc perf reasons
	{
	gets[].ceilingstat TEMP
	xorvar TEMP 8192
	sets[].ceilingstat TEMP
	killit
	}
ifspritepal 40 // fix floor shades
	{
	ifn sprite[].shade sector[].floorshade
		{
		headspritesect spriteid sprite[].sectnum
		whilevarn spriteid -1
			{
			geta[spriteid].shade TEMP
			ifn TEMP sector[].floorshade
			 ifg sprite[spriteid].picnum 10 // don't shade built in effectors
				{
				ifand sprite[spriteid].htflags 4 nullop else
				seta[spriteid].shade sector[].floorshade
				}
			nextspritesect spriteid spriteid
			}
		}
	}
ifspritepal 41 // kill all target actors
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
		set TEMP 0
		whilevarn TEMP 16384
		{
		  geta[TEMP].statnum STATNUM
		  ifn STATNUM 1024
		  {
			geta[TEMP].picnum TEMP2
			ife TEMP2 SHOOTME
			{
			seta[TEMP].xrepeat 0
			seta[TEMP].yrepeat 0
			}
		  }
		  add TEMP 1
		}
		killit
	}
}
ifspritepal 42 // maeph beam
{
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
		shoot MAEPH_BEAM
		screensound MAEPH_FIRE
		shoot SPARK
		shoot SPARK
		shoot SPARK
		palfrom 64 64 64 64
		killit
	}
}
ifspritepal 43 // micky begins skipper
{
ifand BEAT_EPISODES[3] 16
	{
	operateactivators 20500 THISACTOR
	}
killit
}
enda

// #################################################
// Upside down camera
// #################################################

spriteshadow 1411

useractor notenemy 1411 ifaction 0 action ACAR enda

// #################################################
// Space Suit stuff
// #################################################

useractor notenemy 22447
cstat 32768



ifspritepal 2
{
	ifcansee
	ifcanseetarget
	 ifpdistl 2048
	 ife inspace 0
		{
		add TEMP 1
		ifg TEMP 4
			{
			ife CHAR 12 soundonce SPACESUIT_ON
			ife CHAR 13 soundonce SPACESUIT_ON
			ife CHAR 14 soundonce SPACESUIT_ON
			ife SPACE_SUIT 1 soundonce SPACESUIT_ON
			setp[].sound_pitch -200 
			set inspace 1
			set TEMP 0
			}
		}
}
ifspritepal 3 // exit door
{
	ifcansee
	ifcanseetarget
	 ife inspace 1
		{
		add TEMP 1
		ifg TEMP 4
			{
			setp[].sound_pitch 0
			ife CHAR 12 soundonce SPACESUIT_OFF
			ife CHAR 13 soundonce SPACESUIT_OFF
			ife CHAR 14 soundonce SPACESUIT_OFF
			ife SPACE_SUIT 1 soundonce SPACESUIT_OFF
			set inspace 0
			set TEMP 0
			}
		}
}
ifspritepal 4
{
ife CHARSELECT 0
	{
	ifn CHAR 12
	 ifn CHAR 13
	  ifn CHAR 14
	   set SPACE_SUIT 1 
	soundonce SPACESUIT_ON
	set LIFE_SUPPORT 14400
	setp[].sound_pitch -200 
	set inspace 1
	killit
	}
}
ifspritepal 5
{
	getp[].i PLAYER_IDENTITY
		ife sprite[PLAYER_IDENTITY].sectnum sprite[].sectnum
		 ife inspace 0
			{
			ife CHAR 12 soundonce SPACESUIT_ON
			ife CHAR 13 soundonce SPACESUIT_ON
			ife CHAR 14 soundonce SPACESUIT_ON
			ife SPACE_SUIT 1 soundonce SPACESUIT_ON
			setp[].sound_pitch -200 
			set inspace 1
			set TEMP 0
			}
}
ifspritepal 6
{
	getp[].i PLAYER_IDENTITY
		ife sprite[PLAYER_IDENTITY].sectnum sprite[].sectnum
		 ife inspace 1
			{
			setp[].sound_pitch 0
			ife CHAR 12 soundonce SPACESUIT_OFF
			ife CHAR 13 soundonce SPACESUIT_OFF
			ife CHAR 14 soundonce SPACESUIT_OFF
			ife SPACE_SUIT 1 soundonce SPACESUIT_OFF
			set inspace 0
			set TEMP 0
			}
}
ifspritepal 8
{
			setp[].sound_pitch 0
			soundonce SPACESUIT_OFF
			set inspace 0
			set SPACE_SUIT 0
			set TEMP 0
			killit
}
enda


// *************************************************
// Dirt splotch
// *************************************************

useractor notenemy 13243
ifn HITAGSAVED 0
	{
	ifaction 0
		{
		cstat 32768
		action ZERO
		}
	}
	
ifaction ZERO
	{
	checkactivatormotion HITAGSAVED
		ife RETURN 1 { seta[].cstat CSTATSAVED action FORM }
	}
	
enda

// *************************************************
// PRECOG BRAIN ie how many people will read the the signs?
// *************************************************

useractor notenemy 11050

ifaction 0
{
cstat 257
action ZERO
}

ifpdistl 1524
 ifaction ZERO
  ifp pfacing
   ifp palive
    ifcansee
	{
	set player_use 0
		ifhitspace
		 ifcount 13
			{
			set hit_key 30
			stopallsounds
			globalsound MIND_ATTACK
			set player_spooked 98 
			palfrom 64 64 64 64 
			wackplayer
			state setknockback
			resetcount
			}
	}
	
ifhitweapon
	{
	spawn BLOOD 
	guts JIBS6 8
	stopallsounds
	globalsound MIND_ATTACK
	ifn HITAGSAVED 0
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED
		}
	else
	{
	set player_spooked 98 
	addphealth -10
	}
	palfrom 64 64 64 64 
	wackplayer
	state setknockback
	action ONE
	}

enda

// ***************************************************************************************************************************************************
// ARROW STUCK IN ENEMIES
// ***************************************************************************************************************************************************


defstate arrow_stuck_code
ifaction 0
	{
	ifactor 18069 sizeat 16 16
	else ifactor 18074 sizeat 16 16
	else sizeat 8 8
	cstat 16
	seta[].x sprite[myowner].x
	seta[].y sprite[myowner].y
	
	geta[myowner].z TEMP
	sub TEMP TEMP5
	seta[].z TEMP
	
	geta[myowner].ang TEMP
	add TEMP TEMP2
	seta[].ang TEMP
	
	ifl sprite[myowner].extra 1 { insertspriteq action ZERO }
	ife sprite[myowner].statnum 1024 { insertspriteq action ZERO }
	
	ifcount 26
		{
		ifrnd 16 { insertspriteq action ZERO }
		resetcount
		}
	
	}

ifaction ZERO
{
fall
ifactor 18069 cactor FIRSTGUNSPRITE
ifactor 18074 cactor FIRSTGUNSPRITE
}

ends

useractor notenemy 12282 state arrow_stuck_code enda // silver bolt
useractor notenemy 12283 state arrow_stuck_code enda // bolt
useractor notenemy 12284 state arrow_stuck_code enda // arrow
useractor notenemy 18097 state arrow_stuck_code enda // arrow
useractor notenemy 18069 state arrow_stuck_code enda // stuck dagger
useractor notenemy 18074 state arrow_stuck_code enda // stuck gold dagger

// ***************************************************************************************************************************************************
// DANCE DANCE BYATCH
// ***************************************************************************************************************************************************


// breakdancin' Micky

spriteshadow 17610

useractor notenemy 17610
ifaction 0 action ACAR
ifaction ACAR
	{
	geta[].ang TEMP
	add TEMP 128
	seta[].ang TEMP
	}
enda

// Spinnin' Sang

spriteshadow 17605

useractor notenemy 17605
ifaction 0 action ACAR
ifaction ACAR
	{
	geta[].ang TEMP
	add TEMP 128
	seta[].ang TEMP
	}
enda


// ***************************************************************************************************************************************************
// BULLET PENETRATION ===============================================================================
// ***************************************************************************************************************************************************

useractor notenemy 5131
cstat 32768
sizeat 32 32
ifaction 0
{
geta[].extra TEMP2
divvar TEMP2 2
setprojectile[NINEMM_CALIBRE].extra TEMP2
shoot NINEMM_CALIBRE
setprojectile[NINEMM_CALIBRE].extra 8
killit
}
enda

// ***************************************************************************************************************************************************
// SPOTLIGHT
// ***************************************************************************************************************************************************

spritenoshade 3070

defstate SHADE_CLOSER
ifaction 0
	{
	sleeptime 0
	dist xydist THISACTOR player[].i
	shiftvarr xydist 8
	ifl xydist 0 set xydist 0
	// sub xydist 127
	set TEMP4 96
	sub TEMP4 xydist
	ifl TEMP4 -127 set TEMP4 -127
	ifg TEMP4 127 set TEMP4 127
	seta[].shade TEMP4
	}
ends

useractor notenemy 3069 state SHADE_CLOSER enda
useractor notenemy 3070 state SHADE_CLOSER enda

// ***************************************************************************************************************************************************
// SPEECH BUBBLE (sizing code by DeeperThought)
// ***************************************************************************************************************************************************

useractor notenemy 12263
ifaction 0
{
  seta[].mdflags 16
  set TEMP4 0
  cstat 128
  action ZERO
 }
  
ifaction ZERO
{
sleeptime 0
dist xydist THISACTOR player[].i
shiftvarr xydist 8
ifl xydist 0 set xydist 0
add xydist 32
ifg xydist 255 set xydist 255
ifpdistl 2548 
	{
	// addlogvar alpha
	ifl TEMP4 254 add TEMP4 8
	}
	else
	ifpdistg 2547
	{
	ifg TEMP4 0 sub TEMP4 8
	}
set alpha TEMP4
state SPRITE_FADE
seta[].xrepeat xydist
seta[].yrepeat xydist
geta[].owner TEMP
ife sprite[TEMP].statnum 1024 killit
ifl sprite[TEMP].extra 1 killit
}
enda

// ***************************************************************************************************************************************************
// REACTOR
// ***************************************************************************************************************************************************

useractor notenemy 1091
ifpdistl 2048
 ifrnd 6
	{
	soundonce SHORT_CIRCUIT
	palfrom 10 10
	addphealth -4
	}
	
ifhitweapon
	{
	soundonce CHOPPER_EXPLODE
	hitradius 4096 5 15 20 40
	spawn EXPLOSION2
	quake 26
	shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	debris SCRAP1 10
	debris SCRAP2 8
	debris SCRAP3 8
	debris SCRAP4 8
	debris SCRAP5 8
	operateactivators LOTAGSAVED THISACTOR
	operaterespawns LOTAGSAVED
	operatemasterswitches LOTAGSAVED
	cactor REACTORBURNT
	}
	
enda

useractor notenemy 1095

ifaction 0 { seta[].blend 255 action ZERO }

checkactivatormotion LOTAGSAVED
ife RETURN 1 
	{
	shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2
	shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2
	killit
	}

	
enda

// ***************************************************************************************************************************************************
// GLINT (code and idea by DeeperThought aka Dan Gaskill)
// ***************************************************************************************************************************************************

spritenoshade GLINT
spritenopal GLINT
useractor notenemy GLINT 0

ifspawnedby 3655
	{
	fall
	state getfloordist
	seta[].z z
	}

ifcount 26
{	
	sizeto 0 0
}
else
{
	cstator 1154
	seta[].blend 255
	sizeto 16 16
}

enda

// ***************************************************************************************************************************************************
// GRASS CODE BY DeeperThought aka Dan Gaskill
// ***************************************************************************************************************************************************


defstate FIND_CENTER_OF_SECTOR
// also calculates area of sector

whilevarvarn currwall sector[sect].wallnum
{
	ife currwall 0 
	{
		set SMALLX wall[wallpoint].x set BIG_X wall[wallpoint].x 
		set SMALLY wall[wallpoint].y set BIGY wall[wallpoint].y 
	}
	else
	{
		ifl wall[wallpoint].x SMALLX set SMALLX wall[wallpoint].x else
		ifg wall[wallpoint].x BIG_X set BIG_X wall[wallpoint].x
		
		ifl wall[wallpoint].y  SMALLY set SMALLY wall[wallpoint].y  else
		ifg wall[wallpoint].y  BIGY set BIGY wall[wallpoint].y 
	}
	
	add wallpoint 1
	add currwall 1
}

sub BIG_X SMALLX
sub BIGY SMALLY
ifl BIG_X 0 mulvar BIG_X -1
ifl BIGY 0 mulvar BIGY -1
set x BIG_X
shiftvarr x 3
set y BIGY
shiftvarr y 3
set area x
mulvarvar area y
shiftvarr area 11
ifg area 320 set area 320

ends

defstate spawngrass
	gets[sect].wallptr wallpoint // get the firstwall of the sector
	// ife wallpoint -1 break
	set currwall 0
	state FIND_CENTER_OF_SECTOR
	// mx, my is the center point
	// BIG_X is the x length of sector
	// BIGY is the y length of sector
		
	set TEMP5 0
	//add attempts area
	whilevarvarn TEMP5 area
	{
		randvarvar TEMP2 BIG_X
		randvarvar TEMP3 BIGY
		set x SMALLX
		set y SMALLY
		add x TEMP2
		add y TEMP3
		updatesector x y TEMP4
		ife sect TEMP4
		ifrnd 128
		{
			add TEMP5 1
			add grasscount 1
			ifspritepal 8 // xuglop
			{
			ifrnd 128 espawn 5421 else
			ifrnd 128 espawn 5420 else
			espawn 8065
			}
			else
			{
			ifrnd 128 espawn 5421 else
			ifrnd 128 espawn 5420 else
			espawn 5422
			}
			ifn sector[sect].floorslope 0
			{
				getflorzofslope sect x y z
				ifrnd 128
				seta[RETURN].cstat 2 else
				seta[RETURN].cstat 6	
			}
			else 
			{
				gets[sect].floorz z
				seta[RETURN].cstat 16
			}
			seta[RETURN].pal sector[sect].floorpal
			setsprite RETURN x y z
			changespritestat RETURN 1
			seta[RETURN].xrepeat 12
			randvar TEMP3 4 add TEMP3 12
			seta[RETURN].yrepeat TEMP3
			seta[RETURN].shade sector[sect].floorshade
		}
		ifl TEMP5 area
		add TEMP5 1
		// ifg grasscount 7000 set TEMP5 area
	}
	
ends

useractor notenemy 5430
cstat 32768

ifaction 0
{
set grasscount 0
set sect 0
whilevarvarn sect NUMSECTORS
	{
		ife sector[sect].floorpicnum sector[].floorpicnum ife sector[sect].lotag 0 state spawngrass
		add sect 1
		ifg grasscount 6000 set sect NUMSECTORS // failsafe
	}
killit
}

enda

// *************************************************
// MAGIC CIRCLES
// *************************************************

defstate MAGIC_CIRCLES
ife LOTAGSAVED 1 nullop
else ife LOTAGSAVED 2
{
ife TEMP5 1
	{
	geta[].shade TEMP6
	add TEMP6 1
	seta[].shade TEMP6
	ifg TEMP6 24 set TEMP5 0
	}
else
ife TEMP5 0
	{
	geta[].shade TEMP6
	sub TEMP6 1
	seta[].shade TEMP6
	ifl TEMP6 -6 set TEMP5 1
	}
	
checkactivatormotion HITAGSAVED
ife RETURN 1 killit
	
}
else
{
ifaction 0
{
ifspawnedby SORCERER
	{
	seta[].blend 255
	palfrom 20 0 0 20
	cstat 130
	}
else
ifspawnedby OBLIVION_STAFF_SENTRY
	{
	seta[].blend 255
	spritepal 27
	fall
	sizeto 32 32
	cstat 34
	}
else
ifspawnedby 18085 // Nemesis Staff
	{
	seta[].blend 255
	spritepal 27
	fall
	sizeto 32 32
	cstat 34
	}
else
	{
	seta[].z sector[].floorz
	seta[].blend 255
	sizeat 16 16
	cstat 34
	}
soundonce COOKINGDEEPFRIER
set INTERNALCOUNT 0
action ZERO
}



ifaction ZERO
{
add INTERNALCOUNT 1
geta[].ang TEMP4
sub TEMP4 4
seta[].ang TEMP4

ifspawnedby SORCERER
	{
	sizeto 48 48
	ifg sprite[].xrepeat 47 killit else
	ifg sprite[].xrepeat 40 cstat 642 else
	ifg sprite[].xrepeat 34 cstat 130
	}

ifg INTERNALCOUNT 256
	{
	geta[].shade TEMP6
	add TEMP6 1
	seta[].shade TEMP6
	ifg TEMP6 40 killit
	}

}

}
ends


spritenoshade 13949
spritenoshade 13950
spritenoshade 13951
spritenoshade 13952

useractor notenemy 13949 state MAGIC_CIRCLES enda
useractor notenemy 13950 state MAGIC_CIRCLES enda
useractor notenemy 13951 state MAGIC_CIRCLES enda

useractor notenemy 13952 // Protection sigil 
ife LOTAGSAVED 1 nullop
else ife LOTAGSAVED 2
{
ife TEMP5 1
	{
	geta[].shade TEMP6
	add TEMP6 1
	seta[].shade TEMP6
	ifg TEMP6 24 set TEMP5 0
	}
else
ife TEMP5 0
	{
	geta[].shade TEMP6
	sub TEMP6 1
	seta[].shade TEMP6
	ifl TEMP6 -6 set TEMP5 1
	}
	
ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 killit
	}
	
}
else
{
ifaction 0
	{
	sizeat 4 4
	cstat 130
	seta[].blend 255
	spriteflags 4
	action ZERO
	}
ifaction ZERO
	{

	ife TEMP5 1
	{
	geta[].shade TEMP6
	add TEMP6 1
	seta[].shade TEMP6
	ifg TEMP6 24 set TEMP5 0
	}
	else
	ife TEMP5 0
	{
	geta[].shade TEMP6
	sub TEMP6 1
	seta[].shade TEMP6
	ifl TEMP6 -6 set TEMP5 1
	}


		sizeto 24 24
		ifg sprite[].xrepeat 23 killit else
		ifg sprite[].xrepeat 20 cstat 642 else
		ifg sprite[].xrepeat 17 cstat 130
		
	set TEMP3 sprite[myowner].x
	add TEMP3 256

	seta[].ang sprite[myowner].ang

	rotatepoint sprite[myowner].x sprite[myowner].y TEMP3 sprite[myowner].y sprite[myowner].ang TEMP5 TEMP6

	updatesector TEMP5 TEMP6 TEMP7
	seta[].x TEMP5 
	seta[].y TEMP6
	
	geta[myowner].z TEMP
	sub TEMP 8192
	seta[].z TEMP
	}
} 
enda

useractor notenemy 3587 // distance actor
cstat 32768
killit
enda

// *************************************************
// TELEPORTER
// *************************************************

action CHARGE_1 1
action CHARGE_2 2
action CHARGE_3 3
action CHARGE_4 4
action CHARGE_5 5
action CHARGED 6

useractor notenemy 14289

ifaction 0
	{
	ifn HITAGSAVED 0
		{
		checkactivatormotion HITAGSAVED
		 ife RETURN 1
			{
			globalsound MS_MECH_BLIP 
			set INTERNALCOUNT 0
			action CHARGE_1
			set CHARGE_UP 1
			}
		}
	}

ifaction CHARGE_1
{
soundonce TELEP_AP
add INTERNALCOUNT 1
 ifg INTERNALCOUNT 300
	{
	globalsound MS_MECH_BLIP 
	set INTERNALCOUNT 0
	add HITAGSAVED 1
	operateactivators HITAGSAVED THISACTOR
	operaterespawns HITAGSAVED
	operatemasterswitches HITAGSAVED
	stopsound TELEP_AP
	action CHARGE_2	
	set CHARGE_UP 2
	}
}

ifaction CHARGE_2
{
	soundonce TELEP_AP
	setactorsoundpitch THISACTOR TELEP_AP 256
add INTERNALCOUNT 1
 ifg INTERNALCOUNT 300
	{
	globalsound MS_MECH_BLIP 
	set INTERNALCOUNT 0
	add HITAGSAVED 1
	operateactivators HITAGSAVED THISACTOR
	operaterespawns HITAGSAVED
	operatemasterswitches HITAGSAVED
	stopsound TELEP_AP
	action CHARGE_3
	set CHARGE_UP 3
	}
}

ifaction CHARGE_3
{
soundonce TELEP_AP
setactorsoundpitch THISACTOR TELEP_AP 512
add INTERNALCOUNT 1
 ifg INTERNALCOUNT 300
	{
	globalsound MS_MECH_BLIP 
	set INTERNALCOUNT 0
	add HITAGSAVED 1
	operateactivators HITAGSAVED THISACTOR
	operaterespawns HITAGSAVED
	operatemasterswitches HITAGSAVED
	stopsound TELEP_AP
	action CHARGE_4	
	set CHARGE_UP 4
	}
}
	
ifaction CHARGE_4
{
soundonce TELEP_AP
setactorsoundpitch THISACTOR TELEP_AP 768
add INTERNALCOUNT 1
 ifg INTERNALCOUNT 300
	{
	globalsound MS_MECH_BLIP 
	set INTERNALCOUNT 0
	add HITAGSAVED 1
	operateactivators HITAGSAVED THISACTOR
	operaterespawns HITAGSAVED
	operatemasterswitches HITAGSAVED
	stopsound TELEP_AP
	action CHARGE_5	
	set CHARGE_UP 5
	}
}

ifaction CHARGE_5
{
soundonce TELEP_AP
setactorsoundpitch THISACTOR TELEP_AP 1024
add INTERNALCOUNT 1
 ifg INTERNALCOUNT 300
	{
	globalsound MS_MECH_BLIP 
	quake 38
	set INTERNALCOUNT 0
	add HITAGSAVED 1
	operateactivators HITAGSAVED THISACTOR
	operaterespawns HITAGSAVED
	operatemasterswitches HITAGSAVED
	stopsound TELEP_AP
	action CHARGED	
	set CHARGE_UP 6
	}
}

enda

useractor notenemy 14296

ifaction 0
	{
	ifspritepal 8 cstator 1024
	seta[].blend 255
	ifn HITAGSAVED 0
		{
		cstat 32768
		action ZERO
		}
	else ifn LOTAGSAVED 0
		{
		checkactivatormotion LOTAGSAVED
		ife RETURN 1
			{
			palfrom 10 50 0 0
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			killit
			}
		}
	}

ifaction ZERO
	{
	checkactivatormotion HITAGSAVED
	 ife RETURN 1
		{
		ifspritepal 0
			{
			palfrom 10 0 50 0
			shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2
			soundonce TELEP_CH
			action FORM
			}
		else
		ifspritepal 23
			{
			palfrom 10 50 0 0
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			soundonce TELEP_CH
			action FORM
			}
		seta[].cstat CSTATSAVED
		}
	}
	
enda

// *************************************************
// BIG FAN
// *************************************************

useractor notenemy 16152

ifaction 0
	{
	seta[].mdflags 16
	action ZERO
	}

ifaction ZERO
	{
	soundonce FAN
	set command 512
	
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		set command 0
		ifg TEMP9 0 killit
		ifspritepal 3 killit
		stopactorsound THISACTOR FAN
		set TEMP2 64
		action BREAK
		}
	
	}
	
ifaction BREAK
	{
	ifg TEMP2 0
		{
		geta[].ang TEMP
		add TEMP TEMP2
		seta[].ang TEMP
		sub TEMP2 1
		}
	}

enda

// *************************************************
// SKY TOGGLE
// *************************************************

useractor notenemy 16154
cstat 32768

ifspritepal 1
 ifpdistl 2048
  ifcansee
	{
	set skybox 1
	}

ifspritepal 2
 ifpdistl 2048
  ifcansee
	{
	set skybox 2
	}

ifspritepal 2
 ifpdistl 2048
  ifcansee
	{
	set skybox 3
	}

ifspritepal 0
 ifpdistl 2048
  ifcansee
	{
	set skybox 0
	}
	
	
enda

// *************************************************
// CODEC FACE
// *************************************************

defstate CODEC_STUFF
ifaction 0
	{
	ifn HITAGSAVED 0
		{
		sizeat 48 2
		seta[].shade 35
		spritepal 27
		checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			action ZERO
			resetcount
			}
		}
	}
	
ifaction ZERO
	{
	geta[].yrepeat TEMP
	ifl TEMP 48 { add TEMP 2 seta[].yrepeat TEMP }
	else ifg TEMP 48 seta[].yrepeat 48
	geta[].shade TEMP2
	ifg TEMP2 0 { sub TEMP2 1 seta[].shade TEMP2 }
	else ife TEMP2 0 spritepal 0
	}
	
	
ends

useractor notenemy 3589 state CODEC_STUFF enda
useractor notenemy 3598 state CODEC_STUFF enda
useractor notenemy 5368 state CODEC_STUFF enda

// *************************************************
// GONG
// *************************************************

useractor notenemy 16343

ifaction 0
{
ife LOTAGSAVED 0 set LOTAGSAVED 120
ifhitweapon
	{
	globalsound GONG_HIT
	action ONE
	set INTERNALCOUNT 0
	ifn HITAGSAVED 0
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED
		}
	seta[].htextra -1
	}
}

ifaction ONE
{
seta[].htextra -1
add INTERNALCOUNT 1
ifg INTERNALCOUNT LOTAGSAVED
	{
	strength 1
	action 0
	}
}


enda

// *************************************************
// MAGIC PLATFORM
// *************************************************

spriteflags 18432 16384

spritenoshade 18161

useractor notenemy 18161

ifaction 0
{
cstat 290
seta[].shade 30

checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	action ZERO
	set INTERNALCOUNT LOTAGSAVED
	}
}

ifaction ZERO
{
add INTERNALCOUNT 1
ifg INTERNALCOUNT 150
	{
	cstat 291
	geta[].shade TEMP
	ifg TEMP 0 sub TEMP 1
	seta[].shade TEMP
	ife TEMP 0 { globalsound USE_TIMEPORTAL set INTERNALCOUNT_2 0 action FORMED }
	}
}

ifaction FORMED
{
add INTERNALCOUNT_2 1
ifg INTERNALCOUNT_2 350
	{
	set INTERNALCOUNT LOTAGSAVED action FORM
	}
}

ifaction FORM
{
add INTERNALCOUNT 1
ifg INTERNALCOUNT 300
	{
	geta[].shade TEMP
	ifl TEMP 30 add TEMP 1
	seta[].shade TEMP
	ife TEMP 30 { globalsound USE_TIMEPORTAL set INTERNALCOUNT 0 action 0 }
	}
}


enda

// =================================================
// CLOUD
// ==================================================

defstate cloud_rot
ifaction 0
	{
	spriteflags 141312
	ldist xydist THISACTOR cloud_centre
	seta[].htlastvx sprite[cloud_centre].x
	seta[].htlastvy sprite[cloud_centre].y
	getangletotarget TEMP4 // hack to use this command to calculate the angle for us
	action ZERO
	}
	
ifaction ZERO
	{
	set TEMP3 skybox_x
	add TEMP3 xydist
	ifn HITAGSAVED 0
		{
		add INTERNALCOUNT 1
		ifg INTERNALCOUNT HITAGSAVED
			{
			add TEMP4 1
			set INTERNALCOUNT 0
			}
		}
	else
	ifcount 30 {  add TEMP4 1 resetcount }
	ifg TEMP4 2048 set TEMP4 0
	rotatepoint skybox_x skybox_y TEMP3 skybox_y TEMP4 TEMP5 TEMP6
	seta[].x TEMP5
	seta[].y TEMP6
	
    set mx skybox_x
    set my skybox_y
    sub mx sprite[].x
    sub my sprite[].y
    getangle ANGVAR mx my
    seta[].ang ANGVAR // tell the cloud to face the skybox, so flat sprites are always parallel to it
	}
ends

useractor notenemy 18165 state cloud_rot enda
useractor notenemy 18166 state cloud_rot enda
useractor notenemy 18167 state cloud_rot enda

// *************************************************
// CLOUD SPAWNER
// *************************************************

useractor notenemy 14307

ifaction 0
{
cstat 32768
set SPEC_ACT 1
ifn HITAGSAVED 0
	{
	sleeptime 0
	checkactivatormotion HITAGSAVED
	ife RETURN 1 action ZERO
	}
	else action ZERO
}

ifaction ZERO
{
ifn LOTAGSAVED 0
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 killit
	}
ifspritepal 1 // vertical cloud spawner
	{
	ifrnd 48
		{
		espawn 14302
		seta[RETURN].pal 3
		add INTERNALCOUNT 1
		
			set TEMP3 sprite[].x
			randvar TEMP8 3072
			add TEMP3 TEMP8
			
			randvar TEMP4 2048

			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			seta[RETURN].ang sprite[].ang
			geta[].z TEMP4
			randvar TEMP9 8192
			ifrnd 128 sub TEMP9 8192
			sub TEMP4 TEMP9
			seta[RETURN].z TEMP4
			resetcount
		}

	}
	else
	ifspritepal 2 // wave spawner
	{
	add INTERNALCOUNT 1
		ifg INTERNALCOUNT 160
		{
		spawn 17079
		set INTERNALCOUNT 0
		}
		
	}
	else // horizontal cloud spawner
	{
		ifg INTERNALCOUNT 19
		{
		add INTERNALCOUNT_2 1
		ifg INTERNALCOUNT_2 520 { set INTERNALCOUNT 0 set INTERNALCOUNT_2 0 }
		}

		ifrnd 48
		ifl INTERNALCOUNT 20
		{
		espawn 14302
		ifspritepal 3 seta[RETURN].pal 3
		else seta[RETURN].pal sprite[].pal
		add INTERNALCOUNT 1

			set TEMP3 sprite[].x
			randvar TEMP8 3072
			add TEMP3 TEMP8
			
			randvar TEMP4 2048

			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			seta[RETURN].ang sprite[].ang
			geta[].z TEMP4
			randvar TEMP9 8192
			ifrnd 128 sub TEMP9 8192
			sub TEMP4 TEMP9
			seta[RETURN].z TEMP4
			resetcount
		}
	}
}

enda

spritenoshade 14302

move CLOUD_MOVE 512
move CLOUD_MOVEV 15 -4096

useractor notenemy 14302 // Cloud

ifspawnedby 14307
	{
	ifspritepal 3 { seta[].shade -128 move CLOUD_MOVEV geth getv ifnotmoving killit ifceilingdistl 64 killit } else
	ifg sprite[].pal 127 { seta[].shade sector[].floorshade move CLOUD_MOVE geth ifnotmoving killit } 
	else { seta[].shade -32 move CLOUD_MOVE geth ifnotmoving killit } 
	}

ifaction 0
{
seta[].mdflags 16
  ifrnd 128
    cstat 4
  else
    cstat 0
randvar GTEMP 64
add GTEMP 96
ifspritepal 3 add GTEMP 64
seta[].xrepeat GTEMP
seta[].yrepeat GTEMP
action ZERO
}


enda

spritenopal 17079

useractor notenemy 17079 // Wave
	
ifaction 0
	{
	seta[].blend 64
	set SPEC_ACT 1
	seta[].pal sector[].floorpal
	cstator 131
	randvar GTEMP 64
	add GTEMP 96
	seta[].xrepeat GTEMP
	seta[].yrepeat GTEMP
	action ZERO
	}

	
ifaction ZERO
{
ifpdistl 1536
 ifcanseetarget
	{
	state setknockback
	wackplayer
	}
ifpdistl 8096 quake 13

	move CLOUD_MOVE geth 
	ifnotmoving 
		{ 
		stopsound WATER_RUSH
		sound WAVECRASH 
		spawn 18138 
		spawn WATERBUBBLE 
		spawn WATERBUBBLE 
		spawn WATERBUBBLE 
		spawn WATERBUBBLE
		cstat 32768
		set INTERNALCOUNT 0
		action LOCKED
		}

ifactorsound THISACTOR WATER_RUSH nullop else
sound WATER_RUSH
}

ifaction LOCKED
{
add INTERNALCOUNT 1
		espawn 18138
		set TEMP3 sprite[].x
		add TEMP3 512
		randvar TEMP4 2048
		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set TEMP6 0
ifg INTERNALCOUNT 10 killit
}

enda


// *************************************************
// SECRET AREA
// *************************************************

useractor notenemy 3832

ifaction 0
	{
	cstat 32768
	getp[].max_secret_rooms TEMP
	add TEMP 1
	setp[].max_secret_rooms TEMP
	action ZERO
	}
	
ifaction ZERO
	{
	ifspritepal 0
	 ifpdistl 1524
	  ifcansee
	   ifp palive
		{
		quote 9
		getp[].secret_rooms TEMP
		add TEMP 1
		setp[].secret_rooms TEMP	
		killit
		}
	}

enda

// *************************************************
// CITIES
// *************************************************

defstate CITY_HITLIGHTS 
seta[].z sector[].floorz
ifaction 0
	{
	ife AMC_BASE 1
	 ifn DAYNIGHT 2
		{
		spritepal 13
		seta[].shade 20
		action ZERO
		}
	checkactivatormotion HITAGSAVED
		ife RETURN 1
		{
		spritepal 13
		seta[].shade 20
		action ZERO
		}
	}
ends

useractor notenemy 8536 state CITY_HITLIGHTS enda
useractor notenemy 8537 state CITY_HITLIGHTS enda
useractor notenemy 18266 state CITY_HITLIGHTS enda
useractor notenemy 18267 state CITY_HITLIGHTS enda
useractor notenemy 18268 state CITY_HITLIGHTS enda
useractor notenemy 18269 state CITY_HITLIGHTS enda

useractor notenemy 8573
ife HITAGSAVED 0
{
seta[].z sector[].floorz
}
enda

useractor notenemy 8575
ife HITAGSAVED 0
{
seta[].z sector[].floorz
}
enda

useractor notenemy 10673 
ife HITAGSAVED 0
{
seta[].z sector[].floorz
}
enda

// *************************************************
// BASE SPOTLIGHT
// *************************************************

useractor notenemy 21616
ifaction 0
	{
	seta[].blend 255
	ife DAYNIGHT 1 killit
	action ZERO
	}
enda

// *************************************************
// LIGHTNING
// *************************************************

spritenoshade 17128
spritenopal 17128

spritenoshade 17131
spritenopal 17131

useractor notenemy 17132 // lightning controller

ifaction 0
{
ife LOTAGSAVED 0 set LOTAGSAVED 64
cstat 32768
action ZERO
}
ifaction ZERO
{
add INTERNALCOUNT 1
ifg INTERNALCOUNT 300
	{
	ifrnd 128 globalsound THUNDER
	set INTERNALCOUNT 0
	}
randvarvar LIGHTNING_STRIKE LOTAGSAVED
}

enda

useractor notenemy 17128 // bolt

ifaction 0
{
seta[].blend 255
cstat 32768
ifn LOTAGSAVED 0
{
checkactivatormotion LOTAGSAVED
 ife RETURN 1
	{
	set LIGHTNING_STRIKE LOTAGSAVED
	cstat 514
	ifspritepal 3 flash
	ifaction 0
		{
		action ZERO
		}
	resetcount
	}
}
else
ife LIGHTNING_STRIKE HITAGSAVED
	{
	cstat 514
	ifspritepal 3 flash
	ifaction 0
		{
		ifrnd 96 action ZERO
		else ifrnd 96 action ONE
		else action TWO
		}
	resetcount
	}
}
else
{
ifcount 13 
	{ 
	ifrnd 128 globalsound LIGHTNING_SLAP2 else globalsound LIGHTNING_SLAP 
	set LIGHTNING_STRIKE 0 
	action 0 
	cstat 32768 
	ifn LOTAGSAVED 0 killit
	}
}

enda

spritenoshade 17131

useractor notenemy 17131 // light effect

ifaction 0
{
ife LOTAGSAVED 1 break
seta[].blend 255
cstat 32768
ife LIGHTNING_STRIKE HITAGSAVED
	{
	cstat 34
	action ZERO
	seta[].shade -13
	resetcount
	}
}
else
ifaction ZERO
{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 25
		{
		cstat 32768
		action 0
		resetcount
		}
}

enda

// *************************************************
// COMPUTER
// *************************************************

action MINUSTHREE -3

useractor notenemy 17014
ifaction 0
{
cstator 257
action ZERO
}

ifhitweapon
	{
	debris SCRAP1 2
	debris SCRAP2 2
	sound VENT_BUST
	cactor 17018
	}

enda

useractor notenemy 17015 // PC tower

ifaction 0
{
cstator 257
ifspritepal 3 action BREAK else
action ZERO
}

ifaction ZERO
 ifpdistl 1024
  ifp pfacing
	{
	set player_use 0
	ifhitspace
		{
		set hit_key 30
		action MINUSONE
		sound LIGHT_SWITCH
		set INTERNALCOUNT -512
		set PC_TURNED_ON LOTAGSAVED
		}
	}
	
	
ifaction MINUSONE
{
soundonce PC_IDLE
ifl INTERNALCOUNT 0
{
add INTERNALCOUNT 16
setactorsoundpitch THISACTOR PC_IDLE INTERNALCOUNT
}
 ifpdistl 1024
  ifp pfacing
   ife PC_TURNED_ON HITAGSAVED
	{
	set player_use 0
	ifhitspace
	 ifcount 13
		{
		set hit_key 30
		ifspritepal 9
		 ifand FLOPPY_DISK 2
			{
			setp[].weapon_pos 10
			xorvar FLOPPY_DISK 2
			sound PC_LOAD_FLOPPY
			set PC_TURNED_ON XVELSAVED
			}
		else
		ifand FLOPPY_DISK 1
			{
			setp[].weapon_pos 10
			xorvar FLOPPY_DISK 1
			sound PC_LOAD_FLOPPY
			set PC_TURNED_ON XVELSAVED
			}
		else
			{
			quote 288
			}
		resetcount
		}
	}
}

ifhitweapon
	{
	debris SCRAP1 2
	debris SCRAP2 2
	sound VENT_BUST
	cactor 17018
	}

enda

defstate PC_MONITOR_CODE

ifaction 0
{
cstator 257
set INTERNALCOUNT 0
ifspritepal 3 nullop else
action ZERO
}

ifaction ZERO
{
ife PC_TURNED_ON LOTAGSAVED
	{
	geta[].shade TEMP
	add INTERNALCOUNT 1
	ife INTERNALCOUNT 3 sub TEMP 1
	ife INTERNALCOUNT 6 sub TEMP 1
	ife INTERNALCOUNT 9 sub TEMP 1
	ife INTERNALCOUNT 12 sub TEMP 1
	ife INTERNALCOUNT 15 sub TEMP 1
	ife INTERNALCOUNT 18 sub TEMP 1
	seta[].shade TEMP
	ife INTERNALCOUNT 26 action MINUSTWO
	}
}

ifaction MINUSTWO
{
ife PC_TURNED_ON HITAGSAVED
	{
	set INTERNALCOUNT 0
	action BREAK
	}
}

ifaction MINUSONE
{
ife PC_TURNED_ON YVELSAVED
	{
	add INTERNALCOUNT 1
	ife INTERNALCOUNT 300
		{
		sound PC_NOTIFY
		action MINUSTHREE
		set PC_TURNED_ON ZVELSAVED
		}
	}
}

ifaction BREAK
{
add INTERNALCOUNT 1
ife INTERNALCOUNT 26
	{
	action MINUSONE
	ifactor 17346 soundonce PC_WINXP_LOAD else
	soundonce PC_WINDOWS_LOAD
	set PC_TURNED_ON XVELSAVED
	set INTERNALCOUNT 0
	}
}

ifhitweapon
	{
	debris SCRAP1 2
	debris SCRAP2 2
	sound VENT_BUST
    lotsofglass 5
    sound GLASS_BREAKING
	cactor 17017
	}

ends

useractor notenemy 17012 // PC Monitor
state PC_MONITOR_CODE
enda

useractor notenemy 17346 // PC Monitor 2
state PC_MONITOR_CODE
enda


useractor notenemy 17016 // PC Keyboard

ifaction 0
{
cstator 257
ifspritepal 3 action ZERO else
ifspritepal 9 action ZERO else
action FORM
}

ifaction ZERO
 ifpdistl 1024
  ifp pfacing
  {
   ife PC_TURNED_ON LOTAGSAVED
	{
	set player_use 0
	ifhitspace
	 ifcount 13
		{
		set hit_key 30
		setp[].weapon_pos 10
		soundonce VOL4_2
		ifspritepal 9
		ife GOT_PASSWORD 3
			{
			set PC_TURNED_ON HITAGSAVED
			resetcount
			}
			else		
		ife GOT_PASSWORD 1
			{
			set PC_TURNED_ON HITAGSAVED
			resetcount
			}
			else
			{
			quote 287
			soundonce PC_ERROR
			}
		}
	}
	else
   ife PC_TURNED_ON XVELSAVED
	{
	set player_use 0
	ifhitspace
	 ifcount 13
		{
		set hit_key 30
		setp[].weapon_pos 10
		soundonce VOL4_2
		set PC_TURNED_ON YVELSAVED
		resetcount
		}
	}
   }

ifhitweapon
	{
	debris SCRAP1 2
	debris SCRAP2 2
	sound VENT_BUST
	cactor 17019
	}

enda

useractor notenemy 17032

ifaction 0
ife PC_TURNED_ON LOTAGSAVED
	{
	action ZERO
	set INTERNALCOUNT 0
	}
	
ifaction ZERO
	{
	add INTERNALCOUNT 1
	ife INTERNALCOUNT 13
		{
		sound MS_MECH_BLIP
		setactorsoundpitch THISACTOR MS_MECH_BLIP 512
		geta[].z TEMP
		add TEMP 512
		seta[].z TEMP
		add INTERNALCOUNT_2 1
		set INTERNALCOUNT 0
		}
	ife INTERNALCOUNT_2 10
		{
		set PC_TURNED_ON HITAGSAVED
		sound MS_MECH_SERV2
		setactorsoundpitch THISACTOR MS_MECH_SERV1 1024
		killit
		}
	}

enda

move PRINT 16 0

useractor notenemy 17033

ifaction 0
{
cstat 32768
ife PC_TURNED_ON LOTAGSAVED
	{
	cstat 32
	action ZERO
	set INTERNALCOUNT 0
	}
}
	
ifaction ZERO
	{
	soundonce MS_MECH_BLIP
	setactorsoundpitch THISACTOR MS_MECH_BLIP 256
	move PRINT geth
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 52 { move STOP sound PC_DONE action BREAK resetcount }
	}

ifaction BREAK
	{
	ifpdistl 1024
	 ifp pfacing
		{
		set player_use 0
		 ifhitspace
		  ifcount 13
			{
			set hit_key 30
			ifn DOCUMENT -1
				{
					readgamevar EVIDENCE_EP2
					ifand EVIDENCE_EP2 2 { set DOCUMENT -1 resetcount }
					else
						{
						xorvar EVIDENCE_EP2 2
						savegamevar EVIDENCE_EP2
						globalsound PROMOTION
						add TREASURE_FOUND 5
						palfrom 16 64 64 64
						quote 289
						set DOCUMENT -1
						killit
						}
				}
			else
			  ife DOCUMENT -1
			  {
				set TEMP9 1
				soundonce READ_DOCUMENT
				set DOCUMENT 17034
				lockplayer 13
				resetcount
			   }
			}
		}
	}
	
enda

useractor notenemy 17404

ifaction 0
{
cstat 32768
ife PC_TURNED_ON LOTAGSAVED
	{
	cstat 32
	action ZERO
	set INTERNALCOUNT 0
	}
}
	
ifaction ZERO
	{
	soundonce MS_MECH_BLIP
	setactorsoundpitch THISACTOR MS_MECH_BLIP 256
	move PRINT geth
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 30 { move STOP sound PC_DONE action BREAK resetcount }
	}

ifaction BREAK
	{
	ifpdistl 1024
	 ifp pfacing
		{
		set player_use 0
		 ifhitspace
		  ifcount 13
			{
			set hit_key 30
			ifn DOCUMENT -1
				{
					readgamevar EVIDENCE_EP2
					ifand EVIDENCE_EP2 256 { set DOCUMENT -1 resetcount }
					else
						{
						xorvar EVIDENCE_EP2 256
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 5
						globalsound PROMOTION
						palfrom 16 64 64 64
						quote 289
						set DOCUMENT -1
						killit
						}
				}
			else
			  ife DOCUMENT -1
			  {
				set TEMP9 1
				soundonce READ_DOCUMENT
				set DOCUMENT 17403
				lockplayer 13
				resetcount
			   }
			}
		}
	}
	
enda

// ===============================================
// EAF COMPUTER
// ===============================================

useractor notenemy 18381
ifspritepal 3
{
	ifaction 0
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 action ZERO
	}
	
	ifmove STOP nullop
	else
	ifaction ZERO
		{
		ifpdistl 4096
		ife GOT_PASSWORD 2
			{
			set player_use 0
			ifhitspace
				{
				set hit_key 30
				soundonce VOL4_2
				operateactivators HITAGSAVED THISACTOR
				move STOP
				}
			}
		}
}
enda

useractor notenemy 18391 

ifaction 0
{
checkactivatormotion HITAGSAVED
 ife RETURN 1
	{
	action ONE
	}
}

ifaction ONE
{
ife GOT_PASSWORD 2
	{
	checkactivatormotion LOTAGSAVED
	 ifn RETURN 0
		{
		action TWO 
		set INTERNALCOUNT 0
		}
	}
}

ifaction TWO
{
add INTERNALCOUNT 1
ifg INTERNALCOUNT 30
	{
	soundonce PC_NOTIFY
	action THREE
	}
}

ifaction THREE
{
ifp pfacing
ifcansee
ifpdistl 4096
ifp palive
	{
	readgamevar EVIDENCE_EP2
	  ifand EVIDENCE_EP2 8 nullop
					else
						{
						xorvar EVIDENCE_EP2 8
						savegamevar EVIDENCE_EP2
						add TREASURE_FOUND 2
						globalsound PROMOTION
						palfrom 16 64 64 64
						quote 289
						}
	}
}

enda

// ===============================================
// LIGHTS
// ===============================================

gamearray LIGHT_SMASHED 16384

useractor notenemy 5862 
ifaction 0
{
ife HITAGSAVED 0 action ZERO
else
ifhitweapon
	{
	sound HITGLASS
	sound VENT_BUST
	lotsofglass 2
	debris SCRAP1 8
	shoot SPARK shoot SPARK shoot SPARK
	ife LIGHT_SMASHED[HITAGSAVED] 0 setarray LIGHT_SMASHED[HITAGSAVED] 1
	killit
	}
}
enda

useractor notenemy WALLLIGHT4
ifaction 0
{
ife HITAGSAVED 0 action ZERO
else
ifhitweapon
	{
	sound HITGLASS
	sound VENT_BUST
	sound SHORT_CIRCUIT
	lotsofglass 8
	debris SCRAP1 8
	shoot SPARK shoot SPARK shoot SPARK
	ife LIGHT_SMASHED[HITAGSAVED] 0 setarray LIGHT_SMASHED[HITAGSAVED] 1
	action ONE
	}
}
enda


useractor notenemy WALLLIGHT3
ifaction 0
{
ife HITAGSAVED 0 action ZERO
else
ifhitweapon
	{
	sound HITGLASS
	sound VENT_BUST
	sound SHORT_CIRCUIT
	lotsofglass 8
	debris SCRAP1 8
	shoot SPARK shoot SPARK shoot SPARK
	ife LIGHT_SMASHED[HITAGSAVED] 0 setarray LIGHT_SMASHED[HITAGSAVED] 1
	ifrnd 16 set TEMP2 1 else set TEMP2 0
	action ONE
	}
}

ifaction ONE
{
ife TEMP2 1
 ifrnd 1
	{
	sound SHORT_CIRCUIT shoot SPARK shoot SPARK shoot SPARK spawn 8433
	}
}

enda

// chinese lanterns

useractor notenemy 3887
ifaction 0
{
ife HITAGSAVED 0 action ZERO
else
ifhitweapon
	{
	sound GLASS_HEAVYBREAK
	sound VENT_BUST
	spritepal 2
	lotsofglass 8
	debris SCRAP1 8
	ife LIGHT_SMASHED[HITAGSAVED] 0 setarray LIGHT_SMASHED[HITAGSAVED] 1
	killit
	}
}
enda

useractor notenemy 8515
ifaction 0
{
ife HITAGSAVED 0 action ZERO
else
ifhitweapon
	{
	sound GLASS_HEAVYBREAK
	sound VENT_BUST
	sound ENGULF_FIRE
	spawn 8433
	spritepal 19
	lotsofglass 8
	debris SCRAP1 8
	shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	ifrnd 32 spawn BURNING
	ife LIGHT_SMASHED[HITAGSAVED] 0 setarray LIGHT_SMASHED[HITAGSAVED] 1
	ifn LOTAGSAVED -1
		{
		operateactivators LOTAGSAVED THISACTOR
		operatemasterswitches LOTAGSAVED
		operaterespawns LOTAGSAVED		
		}
	killit
	}
}
enda

defstate lightbeam_smash
ifn HITAGSAVED 0 
	{ 
	sleeptime 0 
	ife LIGHT_SMASHED[HITAGSAVED] 1 action BREAK
	} 
ifaction BREAK
	{
	geta[].shade TEMP
	add TEMP 4
	ifg TEMP 32 killit
	seta[].shade TEMP
	}
ends


useractor 4 8623 state lightbeam_smash enda

useractor notenemy 18225 state lightbeam_smash enda

useractor notenemy 18224 state lightbeam_smash enda


// ===============================================
// CIVILIANS
// ===============================================

// MISC CIVS

defstate kill_on_hitag
ifn HITAGSAVED 0
	{
	sleeptime 0
	checkactivatormotion HITAGSAVED
	ife RETURN 1 killit
	} 
ends

spriteshadow 8167

useractor notenemy 8167 state kill_on_hitag enda

useractor notenemy 8541 state kill_on_hitag enda

useractor notenemy 8544 state kill_on_hitag enda

useractor notenemy 17332 state kill_on_hitag enda

defstate STANDING_CIV
ifaction 0 
{
ifspritepal 3 nullop else
ifspritepal 140 nullop else // ugly manual hack but fuck it
	{
	randvar TEMP 3 add TEMP 22 seta[].xrepeat TEMP
    randvar TEMP 3 add TEMP 22 seta[].yrepeat TEMP
	}

ifspritepal 27
	{
	seta[].mdflags 16
	 // set command 2048
	}
spriteflags 3
action ACAR
ifspritepal 0
	{
	ifrnd 32 spritepal 23
	else ifrnd 32 spritepal 36
	else ifrnd 32 spritepal 21
	else ifrnd 32 spritepal 49
	else ifrnd 32 spritepal 43
	else ifrnd 32 spritepal 44
	else ifrnd 32 spritepal 35
	else ifrnd 32 spritepal 37
	else ifrnd 32 spritepal 38
	else ifrnd 32 spritepal 39
	else ifrnd 32 spritepal 16
	else ifrnd 32 spritepal 15
	else ifrnd 32 spritepal 14
	else ifrnd 32 spritepal 13
	else ifrnd 32 spritepal 3
	else ifrnd 32 spritepal 11
	else ifrnd 32 spritepal 10
	else spritepal 12
	}
}
ifaction ACAR state kill_on_hitag
ends

useractor notenemy 15574 state STANDING_CIV enda
useractor notenemy 15579 state STANDING_CIV enda
useractor notenemy 15584 state STANDING_CIV enda
useractor notenemy 15589 state STANDING_CIV enda
useractor notenemy 15594 state STANDING_CIV enda
useractor notenemy 15599 state STANDING_CIV enda
useractor notenemy 15604 state STANDING_CIV enda
useractor notenemy 15609 state STANDING_CIV enda

action CIV1_IDLE 0 1 5 1 1
action CIV1_WALK 0 4 5 1 12
action CIV1_DIE 160 3 1 12
action CIV1_DEAD 162

action CIV2_IDLE 20 1 5 1 1
action CIV2_WALK 20 4 5 1 12
action CIV2_DIE 163 3 1 12
action CIV2_DEAD 165

action CIV3_IDLE 40 1 5 1 1
action CIV3_WALK 40 4 5 1 12
action CIV3_DIE 166 3 1 12
action CIV3_DEAD 168

action CIV4_IDLE 60 1 5 1 1
action CIV4_WALK 60 4 5 1 12
action CIV4_DIE 169 3 1 12
action CIV4_DEAD 171

action CIV5_IDLE 80 1 5 1 1
action CIV5_WALK 80 4 5 1 12
action CIV5_RUN 9552 4 5 1 12
action CIV5_DIE 172 3 1 12
action CIV5_DEAD 174

action CIV6_IDLE 100 1 5 1 1
action CIV6_WALK 100 4 5 1 12
action CIV6_RUN 9527 4 5 1 12
action CIV6_DIE 175 3 1 12
action CIV6_DEAD 177

action CIV7_IDLE 120 1 5 1 1
action CIV7_WALK 120 4 5 1 12
action CIV7_RUN 9502 4 5 1 8
action CIV7_DIE 178 3 1 12
action CIV7_DEAD 180

action CIV8_IDLE 140 1 5 1 1
action CIV8_WALK 140 4 5 1 12
action CIV8_RUN 9477 4 5 1 8
action CIV8_DIE 181 3 1 12
action CIV8_DEAD 183

move CIV_WALK 64
move CIV_RUN 128
move CIV_STOP 0

defstate CIVILIAN_CODE
fall

ifaction 0 
	{
	strength 25
	cstat 256
	randvar TEMP2 18
	switch TEMP2
	case 0 spritepal 23 break
	case 1 spritepal 36 break
	case 2 spritepal 21 break
	case 3 spritepal 49 break
	case 4 spritepal 43 break
	case 5 spritepal 44 break
	case 6 spritepal 35 break
	case 7 spritepal 37 break
	case 8 spritepal 38 break
	case 9 spritepal 39 break
	case 10 spritepal 16 break
	case 12 spritepal 15 break
	case 13 spritepal 14 break
	case 14 spritepal 13 break
	case 15 spritepal 3 break
	case 16 spritepal 11 break
	case 17 spritepal 10 break
	case 18 spritepal 12 break
	endswitch
	clipdist 16
	
	randvar TEMP 3 add TEMP 23 seta[].xrepeat TEMP
    randvar TEMP 3 add TEMP 22 seta[].yrepeat TEMP

	randvar TEMP 80
	
	ifl TEMP 10 { set GENDER FEMALE set ALLY_MAG 1 action CIV1_IDLE }
	else ifl TEMP 20 { set GENDER FEMALE set ALLY_MAG 2 action CIV2_IDLE }
	else ifl TEMP 30 { set GENDER MALE set ALLY_MAG 3 action CIV3_IDLE }
	else ifl TEMP 40 { set GENDER MALE set ALLY_MAG 4 action CIV4_IDLE }
	else ifl TEMP 50 { set GENDER MALE set ALLY_MAG 5 action CIV5_IDLE }
	else ifl TEMP 60 { set GENDER MALE set ALLY_MAG 6 action CIV6_IDLE }
	else ifl TEMP 70 { set GENDER FEMALE set ALLY_MAG 7 action CIV7_IDLE }
	else { set GENDER FEMALE set ALLY_MAG 8 action CIV8_IDLE }
	
	ife CIVS_PANIC 1 { spawn SHOOTME2 move CIV_RUN geth randomangle } else
	move CIV_WALK geth
	}
	
ifg TEMP5 0
	{
	sub TEMP5 1
	ifg TEMP5 30 
		{
		move CIV_STOP
		}
	else
		{
		ife CIVS_PANIC 1 move CIV_RUN geth randomangle else
		move CIV_WALK geth
		seta[].ang TEMP3
		}
	}
	
ifmove STOP
{
ifaction CIV1_DIE
	{
	ifactioncount 2 action CIV1_DEAD
	}
	
ifaction CIV2_DIE
	{
	ifactioncount 2 action CIV2_DEAD
	}
	
ifaction CIV3_DIE
	{
	ifactioncount 2 action CIV3_DEAD
	}

ifaction CIV4_DIE
	{
	ifactioncount 2 action CIV4_DEAD
	}
	
ifaction CIV5_DIE
	{
	ifactioncount 2 action CIV5_DEAD
	}
	
ifaction CIV6_DIE
	{
	ifactioncount 2 action CIV6_DEAD
	}
	
ifaction CIV7_DIE
	{
	ifactioncount 2 action CIV7_DEAD
	}
	
ifaction CIV8_DIE
	{
	ifactioncount 2 action CIV8_DEAD
	}
}
else	
ifmove CIV_STOP
	{
	ifaction CIV1_WALK action CIV1_IDLE
	ifaction CIV2_WALK action CIV2_IDLE
	ifaction CIV3_WALK action CIV3_IDLE
	ifaction CIV4_WALK action CIV4_IDLE
	ifaction CIV5_WALK action CIV5_IDLE
	ifaction CIV6_WALK action CIV6_IDLE
	ifaction CIV7_WALK action CIV7_IDLE
	ifaction CIV8_WALK action CIV8_IDLE
	}
else
ifmove CIV_WALK
	{
	ife CIVS_PANIC 1 { spawn SHOOTME2 move CIV_RUN geth randomangle }
	ifaction CIV1_IDLE action CIV1_WALK
	ifaction CIV2_IDLE action CIV2_WALK
	ifaction CIV3_IDLE action CIV3_WALK
	ifaction CIV4_IDLE action CIV4_WALK
	ifaction CIV5_IDLE action CIV5_WALK
	ifaction CIV6_IDLE action CIV6_WALK
	ifaction CIV7_IDLE action CIV7_WALK
	ifaction CIV8_IDLE action CIV8_WALK
	ifnotmoving ife TEMP5 0 move CIV_WALK geth randomangle
	}
else
ifmove CIV_RUN
	{
	ifaction CIV1_IDLE action CIV1_WALK
	ifaction CIV2_IDLE action CIV2_WALK
	ifaction CIV3_IDLE action CIV3_WALK
	ifaction CIV4_IDLE action CIV4_WALK
	ife ALLY_MAG 5 { ifaction CIV5_RUN nullop else action CIV5_RUN }
	ife ALLY_MAG 6 { ifaction CIV6_RUN nullop else action CIV6_RUN }
	ife ALLY_MAG 7 { ifaction CIV7_RUN nullop else action CIV7_RUN }
	ife ALLY_MAG 8 { ifaction CIV8_RUN nullop else action CIV8_RUN }
	ifnotmoving move CIV_RUN geth randomangle
	}
	
state ignore_ally_damage
	
	ifhitweapon
	{
	spawn BLOOD
	ifdead
		{
		 ifrnd 128
		 ifpdistl 4096
		  ifcansee
			{ ife CHAR 0 sound JOHSHIT else
			ife CHAR 2 sound MOHSHIT else
			ife CHAR 3 sound ROHSHIT else
			ife CHAR 5 sound RNOHSHIT else
			ife CHAR 6 sound GOHSHIT else
			ife CHAR 7 sound MSOHSHIT }

		ife GENDER MALE
			{
			randvar TEMP 30
			ifl TEMP 10 sound EDFSOLD_DIE1 else
			ifl TEMP 20 sound EDFSOLD_DIE2 else
			sound EDFSOLD_DIE3
			}
		else
		ife GENDER FEMALE
			{
			randvar TEMP 30
			ifl TEMP 10 sound AMCSOLDF_DIE1 else
			ifl TEMP 20 sound AMCSOLDF_DIE2 else
			sound AMCSOLDF_DIE3
			}
		respawnhitag
		state rf
		move STOP
		ife ALLY_MAG 1 action CIV1_DIE
		ife ALLY_MAG 2 action CIV2_DIE
		ife ALLY_MAG 3 action CIV3_DIE
		ife ALLY_MAG 4 action CIV4_DIE
		ife ALLY_MAG 5 action CIV5_DIE
		ife ALLY_MAG 6 action CIV6_DIE
		ife ALLY_MAG 7 action CIV7_DIE
		ife ALLY_MAG 8 action CIV8_DIE
		resetactioncount
		shoot BLOOD
		spawn BLOODPOOL	  
		}
	}
	

ends

spriteshadow 15360

useractor notenemy 15360 state CIVILIAN_CODE enda

defstate MOVE_IT_HERE
			ife INTERNALCOUNT_2 0
				{
				getactorvar[TEMP].LOTAGSAVED TEMP4
					ife TEMP4 LOTAGSAVED
						{
						seta[TEMP].x sprite[].x
						seta[TEMP].y sprite[].y
						ifspritepal 3
						set INTERNALCOUNT_2 96
						else
						set INTERNALCOUNT_2 30
						}
				}

ends

useractor notenemy 15615 // Civilian waypoint
cstat 32768
ife CIVS_PANIC 1 killit

ifg INTERNALCOUNT_2 0 sub INTERNALCOUNT_2 1
ifg INTERNALCOUNT 0 sub INTERNALCOUNT 1

ifspritepal 4
{
findnearactor 15360 512 TEMP
	ifn TEMP -1
		{
		seta[TEMP].xrepeat 0
		seta[TEMP].yrepeat 0
		}
}
else
ifcount 3
{
findnearactor 15360 768 TEMP

	ifn TEMP -1
		{
			ifspritepal 2 // If it's spritepal is 2, make it a 'random' waypoint
				{
				 ifrnd 16
					{
						ifn XVELSAVED 0
							{
							set TEMP3 sprite[].x
							add TEMP3 XVELSAVED
							rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6
							sub TEMP5 sprite[].x
							sub TEMP6 sprite[].y
							getangle ANGVAR TEMP5 TEMP6
							seta[TEMP].ang ANGVAR
							}
						else
							seta[TEMP].ang sprite[].ang
					}
				}
			else
			ifspritepal 1 // If it's spritepal is 1, make it a 'random' interest waypoint
				{
				getactorvar[TEMP].TEMP5 TEMP5 // get scientists 'interest' counter
				ife TEMP5 0 // if it's zero
				 ife INTERNALCOUNT 0 // set delay so it doesn't keep triggering
				 ifrnd 128
					{
					state MOVE_IT_HERE
					set INTERNALCOUNT 128
					geta[].ang TEMP2 // get this actor's angle
					geta[TEMP].ang TEMP3 // get scientist's angle
					setactorvar[TEMP].TEMP3 TEMP3 // store scientist's angle in a temp var
					setactorvar[TEMP].TEMP5 96 // set countdown timer
					seta[TEMP].ang TEMP2 // set scientist to face this actor
					}
				}
			else
			ifspritepal 6 // If it's spritepal is 6, make it a compulsory interest waypoint
				{
				getactorvar[TEMP].TEMP5 TEMP5 // get scientists 'interest' counter
				ife TEMP5 0 // if it's zero
				 ife INTERNALCOUNT 0 // set delay so it doesn't keep triggering
					{
					state MOVE_IT_HERE
					set INTERNALCOUNT 128
					geta[].ang TEMP2 // get this actor's angle
					geta[TEMP].ang TEMP3 // get scientist's angle
					setactorvar[TEMP].TEMP3 TEMP3 // store scientist's angle in a temp var
					setactorvar[TEMP].TEMP5 96 // set countdown timer
					seta[TEMP].ang TEMP2 // set scientist to face this actor
					}
				}
			else
				{
				ifn XVELSAVED 0
					{
					set TEMP3 sprite[].x
					add TEMP3 XVELSAVED
					rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6
					sub TEMP5 sprite[].x
					sub TEMP6 sprite[].y
					getangle ANGVAR TEMP5 TEMP6
					ifvarvarn sprite[TEMP].ang ANGVAR
						{
						seta[TEMP].ang ANGVAR
							ifspritepal 5 
							{
							seta[TEMP].x sprite[].x
							seta[TEMP].y sprite[].y
							seta[TEMP].z sprite[].z
							}
						}
	
					}
				else
					seta[TEMP].ang sprite[].ang
				}
			
		}
resetcount
}

enda

defstate SPAWN_CIV
ifrnd 64
{
espawn 15360

	set TEMP3 sprite[].x
	randvarvar TEMP8 HITAGSAVED
	add TEMP3 TEMP8
	
	geta[].ang TEMP4
	add TEMP4 TEMP3

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
	resetcount
}
ends

useractor notenemy 15614 // civilian spawner
cstat 32768

ifn LOTAGSAVED 0
{
checkactivatormotion LOTAGSAVED
	ife RETURN 1
	   {
	   ife EXTRASAVED 1 globalsound CROWD_PANIC
		killit
		}
}

ifspritepal 0 
{
ifcount 104 state SPAWN_CIV
}
else
ifspritepal 1
{
ifcount 26 state SPAWN_CIV
}
else
ifspritepal 2
{
ifcount 13 state SPAWN_CIV
}
else
ifspritepal 4
{
ifcount 8 state SPAWN_CIV
}

enda

// ===============================================
// TELEPORT PARTICLES
// ===============================================

spriteflags 18574 16

spritenoshade 18574
spritenopal 18574

useractor notenemy 18574
ifaction 0
	{
	sizeat 32 32
	seta[].blend 255
	seta[].cstat 130
	seta[].shade -16
	action ZERO
	}

ifaction ZERO
{
move FLYUP getv
geta[].shade TEMP
add TEMP 1
ifg TEMP 30 killit
seta[].shade TEMP
}
enda

// ===============================================
// ALIEN SKY BLAST
// ===============================================

move UPWARDS 0 -800

spritenoshade 18271
spritenopal 18271
spritenoshade 18273
spritenopal 18273

useractor notenemy 18273
ifaction 0
{
seta[].blend 255
seta[].shade -128
sizeat 128 128
cstat 514
spritepal 8
move UPWARDS getv
action ZERO
}

ifaction ZERO
{
sizeto 1 1

ifceilingdistl 16 killit
ifcount 128 killit

}

enda

useractor notenemy 18271

ifaction 0
{
seta[].shade -128
ifspritepal 3 cstat 32768 else 
	{
	globalsound ALIENSHIP_FIRE
	spritepal 8
	}
sizeat 200 200
ifp pfacing palfrom 20 20 20 20
quake 52
action ZERO
}

ifaction ZERO
{
		ifspritepal 8 spawn 18273
		sound RPG_EXPLODE
		set TEMP3 sprite[].x
		add TEMP3 2048
		randvar TEMP4 2048
		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
		espawn BIG_EXPLOSION
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		espawn BIG_SMOKE2
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set TEMP6 0

ifcount 26
	{ 
	flash 
	spawn NUCLEAR_EXPLOSION
	globalsound EXPLOSION_HUGE
	operateactivators LOTAGSAVED THISACTOR
	operatemasterswitches LOTAGSAVED
	operaterespawns LOTAGSAVED
	killit 
	}
}

enda


// GORO RING OF FIRE===============================================================================================================

spritenoshade 17361
spritenopal 17361

useractor notenemy 17361

ifaction 0
{
sizeat 8 8
seta[].shade -64
cstator 130
seta[].blend 255
}

ifspawnedby APLAYER
{
getp[].posx TEMP
getp[].posy TEMP2
}

add INTERNALCOUNT_2 1
ifg INTERNALCOUNT_2 300 { spawn GORO_FLAME_EX soundonce EXPLOSION_SMALL killit }

set TEMP3 TEMP
add TEMP3 256
ife INTERNALCOUNT 0
	{
	add TEMP7 16
	ifg TEMP7 512
	set INTERNALCOUNT 1
	}
else
ife INTERNALCOUNT 1
	{
	sub TEMP7 16
	ifl TEMP7 16
	set INTERNALCOUNT 0
	}
add TEMP3 TEMP7

rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

add TEMP4 32

ifg TEMP4 2048 sub TEMP4 2048

seta[].x TEMP5 
seta[].y TEMP6
getp[].posz TEMP8
add TEMP8 512
seta[].z TEMP8

   findnearactor3d SHOOTME 768 target ifn target -1 { action ZERO resetcount }
   else ife target -1 findnearactor3d SHOOTME3 768 target ifn target -1 { action ZERO resetcount }
   
ifaction ZERO
	{
	ife target -1 action 0
	getactorvar[target].myowner TEMP8
	seta[TEMP8].htextra 3
	setactorvar[TEMP8].FIRE_DAMAGE 10
	soundonce EXPLOSION_SMALL
	spawn GORO_FLAME_EX
	action 0
	}


enda

// *************************************************
// STARDRIVE
// *************************************************

spritenoshade 15331
spritenopal 15331

useractor notenemy 15331

ifaction 0
	{
	seta[].blend 255
	seta[].shade -120
	sizeat 2 2
	cstat 32768
	ife LOTAGSAVED 0
		{
		// ugly case specific code to stop it interupting radio in micky begins
		ife VOLUME 2 ife LEVEL 42 nullop
		else stopallsounds
		palfrom 32 0 0 32
		globalsound STARDRIVE_WARP
		cstat 1154
		action ZERO
		resetcount
		}
		else
		{
		checkactivatormotion LOTAGSAVED
		 ife RETURN 1
			{
			palfrom 32 0 0 32
			globalsound STARDRIVE_WARP
			cstat 1154
			action ZERO
			resetcount
			}
		}
	}
	
ifaction ZERO
	{
	sizeto 64 64
	ifcount 105
		{
		spawn 8433
		ife HITAGSAVED 15331
			{
			set global_trigger 15330
			}
			else
		ife HITAGSAVED 21695
			{
			set global_trigger 21694
			}
			else
		ifn HITAGSAVED 0 espawnvar HITAGSAVED
		action FORM
		resetcount
		}
	}
	
ifaction FORM
	{
	geta[].shade TEMP
	add TEMP 5
	ifg TEMP 40 killit
	seta[].shade TEMP
	}
	

enda

spritenoshade 15330

useractor notenemy 15330 // Cycloid ship
	ifspawnedby 15331
	 ifaction 0
		{
		seta[].blend 255
		seta[].shade 30
		ife VOLUME 2 ife LEVEL 42 sizeat 128 128 else
		sizeat 32 32
		cstat 130
		action ZERO
		}
		
ifaction ZERO
	{
	geta[].shade TEMP
	sub TEMP 2
	ife TEMP 0 { cstat 128 action FORMED }
	seta[].shade TEMP	
	}
	
ifaction FORMED
	{
	checkactivatormotion 15331
	 ife RETURN 1
		{
		espawn 15331
		setactorvar[RETURN].HITAGSAVED 15331
		action UNFORM
		}
	}
	
ifaction UNFORM
	{
	ife global_trigger 15330
		{
		cstat 130
		action FORM
		set global_trigger 0
		}
	}
	
ifaction FORM
	{
	geta[].shade TEMP
	add TEMP 2
	ife TEMP 30 killit
	seta[].shade TEMP	
	}
		
enda

spritenoshade 21694

useractor notenemy 21694 // EAF ship
ifaction 0
	{
	seta[].blend 255
	ifspawnedby 15331
		{
		seta[].shade 30
		sizeat 32 32
		cstat 130
		action ZERO
		}
		else action FORMED
	}
		
		
ifaction ZERO
	{
	geta[].shade TEMP
	sub TEMP 2
	ife TEMP 0 { cstat 128 action FORMED }
	seta[].shade TEMP	
	}
	
ifaction FORMED
	{
		checkactivatormotion 21694
		 ife RETURN 1
			{
			espawn 15331
			setactorvar[RETURN].HITAGSAVED 21695
			action UNFORM
			}
	}
	
ifaction UNFORM
	{
	ife global_trigger 21694
		{
		cstat 130
		action FORM
		set global_trigger 0
		}
	}
	
ifaction FORM
	{
	geta[].shade TEMP
	add TEMP 2
	ife TEMP 30 killit
	seta[].shade TEMP	
	}
		
enda

// *************************************************
// NEON/MISC ADDITIVE
// *************************************************

defstate ADD_BLEND
ifaction 0 { seta[].blend 255 action ZERO }
ends

useractor notenemy 13035 state ADD_BLEND enda
useractor notenemy 13036 state ADD_BLEND enda
useractor notenemy 13037 state ADD_BLEND enda
useractor notenemy 13038 state ADD_BLEND enda
useractor notenemy 13039 state ADD_BLEND enda
useractor notenemy 18654 state ADD_BLEND enda

useractor notenemy 18333
state ADD_BLEND
enda

useractor notenemy 16292
state ADD_BLEND
enda

useractor notenemy 18473
state ADD_BLEND
enda



spritenoshade 18414
spritenopal 18414

useractor notenemy 18432
state ADD_BLEND
enda

useractor 4 10613
state ADD_BLEND
enda

useractor notenemy 11686
state ADD_BLEND
enda

useractor notenemy 18428
state ADD_BLEND
enda

useractor notenemy 18429
state ADD_BLEND
enda

spritenoshade 18431
spritenopal 18431 
useractor notenemy 18431
state ADD_BLEND
enda

spritenoshade 18427

useractor notenemy 18427
ifaction 0 
	{ 
	seta[].blend 255 
	cstat 34 
	sizeat 64 64 
	seta[].mdflags 16
	set command 256
	action ZERO 
	}

ifaction ZERO
	{
	ife sprite[myowner].statnum 1024 
		{
		action FORM
		}
	}
	
ifaction FORM
	{
	geta[].shade TEMP2
	add TEMP2 2
	ifg TEMP2 35 killit
	seta[].shade TEMP2
	}

enda

spriteflags 15967 84

useractor notenemy 15967
sleeptime 0

ifn HITAGSAVED 0
	{
	seta[].blend 255 
	action ZERO
	checkactivatormotion HITAGSAVED
	ife RETURN 1 killit
	}
else	
ifn LOTAGSAVED 0
	{
	cstat 32768
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 
		{
		seta[].cstat CSTATSAVED
		action ZERO
		}
	}
else
ifaction 0 
	{ 
	seta[].blend 255 
	seta[].mdflags 16
	ifspritepal 3 action FORMED else action ZERO 
	}

ifaction ZERO set command 256
	
ifaction FORMED
	{
	seta[].pal sector[].floorpal
	geta[].ang TEMP
	ifspritepal 2 sub TEMP 8 else
	add TEMP 8
	seta[].ang TEMP
	}

enda

spritenoshade 3375

useractor notenemy 3375 

 ifaction 0
	{
	ifn LOTAGSAVED 0
		{
		sizeat 2 2
		seta[].shade 30
		checkactivatormotion LOTAGSAVED
		 ife RETURN 1
		   {
		   sound FFIELD_ON
		   action FORM
		   }
		}
	}
	
ifaction FORM
	{
	geta[].ang TEMP3
	add TEMP3 256
	seta[].ang TEMP3
	geta[].xrepeat TEMP2
	add TEMP2 2
	seta[].xrepeat TEMP2
	seta[].yrepeat TEMP2
	ifg TEMP2 128
		{
		sizeat 128 128
		seta[].ang TEMP8
		sound SOMETHINGHITFORCE
		setactorsoundpitch THISACTOR SOMETHINGHITFORCE 1024
		action FORMED
		}
	
	geta[].shade TEMP
	ifg TEMP -120
		{
		sub TEMP 2
		seta[].shade TEMP
		}
	}
	
ifaction FORMED
	{
	soundonce FFIELD_IDLE
		checkactivatormotion HITAGSAVED
		 ife RETURN 1
		   {
		   killit
		   }
	}
	
	
	
enda


useractor notenemy 9175 state ADD_BLEND enda
useractor notenemy 16290 state ADD_BLEND enda
useractor notenemy 10037 state ADD_BLEND enda
useractor notenemy 16327 state ADD_BLEND enda

// *************************************************
// MOUNTAIN CODE
// *************************************************

useractor notenemy 18136
cstat 32768

ifcount 600
{
sleeptime 0
espawn 18137

	geta[].x TEMP
	geta[].y TEMP2

	set TEMP3 TEMP
	randvar TEMP8 1536
	add TEMP3 TEMP8
	
	randvar TEMP4 2048

	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6
	geta[].ang TEMP7
	seta[RETURN].ang TEMP7
	resetcount
}

enda

useractor notenemy 18137
fall
ifspawnedby 18136
	{
	sizeat 90 90
	fall
	move TREESPEEDUP geth
	ifnotmoving killit
	} 
enda

// *************************************************
// GHOST SHIP STUFF
// *************************************************

defstate FADE_AWAY
ifcansee
	{
	getp[].i target
	dist xydist THISACTOR target
	shiftvarr xydist 8
	ifl xydist 0 set xydist 0
	add xydist 32
	ifg xydist 255 set xydist 255
	ifpdistl 2548 
		{
		soundonce SHIP_LAUGH
		ifl TEMP4 254 add TEMP4 8
		else killit
		}
	set alpha TEMP4
	
	state SPRITE_FADE
	}
ends

defstate FADE_IN
ifcansee
	{
	getp[].i target
	dist xydist THISACTOR target
	shiftvarr xydist 8
	ifl xydist 0 set xydist 0
	add xydist 32
	ifg xydist 255 set xydist 255
	ifpdistl 2548 
		{
		soundonce SHIP_LAUGH
		ifg TEMP4 0 sub TEMP4 8
		else spritepal 0
		}
	set alpha TEMP4
	
	state SPRITE_FADE
	}
ends

useractor notenemy 7260
ifspritepal 3
	{
	ifaction 0 { cstator 1 set TEMP4 254 action ZERO }
	state FADE_IN
	}
enda

action GHOST_STRIPPER -15282
action GHOST_STRIPPER2 -15277
action GHOST_STRIPPER3 -15269
action GHOST_STRIPPER4 -15199
action GHOST_STRIPPER5 -15199

useractor notenemy 16594
ifspritepal 0 action GHOST_STRIPPER
ifspritepal 3 action GHOST_STRIPPER2
ifspritepal 5 action GHOST_STRIPPER3
ifspritepal 9 action GHOST_STRIPPER4

ifcansee
	{
	ifpdistl 4096
		{
		soundonce SHIP_LAUGH
		ifl TEMP4 254 add TEMP4 8
		else { spawn SKULLEXPLOSION spawn SHADE killit }
		}
	set alpha TEMP4
	
	state SPRITE_FADE
	}

enda

useractor notenemy 16611 state FADE_AWAY enda
useractor notenemy 16612 state FADE_AWAY enda

// KEYPAD #################################################################


// This is defined once and re-used for each of the buttons. 'param' is the digit to enter
defstate enterdigit
{
	ifn pad_id -1 ifl pnum 9999 //hitags can only reach 65536, so we limit entered codes to 5 digits.
	{
		sound KEY_PRESS
		set RETURN -1 //Keep in mind that the buttons we are using are serving double-duty as weapon selection. We only disbale that when we are entering a passcode.
		mulvar pnum 10 // This shifts the passcode over a place value to make room for the new digit
		add pnum param
	}
}
ends

// The actual buttons. Any one should do as long as you set param to the digit and call 'enterdigit'.
onevent EVENT_WEAPKEY10
	set param 0
	state enterdigit
endevent
onevent EVENT_WEAPKEY1
	set param 1
	state enterdigit
endevent
onevent EVENT_WEAPKEY2
	set param 2
	state enterdigit
endevent
onevent EVENT_WEAPKEY3
	set param 3
	state enterdigit
endevent
onevent EVENT_WEAPKEY4
	set param 4
	state enterdigit
endevent
onevent EVENT_WEAPKEY5
	set param 5
	state enterdigit
endevent
onevent EVENT_WEAPKEY6
	set param 6
	state enterdigit
endevent
onevent EVENT_WEAPKEY7
	set param 7
	state enterdigit
endevent
onevent EVENT_WEAPKEY8
	set param 8
	state enterdigit
endevent
onevent EVENT_WEAPKEY9
	set param 9
	state enterdigit
endevent

// this makes reseting the code entry easier.
state clearpad
{
	sound KEY_PRESS
	set pad_id -1
	set pnum 0
}
ends

// Additional Section by Lord Misfit: How to incorporate a "backspace" key to the keypad
onevent EVENT_TURNAROUND
        ifn pad_id -1
        {
         ife pnum 0 // If you hit backspace when the code is 0, you cancel out of the keypad
         {
          state clearpad
         }
         else
         ifg pnum 0 // Else if it's above 0, you divide by 10 to emulate a backspace key
         {
          divvar pnum 10
          ifl pnum 0 { set pnum 0 }
         }
        }
endevent

// Additional Section By Lord Misfit: Displaying the code on the screen as you type it.
// You'll probably need vars for the following...

appendevent EVENT_DISPLAYREST
ifn pad_id -1
{
 ifn pnum -1
 {
  digitalnumber 2837 160 32 pnum 0 0 27 0 0 xdim ydim
 } 
}
endevent

// The hitag of the keypad actor is the passcode, and the lotag should match that of the activator or activator-locked.

useractor notenemy 3609
ifaction 0 { cstat 32768 action ZERO }

ifg INTERNALCOUNT 0 sub INTERNALCOUNT 1
clamp INTERNALCOUNT 0 10

	ifpdistl 1024 ifp pfacing ifhitspace ifcansee ife INTERNALCOUNT 0 // There are lot of conditons on this line. The last one is there to ensure proper timing.
	{
		ife pad_id -1 // enter passcode entering mode
		{
			soundonce COMP_SELECT
			set pad_id THISACTOR
		}
		else ife pad_id THISACTOR
		{
			ife pnum HITAGSAVED // passcode accepted
			{
				operateactivators LOTAGSAVED THISACTOR
				soundonce KEY_ACCEPT
				state clearpad
				killit
			}
			else // passcode rejected (The 'soundonce' and 'quote' statements are optional, and the quote numbers wil likely be different for your mod. )
			{
				soundonce COMP_INVALID
				state clearpad
			}
		}
		set INTERNALCOUNT 10 // This sets a delay between presses of space so that everything doesn't happen at once.
	}
	ife pad_id THISACTOR // this block disengages the player from the keypad when he moves or looks away from it.
	{
		ifpdistg 1024
			state clearpad
		ifp pfacing nullop else
			state clearpad
		ifcansee nullop else
			state clearpad
	}

enda

// *************************************************
// UNDERWORLD STATUE
// *************************************************

spritenoshade 18133
spritenopal 18133

useractor notenemy 18133
ifaction 0
{
cstator 514
seta[].blend 255
action ZERO
}


ifspawnedby 18134 // statues to be destroyed
{
sizeat 4 4
spawn FRAMEEFFECT1
	ifaction ZERO
	{
	geta[myowner].x TEMP
	geta[myowner].y TEMP2

	set TEMP3 TEMP
	add TEMP3 128


				set INTERNALCOUNT player[].player_par
				set INTERNALCOUNT_2 THISACTOR
				ifand INTERNALCOUNT_2 1 add INTERNALCOUNT_2 4096
				add INTERNALCOUNT INTERNALCOUNT_2
				shiftvarl INTERNALCOUNT 6
				sin INTERNALCOUNT_2 INTERNALCOUNT
				shiftvarr INTERNALCOUNT_2 4	
				sub TEMP3 INTERNALCOUNT_2


	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	ifg TEMP4 2048 sub TEMP4 2048

	seta[].x TEMP5 
	seta[].y TEMP6
	geta[myowner].z TEMP8
	sub TEMP8 16384
	seta[].z TEMP8

	ifcount 1 { add TEMP4 32 resetcount }
	ife TEMP9 1 { spawn 8433 sound SPIRIT_RELEASE set INTERNALCOUNT 0 action BREAK }
	}

	ifaction BREAK
	{
	move FLYUP getv
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 60
		{
		spawn 8433
		addphealth 50
		sound SHADOWRM_UNL
		killit
		}
	}
}
else
ifspawnedby 18132 // main lock
{
sizeat 8 8
	ifaction ZERO
	{
	geta[myowner].x TEMP
	geta[myowner].y TEMP2

	set TEMP3 TEMP
	add TEMP3 128

				set INTERNALCOUNT player[].player_par
				set INTERNALCOUNT_2 THISACTOR
				ifand INTERNALCOUNT_2 1 add INTERNALCOUNT_2 4096
				add INTERNALCOUNT INTERNALCOUNT_2
				shiftvarl INTERNALCOUNT 6
				sin INTERNALCOUNT_2 INTERNALCOUNT
				shiftvarr INTERNALCOUNT_2 4	
				sub TEMP3 INTERNALCOUNT_2


	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	ifg TEMP4 2048 sub TEMP4 2048

	seta[].x TEMP5 
	seta[].y TEMP6
	geta[myowner].z TEMP8
	sub TEMP8 18384
	seta[].z TEMP8

	ifcount 1 { add TEMP4 16 resetcount }
	checkactivatormotion TEMP9
	ife RETURN 1 { spawn 8433 sound SPIRIT_RELEASE set INTERNALCOUNT 0 action BREAK }
	}

	ifaction BREAK
	{
	move FLYUP getv
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 60
		{
		spawn 8433
		getactorvar[myowner].INTERNALCOUNT TEMP
		add TEMP 1
		setactorvar[myowner].INTERNALCOUNT TEMP
		sound USE_PORTAL
		killit
		}
	}
}

enda

useractor notenemy 18134
ifaction 0
 ifn HITAGSAVED 0
	{
	geta[].pal TEMP
	strength 100
	espawn 18133
	set TEMP7 RETURN // store id of first sphere
	seta[RETURN].pal TEMP
	setactorvar[RETURN].myowner THISACTOR
	espawn 18133
	set TEMP8 RETURN // store id of second sphere
	seta[RETURN].pal TEMP
	setactorvar[RETURN].myowner THISACTOR
	setactorvar[RETURN].TEMP4 682
	espawn 18133
	set TEMP9 RETURN // store id of third sphere
	seta[RETURN].pal TEMP
	setactorvar[RETURN].myowner THISACTOR
	setactorvar[RETURN].TEMP4 1365
	action ZERO
	}
	
ifaction ZERO
	{
	ifactorsound THISACTOR SMALLST_CHANT nullop else sound SMALLST_CHANT
	ifhitweapon
		{
		sound HITSTONE
		spawn DUSTSMOKE
		ifdead
			{
			stopactorsound THISACTOR SMALLST_CHANT
			sound BUST_CONCRETE
				quake 26
			shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
			shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1 shoot ROCKDEB1
			spawn BIG_SMOKE2 spawn BIG_SMOKE2
			operateactivators HITAGSAVED THISACTOR
			operaterespawns HITAGSAVED
			operatemasterswitches HITAGSAVED
			setactorvar[TEMP7].TEMP9 1
			setactorvar[TEMP8].TEMP9 1
			setactorvar[TEMP9].TEMP9 1
			killit
			}
		}
	}
	
	
enda

useractor notenemy 18132
ifaction 0
 ifn LOTAGSAVED 0
	{
	set INTERNALCOUNT 0
	espawn 18133
	set TEMP7 RETURN // store id of blue sphere
	seta[RETURN].pal 0
	setactorvar[RETURN].myowner THISACTOR
	setactorvar[RETURN].TEMP9 LOTAGSAVED
	espawn 18133
	set TEMP8 RETURN // store id of red sphere
	seta[RETURN].pal 21
	setactorvar[RETURN].myowner THISACTOR
	setactorvar[RETURN].TEMP4 682
	setactorvar[RETURN].TEMP9 HITAGSAVED
	espawn 18133
	set TEMP9 RETURN // store id of green sphere
	seta[RETURN].pal 11
	setactorvar[RETURN].myowner THISACTOR
	setactorvar[RETURN].TEMP4 1365
	setactorvar[RETURN].TEMP9 EXTRASAVED
	action ZERO
	}	
	
ifaction ZERO
	{
	ifactorsound THISACTOR LARGEST_CHANT nullop else sound LARGEST_CHANT
	ife INTERNALCOUNT 3
		{
		stopactorsound THISACTOR LARGEST_CHANT
		globalsound SHADOWRM_UNL
		ifn XVELSAVED 0
			{
			operateactivators XVELSAVED THISACTOR
			operaterespawns XVELSAVED
			operatemasterswitches XVELSAVED
			}
		spawn BIG_SMOKE2 spawn BIG_SMOKE2
		action MINUSONE
		}
	}
	
enda

// *************************************************
// MAGIC FIELD
// *************************************************

spritenoshade 18463
spritenopal 18463

useractor notenemy 18463

ifaction 0
{
ife sprite[].shade 30 action UNFORM else action FORM
}

ifaction FORM
{
checkactivatormotion HITAGSAVED
ife RETURN 1 { seta[].shade 0 globalsound MAGIC_FIELD_DOWN action FORMED }
}

ifaction FORMED
{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 killit
}

ifaction UNFORM
{
cstat 32768
checkactivatormotion LOTAGSAVED
ife RETURN 1 { globalsound MAGIC_FIELD_UP seta[].cstat CSTATSAVED action ZERO }
}

ifaction ZERO
{
geta[].shade TEMP
sub TEMP 1
seta[].shade TEMP
ife TEMP 0 { seta[].shade -127 action FORM }
}

enda

// *************************************************
// thruster
// *************************************************

spritenoshade 16212

useractor notenemy 16212

ifn HITAGSAVED 0
{
seta[].blend 255
ifaction 0 seta[].shade 30
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	action ZERO
	set HITAGSAVED 0
	}
}

ifaction ZERO
{
geta[].shade TEMP
sub TEMP 1
ifl TEMP -50 action FORM
seta[].shade TEMP
}

enda

// *************************************************
// FLAME
// *************************************************

spritenoshade 8694

useractor notenemy 8694
ifspritepal 3
{
	ifaction 0
	{
	sleeptime 0
	set INTERNALCOUNT 0
	action ZERO
	}

	ifaction ZERO
	{
	sleeptime 0
	hitradius 2048 1 8 32 128
	ifpdistl 4096
	 ifcansee    
		{
		soundonce FLESH_BURNING
		getp[].i TEMP4
		getactorvar[TEMP4].FIRE_DAMAGE TEMP5
		ifl TEMP5 1 sound ENGULF_FIRE
		add TEMP5 5
		setactorvar[TEMP4].FIRE_DAMAGE TEMP5
		palfrom 16 16
		}
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 140
		{
		stopsound MC_JETPAKIDLE
		soundonce MC_JETPAKOFF
		geta[].shade TEMP
		add TEMP 4
		seta[].shade TEMP
		ife TEMP 40 { shoot SPARK shoot SPARK shoot SPARK set INTERNALCOUNT 0 action BREAK }
		}
		else
		{ soundonce MC_JETPAKIDLE seta[].shade -16 }
	}

	ifaction BREAK
		{
		add INTERNALCOUNT 1
		ifg INTERNALCOUNT 140
			{
			soundonce MC_JETPAKON
			geta[].shade TEMP
			sub TEMP 4
			seta[].shade TEMP
			ife TEMP -16 { set INTERNALCOUNT 0 action ZERO }
			}
			else
			seta[].shade 40
		}
}
enda

// *************************************************
// JET TRAIL
// *************************************************

spritenoshade 16234

useractor notenemy 16234
ifspritepal 3 break
ifaction 0
{
sleeptime 0
set INTERNALCOUNT 0
action ZERO
}

ifaction ZERO
{
sleeptime 0
hitradius 2048 1 8 32 128
ifpdistl 4096
 ifcansee    
	{
	soundonce FLESH_BURNING
	getp[].i TEMP4
	getactorvar[TEMP4].FIRE_DAMAGE TEMP5
	ifl TEMP5 1 sound ENGULF_FIRE
	add TEMP5 5
	setactorvar[TEMP4].FIRE_DAMAGE TEMP5
    palfrom 16 16
	}
add INTERNALCOUNT 1
ifg INTERNALCOUNT 140
	{
	stopsound MC_JETPAKIDLE
	soundonce MC_JETPAKOFF
	geta[].shade TEMP
	add TEMP 4
	seta[].shade TEMP
	ife TEMP 40 { shoot SPARK shoot SPARK shoot SPARK set INTERNALCOUNT 0 action BREAK }
	}
	else
	{ soundonce MC_JETPAKIDLE seta[].shade -16 }
}

ifaction BREAK
{
add INTERNALCOUNT 1
ifg INTERNALCOUNT 140
	{
	soundonce MC_JETPAKON
	geta[].shade TEMP
	sub TEMP 4
	seta[].shade TEMP
	ife TEMP -16 { set INTERNALCOUNT 0 action ZERO }
	}
	else
	seta[].shade 40
}

enda

// *************************************************
// CRACK
// *************************************************

useractor notenemy 4805

ifn HITAGSAVED 0
{
ifaction 0 cstat 32768
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	seta[].cstat CSTATSAVED
	action ZERO
	set HITAGSAVED 0
	}
}
else
ifspritepal 3
{
ifaction 0 cstat 32768
ifhitweapon
 ifwasweapon RADIUSEXPLOSION
	{
	seta[].cstat CSTATSAVED
	action ZERO
	}
}

enda

// *************************************************
// WOOD PILE
// *************************************************

useractor notenemy 19704

ifn HITAGSAVED 0
{
ifaction 0 cstat 32768
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	seta[].cstat CSTATSAVED
	action ZERO
	set HITAGSAVED 0
	}
}

enda

// *************************************************
// IDLE MECHSUITS
// *************************************************

spriteshadow 19181

useractor notenemy 19181

ifaction 0
	{
	sizeat 64 64
	strength 2000
	action ACAR
	}
	
ifaction ACAR
	{
	ifn LOTAGSAVED 0
		{
		checkactivatormotion LOTAGSAVED
		ife RETURN 1 cactor HPOWERSUIT
		}
	ifn HITAGSAVED 0
		{
		checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			ife TEMP9 0 { resetcount set TEMP9 1 }
			soundonce BLOWUP
			sound RPG_EXPLODE
			set TEMP3 sprite[].x
			add TEMP3 256
			randvar TEMP4 2048
			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
			espawn BIG_EXPLOSION
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			espawn BIG_SMOKE2
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			set TEMP6 0
			readarrayfromfile PLOT_POINTS 4050
			ifn PLOT_POINTS[LOTAGSAVED] 1
				{
				setarray PLOT_POINTS[LOTAGSAVED] 1
				writearraytofile PLOT_POINTS 4050
				}
			ifcount 13 
				{
				debris SCRAP1 40 
				debris SCRAP2 32
				debris SCRAP3 32
				debris SCRAP4 32
				debris SCRAP5 32
				ezshoot 4096 19177
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19177
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19172
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19172
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				killit
				}
			}
		}
	}
	
enda

// BIPOD ACTOR =====================================================

useractor notenemy 3630
ifpdistl 1536
	{
	ifp pjumping 
		{
		setp[].weapon_pos 10
		xorvar GUNFIREMODE 512
		soundonce PUT_ON_EQUIP
		killit
		}
	ifand GUNFIREMODE 512 nullop else killit
	
	geta[].x mx
	geta[].y my
	getp[].posx x
	getp[].posy y
	sub mx x
	sub my y
	getangle ANGVAR mx my
	setp[].ang ANGVAR
	}
ifpdistg 1536
	{
	ifand GUNFIREMODE 512
		{
		setp[].weapon_pos 10
		xorvar GUNFIREMODE 512
		soundonce PUT_ON_EQUIP
		}
	killit
	}
enda

// LOCKED DOOR HOLOGRAMS =====================================================

useractor notenemy 19622

ifaction 0
{
ifn HITAGSAVED 0
	{
	sleeptime 0
	checkactivatormotion HITAGSAVED
	ife RETURN 1 action MINUSTWO
	}
}

enda

useractor notenemy 19626 // ladies holographic sign

ifaction 0
{
spritepal 8
ifpdistl 1536
 ifcansee
  ifp palive
	{
	ifn CHAR 12
	ifn CHAR 10
	ifn CHAR 20
		{
		spritepal 2
		soundonce COMP_INVALID
		action ZERO
		resetcount
		}
	}
}

ifaction ZERO
{
ifcount 30
	{
	action 0
	resetcount
	}
}


enda

useractor notenemy 19627 // mens holographic sign

ifaction 0
{
spritepal 8
ifpdistl 1536
 ifcansee
  ifp palive
	{
	ife CHAR 10
		{
		spritepal 2
		soundonce COMP_INVALID
		action ZERO
		resetcount
		}
	ife CHAR 12
		{
		spritepal 2
		soundonce COMP_INVALID
		action ZERO
		resetcount
		}
	ife CHAR 20
		{
		spritepal 2
		soundonce COMP_INVALID
		action ZERO
		resetcount
		}
	}
}

ifaction ZERO
{
ifcount 30
	{
	action 0
	resetcount
	}
}

enda

useractor notenemy 20111 // subway ticket sign

ifaction 0
{
spritepal 1
ifpdistl 1536
 ifcansee
  ifp palive
	{
	spritepal 2
	soundonce TICKET_PUNCH
	action ZERO
	resetcount
	}
}

ifaction ZERO
{
ifpdistg 1536
	{
	action 0
	resetcount
	}
}

enda


// LASER BEAM SPAWNER =====================================================

spritenoshade 19568
spritenopal 19568

useractor notenemy 19568

ifaction 0
	{
	seta[].blend 255
	ifn EXTRASAVED -1
		{
		ifl SKILL_LEVEL EXTRASAVED killit
		}
	action ZERO
	}
	
ifaction ZERO
	{
	ifn LOTAGSAVED 0
		{
		checkactivatormotion LOTAGSAVED
		ife RETURN 1 killit
		}
	}

enda

spritenoshade 19569
spritenopal 19569

useractor notenemy 19569

ifaction 0
	{
	seta[].blend 255
	ifn EXTRASAVED -1
		{
		ifl SKILL_LEVEL EXTRASAVED killit
		}
	ifn LOTAGSAVED 0
		{
		checkactivatormotion LOTAGSAVED
		ife RETURN 1 killit
		}
	ifcount 3
		{
		eshoot 19570 geta[RETURN].z TEMP add TEMP 1024 seta[RETURN].z TEMP
		resetcount
		}
	}

enda

// INSTANT RESPAWN =====================================================

useractor notenemy 14
cstat 32768
sleeptime 0

checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife EXTRASAVED 1 { globalsound SOMETHINGHITFORCE spawn TRANSPORTERBEAM }
	killit
	}

enda

// *************************************************
// SYSTEM ON OFF TEXT
// *************************************************

useractor notenemy 19575
ifaction 0
	{
	ifn HITAGSAVED 0 action ZERO
	}
	
ifaction ZERO
	{
	sleeptime 0
	checkactivatormotion HITAGSAVED
	 ife RETURN 1
		{
		soundonce RED_COMPBEEP
		action MINUSONE
		}
	}
	
enda

useractor notenemy 19574
ifaction 0
	{
	ifn HITAGSAVED 0 action ZERO
	}
	
ifaction ZERO
	{
	sleeptime 0
	checkactivatormotion HITAGSAVED
	 ife RETURN 1
		{
		soundonce RED_COMPBEEP
		action ONE
		}
	}
	
enda

// *************************************************
// RED CIVILIAN
// *************************************************

useractor notenemy 15455
ifaction 0
	{
	sleeptime 0
	checkactivatormotion HITAGSAVED 
	ife RETURN 1 killit
	}
enda


// *************************************************
// COUNTER
// *************************************************

useractor notenemy 17636
ifaction 0
{
sleeptime 0
cstat 32768
ifn LOTAGSAVED 0 xorvar INTERNALCOUNT 1
ifn HITAGSAVED 0 xorvar INTERNALCOUNT 2
ifn XVELSAVED 0 xorvar INTERNALCOUNT 4
ifn YVELSAVED 0 xorvar INTERNALCOUNT 8
ifn ZVELSAVED 0 xorvar INTERNALCOUNT 16
ifspritepal 3 addlogvar INTERNALCOUNT
action ZERO
}

ifaction ZERO
{
sleeptime 0
ifand INTERNALCOUNT 1
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 { ifand INTERNALCOUNT_2 1 nullop else xorvar INTERNALCOUNT_2 1 }
	}
ifand INTERNALCOUNT 2
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 { ifand INTERNALCOUNT_2 2 nullop else xorvar INTERNALCOUNT_2 2 }
	}
ifand INTERNALCOUNT 4
	{
	checkactivatormotion XVELSAVED
	ife RETURN 1 { ifand INTERNALCOUNT_2 4 nullop else xorvar INTERNALCOUNT_2 4 }
	}
ifand INTERNALCOUNT 8
	{
	checkactivatormotion YVELSAVED
	ife RETURN 1 { ifand INTERNALCOUNT_2 8 nullop else xorvar INTERNALCOUNT_2 8 }
	}
ifand INTERNALCOUNT 16
	{
	checkactivatormotion ZVELSAVED
	ife RETURN 1 { ifand INTERNALCOUNT_2 16 nullop else xorvar INTERNALCOUNT_2 16 }
	}
ife INTERNALCOUNT_2 INTERNALCOUNT
	{
	operateactivators EXTRASAVED THISACTOR
	operaterespawns EXTRASAVED
	operatemasterswitches EXTRASAVED
	killit
	}
}

enda

// CRYSTAL

useractor notenemy 3468 
	state MAKO_RING_ARTIFACT 
	
cstator 1024
	
ifspritepal 11
	{
	ifpdistl 8192
		set near_crystal 30
	}
	
enda

// ===========================================================================
// SCI-FI FIGHTER JET
// ===========================================================================

useractor notenemy 21591

sleeptime 0
ifaction 0 { ifpdistg 32768 action ONE }
ifaction ONE { ifpdistl 32768 action 0 }

enda

// ===========================================================================
// COUCH
// ===========================================================================

useractor notenemy 21599

sleeptime 0
ifaction 0 { cstat 257 action ZERO }
ifaction ZERO { ifpdistg 8192 action FOUR }
ifaction FOUR { ifpdistl 8192 action ZERO }

enda


// ===========================================================================
// FLOOR SHOCK
// ===========================================================================

spritenoshade 18919

useractor notenemy 18919

ifaction 0
	{
	seta[].blend 255
	cstat 32768
	ifn HITAGSAVED 0 action BREAK
	else action ZERO
	}
ifaction BREAK
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 action ZERO
	}
ifaction ZERO
	{
	ifrnd 1
		{
		seta[].cstat CSTATSAVED
		sound SPELL2FIRE
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		action FORM
		resetcount
		}
	}
ifaction FORM
	{
	ifcount 4
		{
		cstat 32768
		action ZERO
		}
	}
	

enda

// *************************************************
// EGYPT STUFF
// *************************************************

useractor notenemy 16864

ifaction 0
{
seta[].blend 255
seta[].shade 30
ifand EGYPT_KEYS 1
	{
	seta[].shade -128
	ifn HITAGSAVED 0
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED	
		}	
	action ZERO
	}
}

enda

useractor notenemy 16866

ifaction 0
{
seta[].blend 255
seta[].shade 30
ifand EGYPT_KEYS 2
	{
	seta[].shade -128
	ifn HITAGSAVED 0
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED	
		}	
	action ZERO
	}
}

enda

useractor notenemy 16868

ifaction 0
{
seta[].blend 255
seta[].shade 30
ifand EGYPT_KEYS 4
	{
	seta[].shade -128
	ifn HITAGSAVED 0
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED	
		}
	action ZERO
	}
}

enda

useractor notenemy 16870

ifaction 0
{
seta[].blend 255
seta[].shade 30
ifand EGYPT_KEYS 8
	{
	seta[].shade -128
	ifn HITAGSAVED 0
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED	
		}	
	action ZERO
	}
}

enda

spritenoshade 16862

useractor notenemy 16862

ifaction 0
{
seta[].shade 10
ifand EGYPT_ARTIFACTS 4
	{
	action ZERO
	seta[].shade -20
	}
else
ifpdistl 1536
 ifp pfacing
  ifcansee
	{
	ifhitspace quote 6905
	}
}

ifaction ZERO
{
ifpdistl 1536
 ifp pfacing
  ifcansee
	{
	set player_use 0
		ifhitspace
			{
			set hit_key 30
			set PLAYER_VOICEOVER 2
			ifspritepal 3 sound CDOOR28
			operateactivators HITAGSAVED THISACTOR
			operaterespawns HITAGSAVED
			operatemasterswitches HITAGSAVED		
			killit
			}
	}
}

enda

// *************************************************
// LIGHT BEAM
// *************************************************


useractor notenemy 7933

ifaction 0
	{
	seta[].mdflags 16
	ifrnd 128
		{
		ifrnd 128 set command 1024 else
		set command 2048
		}
	else
		{
		ifrnd 128 set command 128 else
		set command 256
		}
	action ZERO
	}

enda

// *************************************************
// MANDALA
// *************************************************


useractor notenemy 21223

ifaction 0
	{
	seta[].mdflags 16
	set command 128
	action ZERO
	}

enda

// *************************************************
// BUGATTI
// *************************************************

useractor notenemy 22452

ifspritepal 0
{
ifaction 0
	{
	readgamevar BASE_COSMETICS
	ifand BASE_COSMETICS 1 action ZERO else killit
	}
}

enda

// *************************************************
// SPIKES
// *************************************************

useractor notenemy 22490

ifaction 0
{
cstator 257
strength 100
action ZERO
}

ifpdistl 1024
{
ifp prunning
	{
	addphealth -3
	soundonce STAB
	palfrom 20 20
	getp[].ang TEMP5
	sub TEMP5 1024
	set knockbackang TEMP5
	set knockback 1
	}
}

ifhitweapon
 {
 ifwasweapon RADIUSEXPLOSION
	{
	debris SCRAP1 3
	debris SCRAP2 3
	debris SCRAP3 3
	sound BUST_METAL
	killit
	}
 }

enda

// *************************************************
// UNIVERSITY ADVERT
// *************************************************

spritenoshade 21617

defstate fade_to_black
ifl INTERNALCOUNT 40
	{
	geta[].shade TEMP
	ifg TEMP 0 sub TEMP 1
	seta[].shade TEMP
	}
ends



useractor notenemy 21617

ifhitweapon
	{
	shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2
	sound SHORT_CIRCUIT sound GLASS_BREAKING
	stopsound UNI_ADEL
	soundonce STORE_MUSIC_BROKE
	ife CHAR 13
	 ife NOISE_SAID 0
		{
		setvar PLAYER_VOICEOVER 47
		set NOISE_SAID 1
		}
	lotsofglass 32
	ifrnd 128 cstator 4
	ifrnd 128 cstator 8
	action EIGHTEEN
	}

ifaction 0
{
soundonce UNI_ADEL
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 120
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action ONE
		}
	}
}
ifaction ONE
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 60
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action TWO
		}
	}
}
ifaction TWO
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 60
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action THREE
		}
	}
}
ifaction THREE
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 120
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action FOUR
		}
	}
}
ifaction FOUR
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 60
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action FIVE
		}
	}
}
ifaction FIVE
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 60
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action SIX
		}
	}
}
ifaction SIX
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 60
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action SEVEN
		}
	}
}
ifaction SEVEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 90
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action EIGHT
		}
	}
}
ifaction EIGHT
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 45
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action NINE
		}
	}
}
ifaction NINE
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 45
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action TEN
		}
	}
}
ifaction TEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 45
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action ELEVEN
		}
	}
}
ifaction ELEVEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 90
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action TWELVE
		}
	}
}
ifaction TWELVE
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 60
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action THIRTEEN
		}
	}
}
ifaction THIRTEEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 60
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action FOURTEEN
		}
	}
}
ifaction FOURTEEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 135
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action FIFTEEN
		}
	}
}
ifaction FIFTEEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 90
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action SIXTEEN
		}
	}
}
ifaction SIXTEEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 90
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		set INTERNALCOUNT 0
		action SEVENTEEN
		}
	}
}
ifaction SEVENTEEN
{
add INTERNALCOUNT 1
state fade_to_black
ifg INTERNALCOUNT 90
	{
	geta[].shade TEMP
	add TEMP 1
	seta[].shade TEMP
	ifg TEMP 30 
		{
		stopsound UNI_ADEL
		set INTERNALCOUNT 0
		action 0
		}
	}
}


enda

// ======================================================================================================================
// LIGHT BUG - CODE By Dan 'DeeperThought' Gaskil
// ======================================================================================================================

spritenoshade 23731

move BUGMOVE1 16 -16
move BUGMOVE2 16 16

useractor notenemy 23731 0
ifmove 0
{
	seta[].blend 255
	ife LOTAGSAVED 2
	{
		geta[].sectnum mysector
		seta[].htactorstayput mysector
	}
	action ZERO
	cstat 2
	sizeat 32 32
	move BUGMOVE1 geth getv
	setactorvar[RETURN].myspawner THISACTOR
	geta[].pal pal
	seta[RETURN].pal pal
	set myspawner RETURN

}

sleeptime 0

ifcount 52 ifrnd 64
{
	ifpdistl 1560 move BUGMOVE1 geth getv furthestdir
	else
	iffloordistl 8 move BUGMOVE1 geth getv randomangle else
	ifceilingdistl 16 move BUGMOVE2 geth getv randomangle
	else
	ifrnd 128 move BUGMOVE1 geth getv randomangle 
	else
	move BUGMOVE2 geth getv randomangle
	ifrnd 128 set mtype 1 else set mtype 0
}

geta[].ang TEMP
ife mtype 0 add TEMP 16 else sub TEMP 16
seta[].ang TEMP
enda

// ===================================================================================================
// CYCLOID EGG SPAWNER
// ======================================================================================================================

useractor notenemy 23447

ifaction 0
{
sizeat 40 40
cstat 257
ifrnd 160 { strength 5 action ONE }
else { strength TOUGH action ZERO }
}

move FLYSLOW geth
ifnotmoving killit
ifg sprite[].z sector[].floorz killit

    ifhitweapon
    {
	guts JIBS6 1
	ifdead
		{
		state squish_sounds
		spritepal 7
        state standard_jibs
        killit
		}
    }

enda

useractor notenemy 23448

ifaction 0
	{
	cstat 32768
	action ONE
	resetcount
	}

ifaction ONE
	{
	ifcount 70
		{
		ifrnd 128 spawn 23447
		resetcount
		}
	}

enda

// =================================================================================================================================
// egg scanner stuff
// =================================================================================================================================

action ERROR -3818

gamearray EGG_SCANNER 8

useractor notenemy 23449
ifaction 0
{
ifspritepal 64 break
cstat 32768
ife EGG_SCANNER[LOTAGSAVED] 1 { sound RED_COMPBEEP setactorsoundpitch THISACTOR RED_COMPBEEP 512 action ZERO }
else ife EGG_SCANNER[LOTAGSAVED] 2 { sound RED_COMPBEEP action ONE }
else ife EGG_SCANNER[LOTAGSAVED] 3 { sound RED_COMPBEEP action ERROR }
}

ifaction ZERO
{
spritepal 0
cstat 514
ife EGG_SCANNER[LOTAGSAVED] 0 action 0
}

ifaction ONE
{
spritepal 2
cstat 514
ife EGG_SCANNER[LOTAGSAVED] 0 action 0
}

ifaction ERROR
{
spritepal 2
cstat 514
ife EGG_SCANNER[LOTAGSAVED] 0 action 0
}

enda

useractor notenemy 23450

ifaction 0
{
cstat 32768
action ZERO
}

ifaction ZERO
{
ifcount 8
	{
	findnearactor3d 23447 512 TEMP2
	ifn TEMP2 -1
		{
		ife sprite[TEMP2].htdispicnum 23447
			{
			ifspritepal 0 setarray EGG_SCANNER[0] 1
			ifspritepal 1 setarray EGG_SCANNER[1] 1
			ifspritepal 2 setarray EGG_SCANNER[2] 1
			ifspritepal 3 setarray EGG_SCANNER[3] 1
			}
		else ife sprite[TEMP2].htdispicnum 23448
			{
			ifspritepal 0 setarray EGG_SCANNER[0] 2
			ifspritepal 1 setarray EGG_SCANNER[1] 2
			ifspritepal 2 setarray EGG_SCANNER[2] 2
			ifspritepal 3 setarray EGG_SCANNER[3] 2
			}
		}
	else ife TEMP2 -1 
			{
			ifpdistl 512
				{
				ifspritepal 0 setarray EGG_SCANNER[0] 3
				ifspritepal 1 setarray EGG_SCANNER[1] 3
				ifspritepal 2 setarray EGG_SCANNER[2] 3
				ifspritepal 3 setarray EGG_SCANNER[3] 3
				}
			else
				{
				ifspritepal 0 setarray EGG_SCANNER[0] 0
				ifspritepal 1 setarray EGG_SCANNER[1] 0
				ifspritepal 2 setarray EGG_SCANNER[2] 0
				ifspritepal 3 setarray EGG_SCANNER[3] 0
				}
			}
	}
}

enda

// =================================================================================================================================
// Egypt key scanner
// =================================================================================================================================

spritenoshade 23738

useractor notenemy 23738

ifaction 0
{
seta[].blend 255
seta[].shade 30
ife EGYPT_KEYS 15
	{
	seta[].shade -127
	action ZERO
	}
}
ifaction ZERO
{
geta[].ang TEMP2
ifspritepal 9 sub TEMP2 2 else add TEMP2 2
seta[].ang TEMP2
ifpdistl 2048
ifspritepal 3
 ifn global_trigger 1
	{
	operateactivators 988 THISACTOR
	palfrom 64 64 64 64
	quake 52
	globalsound USE_PORTAL
	stopallmusic
	set global_trigger 1
	}
}

enda

spritenoshade 23742

useractor notenemy 23742

ifaction 0
{
seta[].blend 255
seta[].shade 30
ife global_trigger 1
	{
	seta[].shade -127
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	action ZERO
	}
}
ifaction ZERO
{
soundonce PORTAL_AMBIENCE
ifpdistl 2048
 ifspritepal 3
	{
	operateactivators 989 THISACTOR
	globalsound LONGD_TELEPORT
	killit
	}
}

enda

// ======================================================================================================================
// REAPER DRONE
// ======================================================================================================================

useractor notenemy 23780

ifaction 0
{
ifspritepal 3 action FORM else
	{
	geta[].x TEMP
	geta[].y TEMP2
	angoff 512
	action ZERO
	}
}

ifaction ZERO
{

	// geta[].ang TEMP9
	set TEMP3 TEMP
	add TEMP3 2048

	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP9 TEMP5 TEMP6
		
	// add TEMP9 512
	ifg TEMP9 2048 sub TEMP9 2048
	seta[].ang TEMP9
	seta[].x TEMP5
	seta[].y TEMP6		

		
	add TEMP9 2
}

enda

// *************************************************
// METAL BARRIER
// *************************************************

useractor notenemy 3481

ifaction 0
{
cstator 257
strength 300
action ZERO
}

ifaction ZERO
ifspritepal 3
{
findnearactor MADRAX 1024 TEMP
ifn TEMP -1 
	{
	debris SCRAP1 12
	debris SCRAP2 12
	sound BUST_METAL
	sound VENT_BUST
	killit
	}
}

ifhitweapon
{
ifdead
	{
	debris SCRAP1 12
	debris SCRAP2 12
	sound BUST_METAL
	sound VENT_BUST
	cactor 3482
	}
}

enda

useractor notenemy 3482

ifaction 0
{
ifspritepal 5 break
cstator 257
strength 300
action ZERO
}

ifaction ZERO
ifspritepal 3
{
findnearactor MADRAX 1024 TEMP
ifn TEMP -1 
	{
	debris SCRAP1 12
	debris SCRAP2 12
	sound BUST_METAL
	sound VENT_BUST
	killit
	}
}

ifhitweapon
{
ifdead
	{
	debris SCRAP1 12
	debris SCRAP2 12
	sound BUST_METAL
	sound VENT_BUST
	killit
	}
}

enda

// *************************************************
// TRAIN
// *************************************************

useractor notenemy 15
ifaction 0
{
setsector[].extra 0
spriteflags 163840
ife LOTAGSAVED 0 set LOTAGSAVED 5
cstat 32768
action ZERO
}

ifaction ZERO
{

	getsector[].extra TEMP
	ifn TEMP 0
	{
	ifactorsound THISACTOR SUBWAY_S nullop else sound SUBWAY_S
	setactorsoundpitch THISACTOR SUBWAY_S TEMP
	ifg TEMP 0 sub TEMP 2
	ifl TEMP 0 add TEMP 2
	ife TEMP 30 { stopsound SUBWAY_S soundonce SUBTRAIN_STOP }
	setsector[].extra TEMP
	}

ifpdistl 2048
 ifp palive
  ife player_using_train -1
	{
	set player_use 0
	 ifhitspace
	  ifcount 13
		{
		sound TRAIN_ACTIVATE
		set hit_key 30
		set hc_gear 0
		set player_using_train 0
		action FORM
		resetcount
		}
	}
}

ifaction FORM
{
		setp[].cursectnum sprite[].sectnum
		setp[].posx sprite[].x
		setp[].posy sprite[].y
		
ife MISSIONUP 0
ifand EXTBITS_PRESS 1
 ifcount 13
  ifl hc_gear LOTAGSAVED
	{
	sound TRAIN_GEAR
	add hc_gear 1
	resetcount
	}
	
ife MISSIONUP 0
ifand EXTBITS_PRESS 2
 ifcount 13
  ifg hc_gear -1
	{
	sound TRAIN_GEAR
	sub hc_gear 1
	resetcount
	}
	
getsector[].extra TEMP
	
ifn hc_gear 0
{
ifactorsound THISACTOR SUBWAY_S nullop else sound SUBWAY_S
setactorsoundpitch THISACTOR SUBWAY_S TEMP
}
	
ife hc_gear -1
	{
	ifg TEMP -64 sub TEMP 2
	ife TEMP 32 { stopsound SUBWAY_S soundonce SUBTRAIN_STOP }
	sets[].extra TEMP
	}
ife hc_gear 0 
	{
	ifg TEMP 0 sub TEMP 2
	ifl TEMP 0 add TEMP 2
	ife TEMP 30 { stopsound SUBWAY_S soundonce SUBTRAIN_STOP }
	setsector[].extra TEMP
	}
else ife hc_gear 1
	{
	ifl TEMP 32 add TEMP 2
	ifl TEMP 32 { stopsound SUBWAY_S soundonce SUBTRAIN_START } 
	ifg TEMP 32 sub TEMP 2
	sets[].extra TEMP
	}
else ife hc_gear 2
	{
	ifl TEMP 64 add TEMP 2
	ifg TEMP 64 sub TEMP 2
	sets[].extra TEMP
	}
else ife hc_gear 3
	{
	ifl TEMP 128 add TEMP 2
	ifg TEMP 128 sub TEMP 2
	sets[].extra TEMP
	}
else ife hc_gear 4
	{
	ifl TEMP 256 add TEMP 2
	ifg TEMP 256 sub TEMP 2
	sets[].extra TEMP
	}
else ife hc_gear 5
	{
	ifl TEMP 512 add TEMP 2
	sets[].extra TEMP
	}
	
clamp TEMP -64 512
	
clamp hc_gear -1 5
	
		
ifpdistl 2048
 ifp palive
  ife player_using_train 0
	{
	 ifhitspace
	  ifcount 13
		{
		set hc_gear 0
		sound TRAIN_ACTIVATE
		set player_using_train -1
		action ZERO
		resetcount
		}
	}
}

enda

// *************************************************
// CHAOSPHERE
// *************************************************

useractor notenemy 21213

ifaction 0
	{
	ifspritepal 3 nullop
	else
		{
		ifand BEAT_EPISODES[3] 262144 nullop else
		killit
		}
	action ZERO
	}

enda

// *************************************************
// AIRSTRIKE STUFF
// *************************************************

useractor notenemy REAPER_CONTROLBOX
ifaction 0
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	action ZERO
	}
}

ifaction ZERO
{
ifpdistl 1536
 ifp pfacing
	  {
	  set player_use 0
	   ifhitspace
			{
			set hit_key 30
			globalsound RED_COMPBEEP
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			action FORMED
			}
	  }
}

enda

useractor notenemy ASTRIKE_PLACE_HERE

ifaction 0 
	{
	sizeat 128 128
	cstat 32768
	action MINUSONE
	}

ifaction MINUSONE
	{
	ifpdistl 8192
	 ifg AIRSTRIKE_MARKER 0
	 {
	 cstat 514
	 spritepal 2
	 }
	 else
	 cstat 32768
	 
	ifpdistl 1536
	 ifp pfacing
		 {
		 set player_use 0
		  ifhitspace
		   ifcount 13
			  {
			  set hit_key 30
			  ife AIRSTRIKE_MARKER 0 quote 185
			  else ifg AIRSTRIKE_MARKER 0 
					{ 
					setp[].weapon_pos 10
					set TEMP2 0
					sizeat 64 64
					globalsound C4_ATTACH
					set PLAYER_VOICEOVER 24
					sub AIRSTRIKE_MARKER 1
					cstat 0
					spritepal 0
					action FORMED
					ifn HITAGSAVED 0
						{
						operateactivators HITAGSAVED THISACTOR
						operaterespawns HITAGSAVED
						operatemasterswitches HITAGSAVED
						}
					}
			  resetcount
			  }
		}
	}
	
ifaction FORMED
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1 killit
	}


enda

// *************************************************
// HIDE WHEN SKYBOX IS ON
// *************************************************

useractor notenemy 22722

ife skybox 0 { seta[].cstat CSTATSAVED } else cstat 32768 

enda

// *************************************************
// VELVET ROPE
// *************************************************

useractor notenemy 18349
ifaction 0
	{
	ife LOTAGSAVED 0
		{
		ifpdistl 1024
		 ifp prunning
			{
			sound VELV_SNAP
			cstat 32
			randvar TEMP 2048
			setactor[].z sector[].floorz
			seta[].ang TEMP
			action ZERO
			}
		ifcount 30
			{
			findnearactor SHOOTME2 1536 TEMP
			ifn TEMP -1
				{
				sound VELV_SNAP
				cstat 32
				randvar TEMP 2048
				setactor[].z sector[].floorz
				seta[].ang TEMP
				action ZERO
				}
			resetcount
			}
		}
	}
enda

// *************************************************
// RADIO CONTACT - will expand over time
// *************************************************

useractor notenemy 3246
cstat 32768
ifspritepal 0 set RADIO_CONTACT 1 else ifspritepal 2 set RADIO_CONTACT 0
enda

// *************************************************
// Shrink grate
// *************************************************

useractor notenemy 23558

ifaction 0
	{
	ifand sprite[].cstat 32 
		{
		ifp pshrunk cstat 32 else cstat 33
		}
		else
		action ZERO
	}

enda


